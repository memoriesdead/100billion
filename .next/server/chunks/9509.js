"use strict";exports.id=9509,exports.ids=[9509],exports.modules={39509:(e,t,r)=>{r.d(t,{Z:()=>w});var s=r(60687),o=r(43210),a=r.n(o),i=r(16189);r(66464);var n=r(18780),l=r(32584),c=r(85535),u=r(11516),d=r(19379),f=r(19422),m=r(73875),p=r(1833),x=r(46569),b=r(96834),h=r(29523),v=r(37590);let g=(0,r(39010).c)(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY),j=(e,t="usd")=>new Intl.NumberFormat("en-US",{style:"currency",currency:t.toUpperCase()}).format(e/100);function y({id:e,username:t,verified:r,profilePictureUrl:a,caption:y,videoSrc:w,posterSrc:k,likes:N,comments:C,shares:I,isPrivate:P,isOwner:S,userId:E,is_for_sale:z,price:U,currency:A,isLocked:L}){let{user:T}=(0,o.useContext)(n.cy),B=(0,i.useRouter)(),R=(0,o.useRef)(null),V=(0,o.useRef)(null),[$,_]=(0,o.useState)(null),[D,F]=(0,o.useState)(!1),[O,K]=(0,o.useState)(null),[M,W]=(0,o.useState)(!1),[q,H]=(0,o.useState)(!0),[J,X]=(0,o.useState)(0),[Y,Z]=(0,o.useState)(0),[G,Q]=(0,o.useState)(!1),ee=z&&!S||L&&!S,et=z&&!S,er=(0,o.useCallback)(()=>{if(console.log("Video area clicked"),ee)return;let e=R.current;e&&(e.paused||e.ended?e.play().catch(e=>console.error("Play error:",e)):e.pause())},[ee]),es=(0,o.useCallback)(()=>{if(ee)return;let e=R.current;e&&(e.muted=!e.muted,H(e.muted))},[ee]),eo=(0,o.useCallback)(()=>{if(ee)return;let e=R.current;e&&Y&&X(e.currentTime/Y*100)},[Y,ee]),ea=(0,o.useCallback)(()=>{if(ee)return;let e=R.current;e&&Z(e.duration)},[ee]),ei=(0,o.useCallback)(async()=>{if(!T)return void v.oR.error("Please log in to purchase.");if(!e||!z||!U||U<=0)return void v.oR.error("Item not purchasable.");Q(!0);try{let t=await fetch("/api/stripe/create-item-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:e})}),r=await t.json();if(!t.ok)throw Error(r.error||"Failed to create session");if(!r.sessionId)throw Error("Session ID missing");let s=await g;if(!s)throw Error("Stripe.js failed");let{error:o}=await s.redirectToCheckout({sessionId:r.sessionId});if(o)throw Error(o.message)}catch(e){v.oR.error(`Purchase failed: ${e instanceof Error?e.message:"Unknown error"}`),Q(!1)}},[T,e,z,U]);return(0,s.jsx)("div",{ref:V,className:"relative w-full h-full bg-black flex items-center justify-center overflow-hidden group",children:ee?(0,s.jsxs)("div",{className:"w-full h-full bg-black flex flex-col items-center justify-center text-white relative p-4",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center z-10",children:[(0,s.jsx)(c.A,{size:48,className:"mb-3 opacity-80"}),(0,s.jsx)("span",{className:"text-lg font-semibold mb-1",children:et?"Purchase to View":"Subscribe to View"}),et&&U&&(0,s.jsxs)(b.E,{variant:"secondary",className:"text-sm font-bold cursor-default mb-4",children:[j(U,A??void 0)," "]})]}),et&&(0,s.jsxs)(h.$,{variant:"default",size:"sm",className:"mt-4 h-9 px-5 text-sm bg-pink-600 hover:bg-pink-700 text-white rounded-full absolute bottom-16 left-1/2 transform -translate-x-1/2 z-20",onClick:ei,disabled:G||!T,"aria-label":`Buy for ${j(U??0,A??void 0)}`,children:[G?(0,s.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(d.A,{className:"mr-2 h-4 w-4"}),G?"Processing...":"Buy"]})]}):(0,s.jsxs)(s.Fragment,{children:[D&&(0,s.jsx)("div",{className:"text-white absolute z-10",children:"Loading..."}),O&&(0,s.jsx)("div",{className:"text-red-500 absolute z-10 p-4 text-center",children:O}),(0,s.jsx)("video",{ref:R,src:$??void 0,poster:k,className:`w-full h-full object-contain ${!$||D||O?"invisible":""}`,playsInline:!0,loop:!0,muted:q,onClick:er,onPlay:()=>W(!0),onPause:()=>W(!1),onLoadedMetadata:ea,onTimeUpdate:eo,onError:t=>console.error(`Video Error (ID: ${e}):`,t.target.error)},$),!M&&$&&!D&&!O&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-auto z-10",children:(0,s.jsx)("button",{onClick:er,className:"p-4 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors","aria-label":"Play",children:(0,s.jsx)(f.A,{size:60,fill:"currentColor"})})}),$&&!D&&!O&&(0,s.jsx)("button",{onClick:es,className:"absolute bottom-4 right-4 p-2 bg-black/40 rounded-full text-white z-20 pointer-events-auto","aria-label":q?"Unmute":"Mute",children:q?(0,s.jsx)(m.A,{size:18}):(0,s.jsx)(p.A,{size:18})}),(0,s.jsxs)("div",{className:"absolute inset-x-0 bottom-0 z-10 pointer-events-none bg-gradient-to-t from-black/60 via-black/30 to-transparent",children:[(0,s.jsxs)("div",{className:"p-4 flex justify-between items-end pointer-events-auto",children:[" ",(0,s.jsxs)("div",{className:"text-white max-w-[calc(100%-80px)]",children:[" ",(0,s.jsxs)("div",{className:"flex items-center gap-1.5 group cursor-pointer",onClick:e=>{console.log("Bottom-left profile clicked, navigating to OWN profile"),e.preventDefault(),e.stopPropagation(),B.push("/profile")},"aria-label":`View profile of ${t}`,role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),B.push("/profile"))},children:[(0,s.jsxs)(l.eu,{className:"h-7 w-7 border border-gray-600 group-hover:scale-110 transition-transform",children:[(0,s.jsx)(l.BK,{src:a??void 0,alt:t??"User profile"}),(0,s.jsx)(l.q5,{children:t?.charAt(0).toUpperCase()??"U"})]}),(0,s.jsxs)("span",{className:"font-bold text-sm hover:underline",children:["@",t]})]}),z&&!ee&&U&&(0,s.jsxs)(b.E,{variant:"secondary",className:"mt-1 text-xs font-semibold cursor-default bg-green-600 hover:bg-green-700 text-white",children:["For Sale: ",j(U,A??void 0)," "]})]}),(0,s.jsx)(x.M,{postId:e,userId:E,username:t,profilePictureUrl:a??void 0,initialLikes:parseInt(N,10)||0,initialIsLiked:!1,commentsCount:C,sharesCount:I,initialIsPrivate:P??!1,postType:"video",isOwner:S??!1,videoCaption:y??void 0,is_for_sale:z,price:U,currency:A})]})," "]})," "]})})}let w=a().memo(function(e){return(0,s.jsx)(y,{...e})});w.displayName="ClientVideoPlayerWrapper"},96834:(e,t,r)=>{r.d(t,{E:()=>n});var s=r(60687);r(43210);var o=r(24224),a=r(4780);let i=(0,o.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n({className:e,variant:t,...r}){return(0,s.jsx)("div",{className:(0,a.cn)(i({variant:t}),e),...r})}}};