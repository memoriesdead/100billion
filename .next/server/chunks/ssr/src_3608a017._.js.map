{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,CAAA,GAAA,2JAAA,CAAA,UAAO,AAAD,EAAE,CAAA,GAAA,qIAAA,CAAA,OAAI,AAAD,EAAE;AACtB","debugId":null}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/avatar.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Avatar = React.forwardRef<\r\n  React.ElementRef<typeof AvatarPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\r\n>(({ className, ...props }, ref) => (\r\n  <AvatarPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nAvatar.displayName = AvatarPrimitive.Root.displayName\r\n\r\nconst AvatarImage = React.forwardRef<\r\n  React.ElementRef<typeof AvatarPrimitive.Image>,\r\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\r\n>(({ className, ...props }, ref) => (\r\n  <AvatarPrimitive.Image\r\n    ref={ref}\r\n    className={cn(\"aspect-square h-full w-full\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\r\n\r\nconst AvatarFallback = React.forwardRef<\r\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\r\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\r\n>(({ className, ...props }, ref) => (\r\n  <AvatarPrimitive.Fallback\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\r\n\r\nexport { Avatar, AvatarImage, AvatarFallback }\r\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,uBAAS,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,kKAAA,CAAA,OAAoB;QACnB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,iEACA;QAED,GAAG,KAAK;;;;;;AAGb,OAAO,WAAW,GAAG,kKAAA,CAAA,OAAoB,CAAC,WAAW;AAErD,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,kKAAA,CAAA,QAAqB;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,+BAA+B;QAC5C,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG,kKAAA,CAAA,QAAqB,CAAC,WAAW;AAE3D,MAAM,+BAAiB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGpC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,kKAAA,CAAA,WAAwB;QACvB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,wEACA;QAED,GAAG,KAAK;;;;;;AAGb,eAAe,WAAW,GAAG,kKAAA,CAAA,WAAwB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/PostInteractionButtons.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useCallback, useContext } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation'; // Keep useRouter import\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport { AuthContext } from '@/context/AuthContext';\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\n// Use Font Awesome icons for closer match to original screenshot\r\nimport { FaHeart, FaCommentDots, FaShare } from \"react-icons/fa\";\r\nimport { Lock, Unlock, ShoppingCart, Loader2 } from 'lucide-react'; // Keep Lock/Unlock for internal logic if needed elsewhere, but remove from UI stack\r\nimport { toast } from 'sonner';\r\nimport { Button } from '@/components/ui/button';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { Eye } from 'lucide-react'; // Import Eye icon for views\r\n\r\n// Initialize Stripe outside the component\r\nconst stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!);\r\n\r\ninterface PostInteractionButtonsProps {\r\n  postId: string;\r\n  userId: string; // ID of the post owner\r\n  // onProfileClick prop removed\r\n  username: string;\r\n  profilePictureUrl?: string;\r\n  initialLikes: number;\r\n  initialIsLiked: boolean;\r\n  commentsCount: string;\r\n  sharesCount: string;\r\n  viewsCount?: number | string; // Add optional viewsCount prop\r\n  initialIsPrivate: boolean;\r\n  isOwner: boolean;\r\n  videoCaption?: string;\r\n  postType: 'video' | 'image';\r\n  variant?: 'default' | 'compact'; // Add variant prop\r\n  is_for_sale: boolean;\r\n  price?: number | null;\r\n  currency?: string | null;\r\n  onLikeSuccess?: (newLikesCount: number) => void;\r\n}\r\n\r\n export function PostInteractionButtons({\r\n   postId,\r\n   userId,\r\n   username,\r\n   profilePictureUrl,\r\n   initialLikes,\r\n   initialIsLiked,\r\n   commentsCount,\r\n   sharesCount,\r\n   initialIsPrivate,\r\n   isOwner,\r\n   videoCaption,\r\n   postType,\r\n   is_for_sale,\r\n   price,\r\n   currency,\r\n   onLikeSuccess,\r\n   viewsCount, // Destructure viewsCount\r\n   variant = 'default', // Destructure variant, default to 'default'\r\n }: PostInteractionButtonsProps) {\r\n   const router = useRouter();\r\n   const { user: loggedInUser } = useContext(AuthContext);\r\n   const [isLiked, setIsLiked] = useState(initialIsLiked);\r\n   const [currentLikes, setCurrentLikes] = useState(initialLikes);\r\n   const [currentIsPrivate, setCurrentIsPrivate] = useState(initialIsPrivate);\r\n   const [isUpdatingPrivacy, setIsUpdatingPrivacy] = useState(false);\r\n   const [isCheckoutLoading, setIsCheckoutLoading] = useState(false);\r\n\r\n   // --- Like Handler ---\r\n   const handleLike = useCallback(async () => {\r\n     if (!loggedInUser) {\r\n       toast.info(\"Please log in to like posts.\");\r\n       return;\r\n     }\r\n     const originalLiked = isLiked;\r\n     const originalLikesCount = currentLikes;\r\n     const newLikedStatus = !isLiked;\r\n     const newLikesCount = newLikedStatus ? currentLikes + 1 : currentLikes - 1;\r\n\r\n     setIsLiked(newLikedStatus);\r\n     setCurrentLikes(newLikesCount);\r\n\r\n     try {\r\n       if (newLikedStatus) {\r\n         const { error } = await supabase.from('likes').insert({ user_id: loggedInUser.id, post_id: postId });\r\n         if (error) throw error;\r\n       } else {\r\n         const { error } = await supabase.from('likes').delete().match({ user_id: loggedInUser.id, post_id: postId });\r\n         if (error) throw error;\r\n       }\r\n       onLikeSuccess?.(newLikesCount);\r\n     } catch (error: unknown) {\r\n       const message = error instanceof Error ? error.message : String(error);\r\n       setIsLiked(originalLiked);\r\n       setCurrentLikes(originalLikesCount);\r\n       toast.error(\"Failed to update like status.\");\r\n       console.error('[InteractionButtons] Error updating like status:', message); // Use the extracted message\r\n     }\r\n   }, [loggedInUser, postId, isLiked, currentLikes, onLikeSuccess]);\r\n\r\n   // --- Share Handler ---\r\n   const handleShare = useCallback(async () => {\r\n     const shareData = {\r\n       title: `Check out this post by @${username}!`,\r\n       text: videoCaption || `Check out this post by @${username}!`,\r\n       url: postType === 'video'\r\n          ? `${window.location.origin}/video/${postId}`\r\n          : `${window.location.origin}/image/${postId}`,\r\n     };\r\n     try {\r\n       if (navigator.share) {\r\n         await navigator.share(shareData);\r\n       } else {\r\n         await navigator.clipboard.writeText(shareData.url);\r\n         toast.success(\"Link copied to clipboard!\");\r\n       }\r\n     } catch (error) {\r\n       console.error('Error sharing:', error);\r\n       if ((error as DOMException).name !== 'AbortError') {\r\n         toast.error(\"Could not share post.\");\r\n       }\r\n     }\r\n   }, [postId, username, videoCaption, postType]);\r\n\r\n   // --- Privacy Toggle Handler ---\r\n   const handleTogglePrivacy = useCallback(async () => {\r\n     if (!isOwner || isUpdatingPrivacy || !loggedInUser) {\r\n       if (!loggedInUser) toast.error(\"You must be logged in.\");\r\n       return;\r\n     }\r\n     setIsUpdatingPrivacy(true);\r\n     const originalIsPrivate = currentIsPrivate;\r\n     const newIsPrivate = !currentIsPrivate;\r\n     setCurrentIsPrivate(newIsPrivate); // Optimistic update\r\n\r\n     try {\r\n       const { error } = await supabase\r\n         .from('posts')\r\n         .update({ is_private: newIsPrivate })\r\n         .eq('id', postId)\r\n         .eq('user_id', loggedInUser.id);\r\n       if (error) throw error;\r\n       toast.success(`Post set to ${newIsPrivate ? 'Private' : 'Public'}`);\r\n     } catch (error: unknown) {\r\n       const message = error instanceof Error ? error.message : String(error);\r\n       setCurrentIsPrivate(originalIsPrivate); // Revert on error\r\n       toast.error(\"Failed to update privacy status.\");\r\n       console.error('Error updating privacy status:', message);\r\n     } finally {\r\n       setIsUpdatingPrivacy(false);\r\n     }\r\n   }, [isOwner, isUpdatingPrivacy, loggedInUser, postId, currentIsPrivate]);\r\n\r\n   // --- Purchase Handler ---\r\n   const handlePurchase = useCallback(async () => {\r\n     if (!loggedInUser) {\r\n       toast.info(\"Please log in to purchase items.\");\r\n       return;\r\n     }\r\n     if (!postId || !is_for_sale || !price || price <= 0) {\r\n       toast.error(\"This item cannot be purchased currently.\");\r\n       return;\r\n     }\r\n     setIsCheckoutLoading(true);\r\n     try {\r\n       const response = await fetch('/api/stripe/create-item-checkout-session', {\r\n         method: 'POST',\r\n         headers: { 'Content-Type': 'application/json' },\r\n         body: JSON.stringify({ postId }),\r\n       });\r\n       const sessionData = await response.json();\r\n       if (!response.ok) throw new Error(sessionData.error || 'Failed to create checkout session');\r\n       if (!sessionData.sessionId) throw new Error('Session ID not received from server');\r\n       const stripe = await stripePromise;\r\n       if (!stripe) throw new Error('Stripe.js failed to load.');\r\n       const { error: stripeError } = await stripe.redirectToCheckout({ sessionId: sessionData.sessionId });\r\n       if (stripeError) throw new Error(stripeError.message);\r\n     } catch (error) {\r\n       console.error('Purchase initiation error:', error);\r\n       toast.error(`Failed to initiate purchase: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n     } finally {\r\n       setIsCheckoutLoading(false);\r\n     }\r\n    }, [loggedInUser, postId, is_for_sale, price]);\r\n\r\n    const PrivacyIcon = currentIsPrivate ? Lock : Unlock;\r\n\r\n   // Determine container classes based on is_for_sale\r\n   const containerClasses = is_for_sale\r\n     ? \"absolute top-4 right-4 z-20 pointer-events-auto\" // Top-right for sale items\r\n     : \"absolute bottom-12 right-3 z-20 flex flex-col items-center space-y-1 pointer-events-auto\";\r\n\r\n   // Simplified rendering logic based on variant\r\n   if (variant === 'compact') {\r\n     // Render only views count if available\r\n     return (\r\n       <div className={containerClasses}>\r\n         {typeof viewsCount !== 'undefined' && (\r\n           <div className=\"flex flex-col items-center text-white\">\r\n             <div className=\"w-10 h-10 bg-black/40 rounded-full flex items-center justify-center mb-1\">\r\n               <Eye size={24} />\r\n             </div>\r\n             <span className=\"text-xs font-semibold\">{viewsCount}</span>\r\n           </div>\r\n         )}\r\n       </div>\r\n     );\r\n   }\r\n\r\n   // Default rendering (full buttons)\r\n   return (\r\n     <div className={containerClasses}>\r\n       {/* Profile Link */}\r\n       <Link\r\n         href={`/profile/${userId}`} // Link using the user's ID\r\n         onClick={(e) => {\r\n           e.stopPropagation(); // Prevent parent Link navigation\r\n         }}\r\n         className={`profile-link-area text-white cursor-pointer ${!is_for_sale && postType === 'video' ? 'mt-4' : ''} ${!is_for_sale ? 'mb-1' : ''} ${is_for_sale ? '' : 'flex flex-col items-center'}`}\r\n         aria-label={`View profile for ${username}`}\r\n       >\r\n         <Avatar className=\"w-10 h-10 border-2 border-white\">\r\n           <AvatarImage src={profilePictureUrl ?? ''} alt={`${username}'s profile picture`} />\r\n           <AvatarFallback>{username?.charAt(0).toUpperCase() ?? 'U'}</AvatarFallback>\r\n         </Avatar>\r\n       </Link>\r\n\r\n       {/* Like Button (Only render if not for sale) */}\r\n       {/* Like Button (Using FaHeart) */}\r\n       {!is_for_sale && (\r\n         <button onClick={handleLike} className=\"flex flex-col items-center text-white group/like\">\r\n           <div className={`w-10 h-10 bg-black/40 rounded-full flex items-center justify-center mb-1 transition-colors ${isLiked ? 'bg-red-500/80' : 'group-hover/like:bg-white/20'}`}>\r\n             <FaHeart size={24} className={`${isLiked ? 'text-red-500' : 'text-white'} transition-transform group-hover/like:scale-110`} /> {/* Use FaHeart */}\r\n           </div>\r\n           <span className=\"text-xs font-semibold\">{currentLikes}</span>\r\n         </button>\r\n       )}\r\n\r\n       {/* Comment Button */}\r\n       {!is_for_sale && (\r\n         <Link\r\n           href={postType === 'video' ? `/video/${postId}#comments` : `/image/${postId}#comments`}\r\n           className=\"flex flex-col items-center text-white\"\r\n           aria-label=\"View comments\"\r\n           onClick={(e) => e.stopPropagation()} // Keep stopPropagation here too\r\n         >\r\n           <div className=\"w-10 h-10 bg-black/40 rounded-full flex items-center justify-center mb-1\">\r\n             <FaCommentDots size={24} /> {/* Use FaCommentDots */}\r\n           </div>\r\n           <span className=\"text-xs font-semibold\">{commentsCount}</span>\r\n         </Link>\r\n       )}\r\n\r\n       {/* Share Button */}\r\n       {/* Share Button (Using FaShare) */}\r\n       {!is_for_sale && (\r\n         <button onClick={handleShare} className=\"flex flex-col items-center text-white group/share\">\r\n           <div className=\"w-10 h-10 bg-black/40 rounded-full flex items-center justify-center mb-1 transition-colors group-hover/share:bg-white/20\">\r\n             <FaShare size={22} className=\"transition-transform group-hover/share:scale-110\" /> {/* Use FaShare, slightly smaller */}\r\n           </div>\r\n           <span className=\"text-xs font-semibold\">{sharesCount}</span>\r\n         </button>\r\n       )}\r\n\r\n       {/* Privacy Status Display/Button REMOVED from UI stack */}\r\n\r\n\r\n       {/* Buy Button (Conditional - Now removed entirely for sale items based on feedback) */}\r\n       {/* {is_for_sale && price && price > 0 && !isOwner && (\r\n         <button\r\n           onClick={handlePurchase}\r\n           disabled={isCheckoutLoading || !loggedInUser}\r\n           className=\"flex flex-col items-center text-white group/buy mt-2\"\r\n           aria-label={`Purchase for ${(price / 100).toFixed(2)} ${currency?.toUpperCase() ?? 'USD'}`}\r\n         >\r\n           <div className={`w-10 h-10 bg-green-600/80 hover:bg-green-500/90 rounded-full flex items-center justify-center mb-1 transition-colors`}>\r\n             {isCheckoutLoading ? <Loader2 className=\"h-5 w-5 animate-spin\" /> : <ShoppingCart size={24} />}\r\n           </div>\r\n           <span className=\"text-xs font-semibold\">Buy (${(price / 100).toFixed(2)})</span>\r\n         </button>\r\n       )} */}\r\n     </div>\r\n   );\r\n }\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 463, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\r\n        secondary:\r\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        destructive:\r\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\r\n        outline: \"text-foreground\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface BadgeProps\r\n  extends React.HTMLAttributes<HTMLDivElement>,\r\n    VariantProps<typeof badgeVariants> {}\r\n\r\nfunction Badge({ className, variant, ...props }: BadgeProps) {\r\n  return (\r\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\r\n  )\r\n}\r\n\r\nexport { Badge, badgeVariants }\r\n"],"names":[],"mappings":";;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACtB,0KACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;QACX;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,8OAAC;QAAI,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE","debugId":null}},
    {"offset": {"line": 505, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"bg-primary text-primary-foreground shadow hover:bg-primary/90\",\r\n        destructive:\r\n          \"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90\",\r\n        outline:\r\n          \"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground\",\r\n        secondary:\r\n          \"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80\",\r\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\r\n        link: \"text-primary underline-offset-4 hover:underline\",\r\n      },\r\n      size: {\r\n        default: \"h-9 px-4 py-2\",\r\n        sm: \"h-8 rounded-md px-3 text-xs\",\r\n        lg: \"h-10 rounded-md px-8\",\r\n        icon: \"h-9 w-9\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface ButtonProps\r\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n    VariantProps<typeof buttonVariants> {\r\n  asChild?: boolean\r\n}\r\n\r\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"button\"\r\n    return (\r\n      <Comp\r\n        className={cn(buttonVariants({ variant, size, className }))}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nButton.displayName = \"Button\"\r\n\r\nexport { Button, buttonVariants }\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,iBAAiB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACvB,ySACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,aACE;YACF,SACE;YACF,WACE;YACF,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAC5B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,gKAAA,CAAA,OAAI,GAAG;IAC9B,qBACE,8OAAC;QACC,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,OAAO,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 565, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/VerticalVideoPlayer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useRef, useEffect, useState, useCallback, useContext } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport { AuthContext } from '@/context/AuthContext';\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Play, Pause, Volume2, VolumeX, Lock, Loader2, ShoppingCart } from 'lucide-react';\r\nimport { PostInteractionButtons } from './PostInteractionButtons';\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { toast } from 'react-hot-toast';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\n\r\n// Initialize Stripe outside the component\r\nconst stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!);\r\n\r\n// Define the props based on the data available\r\ninterface VerticalVideoPlayerProps {\r\n  id: string;\r\n  username: string;\r\n  verified?: boolean;\r\n  profilePictureUrl?: string;\r\n  caption: string | null;\r\n  videoSrc: string;\r\n  posterSrc?: string;\r\n  likes: string;\r\n  comments: string;\r\n  shares: string;\r\n  initialIsLiked?: boolean;\r\n  isPrivate?: boolean | null;\r\n  isOwner?: boolean;\r\n  userId: string;\r\n  is_for_sale: boolean;\r\n  price?: number | null;\r\n  currency?: string | null;\r\n  stripe_price_id?: string | null;\r\n  isLocked?: boolean;\r\n  showControls?: boolean; // Add new prop\r\n  isForYouPage?: boolean; // Add prop to indicate if on For You page\r\n  isActive?: boolean; // Add prop to control playback externally (e.g., from FYP)\r\n  disableClickToPlay?: boolean;\r\n  hideProgressBar?: boolean;\r\n  interactionVariant?: 'default' | 'compact'; // Add prop for interaction variant\r\n}\r\n\r\n// Helper function to format price\r\nconst formatPrice = (priceInCents: number, currency: string = 'usd') => {\r\n  return new Intl.NumberFormat('en-US', {\r\n    style: 'currency',\r\n    currency: currency.toUpperCase(),\r\n   }).format(priceInCents / 100);\r\n };\r\n\r\n // Helper function to format time (e.g., 0:05, 1:23)\r\n const formatTime = (timeInSeconds: number): string => {\r\n   if (isNaN(timeInSeconds) || timeInSeconds < 0) {\r\n    return \"0:00\"; // Return default or error state\r\n  }\r\n  const minutes = Math.floor(timeInSeconds / 60);\r\n  const seconds = Math.floor(timeInSeconds % 60);\r\n  return `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n};\r\n\r\n export function VerticalVideoPlayer({\r\n   id,\r\n  username,\r\n  verified,\r\n  profilePictureUrl,\r\n  caption,\r\n  videoSrc,\r\n  posterSrc,\r\n  likes,\r\n  comments,\r\n  shares,\r\n  isPrivate: initialIsPrivate,\r\n  isOwner,\r\n  userId,\r\n  is_for_sale,\r\n  price,\r\n  currency,\r\n  isLocked: isSubLocked,\r\n  initialIsLiked = false,\r\n  showControls = true, // Destructure showControls, default to true\r\n  isForYouPage = false, // Destructure isForYouPage, default to false\r\n  isActive, // Destructure isActive prop\r\n  disableClickToPlay = false,\r\n  hideProgressBar = false,\r\n  interactionVariant = 'default', // Destructure new prop, default to 'default'\r\n}: VerticalVideoPlayerProps) {\r\n  const { user: loggedInUser } = useContext(AuthContext);\r\n  const router = useRouter();\r\n\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const progressBarContainerRef = useRef<HTMLDivElement>(null);\r\n  const [objectUrl, setObjectUrl] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [errorState, setErrorState] = useState<string | null>(null);\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [isMuted, setIsMuted] = useState(true);\r\n  const [progress, setProgress] = useState(0);\r\n  const [duration, setDuration] = useState(0);\r\n  const [isBuying, setIsBuying] = useState(false);\r\n  const [accumulatedWatchTimeMs, setAccumulatedWatchTimeMs] = useState(0);\r\n  const [isVisible, setIsVisible] = useState(false);\r\n   const watchIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n   const reportedWatchTimeRef = useRef(false);\r\n   const [isHovering, setIsHovering] = useState(false); // State for hover\r\n   const [hoverTime, setHoverTime] = useState(0); // State for time preview on hover\r\n   const [isScrubbing, setIsScrubbing] = useState(false); // State for scrubbing\r\n   const [currentTimeFormatted, setCurrentTimeFormatted] = useState(\"0:00\"); // State for current time display\r\n   const [showOverlayOnEnd, setShowOverlayOnEnd] = useState(false); // State to show overlay on video end\r\n   const [videoBounds, setVideoBounds] = useState({ top: 0, left: 0, width: 0, height: 0 }); // State for calculated video bounds\r\n\r\n   // Determine lock status\r\n   const isContentLocked = (is_for_sale && !isOwner) || (isSubLocked && !isOwner);\r\n  const isLockedForPurchase = is_for_sale && !isOwner;\r\n\r\n  // Refs to hold latest state values for cleanup function\r\n  const durationRef = useRef(duration);\r\n  const accumulatedWatchTimeMsRef = useRef(accumulatedWatchTimeMs);\r\n  const isContentLockedRef = useRef(isContentLocked);\r\n\r\n  // Keep refs updated\r\n  useEffect(() => { durationRef.current = duration; }, [duration]);\r\n  useEffect(() => { accumulatedWatchTimeMsRef.current = accumulatedWatchTimeMs; }, [accumulatedWatchTimeMs]);\r\n  useEffect(() => { isContentLockedRef.current = isContentLocked; }, [isContentLocked]);\r\n\r\n\r\n  // Fetch video blob only if content is not locked\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    let currentObjectUrl: string | null = null;\r\n    const fetchVideoAsBlob = async () => {\r\n      if (isContentLockedRef.current || !videoSrc) { // Use ref\r\n        setIsLoading(false); return;\r\n      }\r\n      setIsLoading(true); setErrorState(null); setObjectUrl(null);\r\n      try {\r\n        const urlParts = videoSrc.split('/public/');\r\n        if (urlParts.length < 2) throw new Error(\"Invalid video URL format\");\r\n        const bucketAndPath = urlParts[1];\r\n        const firstSlashIndex = bucketAndPath.indexOf('/');\r\n        if (firstSlashIndex === -1) throw new Error(\"Invalid bucket/path format\");\r\n        const bucketName = bucketAndPath.substring(0, firstSlashIndex);\r\n        const filePath = bucketAndPath.substring(firstSlashIndex + 1);\r\n        const { data: blob, error: downloadError } = await supabase.storage.from(bucketName).download(filePath);\r\n        if (downloadError) throw downloadError;\r\n        if (!blob) throw new Error(\"Downloaded data is null\");\r\n        currentObjectUrl = URL.createObjectURL(blob);\r\n        if (isMounted) setObjectUrl(currentObjectUrl);\r\n      } catch (err: unknown) {\r\n        const message = err instanceof Error ? err.message : String(err);\r\n        if (isMounted) setErrorState(`Failed to load video: ${message}`);\r\n      } finally {\r\n        if (isMounted) setIsLoading(false);\r\n      }\r\n    };\r\n    fetchVideoAsBlob();\r\n    return () => { isMounted = false; if (currentObjectUrl) URL.revokeObjectURL(currentObjectUrl); };\r\n  }, [id, videoSrc]); // Removed isContentLocked dependency, rely on ref\r\n\r\n  // Control Handlers\r\n  const togglePlayPause = useCallback(() => {\r\n    if (isContentLockedRef.current) return; // Use ref\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n    if (video.paused || video.ended) video.play().catch(e => console.error(\"Play error:\", e));\r\n    else video.pause();\r\n  }, []); // No dependencies needed as it uses refs\r\n\r\n  const toggleMute = useCallback(() => {\r\n    if (isContentLockedRef.current) return; // Use ref\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n    video.muted = !video.muted;\r\n    setIsMuted(video.muted);\r\n  }, []); // No dependencies needed as it uses refs\r\n\r\n  const handleTimeUpdate = useCallback(() => {\r\n    // Don't update progress if scrubbing or locked\r\n    if (isScrubbing || isContentLockedRef.current) return;\r\n    const video = videoRef.current;\r\n    const progressBarContainer = progressBarContainerRef.current;\r\n    // Use durationRef here\r\n    if (!video || !durationRef.current || !progressBarContainer) return;\r\n    const currentTime = video.currentTime;\r\n    const currentProgress = (currentTime / durationRef.current) * 100;\r\n    setProgress(currentProgress);\r\n    setCurrentTimeFormatted(formatTime(currentTime)); // Update formatted time state\r\n    // Flash effect logic (optional, kept for consistency)\r\n    if (currentTime < 0.1 && durationRef.current > 0 && !video.seeking) {\r\n      if (progressBarContainer && !progressBarContainer.classList.contains('flash-effect')) { // Added null check\r\n        progressBarContainer.classList.add('flash-effect');\r\n        setTimeout(() => {\r\n          // Check again if the element exists before removing class\r\n          if (progressBarContainerRef.current) {\r\n             progressBarContainerRef.current.classList.remove('flash-effect');\r\n          }\r\n        }, 200);\r\n      }\r\n    }\r\n  }, [isScrubbing]); // Add isScrubbing dependency\r\n\r\n  // Function to calculate the rendered video bounds\r\n  const calculateVideoBounds = useCallback(() => {\r\n    const video = videoRef.current;\r\n    // Use the parent of the video element as the container for bounds calculation\r\n    const container = video?.parentElement;\r\n\r\n    if (video && container && video.videoWidth > 0 && video.videoHeight > 0) {\r\n      const containerWidth = container.offsetWidth;\r\n      const containerHeight = container.offsetHeight;\r\n      const videoRatio = video.videoWidth / video.videoHeight;\r\n      const containerRatio = containerWidth / containerHeight;\r\n\r\n      let renderedWidth = containerWidth;\r\n      let renderedHeight = containerHeight;\r\n      let top = 0;\r\n      let left = 0;\r\n\r\n      if (videoRatio > containerRatio) {\r\n        // Video is wider than container (letterboxed top/bottom)\r\n        renderedHeight = containerWidth / videoRatio;\r\n        top = (containerHeight - renderedHeight) / 2;\r\n      } else {\r\n        // Video is taller than container (pillarboxed left/right)\r\n        renderedWidth = containerHeight * videoRatio;\r\n        left = (containerWidth - renderedWidth) / 2;\r\n      }\r\n\r\n      setVideoBounds({\r\n        top: Math.round(top), // Round to nearest pixel\r\n        left: Math.round(left),\r\n        width: Math.round(renderedWidth),\r\n        height: Math.round(renderedHeight),\r\n      });\r\n    } else {\r\n      // Reset or set default if video/container not ready\r\n      setVideoBounds({ top: 0, left: 0, width: container?.offsetWidth ?? 0, height: container?.offsetHeight ?? 0 });\r\n    }\r\n  }, []); // Dependencies: videoRef (implicitly via videoRef.current)\r\n\r\n  // Recalculate bounds when video metadata is loaded\r\n  const handleLoadedMetadata = useCallback(() => {\r\n    if (isContentLockedRef.current) return; // Use ref\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n     setDuration(video.duration); // Update state, which updates durationRef via its effect\r\n     setCurrentTimeFormatted(formatTime(0)); // Reset time display on new video load\r\n     calculateVideoBounds(); // Calculate bounds now that dimensions are known\r\n   }, [calculateVideoBounds]); // Added calculateVideoBounds dependency\r\n\r\n  // Recalculate bounds on container resize\r\n  useEffect(() => {\r\n    const container = videoRef.current?.parentElement; // Get container\r\n    if (!container) return;\r\n\r\n    const resizeObserver = new ResizeObserver(() => {\r\n      calculateVideoBounds();\r\n    });\r\n\r\n    resizeObserver.observe(container);\r\n\r\n    // Initial calculation in case metadata loaded before effect ran\r\n    calculateVideoBounds();\r\n\r\n    return () => {\r\n      resizeObserver.disconnect();\r\n    };\r\n  }, [calculateVideoBounds]); // Re-run if the calculation function changes\r\n\r\n  // Seek handler for progress bar click\r\n  const handleSeek = useCallback((event: React.MouseEvent<HTMLDivElement>) => {\r\n    if (isContentLockedRef.current) return;\r\n    const progressBarContainer = progressBarContainerRef.current;\r\n    const video = videoRef.current;\r\n    const currentDuration = durationRef.current; // Use ref\r\n\r\n    if (!progressBarContainer || !video || !currentDuration || currentDuration <= 0) return;\r\n\r\n    const rect = progressBarContainer.getBoundingClientRect();\r\n    const clickX = event.clientX - rect.left;\r\n    const barWidth = rect.width;\r\n    const seekPercentage = Math.max(0, Math.min(1, clickX / barWidth)); // Clamp between 0 and 1\r\n    const seekTime = seekPercentage * currentDuration;\r\n\r\n    video.currentTime = seekTime;\r\n    // Update progress state immediately for responsiveness\r\n     setProgress(seekPercentage * 100);\r\n     setCurrentTimeFormatted(formatTime(seekTime)); // Update time display on seek\r\n\r\n   }, []); // No dependencies needed as it uses refs\r\n\r\n  // Hover handlers for progress bar preview\r\n  const handleMouseMove = useCallback((event: React.MouseEvent<HTMLDivElement>) => {\r\n    if (isContentLockedRef.current) return;\r\n    const progressBarContainer = progressBarContainerRef.current;\r\n    const currentDuration = durationRef.current;\r\n\r\n    if (!progressBarContainer || !currentDuration || currentDuration <= 0) return;\r\n\r\n    const rect = progressBarContainer.getBoundingClientRect();\r\n    const hoverX = event.clientX - rect.left;\r\n    const barWidth = rect.width;\r\n    const hoverPercentage = Math.max(0, Math.min(1, hoverX / barWidth));\r\n    setHoverTime(hoverPercentage * currentDuration);\r\n\r\n  }, []); // Dependencies: none, uses refs\r\n\r\n  const handleMouseEnter = useCallback(() => {\r\n    if (isContentLockedRef.current) return;\r\n    setIsHovering(true);\r\n  }, []); // Dependencies: none, uses refs\r\n\r\n  const handleMouseLeave = useCallback(() => {\r\n    if (isContentLockedRef.current) return;\r\n     setIsHovering(false);\r\n   }, []); // Dependencies: none, uses refs\r\n\r\n  // Handle video end\r\n  const handleVideoEnd = useCallback(() => {\r\n    if (isForYouPage) {\r\n      setShowOverlayOnEnd(true);\r\n    }\r\n    setIsPlaying(false); // Update playing state\r\n  }, [isForYouPage]);\r\n\r\n  // Scrubbing handlers\r\n  const handleScrubMove = (event: MouseEvent) => {\r\n    if (!isScrubbing || isContentLockedRef.current) return;\r\n\r\n    const progressBarContainer = progressBarContainerRef.current;\r\n    const video = videoRef.current;\r\n    const currentDuration = durationRef.current;\r\n\r\n    if (!progressBarContainer || !video || !currentDuration || currentDuration <= 0) return;\r\n\r\n    const rect = progressBarContainer.getBoundingClientRect();\r\n    const clientX = event.clientX;\r\n    const scrubX = clientX - rect.left;\r\n    const barWidth = rect.width;\r\n    const scrubPercentage = Math.max(0, Math.min(1, scrubX / barWidth));\r\n    const seekTime = scrubPercentage * currentDuration;\r\n\r\n    video.currentTime = seekTime;\r\n    setProgress(scrubPercentage * 100);\r\n    setHoverTime(seekTime);\r\n    setCurrentTimeFormatted(formatTime(seekTime));\r\n  };\r\n\r\n  const handleScrubEnd = () => {\r\n    if (!isScrubbing) return;\r\n    setIsScrubbing(false);\r\n    document.removeEventListener('mousemove', handleScrubMove);\r\n    document.removeEventListener('mouseup', handleScrubEnd);\r\n  };\r\n\r\n  const handleMouseDown = useCallback((event: React.MouseEvent<HTMLDivElement>) => {\r\n    if (isContentLockedRef.current) return;\r\n    setIsScrubbing(true);\r\n    setShowOverlayOnEnd(false);\r\n    handleSeek(event); // Seek immediately on mouse down\r\n    document.addEventListener('mousemove', handleScrubMove);\r\n    document.addEventListener('mouseup', handleScrubEnd);\r\n  }, [handleSeek, handleScrubMove, handleScrubEnd]); // Corrected dependencies\r\n\r\n  // Cleanup global listeners on component unmount\r\n  useEffect(() => {\r\n    const cleanup = () => {\r\n      document.removeEventListener('mousemove', handleScrubMove);\r\n      document.removeEventListener('mouseup', handleScrubEnd);\r\n    };\r\n    return cleanup;\r\n   }, [handleScrubMove, handleScrubEnd]); // Corrected dependencies\r\n\r\n   // Intersection Observer and Watch Time Reporting Effect\r\n   useEffect(() => {\r\n    const videoElement = videoRef.current;\r\n    if (isContentLockedRef.current || !videoElement || !objectUrl) return;\r\n\r\n    // --- Playback control based on isActive prop ---\r\n    if (typeof isActive !== 'undefined') {\r\n      if (isActive) {\r\n        videoElement.play().then(() => setIsPlaying(true)).catch(() => setIsPlaying(false));\r\n      } else {\r\n        if (!videoElement.paused) {\r\n          videoElement.pause();\r\n          setIsPlaying(false);\r\n        }\r\n      }\r\n      return () => { /* No observer cleanup needed */ };\r\n    }\r\n    // --- Fallback to IntersectionObserver if isActive is not provided ---\r\n\r\n    const reportWatchTimeOnCleanup = async () => {\r\n      const currentDuration = durationRef.current;\r\n      const currentAccumulatedTime = accumulatedWatchTimeMsRef.current;\r\n      const currentContentLocked = isContentLockedRef.current;\r\n\r\n      if (reportedWatchTimeRef.current || currentContentLocked || currentDuration <= 0 || currentAccumulatedTime <= 0) {\r\n        return;\r\n      }\r\n      reportedWatchTimeRef.current = true;\r\n      if (watchIntervalRef.current) {\r\n        clearInterval(watchIntervalRef.current);\r\n        watchIntervalRef.current = null;\r\n      }\r\n      const payload = {\r\n        post_id: id,\r\n        watch_time_ms: Math.round(currentAccumulatedTime),\r\n        video_duration_ms: Math.round(currentDuration * 1000),\r\n      };\r\n      console.log(`Reporting watch time for post ${id} (Cleanup):`, payload);\r\n      try {\r\n        const functionUrl = `${process.env.NEXT_PUBLIC_SUPABASE_URL}/functions/v1/record-watch-time`;\r\n        const response = await fetch(functionUrl, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload),\r\n          keepalive: true,\r\n        });\r\n        if (!response.ok) {\r\n          const errorData = await response.json();\r\n          throw new Error(errorData.error || `HTTP error! status: ${response.status}`);\r\n        }\r\n        console.log(`Successfully reported watch time for post ${id} (Cleanup)`);\r\n      } catch (error) {\r\n        console.error(`Failed to report watch time for post ${id} (Cleanup):`, error);\r\n        reportedWatchTimeRef.current = false;\r\n      }\r\n    };\r\n\r\n    const observer = new IntersectionObserver(\r\n      ([entry]) => {\r\n        const currentlyVisible = entry.isIntersecting;\r\n        setIsVisible(currentlyVisible);\r\n\r\n        if (currentlyVisible) {\r\n          reportedWatchTimeRef.current = false;\r\n          videoElement.play().then(() => setIsPlaying(true)).catch(() => setIsPlaying(false));\r\n        } else {\r\n          if (!videoElement.paused) {\r\n            videoElement.pause();\r\n            setIsPlaying(false);\r\n          }\r\n          reportWatchTimeOnCleanup();\r\n        }\r\n      },\r\n      { threshold: 0.5 }\r\n    );\r\n\r\n    observer.observe(videoElement);\r\n\r\n    return () => {\r\n      observer.disconnect();\r\n      reportWatchTimeOnCleanup();\r\n    };\r\n   }, [objectUrl, id, isActive]); // Corrected dependencies\r\n\r\n   // Watch Time Accumulation Interval Effect\r\n   useEffect(() => {\r\n    if (isPlaying && isVisible && !isContentLockedRef.current) {\r\n      if (!watchIntervalRef.current) {\r\n        watchIntervalRef.current = setInterval(() => {\r\n          setAccumulatedWatchTimeMs(prev => prev + 100);\r\n        }, 100);\r\n      }\r\n    } else {\r\n      if (watchIntervalRef.current) {\r\n        clearInterval(watchIntervalRef.current);\r\n        watchIntervalRef.current = null;\r\n      }\r\n    }\r\n    return () => {\r\n      if (watchIntervalRef.current) {\r\n        clearInterval(watchIntervalRef.current);\r\n        watchIntervalRef.current = null;\r\n      }\r\n    };\r\n  }, [isPlaying, isVisible]); // Corrected dependencies\r\n\r\n  // Purchase Handler\r\n  const handlePurchase = useCallback(async () => {\r\n    if (!loggedInUser) { toast.error(\"Please log in to purchase.\"); return; }\r\n    if (!id || !is_for_sale || !price || price <= 0) { toast.error(\"Item not purchasable.\"); return; }\r\n    setIsBuying(true);\r\n    try {\r\n      const response = await fetch('/api/stripe/create-item-checkout-session', {\r\n        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ postId: id }),\r\n      });\r\n      const sessionData = await response.json();\r\n      if (!response.ok) throw new Error(sessionData.error || 'Failed to create session');\r\n      if (!sessionData.sessionId) throw new Error('Session ID missing');\r\n      const stripe = await stripePromise;\r\n      if (!stripe) throw new Error('Stripe.js failed');\r\n      const { error } = await stripe.redirectToCheckout({ sessionId: sessionData.sessionId });\r\n      if (error) throw new Error(error.message);\r\n    } catch (error) {\r\n      toast.error(`Purchase failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    } finally {\r\n      setIsBuying(false);\r\n    }\r\n  }, [loggedInUser, id, is_for_sale, price]);\r\n\r\n  // Profile Click Handler\r\n  const handleProfileClick = () => {\r\n    router.push(`/profile/${username}`);\r\n   };\r\n\r\n   return (\r\n       <div\r\n         ref={containerRef}\r\n         className=\"relative w-full h-full bg-black overflow-hidden group flex flex-col\"\r\n       >\r\n        {isContentLocked ? (\r\n           <div className=\"flex-grow w-full bg-black flex flex-col items-center justify-center text-white relative p-4\">\r\n             <div className=\"flex flex-col items-center justify-center text-center z-10\">\r\n               <Lock size={48} className=\"mb-3 opacity-80\" />\r\n               <span className=\"text-lg font-semibold mb-1\">\r\n                 {isLockedForPurchase ? 'Purchase to View' : 'Subscribe to View'}\r\n               </span>\r\n               {isLockedForPurchase && price && (\r\n                 <Badge variant=\"secondary\" className=\"text-sm font-bold cursor-default mb-4\">\r\n                   {formatPrice(price, currency ?? undefined)}\r\n                 </Badge>\r\n               )}\r\n             </div>\r\n             {isLockedForPurchase && (\r\n               <Button\r\n                 variant=\"default\" size=\"sm\"\r\n                 className=\"mt-4 h-9 px-5 text-sm bg-pink-600 hover:bg-pink-700 text-white rounded-full absolute bottom-16 left-1/2 transform -translate-x-1/2 z-20\"\r\n                 onClick={handlePurchase} disabled={isBuying || !loggedInUser}\r\n                 aria-label={`Buy for ${formatPrice(price ?? 0, currency ?? undefined)}`}\r\n               >\r\n                 {isBuying ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> : <ShoppingCart className=\"mr-2 h-4 w-4\" />}\r\n                 {isBuying ? 'Processing...' : 'Buy'}\r\n               </Button>\r\n             )}\r\n           </div>\r\n         ) : (\r\n           <>\r\n             {/* Video Area */}\r\n             <div className=\"relative flex-grow flex-shrink min-h-0\">\r\n               {isLoading && <div className=\"absolute inset-0 flex items-center justify-center text-white z-10\"><Loader2 className=\"h-8 w-8 animate-spin\" /></div>}\r\n               {errorState && <div className=\"absolute inset-0 flex items-center justify-center text-red-500 z-10 p-4 text-center\">{errorState}</div>}\r\n               <video\r\n                 ref={videoRef} key={objectUrl} src={objectUrl ?? undefined} poster={posterSrc}\r\n                 className={`w-full h-full object-contain ${!objectUrl || isLoading || errorState ? 'invisible' : ''} border-0 bg-black`}\r\n                 playsInline loop muted={isMuted} onClick={disableClickToPlay ? undefined : togglePlayPause}\r\n                 onPlay={() => { setIsPlaying(true); setShowOverlayOnEnd(false); }} onPause={() => setIsPlaying(false)}\r\n                 onEnded={handleVideoEnd}\r\n                 onLoadedMetadata={handleLoadedMetadata} onTimeUpdate={handleTimeUpdate}\r\n                 onError={(e) => console.error(`Video Error (ID: ${id}):`, (e.target as HTMLVideoElement).error)}\r\n               />\r\n\r\n               {/* Overlay Container - Positioned exactly over the rendered video */}\r\n               <div\r\n                 className=\"absolute pointer-events-none z-20\"\r\n                 style={{\r\n                   top: `${videoBounds.top}px`,\r\n                   left: `${videoBounds.left}px`,\r\n                   width: `${videoBounds.width}px`,\r\n                   height: `${videoBounds.height}px`,\r\n                 }}\r\n               >\r\n                 {/* Conditional Play Button Overlay (Centered) */}\r\n                 {!isPlaying && !disableClickToPlay && !isContentLocked && objectUrl && !isLoading && !errorState && (\r\n                   <div\r\n                     className=\"absolute inset-0 flex items-center justify-center bg-black/30 cursor-pointer pointer-events-auto\" // Centered again\r\n                     onClick={togglePlayPause}\r\n                     aria-label=\"Play video\"\r\n                   >\r\n                     <Play size={64} className=\"text-white/80\" fill=\"currentColor\" />\r\n                   </div>\r\n                 )}\r\n\r\n                 {/* User Info & Caption */}\r\n                 {!isContentLocked && objectUrl && !isLoading && !errorState && (\r\n                   <div className={`absolute bottom-12 left-4 text-white pointer-events-auto max-w-[calc(100%-80px)]`}> {/* Changed bottom-4 to bottom-12 */}\r\n                     <div className={`flex items-center gap-1.5 group cursor-pointer`} onClick={handleProfileClick}\r\n                        aria-label={`View profile of ${username}`} role=\"button\" tabIndex={0}\r\n                        onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handleProfileClick(); } }}\r\n                    >\r\n                     <Avatar className=\"h-7 w-7 border border-gray-600 group-hover:scale-110 transition-transform\">\r\n                       <AvatarImage src={profilePictureUrl ?? undefined} alt={username ?? 'User profile'} />\r\n                       <AvatarFallback>{username?.charAt(0).toUpperCase() ?? 'U'}</AvatarFallback>\r\n                     </Avatar>\r\n                     <span className=\"font-bold text-sm hover:underline\">@{username}</span>\r\n                   </div>\r\n                   {caption && <p className=\"text-xs text-white mt-1 max-w-full break-words line-clamp-2\">{caption}</p>}\r\n                   {is_for_sale && !isContentLocked && price && (\r\n                     <Badge variant=\"secondary\" className=\"mt-1 text-xs font-semibold cursor-default bg-green-600 hover:bg-green-700 text-white\">\r\n                       For Sale: {formatPrice(price, currency ?? undefined)}\r\n                     </Badge>\r\n                   )}\r\n                 </div>\r\n               )}\r\n\r\n               {/* Mute Button */}\r\n               {objectUrl && !isLoading && !errorState && !isContentLocked && (\r\n                 <button onClick={toggleMute} className={`absolute bottom-12 right-4 p-2 bg-black/40 rounded-full text-white pointer-events-auto`} aria-label={isMuted ? 'Unmute' : 'Mute'}> {/* Changed bottom-5 to bottom-12 */}\r\n                   {isMuted ? <VolumeX size={18} /> : <Volume2 size={18} />}\r\n                 </button>\r\n               )}\r\n\r\n               {/* Interaction Buttons */}\r\n               {!isContentLocked && (\r\n                 <div className={`absolute bottom-20 right-4 pointer-events-auto opacity-100 transition-opacity duration-300`}>\r\n                   <PostInteractionButtons\r\n                     postId={id} userId={userId} username={username}\r\n                     profilePictureUrl={profilePictureUrl ?? undefined}\r\n                     initialLikes={parseInt(likes, 10) || 0} initialIsLiked={initialIsLiked}\r\n                     commentsCount={comments} sharesCount={shares}\r\n                     initialIsPrivate={initialIsPrivate ?? false} postType=\"video\"\r\n                     isOwner={isOwner ?? false} videoCaption={caption ?? undefined}\r\n                     is_for_sale={is_for_sale} price={price} currency={currency}\r\n                     variant={interactionVariant}\r\n                   />\r\n                 </div>\r\n               )}\r\n\r\n               {/* Controls Area (Moved inside overlay container) */}\r\n               {!isContentLocked && objectUrl && !isLoading && !errorState && !hideProgressBar && showControls && duration > 0 && (\r\n                 <div className=\"absolute bottom-0 left-0 right-0 px-4 pb-2 pt-1 z-30 pointer-events-none\"> {/* Positioned at bottom, removed bg-black, added z-index */}\r\n                   <div className=\"relative pointer-events-auto\"> {/* Enable pointer events for controls */}\r\n                     <div\r\n                         ref={progressBarContainerRef}\r\n                       className={`relative h-1.5 w-full bg-gray-500/30 cursor-pointer group-hover:opacity-100 transition-opacity duration-200 ${isScrubbing ? 'opacity-100' : 'opacity-70'}`}\r\n                       onClick={handleSeek}\r\n                       onMouseDown={handleMouseDown}\r\n                       onMouseMove={handleMouseMove}\r\n                       onMouseEnter={handleMouseEnter}\r\n                       onMouseLeave={handleMouseLeave}\r\n                     >\r\n                       <div className=\"absolute top-0 left-0 h-full w-full bg-gray-500/30\" />\r\n                       <div\r\n                         className=\"absolute top-0 left-0 h-full bg-white/80 transition-colors duration-200 group-hover:bg-white\"\r\n                         style={{ width: `${progress}%` }}\r\n                       />\r\n                       <div\r\n                         className={`absolute top-1/2 w-3 h-3 bg-white rounded-full transform -translate-y-1/2 -translate-x-1/2 pointer-events-none`}\r\n                         style={{ left: `${progress}%` }}\r\n                       />\r\n                       {(isHovering || isScrubbing) && (\r\n                         <div\r\n                           className=\"absolute bottom-full mb-1 left-0 transform -translate-x-1/2 px-2 py-0.5 bg-black/70 text-white text-xs rounded whitespace-nowrap z-50 pointer-events-none\"\r\n                           style={{ left: `${(hoverTime / duration) * 100}%` }}\r\n                         >\r\n                           {formatTime(hoverTime)}\r\n                         </div>\r\n                       )}\r\n                     </div>\r\n                     <div className={`mt-1 text-white text-xs font-mono pointer-events-none select-none`}>\r\n                       {currentTimeFormatted} / {formatTime(duration)}\r\n                     </div>\r\n                   </div>\r\n                 </div>\r\n               )}\r\n             </div> {/* Closing tag for the overlay container */}\r\n             </div> {/* Closing tag for Video Area */}\r\n           </>\r\n         )}\r\n       </div>\r\n     );\r\n }\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1462, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ClientVideoPlayerWrapper.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from 'react'; // Import React\r\nimport { VerticalVideoPlayer } from './VerticalVideoPlayer';\r\n\r\n// Define the props type - should match VerticalVideoPlayerProps\r\ninterface ClientVideoPlayerWrapperProps {\r\n  id: string;\r\n  username: string;\r\n  verified?: boolean;\r\n  profilePictureUrl?: string; // Add profile picture URL prop\r\n  caption: string;\r\n  videoSrc: string;\r\n  posterSrc?: string;\r\n  likes: string;\r\n  comments: string;\r\n  shares: string;\r\n  isPrivate?: boolean | null;\r\n  isOwner?: boolean;\r\n  userId: string; // Post owner's ID\r\n  // Add sale-related props passed from VideoGrid\r\n  is_for_sale: boolean;\r\n  price?: number | null;\r\n  currency?: string | null;\r\n  stripe_price_id?: string | null;\r\n  isLocked?: boolean; // Locked by subscription or sale\r\n  isPaidContent?: boolean | null | undefined; // Allow null as well\r\n  disableClickToPlay?: boolean; // Add prop from VerticalVideoPlayer\r\n  hideProgressBar?: boolean; // Add prop to pass down\r\n}\r\n\r\n// Wrap the component with React.memo to prevent unnecessary re-renders\r\n// if the props haven't changed.\r\nexport const ClientVideoPlayerWrapper = React.memo(function ClientVideoPlayerWrapper(props: ClientVideoPlayerWrapperProps) {\r\n  // Log that the wrapper is rendering (can be removed after debugging)\r\n  // console.log(`Rendering ClientVideoPlayerWrapper for ID: ${props.id}`);\r\n  // Pass all props down to VerticalVideoPlayer\r\n  return <VerticalVideoPlayer {...props} />;\r\n});\r\n\r\n// Optional: Add a display name for better debugging in React DevTools\r\nClientVideoPlayerWrapper.displayName = 'ClientVideoPlayerWrapper';\r\n"],"names":[],"mappings":";;;;AAEA,oVAA2B,eAAe;AAC1C;AAHA;;;;AAiCO,MAAM,yCAA2B,qMAAA,CAAA,UAAK,CAAC,IAAI,CAAC,SAAS,yBAAyB,KAAoC;IACvH,qEAAqE;IACrE,yEAAyE;IACzE,6CAA6C;IAC7C,qBAAO,8OAAC,yIAAA,CAAA,sBAAmB;QAAE,GAAG,KAAK;;;;;;AACvC;AAEA,sEAAsE;AACtE,yBAAyB,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 1492, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\r\n  ({ className, type, ...props }, ref) => {\r\n    return (\r\n      <input\r\n        type={type}\r\n        className={cn(\r\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\r\n          className\r\n        )}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nInput.displayName = \"Input\"\r\n\r\nexport { Input }\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAC3B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,8OAAC;QACC,MAAM;QACN,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,2WACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,MAAM,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 1521, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/app/video/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\"; // Add useCallback\r\nimport { useParams, useRouter } from \"next/navigation\"; // Import useRouter\r\nimport Link from 'next/link'; // Import Link\r\nimport { ClientVideoPlayerWrapper } from \"@/components/ClientVideoPlayerWrapper\"; // Import player wrapper\r\nimport { supabase } from \"@/lib/supabaseClient\";\r\nimport { useAuth } from '@/context/AuthContext'; // Import useAuth for posting comments\r\nimport type { Tables } from \"@/lib/database.types\"; // Import types\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"; // Re-import Avatar\r\nimport { Button } from \"@/components/ui/button\"; // Re-import Button\r\nimport { Input } from \"@/components/ui/input\"; // Re-import Input\r\nimport { Separator } from \"@/components/ui/separator\"; // Re-import Separator\r\n// Import icons, add Trash2 for delete, Share2 for general share, and placeholders\r\nimport { Heart, MessageCircle, Send, Bookmark, Copy, X, Trash2, Share2, Facebook, Twitter, Link2 } from 'lucide-react';\r\nimport { formatDistanceToNow } from 'date-fns'; // Import date formatting function\r\n// Keep Avatar imports if needed elsewhere, or remove if truly unused after layout change\r\n// import { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\n// Keep other UI imports if needed for future comment implementation\r\n// import { FaHeart, FaComment, FaShare, FaLink, FaCode } from \"react-icons/fa\";\r\n// import { Button } from \"@/components/ui/button\";\r\n// import { Input } from \"@/components/ui/input\";\r\n// import { Separator } from \"@/components/ui/separator\";\r\n// import { cn } from \"@/lib/utils\";\r\n\r\n// Define combined type for post and profile data\r\ntype PostWithProfile = Tables<'posts'> & {\r\n  // Ensure profiles relation includes all fields needed by VerticalVideoPlayer\r\n  // Include necessary fields for the right column\r\n  // Removed 'uid' as it's not in the updated profiles type\r\n  profiles: Pick<Tables<'profiles'>, 'id' | 'username' | 'profile_picture_url' | 'name'> | null; // Added 'id' for join key\r\n};\r\n\r\n// Type for comments, ensuring profiles relation is correctly typed\r\ntype CommentWithProfile = Tables<'comments'> & {\r\n  // Added 'id' for join key\r\n  profiles: Pick<Tables<'profiles'>, 'id' | 'username' | 'profile_picture_url'> | null;\r\n};\r\n\r\n\r\nexport default function VideoDetailPage() {\r\n  const params = useParams();\r\n  const router = useRouter(); // For close button\r\n  const { user: loggedInUser } = useAuth(); // Get logged-in user for posting\r\n  const videoId = params.id as string;\r\n\r\n  // State for fetched data, loading, and errors\r\n  const [postData, setPostData] = useState<PostWithProfile | null>(null);\r\n  const [comments, setComments] = useState<CommentWithProfile[]>([]); // Use updated type\r\n  const [loading, setLoading] = useState(true); // Loading for post data\r\n  const [error, setError] = useState<string | null>(null); // Error for post data\r\n  const [loadingComments, setLoadingComments] = useState(false); // Separate loading for comments\r\n  const [commentError, setCommentError] = useState<string | null>(null); // Separate error for comments\r\n  const [newComment, setNewComment] = useState(\"\"); // State for new comment input\r\n  const [isLiked, setIsLiked] = useState(false); // Placeholder state\r\n  const [isBookmarked, setIsBookmarked] = useState(false); // Placeholder state\r\n  const [copied, setCopied] = useState(false); // State for copy feedback\r\n  const [isDeleting, setIsDeleting] = useState(false); // State for delete operation\r\n\r\n  // --- Delete Handler ---\r\n  const handleDeletePost = useCallback(async () => {\r\n     if (!postData || !loggedInUser || postData.user_id !== loggedInUser.id || isDeleting) return;\r\n\r\n     if (!window.confirm('Are you sure you want to delete this video?')) {\r\n       return;\r\n     }\r\n\r\n     setIsDeleting(true);\r\n     setError(null); // Clear previous errors\r\n\r\n     try {\r\n       // 1. Delete from 'posts' table\r\n       const { error: dbError } = await supabase\r\n         .from('posts')\r\n         .delete()\r\n         .eq('id', postData.id);\r\n\r\n       if (dbError) throw dbError;\r\n\r\n       // 2. Delete from Storage (video and thumbnail if they exist)\r\n       const storagePathsToDelete: string[] = [];\r\n       if (postData.video_url) {\r\n         try {\r\n           const urlParts = postData.video_url.split('/public/');\r\n           if (urlParts.length >= 2) {\r\n             const bucketAndPath = urlParts[1];\r\n             const firstSlashIndex = bucketAndPath.indexOf('/');\r\n             if (firstSlashIndex !== -1) {\r\n               storagePathsToDelete.push(bucketAndPath.substring(firstSlashIndex + 1));\r\n             }\r\n           }\r\n         } catch (parseError) { console.error(\"Could not parse video URL for deletion:\", postData.video_url, parseError); }\r\n       }\r\n       if (postData.thumbnail_url) {\r\n         try {\r\n           const urlParts = postData.thumbnail_url.split('/public/');\r\n           if (urlParts.length >= 2) {\r\n             const bucketAndPath = urlParts[1];\r\n             const firstSlashIndex = bucketAndPath.indexOf('/');\r\n             if (firstSlashIndex !== -1) {\r\n               storagePathsToDelete.push(bucketAndPath.substring(firstSlashIndex + 1));\r\n             }\r\n           }\r\n         } catch (parseError) { console.error(\"Could not parse thumbnail URL for deletion:\", postData.thumbnail_url, parseError); }\r\n       }\r\n\r\n       if (storagePathsToDelete.length > 0) {\r\n         const { error: storageError } = await supabase.storage\r\n           .from('posts') // Assuming 'posts' bucket\r\n           .remove(storagePathsToDelete);\r\n         if (storageError) console.error(\"Error deleting from storage:\", storageError);\r\n       }\r\n\r\n       // 3. Navigate away after successful deletion\r\n       router.back(); // Or redirect to profile: router.push(`/profile/${loggedInUser.user_metadata?.username || ''}`);\r\n\r\n     } catch (err: unknown) {\r\n       const message = err instanceof Error ? err.message : String(err);\r\n       console.error(\"Error deleting post:\", err);\r\n       setError(`Failed to delete post: ${message}`);\r\n       setIsDeleting(false); // Reset deleting state on error\r\n     }\r\n     // No finally block needed as navigation happens on success\r\n  }, [postData, loggedInUser, isDeleting, router]);\r\n\r\n\r\n  // Fetch video data from Supabase\r\n  useEffect(() => {\r\n    const fetchVideoData = async () => {\r\n      if (!videoId) return;\r\n\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      try {\r\n        const { data, error: fetchError } = await supabase\r\n          .from('posts')\r\n          .select(`*`) // Select only post data initially\r\n          .eq('id', videoId)\r\n          .single(); // Fetch a single post\r\n\r\n        if (fetchError) {\r\n          // Handle case where video ID doesn't exist\r\n          if (fetchError.code === 'PGRST116') { // Not found\r\n             throw new Error(\"Video not found.\");\r\n          }\r\n          throw fetchError; // Rethrow other errors\r\n        }\r\n\r\n        if (data) {\r\n          // Now fetch the profile data separately using the user_id from the post\r\n          const { data: profileData, error: profileError } = await supabase\r\n            .from('profiles')\r\n            .select('id, username, name, profile_picture_url')\r\n            .eq('id', data.user_id) // Join based on user_id -> profiles.id\r\n            .single();\r\n\r\n          if (profileError && profileError.code !== 'PGRST116') { // Ignore 'not found' error for profile, handle below\r\n             console.error(\"Error fetching post author profile:\", profileError);\r\n             // Proceed without profile data or throw? For now, proceed.\r\n          }\r\n\r\n          console.log(\"Fetched Post Data:\", data);\r\n          console.log(\"Fetched Profile Data:\", profileData);\r\n\r\n          // Combine post and profile data\r\n          // Type assertion needed here as we are manually constructing the joined type\r\n          setPostData({ ...data, profiles: profileData || null } as PostWithProfile);\r\n\r\n        } else {\r\n          setError(\"Video not found.\"); // Post itself not found\r\n        }\r\n      } catch (err: unknown) {\r\n        const message = err instanceof Error ? err.message : String(err);\r\n        console.error(\"Error fetching video data:\", err);\r\n        setError(`Failed to load video: ${message}`);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    // Function to fetch comments\r\n    const fetchComments = async () => {\r\n       if (!videoId) return;\r\n       setLoadingComments(true);\r\n       setCommentError(null);\r\n       try {\r\n         // Use explicit join syntax: foreign_table!fk_column(columns_to_select)\r\n         // 1. Fetch comments without profile data first\r\n         const { data: commentsData, error: commentFetchError } = await supabase\r\n           .from('comments')\r\n           .select(`*`) // Select only comment data\r\n           .eq('post_id', videoId)\r\n           .order('created_at', { ascending: true });\r\n\r\n         if (commentFetchError) throw commentFetchError;\r\n         if (!commentsData) {\r\n            setComments([]); // No comments found\r\n            return;\r\n         }\r\n\r\n         // 2. Extract unique user IDs from comments\r\n         const userIds = [...new Set(commentsData.map(c => c.user_id).filter(id => id))]; // Filter out potential nulls/undefined\r\n\r\n         // 3. Fetch profiles for these user IDs\r\n         const profilesMap: Map<string, Pick<Tables<'profiles'>, 'id' | 'username' | 'profile_picture_url'>> = new Map();\r\n         if (userIds.length > 0) {\r\n            const { data: profilesData, error: profilesError } = await supabase\r\n              .from('profiles')\r\n              .select('id, username, profile_picture_url')\r\n              .in('id', userIds);\r\n\r\n            if (profilesError) {\r\n               console.error(\"Error fetching comment author profiles:\", profilesError);\r\n               // Proceed without profile data for comments or throw? For now, proceed.\r\n            } else if (profilesData) {\r\n               profilesData.forEach(p => profilesMap.set(p.id, p));\r\n            }\r\n         }\r\n\r\n         // 4. Combine comments and profiles\r\n         const commentsWithProfiles = commentsData.map(comment => ({\r\n           ...comment,\r\n           profiles: profilesMap.get(comment.user_id) || null,\r\n         }));\r\n\r\n         // Type assertion needed as we manually constructed the joined type\r\n         setComments(commentsWithProfiles as CommentWithProfile[]);\r\n\r\n       } catch (err: unknown) {\r\n         const message = err instanceof Error ? err.message : String(err);\r\n         console.error(\"Error fetching comments:\", err);\r\n         setCommentError(`Failed to load comments: ${message}`);\r\n         setComments([]);\r\n       } finally {\r\n         setLoadingComments(false);\r\n       }\r\n    };\r\n\r\n    fetchVideoData();\r\n    fetchComments(); // Fetch comments along with video data\r\n\r\n  }, [videoId]); // Re-run effect if videoId changes\r\n\r\n  // --- Action Handlers ---\r\n  const handleLike = () => setIsLiked(!isLiked);\r\n  const handleBookmark = () => setIsBookmarked(!isBookmarked);\r\n  const handleCopyLink = () => {\r\n     const videoUrl = window.location.href;\r\n     navigator.clipboard.writeText(videoUrl).then(() => {\r\n       setCopied(true);\r\n       setTimeout(() => setCopied(false), 2000);\r\n     }).catch(err => console.error('Failed to copy URL: ', err));\r\n  };\r\n  const handlePostComment = useCallback(async () => {\r\n     if (!newComment.trim() || !loggedInUser || !videoId) return;\r\n\r\n     const commentToPost = {\r\n       post_id: videoId,\r\n       user_id: loggedInUser.id,\r\n       text: newComment.trim(),\r\n     };\r\n\r\n     // Optimistic UI update (optional but good UX)\r\n     const optimisticComment: CommentWithProfile = {\r\n        ...commentToPost,\r\n        id: `temp-${Date.now()}`, // Temporary ID\r\n        created_at: new Date().toISOString(),\r\n        profiles: { // Use logged-in user's info for optimistic update\r\n           id: loggedInUser.id, // Add the user ID here\r\n           username: loggedInUser.user_metadata?.user_name || 'You',\r\n           profile_picture_url: loggedInUser.user_metadata?.avatar_url || null,\r\n        }\r\n     };\r\n     setComments(current => [...current, optimisticComment]);\r\n     setNewComment(\"\"); // Clear input immediately\r\n\r\n     try {\r\n       // 1. Insert the comment without selecting related data\r\n       const { data: insertedComment, error: insertError } = await supabase\r\n         .from('comments')\r\n         .insert(commentToPost)\r\n         .select() // Select the inserted comment itself\r\n         .single();\r\n\r\n       if (insertError) throw insertError;\r\n       if (!insertedComment) throw new Error(\"Failed to retrieve inserted comment.\");\r\n\r\n       // 2. Manually construct the final comment object with profile data\r\n       //    (We already have the profile data in optimisticComment.profiles)\r\n       const finalComment: CommentWithProfile = {\r\n         ...insertedComment,\r\n         profiles: optimisticComment.profiles, // Use profile data from optimistic update\r\n       };\r\n\r\n\r\n       // 3. Replace optimistic comment with the final one\r\n       setComments(current =>\r\n         current.map(c =>\r\n           c.id === optimisticComment.id ? finalComment : c\r\n         )\r\n       );\r\n\r\n     } catch (err: unknown) {\r\n       const message = err instanceof Error ? err.message : String(err);\r\n       console.error(\"Error posting comment:\", err);\r\n       setCommentError(`Failed to post comment: ${message}`);\r\n       // Revert optimistic update on error\r\n       setComments(current => current.filter(c => c.id !== optimisticComment.id));\r\n       setNewComment(commentToPost.text); // Put text back in input\r\n     }\r\n  }, [newComment, loggedInUser, videoId]);\r\n\r\n  // --- UI Render Logic ---\r\n\r\n  // Loading state for the main video data\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center w-screen h-screen bg-black text-white\">\r\n        <p>Loading video...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Error state for the main video data\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex flex-col justify-center items-center w-screen h-screen bg-black text-white\">\r\n        <p className=\"text-red-500 mb-4\">{error}</p>\r\n        <Button variant=\"secondary\" onClick={() => router.back()}>Go Back</Button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Video not found or missing URL\r\n  if (!postData || !postData.video_url) {\r\n    return (\r\n      <div className=\"flex flex-col justify-center items-center w-screen h-screen bg-black text-white\">\r\n        <p className=\"mb-4\">Video not found or source is unavailable.</p>\r\n        <Button variant=\"secondary\" onClick={() => router.back()}>Go Back</Button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Extract data needed for rendering\r\n  const {\r\n    id,\r\n    caption,\r\n    video_url,\r\n    thumbnail_url,\r\n    likes_count,\r\n    comments_count,\r\n    views_count, // Assuming shares might be views or calculated differently\r\n    profiles,\r\n  } = postData;\r\n\r\n  const username = profiles?.username || \"Unknown\";\r\n  const profileName = profiles?.name || username; // Fallback to username if name is missing\r\n  const profilePic = profiles?.profile_picture_url;\r\n\r\n  return (\r\n    // Full screen container\r\n    <div className=\"fixed inset-0 flex bg-background text-foreground z-50\"> {/* Use fixed positioning */}\r\n\r\n      {/* Close Button */}\r\n      <Button\r\n        variant=\"ghost\"\r\n        size=\"icon\"\r\n        className=\"absolute top-4 left-4 text-white bg-black/50 hover:bg-black/70 rounded-full z-50\"\r\n        onClick={() => router.back()} // Go back in history\r\n        aria-label=\"Close video\"\r\n      >\r\n        <X size={24} />\r\n      </Button>\r\n\r\n      {/* Left Column: Video Player */}\r\n      <div className=\"flex-1 bg-black flex items-center justify-center overflow-hidden relative\">\r\n        <ClientVideoPlayerWrapper\r\n          id={id}\r\n          username={username}\r\n          profilePictureUrl={profilePic ?? undefined}\r\n          // verified={profiles?.verified ?? false} // Add if verified exists\r\n          caption={caption ?? \"\"}\r\n          videoSrc={video_url} // Already checked this exists\r\n          posterSrc={thumbnail_url ?? undefined}\r\n          likes={(likes_count ?? 0).toString()}\r\n          comments={(comments_count ?? 0).toString()}\r\n          // Use views_count for shares placeholder, or implement actual shares\r\n          shares={(views_count ?? 0).toString()}\r\n          userId={postData.user_id} // Add missing userId prop\r\n          is_for_sale={postData.is_for_sale ?? false} // Add missing is_for_sale prop (default to false)\r\n          // Note: Delete button logic might need adjustment if it relies on profile page context\r\n        />\r\n      </div>\r\n\r\n      {/* Right Column: Details & Comments */}\r\n      <div className=\"w-[400px] lg:w-[500px] border-l border-border bg-background flex flex-col h-full\">\r\n\r\n        {/* Top Section: Creator Info & Caption */}\r\n        <div className=\"p-4 border-b border-border\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            {/* Use userId for the link href */}\r\n            <Link href={`/profile/${postData.user_id}`} className=\"flex items-center gap-2 group\">\r\n              <Avatar className=\"w-10 h-10\">\r\n                <AvatarImage src={profilePic ?? undefined} alt={username} />\r\n                {/* Display username if available, otherwise fallback */}\r\n                <AvatarFallback>{username?.charAt(0).toUpperCase() ?? 'U'}</AvatarFallback>\r\n              </Avatar>\r\n              <div>\r\n                <p className=\"font-semibold group-hover:underline\">{username}</p>\r\n                <p className=\"text-sm text-muted-foreground\">{profileName} · <span className=\"text-xs\">5d ago</span></p> {/* Placeholder date */}\r\n              </div>\r\n            </Link>\r\n            <Button variant=\"outline\" size=\"sm\">Follow</Button> {/* Placeholder */}\r\n          </div>\r\n          <p className=\"text-sm mb-2\">{caption ?? \"No caption\"}</p>\r\n          {/* TODO: Add Hashtags and Music info here if available */}\r\n          <p className=\"text-sm font-semibold text-muted-foreground mb-3\">♫ original sound - placeholder</p>\r\n\r\n          {/* Action Buttons */}\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n             <div className=\"flex items-center gap-4\">\r\n                <button onClick={handleLike} className=\"flex items-center gap-1.5 text-sm hover:text-primary\">\r\n                   <Heart size={20} fill={isLiked ? 'currentColor' : 'none'} className={isLiked ? 'text-red-500' : ''} />\r\n                   {likes_count ?? 0}\r\n                </button>\r\n                <button className=\"flex items-center gap-1.5 text-sm hover:text-primary\">\r\n                   <MessageCircle size={20} />\r\n                   {comments_count ?? 0}\r\n                </button>\r\n                {/* Bookmark button removed */}\r\n             </div>\r\n             <div className=\"flex items-center gap-2\">\r\n                {/* TODO: Implement actual sharing options (e.g., social media) */}\r\n                <Button variant=\"ghost\" size=\"icon\" className=\"hover:bg-muted\" aria-label=\"Share options\">\r\n                   <Send size={20} />\r\n                </Button>\r\n             </div>\r\n          </div>\r\n\r\n          {/* Copy Link */}\r\n          <div className=\"flex items-center border border-input rounded-md bg-muted\">\r\n             <p className=\"flex-1 px-3 py-1.5 text-sm text-muted-foreground truncate\">\r\n                {window.location.href} {/* Display current URL */}\r\n             </p>\r\n             <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"rounded-l-none\"\r\n                onClick={handleCopyLink}\r\n             >\r\n                {copied ? 'Copied' : 'Copy link'}\r\n             </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Middle Section: Comments */}\r\n        <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n          {/* Placeholder for comments */}\r\n          {loadingComments && <p className=\"text-muted-foreground text-center\">Loading comments...</p>}\r\n          {commentError && <p className=\"text-red-500 text-center\">{commentError}</p>}\r\n          {!loadingComments && comments.length === 0 && <p className=\"text-muted-foreground text-center\">No comments yet.</p>}\r\n\r\n          {/* Map over actual comments */}\r\n          {comments.map((comment) => (\r\n            <div key={comment.id} className=\"flex items-start gap-2\">\r\n              <Avatar className=\"w-8 h-8\">\r\n                <AvatarImage src={comment.profiles?.profile_picture_url ?? undefined} alt={comment.profiles?.username ?? 'User'} />\r\n                <AvatarFallback>{comment.profiles?.username?.charAt(0).toUpperCase() ?? 'U'}</AvatarFallback>\r\n              </Avatar>\r\n              <div className=\"text-sm flex-1\">\r\n                <p>\r\n                  <span className=\"font-semibold mr-1\">{comment.profiles?.username ?? 'User'}</span>\r\n                  {comment.text}\r\n                </p>\r\n                <div className=\"flex items-center gap-2 text-xs text-muted-foreground mt-1\">\r\n                  {/* TODO: Format date properly */}\r\n                  <span>{new Date(comment.created_at).toLocaleDateString()}</span>\r\n                  <button className=\"hover:underline\">Reply</button>\r\n                  <button className=\"flex items-center gap-0.5 hover:text-red-500\">\r\n                    <Heart size={12} /> 0 {/* Placeholder like count */}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Bottom Section: Add Comment - Disable if not logged in */}\r\n        <div className=\"p-4 border-t border-border bg-background\">\r\n          {!loggedInUser ? (\r\n             <p className=\"text-sm text-muted-foreground text-center\">\r\n               <Link href=\"#\" className=\"text-primary hover:underline\" onClick={(e) => { e.preventDefault(); /* TODO: Trigger login modal */ }}>Log in</Link> to add a comment.\r\n             </p>\r\n          ) : (\r\n            <div className=\"flex items-center gap-2\">\r\n              <Input\r\n                placeholder=\"Add comment...\"\r\n                className=\"flex-1\"\r\n                value={newComment}\r\n                onChange={(e) => setNewComment(e.target.value)}\r\n                onKeyPress={(e) => e.key === 'Enter' && handlePostComment()}\r\n              />\r\n              <Button onClick={handlePostComment} disabled={!newComment.trim()}>Post</Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n        {/* Removed duplicated block from here */}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}