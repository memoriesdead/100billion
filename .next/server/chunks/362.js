"use strict";exports.id=362,exports.ids=[362],exports.modules={30362:(e,s,t)=>{t.d(s,{MainLayout:()=>S});var r=t(60687),a=t(43210),i=t(85814),l=t.n(i),n=t(42692),o=t(35950),c=t(18780),d=t(66464),u=t(32584);function x(){let{user:e}=(0,c.As)(),[s,t]=(0,a.useState)([]),[i,n]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null);return e?i?(0,r.jsx)("div",{className:"px-4 py-2 text-sm text-muted-foreground",children:"Loading following..."}):o?(0,r.jsx)("div",{className:"px-4 py-2 text-sm text-destructive",children:o}):0===s.length?(0,r.jsx)("div",{className:"px-4 py-2 text-sm text-muted-foreground",children:"Not following anyone yet."}):(0,r.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,r.jsxs)(l(),{href:`/profile/${e.username||e.id}`,className:"flex items-center gap-3 px-4 py-2 rounded-md transition-colors w-full text-foreground/80 hover:text-foreground hover:bg-secondary/50",children:[(0,r.jsxs)(u.eu,{className:"h-8 w-8",children:[(0,r.jsx)(u.BK,{src:e.profile_picture_url??void 0,alt:e.username??"User"}),(0,r.jsx)(u.q5,{children:e.username?.charAt(0).toUpperCase()??"U"})]}),(0,r.jsx)("span",{className:"text-sm font-medium truncate",children:e.username??"Unnamed User"})]},e.id))}):null}var p=t(69587),m=t(69556);function f({toggleSearchPanel:e,deactivateSearch:s}){let{user:t}=(0,c.As)(),a=t&&t.user_metadata?.username?`/profile/${t.user_metadata.username}`:"/profile";return(0,r.jsxs)("div",{className:"flex flex-col h-screen w-[240px] border-r border-border pb-4",children:[(0,r.jsx)("div",{className:"p-4 flex-shrink-0",children:(0,r.jsxs)(l(),{href:"/",className:"flex items-center",onClick:s,children:[" ",(0,r.jsx)("span",{className:"text-xl font-bold",children:"SubScroll"})]})}),(0,r.jsxs)(n.F,{className:"flex-1 px-4",children:[(0,r.jsxs)("div",{className:"space-y-2 py-2",children:[(0,r.jsxs)("button",{onClick:e,className:"flex items-center gap-3 px-4 py-4 rounded-md transition-colors w-full text-foreground/80 hover:text-foreground hover:bg-secondary/50",children:[(0,r.jsx)(p.KSO,{size:20}),(0,r.jsx)("span",{className:"text-base",children:"Search"})]}),(0,r.jsx)(h,{href:"/",icon:(0,r.jsx)(p.rQ8,{size:20}),label:"For You",onClick:s}),(0,r.jsx)(h,{href:"/explore",icon:(0,r.jsx)(p.iq2,{size:20}),label:"Explore",onClick:s}),(0,r.jsx)(h,{href:"/following",icon:(0,r.jsx)(m.h7B,{size:20}),label:"Following",onClick:s}),(0,r.jsx)(h,{href:"/messages",icon:(0,r.jsx)(p.maD,{size:20}),label:"Messages",onClick:s})," ",(0,r.jsx)(h,{href:"/upload",icon:(0,r.jsx)(p.HiP,{size:20}),label:"Upload",onClick:s})," ",(0,r.jsx)(h,{href:a,icon:(0,r.jsx)(p.x$1,{size:20}),label:"Profile",onClick:s})]}),(0,r.jsx)(o.w,{className:"my-4"}),(0,r.jsx)(g,{title:"Following",children:(0,r.jsx)(x,{})})]})]})}function h({href:e,icon:s,label:t,active:a,onClick:i}){return(0,r.jsxs)(l(),{href:e,onClick:i,className:`flex items-center gap-3 px-4 py-4 rounded-md transition-colors w-full ${a?"font-semibold bg-secondary":"text-foreground/80 hover:text-foreground hover:bg-secondary/50"}`,children:[s,(0,r.jsx)("span",{className:"text-base",children:t})]})}function g({title:e,children:s}){return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"text-xs uppercase tracking-wider text-muted-foreground",children:e}),(0,r.jsx)("div",{className:"space-y-1",children:s})]})}var j=t(29523),b=t(16189);function v(){let{user:e,loading:s,signInWithGoogle:t,signOut:a}=(0,c.As)();(0,b.useRouter)();let i=async()=>{await t()},n=async()=>{await a()};return(0,r.jsxs)("header",{className:"fixed top-0 right-0 left-[240px] h-16 flex items-center justify-end px-6 bg-background/95 backdrop-blur-sm z-10",children:[" ",(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(l(),{href:"/upload",children:(0,r.jsx)(j.$,{variant:"outline",className:"border-primary text-primary hover:bg-primary/10 font-semibold",children:"Upload"})}),s?(0,r.jsx)(j.$,{disabled:!0,children:"Loading..."}):e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{href:`/profile/${e.user_metadata?.username||e.id}`,passHref:!0,children:(0,r.jsxs)(u.eu,{className:"h-8 w-8 cursor-pointer",children:[(0,r.jsx)(u.BK,{src:e.user_metadata?.avatar_url||void 0,alt:e.user_metadata?.full_name||e.email||"User"}),(0,r.jsx)(u.q5,{children:e.user_metadata?.username?.charAt(0)?.toUpperCase()||e.email?.charAt(0)?.toUpperCase()||"U"})]})}),(0,r.jsx)(j.$,{onClick:n,variant:"outline",children:"Log out"})]}):(0,r.jsx)(j.$,{onClick:i,className:"tiktok-button px-4 py-2 flex items-center gap-2",children:(0,r.jsxs)("span",{children:[(0,r.jsx)(p.DSS,{})," Log in"]})}),(0,r.jsx)(j.$,{variant:"ghost",size:"icon",children:(0,r.jsx)(p.H_v,{})})]})]})}var N=t(89667),y=t(20540),w=t.n(y);function _({isVisible:e,setActiveSearchQuery:s,setIsSearchActive:t,closePanel:i}){(0,b.useRouter)();let[n,o]=(0,a.useState)(""),[c,x]=(0,a.useState)([]),[m,f]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!0),v=(0,a.useRef)(null),y=(0,a.useCallback)(w()(async e=>{if(e.trim().length<1){x([{type:"text",data:"metal sonic edit"},{type:"text",data:"meta quest 3"}]),f(!1);return}f(!0);let s=[];try{let{data:t,error:r}=await d.N.from("profiles").select("id, username, name, profile_picture_url").or(`username.ilike.%${e}%,name.ilike.%${e}%`).limit(4);r?console.error("Profile suggestion error:",r):t&&(s=s.concat(t.map(e=>({type:"profile",data:e}))));let a=["metal sonic edit","metal gear solid","meta quest 3","metallica"].filter(s=>s.toLowerCase().includes(e.toLowerCase())).slice(0,6);(s=s.concat(a.map(e=>({type:"text",data:e})))).sort((e,s)=>"text"===e.type&&"profile"===s.type?-1:+("profile"===e.type&&"text"===s.type)),x(s)}catch(e){console.error("Error fetching suggestions:",e),x([])}finally{f(!1)}},300),[]),_=e=>{let r=e.trim();r&&(o(r),s(r),t(!0))},k=e=>{_(e)},S=()=>{i()};return(0,r.jsxs)("div",{ref:v,className:"fixed left-[240px] top-0 w-[350px] h-full bg-background border-r border-border z-20 flex flex-col shadow-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-border flex-shrink-0",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Search"}),(0,r.jsx)(j.$,{variant:"ghost",size:"icon",onClick:i,"aria-label":"Close search",children:(0,r.jsx)(p.QCr,{className:"h-5 w-5 text-muted-foreground"})})]}),(0,r.jsx)("div",{className:"p-4 flex-shrink-0",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(N.p,{type:"text",placeholder:"Search accounts and videos",value:n,onChange:e=>{let r=e.target.value;o(r),s(r),t(!0)},onKeyDown:e=>"Enter"===e.key&&_(n),className:"bg-secondary border-0 pl-10 pr-10 h-10 rounded-md text-sm focus-visible:ring-1 focus-visible:ring-primary",autoFocus:!0}),(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-muted-foreground pointer-events-none",children:(0,r.jsx)(p.KSO,{size:16})}),n&&(0,r.jsx)(j.$,{type:"button",variant:"ghost",size:"icon",className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground hover:text-foreground h-10 w-10",onClick:()=>{o(""),s(""),x([]),y.cancel()},"aria-label":"Clear search",children:(0,r.jsx)(p.QCr,{className:"h-4 w-4"})})]})}),(0,r.jsxs)("div",{className:"flex-grow overflow-y-auto px-4 pb-4",children:[m&&0===c.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center p-4 text-sm",children:"Searching..."}),!m&&0===c.length&&n.trim().length>0&&(0,r.jsxs)("p",{className:"text-muted-foreground text-center p-4 text-sm",children:['No results found for "',n,'"']}),c.length>0&&(0,r.jsxs)("ul",{className:"space-y-1",children:[c.filter(e=>"text"===e.type).map((e,s)=>(0,r.jsx)("li",{children:(0,r.jsxs)("button",{onClick:()=>k(e.data),className:"flex items-center gap-3 w-full text-left p-2 rounded hover:bg-secondary transition-colors",children:[(0,r.jsx)(p.KSO,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),(0,r.jsx)("span",{className:"text-sm text-foreground truncate",children:e.data})]})},`text-${s}`)),c.filter(e=>"profile"===e.type).length>0&&(0,r.jsx)("li",{className:"px-2 pt-3 pb-1 text-xs font-semibold text-muted-foreground uppercase",children:"Accounts"}),c.filter(e=>"profile"===e.type).map(e=>{let s=e.data;return(0,r.jsx)("li",{children:(0,r.jsxs)(l(),{href:`/profile/${s.username}`,onClick:S,className:"flex items-center gap-3 p-2 rounded hover:bg-secondary transition-colors",children:[(0,r.jsxs)(u.eu,{className:"h-8 w-8",children:[(0,r.jsx)(u.BK,{src:s.profile_picture_url||void 0,alt:s.username||"User"}),(0,r.jsx)(u.q5,{className:"text-xs",children:s.username?.charAt(0)?.toUpperCase()||"U"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-sm text-foreground",children:s.username}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:s.name})]})]})},s.id)})]}),n.trim()&&!m&&(0,r.jsx)("div",{className:"mt-4 pt-4 border-t border-border",children:(0,r.jsxs)("button",{onClick:()=>_(n),className:"flex items-center gap-3 w-full text-left p-2 rounded hover:bg-secondary transition-colors text-primary",children:[(0,r.jsx)(p.KSO,{className:"w-4 h-4"}),(0,r.jsxs)("span",{className:"text-sm font-medium",children:['View all results for "',n,'"']})]})}),!n.trim()&&!m&&0===c.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center p-4 text-sm",children:"Search for accounts or videos."})]})]})}var k=t(60516);function S({children:e}){let[s,t]=(0,a.useState)(""),[i,l]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1);return(0,r.jsxs)("div",{className:"flex min-h-screen bg-background",children:[(0,r.jsx)("div",{className:"fixed left-0 top-0 w-[240px] h-full z-30",children:(0,r.jsx)(f,{toggleSearchPanel:()=>{o(e=>!e)},deactivateSearch:()=>{l(!1),o(!1),t("")}})}),n&&(0,r.jsx)(_,{isVisible:n,setActiveSearchQuery:t,setIsSearchActive:l,closePanel:()=>o(!1)}),(0,r.jsxs)("div",{className:`w-full transition-all duration-200 ease-in-out ${n?"ml-[540px]":"ml-[240px]"}`,children:[" ",(0,r.jsx)("div",{className:`fixed top-0 right-0 transition-all duration-200 ease-in-out z-10 ${n?"left-[540px]":"left-[240px]"}`,children:(0,r.jsx)(v,{})}),(0,r.jsx)("div",{className:"w-full pt-14 h-[calc(100vh-theme(space.14))] overflow-y-auto",children:i&&s.trim()?(0,r.jsx)(k.Y,{searchQuery:s}):e})]})]})}},35950:(e,s,t)=>{t.d(s,{w:()=>n});var r=t(60687),a=t(43210),i=t(62369),l=t(4780);let n=a.forwardRef(({className:e,orientation:s="horizontal",decorative:t=!0,...a},n)=>(0,r.jsx)(i.b,{ref:n,decorative:t,orientation:s,className:(0,l.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...a}));n.displayName=i.b.displayName},42692:(e,s,t)=>{t.d(s,{F:()=>n});var r=t(60687),a=t(43210),i=t(68123),l=t(4780);let n=a.forwardRef(({className:e,children:s,...t},a)=>(0,r.jsxs)(i.bL,{ref:a,className:(0,l.cn)("relative overflow-hidden",e),...t,children:[(0,r.jsx)(i.LM,{className:"h-full w-full rounded-[inherit]",children:s}),(0,r.jsx)(o,{}),(0,r.jsx)(i.OK,{})]}));n.displayName=i.bL.displayName;let o=a.forwardRef(({className:e,orientation:s="vertical",...t},a)=>(0,r.jsx)(i.VM,{ref:a,orientation:s,className:(0,l.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...t,children:(0,r.jsx)(i.lr,{className:"relative flex-1 rounded-full bg-border"})}));o.displayName=i.VM.displayName},54987:(e,s,t)=>{t.d(s,{d:()=>n});var r=t(60687),a=t(43210),i=t(90270),l=t(4780);let n=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)(i.bL,{className:(0,l.cn)("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...s,ref:t,children:(0,r.jsx)(i.zi,{className:(0,l.cn)("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));n.displayName=i.bL.displayName},60516:(e,s,t)=>{t.d(s,{Y:()=>S});var r=t(60687),a=t(43210),i=t(16189),l=t(66464),n=t(18780),o=t(39509),c=t(69507),d=t(29523),u=t(85535),x=t(69861),p=t(57207),m=t(63503),f=t(8693),h=t(54050),g=t(80013),j=t(89667),b=t(54987),v=t(36558),N=t(11516),y=t(37590),w=t(88920),_=t(163);function k({isOpen:e,onOpenChange:s,postData:t,onSaveSuccess:i}){let o=(0,f.jE)(),{user:c}=(0,n.As)(),[u,x]=(0,a.useState)(!1),[p,k]=(0,a.useState)(""),[S,C]=(0,a.useState)(null),P=(0,h.n)({mutationFn:async e=>{if(!t)throw Error("No post data available for update.");C(null);let s={is_for_sale:e.is_for_sale,price:e.is_for_sale?e.newPriceInCents:null,currency:e.is_for_sale?"usd":null,stripe_product_id:e.is_for_sale?t.stripe_product_id:null,stripe_price_id:e.is_for_sale?t.stripe_price_id:null},{error:r}=await l.N.from("posts").update(s).eq("id",t.id);if(r)throw r},onSuccess:()=>{y.oR.success("Post sale status updated!"),o.invalidateQueries({queryKey:["posts"]}),o.invalidateQueries({queryKey:["posts",t?.user_id]}),o.invalidateQueries({queryKey:["homeFeedPosts",c?.id]}),i&&i(),s(!1)},onError:e=>{let s=e instanceof Error?e.message:String(e);console.error("Failed to update post sale status:",e),C(s||"Failed to update post."),y.oR.error(`Update failed: ${s}`)}});return t?(0,r.jsx)(m.lG,{open:e,onOpenChange:s,children:(0,r.jsxs)(m.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(m.c7,{children:[(0,r.jsx)(m.L3,{children:"Edit Post Sale Status"}),(0,r.jsx)(m.rr,{children:"Update whether this post is for sale and set its price."})]}),(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!t)return;let s=null;if(u){if(!p||isNaN(parseFloat(p)))return void C("Please enter a valid price.");if((s=Math.round(100*parseFloat(p)))<50)return void C("Price must be at least $0.50.")}let r={is_for_sale:u,newPriceInCents:u?s:null};P.mutate(r)},children:[(0,r.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between space-x-2",children:[(0,r.jsxs)(g.J,{htmlFor:"sale-switch-edit",className:"flex flex-col space-y-1",children:[(0,r.jsx)("span",{children:"Mark as For Sale"}),(0,r.jsx)("span",{className:"font-normal leading-snug text-muted-foreground",children:"Enable this to set a price for direct purchase."})]}),(0,r.jsx)(b.d,{id:"sale-switch-edit",checked:u,onCheckedChange:x,disabled:P.isPending})]}),(0,r.jsx)(w.N,{children:u&&(0,r.jsxs)(_.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden space-y-2",children:[(0,r.jsx)(g.J,{htmlFor:"sale-price-edit",children:"Price (USD)"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(v.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,r.jsx)(j.p,{id:"sale-price-edit",type:"number",value:p,onChange:e=>k(e.target.value),placeholder:"e.g., 5.00",className:"pl-8",step:"0.01",min:"0.50",disabled:P.isPending,required:u})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Minimum price is $","0.50","."]})]},"price-input-edit")}),S&&(0,r.jsx)("p",{className:"text-sm text-red-600 text-center",children:S})]}),(0,r.jsxs)(m.Es,{children:[(0,r.jsx)(m.HM,{asChild:!0,children:(0,r.jsx)(d.$,{type:"button",variant:"outline",disabled:P.isPending,children:"Cancel"})}),(0,r.jsxs)(d.$,{type:"submit",disabled:P.isPending,children:[P.isPending&&(0,r.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})]})}):null}function S({userId:e,searchQuery:s,followedUserIds:t,allowDeletion:h=!1}){let g=(0,i.useRouter)(),{user:j}=(0,n.As)(),b=(0,f.jE)(),[v,N]=(0,a.useState)([]),[w,_]=(0,a.useState)(!0),[S,C]=(0,a.useState)(null),[P,U]=(0,a.useState)(null),[z,$]=(0,a.useState)(!1),[E,L]=(0,a.useState)(null),[A,F]=(0,a.useState)(!1),[R,I]=(0,a.useState)(null),D=(0,a.useCallback)(async s=>{if(!P){U(s),C(null);try{if(!v.find(e=>e.id===s))throw Error("Post not found.");let{error:t}=await l.N.from("posts").delete().eq("id",s);if(t)throw t;N(e=>e.filter(e=>e.id!==s)),b.invalidateQueries({queryKey:["posts",e]})}catch(s){let e=s instanceof Error?s.message:String(s);C(`Failed to delete post: ${e}`)}finally{U(null),L(null),$(!1)}}},[v,P,b,e]);if(w)return(0,r.jsx)("div",{className:"text-center p-4",children:"Loading posts..."});if(S)return(0,r.jsx)("div",{className:"text-center text-red-500 p-4",children:S});if(0===v.length)return(0,r.jsx)("div",{className:"text-center text-muted-foreground p-4",children:"No posts found."});let q=e=>{L(e),$(!0)},K=e=>{I(e),F(!0)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-4",children:v.map(e=>{let s,t=j?.id===e.user_id,a=e.is_private&&!t,i=!a;return s="video"===e.type&&e.video_url?(0,r.jsx)(o.Z,{id:e.id,userId:e.user_id,username:e.profiles?.username||"Unknown User",profilePictureUrl:e.profiles?.profile_picture_url||void 0,caption:e.caption||"",videoSrc:e.video_url,likes:(e.likes_count??0).toString(),comments:(e.comments_count??0).toString(),shares:"0",isPrivate:e.is_private,isOwner:t,is_for_sale:e.is_for_sale,price:e.price,currency:e.currency,stripe_price_id:e.stripe_price_id,isLocked:null===a?void 0:a,isPaidContent:null===e.is_private?void 0:e.is_private}):"image"===e.type&&e.image_url?(0,r.jsx)(c.S,{id:e.id,userId:e.user_id,username:e.profiles?.username||"Unknown User",profilePictureUrl:e.profiles?.profile_picture_url||void 0,caption:e.caption,imageUrl:e.image_url,likes:e.likes_count??0,comments:(e.comments_count??0).toString(),shares:"0",isPrivate:e.is_private??!1,isOwner:t,initialIsLiked:!1,is_for_sale:e.is_for_sale,price:e.price,currency:e.currency,stripe_price_id:e.stripe_price_id,isLocked:null===a?void 0:a,isPaidContent:null===e.is_private?void 0:e.is_private}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-800 text-white text-xs p-2",children:"Invalid post data"}),(0,r.jsxs)("div",{className:"aspect-[9/16] overflow-hidden rounded-lg relative group bg-black cursor-pointer",onClick:()=>{if(i){let s="video"===e.type?`/video/${e.id}`:`/image/${e.id}`;g.push(s)}else(0,y.oR)("Subscription required to view this content.")},children:[(0,r.jsxs)(r.Fragment,{children:[s,!i&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10 pointer-events-none",children:(0,r.jsx)(u.A,{className:"h-10 w-10 text-white/80"})})]}),h&&t&&(0,r.jsxs)("div",{className:"absolute top-2 left-2 z-40 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,r.jsx)(d.$,{variant:"outline",size:"icon",className:"h-7 w-7 bg-black/50 hover:bg-black/70 border-white/30 text-white",onClick:s=>{s.stopPropagation(),s.preventDefault(),K(e)},"aria-label":"Edit post",children:(0,r.jsx)(x.A,{className:"h-4 w-4"})}),(0,r.jsx)(d.$,{variant:"destructive",size:"icon",className:"h-7 w-7 bg-black/50 hover:bg-red-700",onClick:s=>{s.stopPropagation(),s.preventDefault(),q(e.id)},disabled:P===e.id,"aria-label":"Delete post",children:P===e.id?(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"}):(0,r.jsx)(p.A,{className:"h-4 w-4"})})]}),P===e.id&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white z-50",children:"Deleting..."})]},e.id)})}),(0,r.jsx)(m.lG,{open:z,onOpenChange:$,children:(0,r.jsxs)(m.Cf,{children:[(0,r.jsxs)(m.c7,{children:[(0,r.jsx)(m.L3,{children:"Confirm Deletion"}),(0,r.jsx)(m.rr,{children:"Are you sure you want to permanently delete this post? This action cannot be undone."})]}),(0,r.jsxs)(m.Es,{children:[(0,r.jsx)(d.$,{variant:"outline",onClick:()=>$(!1),disabled:!!P,children:"Cancel"}),(0,r.jsx)(d.$,{variant:"destructive",onClick:()=>{E&&D(E)},disabled:!!P,children:P?"Deleting...":"Delete Post"})]})]})}),R&&(0,r.jsx)(k,{isOpen:A,onOpenChange:F,postData:{id:R.id,user_id:R.user_id,caption:R.caption,is_for_sale:R.is_for_sale,price:R.price,currency:R.currency,stripe_product_id:R.stripe_product_id,stripe_price_id:R.stripe_price_id},onSaveSuccess:()=>{b.invalidateQueries({queryKey:["posts",e]}),b.invalidateQueries({queryKey:["posts"]}),I(null)}})]})}},63503:(e,s,t)=>{t.d(s,{Cf:()=>p,Es:()=>f,HM:()=>u,L3:()=>h,c7:()=>m,lG:()=>o,rr:()=>g,zM:()=>c});var r=t(60687),a=t(43210),i=t(4408),l=t(78726),n=t(4780);let o=i.bL,c=i.l9,d=i.ZL,u=i.bm,x=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)(i.hJ,{ref:t,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));x.displayName=i.hJ.displayName;let p=a.forwardRef(({className:e,children:s,...t},a)=>(0,r.jsxs)(d,{children:[(0,r.jsx)(x,{}),(0,r.jsxs)(i.UC,{ref:a,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[s,(0,r.jsxs)(i.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(l.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));p.displayName=i.UC.displayName;let m=({className:e,...s})=>(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});m.displayName="DialogHeader";let f=({className:e,...s})=>(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});f.displayName="DialogFooter";let h=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)(i.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",e),...s}));h.displayName=i.hE.displayName;let g=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)(i.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",e),...s}));g.displayName=i.VY.displayName},69507:(e,s,t)=>{t.d(s,{S:()=>j});var r=t(60687),a=t(43210),i=t(85814),l=t.n(i),n=t(16189),o=t(46569),c=t(11516),d=t(19379),u=t(29523),x=t(96834),p=t(39010),m=t(37590),f=t(69587);let h=(0,p.c)(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY),g=(e,s="usd")=>new Intl.NumberFormat("en-US",{style:"currency",currency:s.toUpperCase()}).format(e/100);function j({id:e,userId:s,username:t,profilePictureUrl:i,caption:p,imageUrl:j,likes:b,comments:v,shares:N,isPrivate:y,isOwner:w,initialIsLiked:_,is_for_sale:k,price:S,currency:C,stripe_price_id:P,isLocked:U}){(0,n.useRouter)();let[z,$]=(0,a.useState)(!1);t.charAt(0).toUpperCase();let E=k||U,L=async s=>{if(s.preventDefault(),s.stopPropagation(),!k)return;$(!0);let t="";try{let s=await fetch("/api/stripe/create-item-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:e})}),r=await s.json();if(t=r.sessionId,!s.ok||!t)throw Error(r.error||"Failed to create session.");let a=await h;if(!a)throw Error("Stripe.js failed.");let{error:i}=await a.redirectToCheckout({sessionId:t});if(i)throw Error(i.message||"Redirect failed.")}catch(s){let e=s instanceof Error?s.message:"Unknown error.";m.oR.error(`Purchase failed: ${e}`),t&&console.error("Session ID:",t)}finally{$(!1)}};function A(){return(0,r.jsxs)("div",{className:"relative w-full h-full bg-black flex items-center justify-center overflow-hidden",children:[E?(0,r.jsx)("div",{className:"w-full h-full bg-black"}):(0,r.jsx)("img",{src:j,alt:p||"User uploaded image",className:"w-full h-full object-contain",loading:"lazy"}),k&&(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none",children:[(0,r.jsx)(f.JhU,{className:"text-4xl mb-2 text-white"}),(0,r.jsx)("span",{className:"text-sm font-semibold text-white",children:"Purchase to View"}),S&&C&&(0,r.jsx)(x.E,{variant:"secondary",className:"mt-1.5 text-sm font-bold",children:g(S,C)}),z&&(0,r.jsx)(c.A,{className:"absolute top-4 right-4 h-5 w-5 animate-spin text-white"})]}),U&&!k&&(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none bg-black/60",children:[(0,r.jsx)(f.JhU,{className:"text-4xl mb-2 text-white"}),(0,r.jsx)("span",{className:"text-xs font-semibold text-white",children:"Subscribe to View"})]}),!E&&p&&(0,r.jsx)("div",{className:"absolute inset-x-0 bottom-0 z-10 p-4 pointer-events-none bg-gradient-to-t from-black/60 via-black/30 to-transparent",children:(0,r.jsx)("p",{className:"text-white text-sm truncate",children:p})})]})}return(0,r.jsxs)("div",{className:"relative w-full h-full bg-black flex items-center justify-center overflow-hidden group",children:[E?(0,r.jsx)("div",{className:"block w-full h-full cursor-default",children:(0,r.jsx)(A,{})}):(0,r.jsx)(l(),{href:`/image/${e}`,className:"block w-full h-full",children:(0,r.jsx)(A,{})}),(0,r.jsx)(o.M,{postId:e,userId:s,username:t,profilePictureUrl:i,initialLikes:b,initialIsLiked:_,commentsCount:v,sharesCount:N,initialIsPrivate:y??!1,isOwner:w,postType:"image",is_for_sale:k,price:S,currency:C}),k&&(0,r.jsxs)(u.$,{variant:"default",size:"sm",className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-30 h-8 px-4 text-sm bg-pink-600 hover:bg-pink-700 text-white rounded-full",onClick:L,disabled:z,"aria-label":`Buy ${p||"image"}`,children:[z?(0,r.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(d.A,{className:"mr-2 h-4 w-4"}),z?"Processing...":"Buy"]})]})}},80013:(e,s,t)=>{t.d(s,{J:()=>c});var r=t(60687),a=t(43210),i=t(78148),l=t(24224),n=t(4780);let o=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef(({className:e,...s},t)=>(0,r.jsx)(i.b,{ref:t,className:(0,n.cn)(o(),e),...s}));c.displayName=i.b.displayName}};