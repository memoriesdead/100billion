(()=>{var e={};e.id=2730,e.ids=[2730],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},18116:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var a=r(60687),s=r(43210),i=r(24851),l=r(4780);let o=s.forwardRef(({className:e,...t},r)=>(0,a.jsxs)(i.bL,{ref:r,className:(0,l.cn)("relative flex w-full touch-none select-none items-center",e),...t,children:[(0,a.jsx)(i.CC,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,a.jsx)(i.Q6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(i.zi,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));o.displayName=i.bL.displayName},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},60948:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var a=r(60687),s=r(43210),i=r.n(s),l=r(16189),o=r(29523),n=r(18780),c=r(66464),d=r(89667),u=r(80013),p=r(32584),m=r(22439),h=r(35169);r(44140);var g=r(63503),f=r(18116);async function x(e,t,r=1){let a=document.createElement("canvas"),s=a.getContext("2d");if(!s)throw Error("No 2d context");let i=e.naturalWidth/e.width,l=e.naturalHeight/e.height;a.width=Math.floor(t.width*i*1),a.height=Math.floor(t.height*l*1),s.scale(1,1),s.imageSmoothingQuality="high";let o=t.x*i,n=t.y*l,c=e.naturalWidth/2,d=e.naturalHeight/2;return s.save(),s.translate(-o,-n),s.translate(c,d),s.scale(r,r),s.translate(-c,-d),s.drawImage(e,0,0,e.naturalWidth,e.naturalHeight,0,0,e.naturalWidth,e.naturalHeight),s.restore(),new Promise((e,t)=>{a.toBlob(r=>{if(!r){console.error("Canvas is empty"),t(Error("Canvas is empty"));return}e(r)},"image/png")})}function b({isOpen:e,onClose:t,imageSrc:r,aspect:i,circularCrop:l=!1,onApply:n,title:c="Edit photo"}){let d=(0,s.useRef)(null),[p,m]=(0,s.useState)(),[b,v]=(0,s.useState)(),[y,j]=(0,s.useState)(1),[w,C]=(0,s.useState)(null),k=async()=>{if(C(null),!b||!d.current||!r){console.error("Crop details, image ref, or image source not available"),C("Could not apply crop. Please ensure an image is loaded and selected.");return}if(0===b.width||0===b.height)return void C("Invalid crop dimensions. Please select an area to crop.");try{let e=await x(d.current,b,y);e?(n(e),t()):C("Failed to generate cropped image.")}catch(t){console.error("Error cropping image:",t);let e=t instanceof Error?t.message:"Unknown error";C(`Could not crop the image: ${e}. Please try again.`)}},N=()=>{C(null),t()};return(0,a.jsx)(g.lG,{open:e,onOpenChange:e=>!e&&N(),children:(0,a.jsxs)(g.Cf,{className:"sm:max-w-[625px] bg-black text-white border-gray-800",children:[(0,a.jsx)(g.c7,{children:(0,a.jsx)(g.L3,{className:"text-white",children:c})}),w&&(0,a.jsx)("p",{className:"text-sm text-red-600 px-6 pb-2",children:w}),(0,a.jsx)("div",{className:"relative flex justify-center items-center overflow-hidden p-4",style:{maxHeight:"70vh"},children:r?(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4 w-full",children:[(0,a.jsx)(h.Ay,{crop:p,onChange:(e,t)=>m(t),onComplete:e=>v(e),aspect:i,circularCrop:l,keepSelection:!0,children:(0,a.jsx)("img",{ref:d,alt:"Crop preview",src:r,style:{transform:`scale(${y})`,objectFit:"contain",width:"100%",height:"auto",maxHeight:"60vh"},onLoad:function(e){let{width:t,height:r}=e.currentTarget;if(t>0&&r>0)m((0,h.ge)((0,h.dS)({unit:"%",width:90},i,t,r),t,r));else C("Could not load image dimensions.")},onError:()=>C("Failed to load image for cropping.")})}),(0,a.jsxs)("div",{className:"w-full max-w-xs flex items-center space-x-2 mt-4 px-4 self-center",children:[(0,a.jsx)(u.J,{htmlFor:"zoom",className:"w-12 text-sm text-gray-400",children:"Zoom"}),(0,a.jsx)(f.A,{id:"zoom",min:1,max:3,step:.01,value:[y],onValueChange:e=>j(e[0]),className:"flex-1 [&>span:first-child]:h-1 [&>span:first-child>span]:bg-white [&>span:last-child]:bg-gray-600 [&>span:last-child]:border-0"})]})]}):(0,a.jsx)("p",{className:"text-gray-400",children:"No image selected for cropping."})}),(0,a.jsxs)(g.Es,{className:"bg-black pt-4 pb-6 px-6 border-t border-gray-800 sm:justify-between",children:[(0,a.jsx)(o.$,{type:"button",variant:"ghost",onClick:N,className:"text-white hover:bg-gray-700",children:"Cancel"}),(0,a.jsx)(o.$,{type:"button",onClick:k,disabled:!b||0===b.width||0===b.height||!r,className:"bg-red-600 hover:bg-red-700 text-white",children:"Apply"})]})]})})}function v({id:e,label:t,initialImageUrl:r=null,aspect:i,circularCrop:l=!1,onFileChange:n,disabled:c=!1,previewType:h="avatar",buttonText:g="Change Picture",modalTitle:f="Edit photo"}){let[x,v]=(0,s.useState)(r),[y,j]=(0,s.useState)(null),[w,C]=(0,s.useState)(!1),k=(0,s.useRef)(null),[N,$]=(0,s.useState)(null),P=()=>{k.current?.click()};return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:e,className:"text-sm font-medium",children:t}),N&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:N}),(0,a.jsx)(d.p,{id:e,type:"file",accept:"image/png, image/jpeg, image/webp",ref:k,onChange:e=>{$(null);let t=e.target.files?.[0];if(t){if(!t.type.startsWith("image/")){$("Invalid file type. Please select an image."),k.current&&(k.current.value="");return}let e=new FileReader;e.onloadend=()=>{j(e.result),C(!0)},e.onerror=()=>{$("Failed to read the selected file."),j(null)},e.readAsDataURL(t)}else j(null);k.current&&(k.current.value="")},className:"hidden",disabled:c}),"banner"===h?(0,a.jsxs)("div",{className:"relative w-full h-32 bg-muted rounded-md border border-dashed border-border flex items-center justify-center cursor-pointer hover:border-primary transition-colors",onClick:P,title:"Click to change banner",children:[x?(0,a.jsx)("img",{src:x,alt:`${t} Preview`,className:"w-full h-full object-cover rounded-md"},x):(0,a.jsxs)("span",{className:"text-muted-foreground text-sm",children:["Click to upload ",t.toLowerCase()]}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity rounded-md",children:(0,a.jsx)(m.A,{className:"text-white h-8 w-8"})})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative cursor-pointer",onClick:P,title:`Click to change ${t.toLowerCase()}`,children:[(0,a.jsxs)(p.eu,{className:"w-24 h-24 border-2 border-muted",children:[(0,a.jsx)(p.BK,{src:x??void 0,alt:`${t} Preview`},x),(0,a.jsx)(p.q5,{className:"text-3xl",children:"??"})]}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity rounded-full",children:(0,a.jsx)(m.A,{className:"text-white h-6 w-6"})})]}),(0,a.jsx)(o.$,{type:"button",variant:"link",size:"sm",onClick:P,disabled:c,className:"text-sm",children:g})]}),"banner"===h&&(0,a.jsx)(o.$,{type:"button",variant:"link",size:"sm",onClick:P,disabled:c,className:"text-sm -mt-1",children:g}),y&&(0,a.jsx)(b,{isOpen:w,onClose:()=>{C(!1),j(null)},imageSrc:y,aspect:i,circularCrop:l,onApply:t=>{$(null);let r=y?.match(/data:image\/(.+);/),a=r?r[1]:"png",s=new File([t],`${e}_cropped_${Date.now()}.${a}`,{type:`image/${a}`});v(URL.createObjectURL(t)),n(s),C(!1),j(null)},title:f})]})}function y({id:e,label:t,initialVideoUrl:r=null,onFileChange:i,disabled:l=!1,buttonText:n="Change Video"}){let[c,p]=(0,s.useState)(r),h=(0,s.useRef)(null),[g,f]=(0,s.useState)(null),x=()=>{h.current?.click()};return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:e,className:"text-sm font-medium",children:t}),g&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:g}),(0,a.jsx)(d.p,{id:e,type:"file",accept:"video/mp4, video/webm, video/quicktime, video/ogg",ref:h,onChange:e=>{f(null);let t=e.target.files?.[0];if(t){if(!t.type.startsWith("video/")){f("Invalid file type. Please select a video."),h.current&&(h.current.value=""),i(null),p(r);return}p(URL.createObjectURL(t)),i(t)}else p(r),i(null);h.current&&(h.current.value="")},className:"hidden",disabled:l}),(0,a.jsxs)("div",{className:"relative w-full h-32 bg-muted rounded-md border border-dashed border-border flex items-center justify-center cursor-pointer hover:border-primary transition-colors",onClick:x,title:`Click to change ${t.toLowerCase()}`,children:[c?(0,a.jsx)("video",{src:c,className:"w-full h-full object-cover rounded-md",autoPlay:!0,loop:!0,muted:!0,playsInline:!0},c):(0,a.jsxs)("span",{className:"text-muted-foreground text-sm",children:["Click to upload ",t.toLowerCase()]}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity rounded-md",children:(0,a.jsx)(m.A,{className:"text-white h-8 w-8"})})]}),(0,a.jsx)(o.$,{type:"button",variant:"link",size:"sm",onClick:x,disabled:l,className:"text-sm -mt-1",children:n})]})}let j=e=>{if(!e)return null;try{let t=new URL(e).pathname,r=t.split(".").pop()?.toLowerCase();if(r&&["mp4","webm","mov","ogg","mkv","avi"].includes(r))return"video";return r&&["png","jpg","jpeg","gif","webp"].includes(r),"image"}catch(t){return console.warn("Could not parse URL to determine media type:",e,t),null}};function w({initialProfileImageUrl:e,initialBannerImageUrl:t,initialProfilePath:r,initialBannerPath:l,onSave:d,onCancel:u}){let{user:p}=(0,n.As)(),[m,h]=(0,s.useState)(null),[g,f]=(0,s.useState)(null),[x,b]=(0,s.useState)(!1),[w,C]=(0,s.useState)(null),[k,N]=(0,s.useState)(j(t)),$=async(e,t,a)=>{if(!p)throw Error("User not authenticated.");let s=t.name.split(".").pop(),i=`${a}.${s}`,o=`${p.id}/${i}`,n=t.type;console.log(`Uploading ${a} (${n}) to: ${e}/${o}`);let d="profile"===a?r:l;if(d)try{console.log(`Attempting to remove old ${a} file from storage: ${d}`);let{error:t}=await c.N.storage.from(e).remove([d]);t&&"The resource was not found"!==t.message?console.warn(`Failed to remove old ${a} file at ${d}:`,t.message):t||console.log(`Successfully removed old ${a} file: ${d}`)}catch(e){console.warn(`Error during removal of old ${a} file:`,e instanceof Error?e.message:String(e))}else console.log(`No initial ${a} path provided for deletion.`);let{data:u,error:m}=await c.N.storage.from(e).upload(o,t,{cacheControl:"3600",upsert:!0,contentType:n});if(m)throw console.error(`Upload error for ${a}:`,m),Error(`Failed to upload ${a} file: ${m.message}`);return console.log(`Successfully uploaded ${a} to ${u?.path}`),u?.path??null},P=async e=>{if(e.preventDefault(),!p)return void C("Cannot save images. User not authenticated.");if(!m&&!g)return void C("No new images or videos selected to save.");b(!0),C(null);try{let e,t;if(m&&(e=await $("avatars",m,"profile"),null===e))throw Error("Failed to get profile picture storage path after upload.");if(g&&(t=await $("banners",g,"banner"),null===t))throw Error("Failed to get banner image storage path after upload.");let r={updated_at:new Date().toISOString()},a=!1;if(void 0!==e&&(r.profile_picture_url=e,a=!0),void 0!==t&&(r.banner_image_url=t,a=!0),a){console.log("Updating profile images data in DB:",r);let{error:e}=await c.N.from("profiles").update(r).eq("id",p.id);if(e)throw console.error("Database update error:",e),Error(`Failed to update profile data: ${e.message}`);console.log("Profile images updated successfully in DB!")}else console.log("No new files were uploaded, skipping database update.");d()}catch(t){let e=t instanceof Error?t.message:String(t);console.error("Failed to update profile images:",t),C(`Failed to update images: ${e}. Please try again.`)}finally{b(!1)}};return(0,a.jsx)(i().Fragment,{children:(0,a.jsxs)("form",{onSubmit:P,className:"space-y-6 p-4 border rounded-lg shadow-sm bg-card",children:[w&&(0,a.jsx)("p",{className:"text-sm text-red-600 mb-4",children:w}),"video"===k?(0,a.jsx)(y,{id:"bannerVideo",label:"Banner Video",initialVideoUrl:t,onFileChange:f,disabled:x,buttonText:"Change Banner"}):(0,a.jsx)(v,{id:"bannerImage",label:"Banner Image",initialImageUrl:t,aspect:16/9,circularCrop:!1,onFileChange:f,disabled:x,previewType:"banner",buttonText:"Change Banner",modalTitle:"Edit banner photo"}),(0,a.jsx)(v,{id:"profilePicture",label:"Profile Picture",initialImageUrl:e,aspect:1,circularCrop:!0,onFileChange:h,disabled:x,previewType:"avatar",buttonText:"Change Picture",modalTitle:"Edit profile photo"}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)(o.$,{type:"button",variant:"outline",onClick:u,disabled:x,children:"Cancel"}),(0,a.jsx)(o.$,{type:"submit",disabled:x||!m&&!g,children:x?"Saving...":"Save Changes"})]})]})})}var C=r(30362);function k(){let e=(0,l.useRouter)(),{user:t}=(0,n.As)(),[r,i]=(0,s.useState)(null),[o,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[p,m]=(0,s.useState)(null),[h,g]=(0,s.useState)(!0),[f,x]=(0,s.useState)(null);return(0,a.jsx)(C.MainLayout,{children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Edit Profile Images"}),h&&(0,a.jsx)("p",{children:"Loading profile data..."}),f&&(0,a.jsxs)("p",{className:"text-red-600",children:["Error: ",f]}),!h&&!f&&t&&(0,a.jsx)(w,{initialProfileImageUrl:r,initialBannerImageUrl:o,initialProfilePath:d,initialBannerPath:p,onSave:()=>{console.log("Profile images saved successfully, navigating back."),e.push("/profile/edit")},onCancel:()=>{console.log("Image editing cancelled."),e.back()}}),!h&&!t&&!f&&(0,a.jsx)("p",{children:"Please log in to edit your profile images."})]})})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63386:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\kevin\\\\Desktop\\\\tiktok-clone\\\\src\\\\app\\\\profile\\\\edit-picture\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\kevin\\Desktop\\tiktok-clone\\src\\app\\profile\\edit-picture\\page.tsx","default")},73412:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var a=r(65239),s=r(48088),i=r(88170),l=r.n(i),o=r(30893),n={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);r.d(t,n);let c={children:["",{children:["profile",{children:["edit-picture",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,63386)),"C:\\Users\\kevin\\Desktop\\tiktok-clone\\src\\app\\profile\\edit-picture\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"C:\\Users\\kevin\\Desktop\\tiktok-clone\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,d=["C:\\Users\\kevin\\Desktop\\tiktok-clone\\src\\app\\profile\\edit-picture\\page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/profile/edit-picture/page",pathname:"/profile/edit-picture",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},82380:(e,t,r)=>{Promise.resolve().then(r.bind(r,63386))},88460:(e,t,r)=>{Promise.resolve().then(r.bind(r,60948))},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,353,2733,5597,2321,1137,9510,3268,1191,9509,362],()=>r(73412));module.exports=a})();