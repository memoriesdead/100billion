(()=>{var e={};e.id=6654,e.ids=[6654],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19571:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>_,workUnitAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{POST:()=>l});var o=t(96559),i=t(48088),n=t(37719),c=t(32190),a=t(97877),u=t(56278);let p=new a.A(process.env.STRIPE_SECRET_KEY);async function l(e){let r=new URL(e.url).origin;try{let{postId:t}=await e.json();if(!t)return c.NextResponse.json({error:"Post ID (postId) is required"},{status:400});console.log(`Creating item checkout session for Post ID: ${t}`);let{data:s,error:o}=await u.N.from("posts").select("caption, price, currency, user_id, is_for_sale").eq("id",t).single();if(o)return console.error("Error fetching post:",o),c.NextResponse.json({error:"Failed to fetch post details"},{status:500});if(!s||!s.is_for_sale||!s.price||s.price<=0)return console.error("Post not found, not for sale, or invalid price:",s),c.NextResponse.json({error:"This item is not available for purchase."},{status:400});let i=s.price,n=s.currency||"usd",a=s.caption||"Digital Content Purchase",l="";try{l=(await p.prices.create({currency:n,unit_amount:i,product_data:{name:a}})).id,console.log(`Dynamically created Stripe Price ID: ${l}`)}catch(e){return console.error("Error creating Stripe price:",e),c.NextResponse.json({error:"Failed to prepare payment details."},{status:500})}let d=`${r}/profile?purchase=success&session_id={CHECKOUT_SESSION_ID}`,_=`${r}/profile?purchase=cancel`;console.log(`Success URL: ${d}`),console.log(`Cancel URL: ${_}`);let x=await p.checkout.sessions.create({payment_method_types:["card"],mode:"payment",line_items:[{price:l,quantity:1}],success_url:d,cancel_url:_});return console.log("Stripe item checkout session created:",x.id),c.NextResponse.json({sessionId:x.id})}catch(e){return console.error("Error creating Stripe item checkout session:",e),e instanceof Error&&e.message,c.NextResponse.json({error:"Failed to create checkout session."},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/stripe/create-item-checkout-session/route",pathname:"/api/stripe/create-item-checkout-session",filename:"route",bundlePath:"app/api/stripe/create-item-checkout-session/route"},resolvedPagePath:"C:\\Users\\kevin\\Downloads\\Clone-https___www.tiktok.com_\\temp_unzip\\tiktok-clone\\src\\app\\api\\stripe\\create-item-checkout-session\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:_,workUnitAsyncStorage:x,serverHooks:m}=d;function h(){return(0,n.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:x})}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56278:(e,r,t)=>{"use strict";t.d(r,{N:()=>n});var s=t(86345);let o=process.env.NEXT_PUBLIC_SUPABASE_URL,i=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!o)throw Error("Supabase URL is missing. Make sure NEXT_PUBLIC_SUPABASE_URL is set in your environment variables.");if(!i)throw Error("Supabase Anon Key is missing. Make sure NEXT_PUBLIC_SUPABASE_ANON_KEY is set in your environment variables.");let n=(0,s.UU)(o,i,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,3472],()=>t(19571));module.exports=s})();