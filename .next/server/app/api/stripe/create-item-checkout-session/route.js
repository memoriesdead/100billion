(()=>{var e={};e.id=6654,e.ids=[6654],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9604:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>f,routeModule:()=>d,serverHooks:()=>x,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>h});var t={};s.r(t),s.d(t,{POST:()=>l});var i=s(96559),o=s(48088),n=s(37719),c=s(32190),a=s(97877),u=s(56278);let p=new a.A(process.env.STRIPE_SECRET_KEY);async function l(e){let r=new URL(e.url).origin;try{let{postId:s}=await e.json();if(!s)return c.NextResponse.json({error:"Post ID (postId) is required"},{status:400});console.log(`Creating item checkout session for Post ID: ${s}`);let{data:t,error:i}=await u.N.from("posts").select("caption, price, currency, user_id, is_for_sale").eq("id",s).single();if(i)return console.error("Error fetching post:",i),c.NextResponse.json({error:"Failed to fetch post details"},{status:500});if(!t||!t.is_for_sale||!t.price||t.price<=0)return console.error("Post not found, not for sale, or invalid price:",t),c.NextResponse.json({error:"This item is not available for purchase."},{status:400});let o=t.price,n=t.currency||"usd",a=t.caption||"Digital Content Purchase",l="";try{l=(await p.prices.create({currency:n,unit_amount:o,product_data:{name:a}})).id,console.log(`Dynamically created Stripe Price ID: ${l}`)}catch(e){return console.error("Error creating Stripe price:",e),c.NextResponse.json({error:"Failed to prepare payment details."},{status:500})}let d=`${r}/profile?purchase=success&session_id={CHECKOUT_SESSION_ID}`,m=`${r}/profile?purchase=cancel`;console.log(`Success URL: ${d}`),console.log(`Cancel URL: ${m}`);let h=await p.checkout.sessions.create({payment_method_types:["card"],mode:"payment",line_items:[{price:l,quantity:1}],success_url:d,cancel_url:m});return console.log("Stripe item checkout session created:",h.id),c.NextResponse.json({sessionId:h.id})}catch(e){return console.error("Error creating Stripe item checkout session:",e),e instanceof Error&&e.message,c.NextResponse.json({error:"Failed to create checkout session."},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/stripe/create-item-checkout-session/route",pathname:"/api/stripe/create-item-checkout-session",filename:"route",bundlePath:"app/api/stripe/create-item-checkout-session/route"},resolvedPagePath:"C:\\Users\\kevin\\Desktop\\tiktok-clone\\src\\app\\api\\stripe\\create-item-checkout-session\\route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:m,workUnitAsyncStorage:h,serverHooks:x}=d;function f(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:h})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56278:(e,r,s)=>{"use strict";s.d(r,{N:()=>n});var t=s(86345);let i="https://bhdufveahujzsaofatnx.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJoZHVmdmVhaHVqenNhb2ZhdG54Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQzNTcwMDksImV4cCI6MjA1OTkzMzAwOX0.3qMmS0VkWLLyxNv-IJCoEYPs7y83m1Pjj5mxrwd3res";if(!i)throw Error("Supabase URL is missing. Make sure NEXT_PUBLIC_SUPABASE_URL is set in your environment variables.");if(!o)throw Error("Supabase Anon Key is missing. Make sure NEXT_PUBLIC_SUPABASE_ANON_KEY is set in your environment variables.");let n=(0,t.UU)(i,o,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4447,3472],()=>s(9604));module.exports=t})();