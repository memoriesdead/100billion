(()=>{var e={};e.id=9890,e.ids=[9890],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56278:(e,r,s)=>{"use strict";s.d(r,{N:()=>n});var t=s(86345);let o="https://bhdufveahujzsaofatnx.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJoZHVmdmVhaHVqenNhb2ZhdG54Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQzNTcwMDksImV4cCI6MjA1OTkzMzAwOX0.3qMmS0VkWLLyxNv-IJCoEYPs7y83m1Pjj5mxrwd3res";if(!o)throw Error("Supabase URL is missing. Make sure NEXT_PUBLIC_SUPABASE_URL is set in your environment variables.");if(!i)throw Error("Supabase Anon Key is missing. Make sure NEXT_PUBLIC_SUPABASE_ANON_KEY is set in your environment variables.");let n=(0,t.UU)(o,i,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},62919:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>f,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>h});var t={};s.r(t),s.d(t,{POST:()=>l});var o=s(96559),i=s(48088),n=s(37719),c=s(32190),u=s(97877),a=s(56278);let p=new u.A(process.env.STRIPE_SECRET_KEY);async function l(e){let r=new URL(e.url).origin;try{let{profileId:s}=await e.json();if(!s)return c.NextResponse.json({error:"Profile ID is required"},{status:400});console.log(`Creating checkout session for profile ID: ${s}`);let{data:t,error:o}=await a.N.from("profiles").select("username, subscription_price").eq("id",s).single();if(o){if(console.error("Error fetching profile:",o),"PGRST116"===o.code)return c.NextResponse.json({error:"Creator profile not found"},{status:404});return c.NextResponse.json({error:"Failed to fetch creator profile"},{status:500})}if(!t||!t.subscription_price||t.subscription_price<=0)return console.error("Invalid profile or subscription price:",t),c.NextResponse.json({error:"Creator does not have a valid subscription price set."},{status:400});let i=t.subscription_price,n=t.username??"Creator",u=`${r}/profile/${n}?subscribe=success`,l=`${r}/profile/${n}?subscribe=cancel`;console.log(`Price: ${i} cents, Creator: ${n}`),console.log(`Success URL: ${u}`),console.log(`Cancel URL: ${l}`);let d=await p.checkout.sessions.create({payment_method_types:["card"],mode:"subscription",line_items:[{price_data:{currency:"usd",unit_amount:i,recurring:{interval:"month"},product_data:{name:`Subscription to ${n}`,description:`Monthly subscription to access content from ${n}.`}},quantity:1}],success_url:u,cancel_url:l});return console.log("Stripe session created:",d.id),c.NextResponse.json({sessionId:d.id})}catch(r){console.error("Error creating Stripe checkout session:",r);let e=r instanceof Error?r.message:"Internal server error";return c.NextResponse.json({error:`Failed to create checkout session: ${e}`},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/stripe/create-checkout-session/route",pathname:"/api/stripe/create-checkout-session",filename:"route",bundlePath:"app/api/stripe/create-checkout-session/route"},resolvedPagePath:"C:\\Users\\kevin\\Desktop\\tiktok-clone\\src\\app\\api\\stripe\\create-checkout-session\\route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:x,workUnitAsyncStorage:h,serverHooks:m}=d;function f(){return(0,n.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:h})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4447,3472],()=>s(62919));module.exports=t})();