"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8104],{5365:(e,r,t)=>{t.d(r,{Fc:()=>n,TN:()=>c,XL:()=>d});var s=t(5155),l=t(2115),a=t(2085),i=t(9434);let o=(0,a.F)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),n=l.forwardRef((e,r)=>{let{className:t,variant:l,...a}=e;return(0,s.jsx)("div",{ref:r,role:"alert",className:(0,i.cn)(o({variant:l}),t),...a})});n.displayName="Alert";let d=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)("h5",{ref:r,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",t),...l})});d.displayName="AlertTitle";let c=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",t),...l})});c.displayName="AlertDescription"},6695:(e,r,t)=>{t.d(r,{BT:()=>d,Wu:()=>c,ZB:()=>n,Zp:()=>i,aR:()=>o,wL:()=>u});var s=t(5155),l=t(2115),a=t(9434);let i=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...l})});i.displayName="Card";let o=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",t),...l})});o.displayName="CardHeader";let n=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("font-semibold leading-none tracking-tight",t),...l})});n.displayName="CardTitle";let d=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("text-sm text-muted-foreground",t),...l})});d.displayName="CardDescription";let c=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("p-6 pt-0",t),...l})});c.displayName="CardContent";let u=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex items-center p-6 pt-0",t),...l})});u.displayName="CardFooter"},6970:(e,r,t)=>{t.d(r,{A:()=>R});var s=t(5155),l=t(2115),a=t(9576),i=t(6927),o=t(6715),n=t(9373),d=t(5041),c=t(8539),u=t(285),m=t(6695),f=t(1394),p=t(6824),x=t(9344),g=t(9311),v=t(6491),h=t(3350),b=t(5318),j=t(9274),N=t(172),w=t(8763),y=t(3561),_=t(6766),k=t(6126),C=t(3762),U=t(4996);function R(){var e,r,t,R,A,P,E,S;let{user:F}=(0,a.As)(),L=(0,o.jE)(),[z,M]=(0,l.useState)(""),[q,D]=(0,l.useState)(null),[T,B]=(0,l.useState)(null),W=(0,l.useRef)(null),[Z,G]=(0,l.useState)(!1),{data:I,isLoading:K}=(0,n.I)({queryKey:["userProfile",null==F?void 0:F.id],queryFn:async()=>{if(!(null==F?void 0:F.id))return null;let{data:e,error:r}=await i.N.from("profiles").select("id, username, name, profile_picture_url").eq("id",F.id).single();if(r&&"PGRST116"!==r.code)throw console.error("Error fetching user profile:",r),r;return e},enabled:!!(null==F?void 0:F.id)}),{data:O,isLoading:$,error:X}=(0,n.I)({queryKey:["homeFeedPosts",null==F?void 0:F.id],queryFn:async()=>{if(!(null==F?void 0:F.id))return[];let{data:e,error:r}=await i.N.from("relationships").select("followed_uid").eq("follower_uid",F.id);if(r)throw Error(r.message);let t=(null==e?void 0:e.map(e=>e.followed_uid))||[],s=[F.id,...t],{data:l,error:a}=await i.N.from("posts").select("*, profiles ( username, name, profile_picture_url )").in("user_id",s).order("created_at",{ascending:!1});if(a)throw Error(a.message);return l},enabled:!!(null==F?void 0:F.id)}),Y=(0,d.n)({mutationFn:async e=>{let{content:r,imageFile:t}=e;if(!(null==F?void 0:F.id))throw Error("User not authenticated");if(!r.trim()&&!t)throw Error("Post content or image cannot be empty");let s=null,l="text",a=null;if(t){l="image";let e=t.name.split(".").pop(),r="".concat(F.id,"/").concat(Date.now(),".").concat(e);a="".concat(r),console.log("Uploading image to bucket 'posts' at path: ".concat(a));let{error:o}=await i.N.storage.from("posts").upload(a,t,{cacheControl:"3600",upsert:!1});if(o){if(console.error("Supabase storage upload error:",o),o.message.includes("Bucket not found"))throw Error("Storage bucket 'posts' not found. Please create it in Supabase.");if(o.message.includes("policy"))throw Error("Storage policy violation. Check bucket permissions.");throw Error("Storage upload failed: ".concat(o.message))}let{data:n}=i.N.storage.from("posts").getPublicUrl(a);if(!(s=null==n?void 0:n.publicUrl))throw console.error("Failed to get public URL for uploaded image."),Error("Failed to get public URL for image");console.log("Image uploaded successfully. Public URL:",s)}try{let{data:e,error:t}=await i.N.from("posts").insert({user_id:F.id,caption:r.trim()||null,type:l,image_url:s,updated_at:new Date().toISOString()}).select().single();if(t)throw t;return console.log("Post record created successfully:",e),e}catch(e){throw e instanceof Error?e.message:String(e),console.error("Error inserting post record:",e),s&&a&&(console.warn("Post insert failed after image upload. Attempting to delete uploaded image:",a),await i.N.storage.from("posts").remove([a])),e}},onSuccess:()=>{L.invalidateQueries({queryKey:["homeFeedPosts",null==F?void 0:F.id]}),M(""),D(null),B(null),G(!1),W.current&&(W.current.value="")},onError:e=>{console.error("Failed to create post (Mutation onError):",e),alert("Failed to create post: ".concat(e instanceof Error?e.message:"Unknown error"))}}),H=e=>{let r=new Date(e),t=new Date,s=new Date(t);return(s.setDate(t.getDate()-1),(0,p.GP)(r,"yyyy-MM-dd")===(0,p.GP)(t,"yyyy-MM-dd"))?(0,x.m)(r,{addSuffix:!0}):(0,p.GP)(r,"yyyy-MM-dd")===(0,p.GP)(s,"yyyy-MM-dd")?"Yesterday":(0,p.GP)(r,"MMM d")};return(0,s.jsxs)("div",{className:"space-y-4 max-w-xl mx-auto",children:[" ",(0,s.jsxs)(m.Zp,{className:"mb-4 relative",children:[(0,s.jsxs)(m.aR,{className:"border-b p-4",children:[(0,s.jsx)("div",{className:"text-muted-foreground text-sm mb-3",children:"Compose new post..."}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("input",{type:"file",ref:W,onChange:e=>{var r;let t=null==(r=e.target.files)?void 0:r[0];t?(D(t),B(URL.createObjectURL(t))):(D(null),B(null))},accept:"image/png, image/jpeg, image/webp",className:"hidden","aria-label":"Upload image"}),(0,s.jsx)(g.A,{size:20,className:"text-muted-foreground cursor-pointer hover:text-foreground",onClick:()=>{var e;null==(e=W.current)||e.click()},"aria-label":"Add image"}),(0,s.jsx)(v.A,{size:20,className:"text-muted-foreground cursor-pointer hover:text-foreground","aria-label":"Format text"}),(0,s.jsx)(h.A,{size:20,className:"text-muted-foreground cursor-pointer hover:text-foreground","aria-label":"Text options"})]})]}),(0,s.jsxs)(m.Wu,{className:"p-4 pt-4",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3 mb-2",children:[K?(0,s.jsx)(f.eu,{className:"w-10 h-10 flex-shrink-0 bg-muted rounded-full"}):(0,s.jsxs)(f.eu,{className:"w-10 h-10 flex-shrink-0",children:[(0,s.jsx)(f.BK,{src:null!=(A=null==I?void 0:I.profile_picture_url)?A:void 0,alt:null!=(P=null==I?void 0:I.username)?P:"User"}),(0,s.jsx)(f.q5,{children:null!=(S=null!=(E=null==I||null==(r=I.name)||null==(e=r.charAt(0))?void 0:e.toUpperCase())?E:null==I||null==(R=I.username)||null==(t=R.charAt(0))?void 0:t.toUpperCase())?S:"U"})]}),(0,s.jsx)(c.T,{placeholder:"Compose new post...",value:z,onChange:e=>M(e.target.value),className:"flex-grow resize-none border rounded-md p-2 min-h-[60px]",rows:2})]}),T&&(0,s.jsxs)("div",{className:"ml-13 mb-3 relative w-32 h-32",children:[(0,s.jsx)(_.default,{src:T,alt:"Selected image preview",layout:"fill",objectFit:"cover",className:"rounded-md border",onLoad:()=>{(null==T?void 0:T.startsWith("blob:"))&&URL.revokeObjectURL(T)}}),(0,s.jsx)(u.$,{variant:"destructive",size:"icon",className:"absolute top-1 right-1 h-6 w-6 rounded-full",onClick:()=>{D(null),B(null),W.current&&(W.current.value="")},"aria-label":"Remove selected image",children:(0,s.jsx)(b.A,{size:14})})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(u.$,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-foreground",onClick:()=>G(!Z),"aria-label":"Add emoji",children:(0,s.jsx)(j.A,{size:20})}),(0,s.jsx)(u.$,{onClick:()=>{Y.mutate({content:z,imageFile:q})},disabled:!z.trim()&&!q||Y.isPending||K,size:"sm",children:Y.isPending?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"})," Posting..."]}):"Post"})]}),Z&&(0,s.jsx)("div",{className:"absolute z-10 mt-2 right-0 sm:right-auto sm:left-12",children:(0,s.jsx)(U.Ay,{onEmojiClick:e=>{M(r=>r+e.emoji)},autoFocusSearch:!1,lazyLoadEmojis:!0,height:350})})]})]}),(0,s.jsxs)("div",{className:"flex p-3 space-x-2 border-b border-border bg-card rounded-t-lg",children:[(0,s.jsx)(k.E,{variant:"default",className:"cursor-pointer",children:"All"}),(0,s.jsx)(k.E,{variant:"secondary",className:"cursor-pointer flex items-center",children:(0,s.jsx)(w.A,{size:14,className:"mr-1"})})]}),$&&(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)(N.A,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,s.jsx)("span",{className:"ml-2 text-muted-foreground",children:"Loading posts..."})]}),X&&(0,s.jsx)(m.Zp,{className:"border-destructive bg-destructive/10",children:(0,s.jsxs)(m.Wu,{className:"p-4 text-destructive-foreground",children:["Error loading posts: ",X.message]})}),!$&&!X&&(null==O?void 0:O.length)===0&&(0,s.jsx)(m.Zp,{children:(0,s.jsx)(m.Wu,{className:"p-6 text-center text-muted-foreground",children:"Your feed is empty. Follow some users or create a post!"})}),null==O?void 0:O.map(e=>{var r,t,l,a,i,o,n,d,c,p,x,g,v,h,b,j,N,w,k,U,R,A,P,E,S,L;return(0,s.jsx)(m.Zp,{className:"rounded-none first:rounded-t-lg last:rounded-b-lg border-t-0 first:border-t",children:(0,s.jsxs)(m.Wu,{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)(f.eu,{className:"w-12 h-12",children:[(0,s.jsx)(f.BK,{src:null!=(h=null==(r=e.profiles)?void 0:r.profile_picture_url)?h:void 0,alt:null!=(b=null==(t=e.profiles)?void 0:t.username)?b:"User"}),(0,s.jsx)(f.q5,{children:null!=(N=null!=(j=null==(i=e.profiles)||null==(a=i.name)||null==(l=a.charAt(0))?void 0:l.toUpperCase())?j:null==(d=e.profiles)||null==(n=d.username)||null==(o=n.charAt(0))?void 0:o.toUpperCase())?N:"U"})]}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("div",{className:"font-semibold flex items-center text-foreground",children:null!=(k=null!=(w=null==(c=e.profiles)?void 0:c.name)?w:null==(p=e.profiles)?void 0:p.username)?k:"Unknown User"}),(0,s.jsxs)("div",{className:"text-muted-foreground text-sm",children:["@",null!=(U=null==(x=e.profiles)?void 0:x.username)?U:"username"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"text-muted-foreground text-sm mr-2",children:H(e.created_at)}),(0,s.jsx)(u.$,{variant:"ghost",size:"icon",className:"text-muted-foreground h-6 w-6",children:(0,s.jsx)(y.A,{size:16})})]})]}),e.caption&&(0,s.jsx)("p",{className:"text-foreground text-sm mb-2 whitespace-pre-wrap",children:e.caption.split(/(\s)/).map((e,r)=>e.startsWith("@")?(0,s.jsx)("span",{className:"text-primary cursor-pointer hover:underline",children:e},r):e.match(/^(https?:\/\/[^\s]+)/)?(0,s.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-primary cursor-pointer hover:underline",children:e},r):e)}),"image"===e.type&&e.image_url&&(0,s.jsx)("div",{className:"mt-3 relative rounded-lg overflow-hidden border max-w-full",children:"/api/placeholder/400/300"!==e.image_url?(0,s.jsx)(_.default,{src:e.image_url,alt:"Post image",width:600,height:600,className:"object-contain w-full h-auto"}):(0,s.jsx)("div",{className:"w-full h-64 bg-muted flex items-center justify-center text-muted-foreground",children:"Image Loading..."})}),"video"===e.type&&e.video_url&&(0,s.jsx)("div",{className:"mt-3 rounded-lg overflow-hidden border aspect-video bg-black",children:(0,s.jsx)(C.Z,{id:e.id,username:null!=(R=null==(g=e.profiles)?void 0:g.username)?R:"user",profilePictureUrl:null!=(A=null==(v=e.profiles)?void 0:v.profile_picture_url)?A:void 0,caption:null!=(P=e.caption)?P:"",videoSrc:e.video_url,posterSrc:null!=(E=e.thumbnail_url)?E:void 0,likes:(null!=(S=e.likes_count)?S:0).toString(),comments:(null!=(L=e.comments_count)?L:0).toString(),shares:"0",isPrivate:e.is_private,isOwner:e.user_id===(null==F?void 0:F.id),userId:e.user_id,is_for_sale:e.is_for_sale,price:e.price,currency:e.currency,stripe_price_id:e.stripe_price_id,isLocked:!1,isPaidContent:e.is_for_sale||e.is_private})})]})},e.id)})]})}},7313:(e,r,t)=>{t.d(r,{Xi:()=>d,av:()=>c,j7:()=>n,tU:()=>o});var s=t(5155),l=t(2115),a=t(64),i=t(9434);let o=a.bL,n=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)(a.B8,{ref:r,className:(0,i.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...l})});n.displayName=a.B8.displayName;let d=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)(a.l9,{ref:r,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...l})});d.displayName=a.l9.displayName;let c=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)(a.UC,{ref:r,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...l})});c.displayName=a.UC.displayName},8539:(e,r,t)=>{t.d(r,{T:()=>i});var s=t(5155),l=t(2115),a=t(9434);let i=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,s.jsx)("textarea",{className:(0,a.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...l})});i.displayName="Textarea"}}]);