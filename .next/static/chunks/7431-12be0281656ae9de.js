"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7431],{285:(e,t,r)=>{r.d(t,{$:()=>c});var s=r(5155),o=r(2115),i=r(9708),a=r(2085),n=r(9434);let l=(0,a.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef((e,t)=>{let{className:r,variant:o,size:a,asChild:c=!1,...u}=e,d=c?i.DX:"button";return(0,s.jsx)(d,{className:(0,n.cn)(l({variant:o,size:a,className:r})),ref:t,...u})});c.displayName="Button"},833:(e,t,r)=>{r.d(t,{M:()=>v});var s=r(5155),o=r(2115),i=r(6874),a=r.n(i),n=r(5695),l=r(6927),c=r(9576),u=r(1394),d=r(9911),h=r(1573),f=r(9048),g=r(6671),p=r(7368),m=r(9509);let b=(0,p.c)(m.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY);function v(e){var t;let{postId:r,userId:i,username:p,profilePictureUrl:m,initialLikes:v,initialIsLiked:w,commentsCount:x,sharesCount:y,initialIsPrivate:N,isOwner:E,videoCaption:k,postType:S,is_for_sale:_,price:P,currency:j,onLikeSuccess:A}=e;(0,n.useRouter)();let{user:C}=(0,o.useContext)(c.cy),[U,I]=(0,o.useState)(w),[B,z]=(0,o.useState)(v),[L,R]=(0,o.useState)(N),[T,O]=(0,o.useState)(!1),[W,F]=(0,o.useState)(!1),K=(0,o.useCallback)(async()=>{if(!C)return void g.o.info("Please log in to like posts.");let e=!U,t=e?B+1:B-1;I(e),z(t);try{if(e){let{error:e}=await l.N.from("likes").insert({user_id:C.id,post_id:r});if(e)throw e}else{let{error:e}=await l.N.from("likes").delete().match({user_id:C.id,post_id:r});if(e)throw e}null==A||A(t)}catch(t){let e=t instanceof Error?t.message:String(t);I(U),z(B),g.o.error("Failed to update like status."),console.error("[InteractionButtons] Error updating like status:",e)}},[C,r,U,B,A]),X=(0,o.useCallback)(async()=>{let e={title:"Check out this post by @".concat(p,"!"),text:k||"Check out this post by @".concat(p,"!"),url:"video"===S?"".concat(window.location.origin,"/video/").concat(r):"".concat(window.location.origin,"/image/").concat(r)};try{navigator.share?await navigator.share(e):(await navigator.clipboard.writeText(e.url),g.o.success("Link copied to clipboard!"))}catch(e){console.error("Error sharing:",e),"AbortError"!==e.name&&g.o.error("Could not share post.")}},[r,p,k,S]);return(0,o.useCallback)(async()=>{if(!E||T||!C){C||g.o.error("You must be logged in.");return}O(!0);let e=!L;R(e);try{let{error:t}=await l.N.from("posts").update({is_private:e}).eq("id",r).eq("user_id",C.id);if(t)throw t;g.o.success("Post set to ".concat(e?"Private":"Public"))}catch(t){let e=t instanceof Error?t.message:String(t);R(L),g.o.error("Failed to update privacy status."),console.error("Error updating privacy status:",e)}finally{O(!1)}},[E,T,C,r,L]),(0,o.useCallback)(async()=>{if(!C)return void g.o.info("Please log in to purchase items.");if(!r||!_||!P||P<=0)return void g.o.error("This item cannot be purchased currently.");F(!0);try{let e=await fetch("/api/stripe/create-item-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:r})}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to create checkout session");if(!t.sessionId)throw Error("Session ID not received from server");let s=await b;if(!s)throw Error("Stripe.js failed to load.");let{error:o}=await s.redirectToCheckout({sessionId:t.sessionId});if(o)throw Error(o.message)}catch(e){console.error("Purchase initiation error:",e),g.o.error("Failed to initiate purchase: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{F(!1)}},[C,r,_,P]),L?h.A:f.A,(0,s.jsxs)("div",{className:_?"absolute top-4 right-4 z-20 pointer-events-auto":"absolute bottom-12 right-3 z-20 flex flex-col items-end space-y-1 pointer-events-auto",children:[(0,s.jsx)(a(),{href:"/profile/".concat(p),onClick:e=>{e.stopPropagation()},className:"profile-link-area text-white cursor-pointer ".concat(!_&&"video"===S?"mt-4":""," ").concat(!_?"mb-1":""," ").concat(_?"":"flex flex-col items-center"),"aria-label":"View profile for ".concat(p),children:(0,s.jsxs)(u.eu,{className:"w-10 h-10 border-2 border-white",children:[(0,s.jsx)(u.BK,{src:null!=m?m:"",alt:"".concat(p,"'s profile picture")}),(0,s.jsx)(u.q5,{children:null!=(t=null==p?void 0:p.charAt(0).toUpperCase())?t:"U"})]})}),!_&&(0,s.jsxs)("button",{onClick:K,className:"flex flex-col items-center text-white group/like",children:[(0,s.jsxs)("div",{className:"w-10 h-10 bg-black/40 rounded-full flex items-center justify-center mb-1 transition-colors ".concat(U?"bg-red-500/80":"group-hover/like:bg-white/20"),children:[(0,s.jsx)(d.Mbv,{size:24,className:"".concat(U?"text-red-500":"text-white"," transition-transform group-hover/like:scale-110")})," "]}),(0,s.jsx)("span",{className:"text-xs font-semibold",children:B})]}),!_&&(0,s.jsxs)(a(),{href:"video"===S?"/video/".concat(r,"#comments"):"/image/".concat(r,"#comments"),className:"flex flex-col items-center text-white","aria-label":"View comments",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"w-10 h-10 bg-black/40 rounded-full flex items-center justify-center mb-1",children:[(0,s.jsx)(d.hYw,{size:24})," "]}),(0,s.jsx)("span",{className:"text-xs font-semibold",children:x})]}),!_&&(0,s.jsxs)("button",{onClick:X,className:"flex flex-col items-center text-white group/share",children:[(0,s.jsxs)("div",{className:"w-10 h-10 bg-black/40 rounded-full flex items-center justify-center mb-1 transition-colors group-hover/share:bg-white/20",children:[(0,s.jsx)(d.Zzu,{size:22,className:"transition-transform group-hover/share:scale-110"})," "]}),(0,s.jsx)("span",{className:"text-xs font-semibold",children:y})]})]})}},1394:(e,t,r)=>{r.d(t,{BK:()=>l,eu:()=>n,q5:()=>c});var s=r(5155),o=r(2115),i=r(4011),a=r(9434);let n=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,s.jsx)(i.bL,{ref:t,className:(0,a.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...o})});n.displayName=i.bL.displayName;let l=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,s.jsx)(i._V,{ref:t,className:(0,a.cn)("aspect-square h-full w-full",r),...o})});l.displayName=i._V.displayName;let c=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,s.jsx)(i.H4,{ref:t,className:(0,a.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...o})});c.displayName=i.H4.displayName},2523:(e,t,r)=>{r.d(t,{p:()=>a});var s=r(5155),o=r(2115),i=r(9434);let a=o.forwardRef((e,t)=>{let{className:r,type:o,...a}=e;return(0,s.jsx)("input",{type:o,className:(0,i.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...a})});a.displayName="Input"},6927:(e,t,r)=>{r.d(t,{N:()=>n});var s=r(851),o=r(9509);let i=o.env.NEXT_PUBLIC_SUPABASE_URL,a=o.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!i)throw Error("Supabase URL is missing. Make sure NEXT_PUBLIC_SUPABASE_URL is set in your environment variables.");if(!a)throw Error("Supabase Anon Key is missing. Make sure NEXT_PUBLIC_SUPABASE_ANON_KEY is set in your environment variables.");let n=(0,s.UU)(i,a,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},9434:(e,t,r)=>{r.d(t,{cn:()=>i});var s=r(2596),o=r(9688);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,s.$)(t))}},9576:(e,t,r)=>{r.d(t,{As:()=>l,OJ:()=>n,cy:()=>a});var s=r(5155),o=r(2115),i=r(6927);let a=(0,o.createContext)({user:null,session:null,loading:!0,signInWithGoogle:async()=>{console.warn("signInWithGoogle called before AuthProvider initialized")},signUpWithEmail:async()=>{console.warn("signUpWithEmail called before AuthProvider initialized")},signInWithEmail:async()=>{console.warn("signInWithEmail called before AuthProvider initialized")},sendPasswordReset:async()=>{console.warn("sendPasswordReset called before AuthProvider initialized")},signOut:async()=>{console.warn("signOut called before AuthProvider initialized")}}),n=e=>{let{children:t}=e,[r,n]=(0,o.useState)(null),[l,c]=(0,o.useState)(null),[u,d]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{try{var e;let{data:{session:t},error:r}=await i.N.auth.getSession();if(r)throw r;c(t),n(null!=(e=null==t?void 0:t.user)?e:null)}catch(e){console.error("Error fetching initial Supabase session:",e)}finally{d(!1)}})();let{data:e}=i.N.auth.onAuthStateChange(async(e,t)=>{var r;console.log("Supabase auth state changed:",e,t),c(t),n(null!=(r=null==t?void 0:t.user)?r:null)});return()=>{null==e||e.subscription.unsubscribe()}},[]);let h=async()=>{d(!0);try{let{error:e}=await i.N.auth.signInWithOAuth({provider:"google"});if(e)throw e}catch(e){console.error("Error signing in with Google (Supabase):",e),d(!1)}},f=async(e,t)=>{d(!0);try{let{data:r,error:s}=await i.N.auth.signUp({email:e,password:t});if(s)throw s;r.user&&!r.user.email_confirmed_at&&console.log("Sign up successful. Please check your email for verification.")}catch(e){console.error("Error signing up (Supabase):",e),d(!1)}},g=async(e,t)=>{d(!0);try{let{error:r}=await i.N.auth.signInWithPassword({email:e,password:t});if(r)throw r}catch(e){console.error("Error signing in (Supabase):",e),d(!1)}},p=async e=>{try{let{error:t}=await i.N.auth.resetPasswordForEmail(e,{});if(t)throw t;console.log("Password reset email sent (Supabase).")}catch(e){console.error("Error sending password reset email (Supabase):",e)}},m=async()=>{try{let{error:e}=await i.N.auth.signOut();if(e)throw e;console.log("Supabase sign out successful.")}catch(e){console.error("Error signing out from Supabase:",e)}};return(0,s.jsx)(a.Provider,{value:{user:r,session:l,loading:u,signInWithGoogle:h,signUpWithEmail:f,signInWithEmail:g,sendPasswordReset:p,signOut:m},children:u?(0,s.jsx)("div",{children:"Loading Authentication..."}):t})},l=()=>(0,o.useContext)(a)}}]);