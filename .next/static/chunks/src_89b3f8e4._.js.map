{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,CAAA,GAAA,8JAAA,CAAA,UAAO,AAAD,EAAE,CAAA,GAAA,wIAAA,CAAA,OAAI,AAAD,EAAE;AACtB","debugId":null}},
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/scroll-area.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst ScrollArea = React.forwardRef<\r\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\r\n>(({ className, children, ...props }, ref) => (\r\n  <ScrollAreaPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\"relative overflow-hidden\", className)}\r\n    {...props}\r\n  >\r\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\r\n      {children}\r\n    </ScrollAreaPrimitive.Viewport>\r\n    <ScrollBar />\r\n    <ScrollAreaPrimitive.Corner />\r\n  </ScrollAreaPrimitive.Root>\r\n))\r\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\r\n\r\nconst ScrollBar = React.forwardRef<\r\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\r\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\r\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\r\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\r\n    ref={ref}\r\n    orientation={orientation}\r\n    className={cn(\r\n      \"flex touch-none select-none transition-colors\",\r\n      orientation === \"vertical\" &&\r\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\r\n      orientation === \"horizontal\" &&\r\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\r\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\r\n))\r\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\r\n\r\nexport { ScrollArea, ScrollBar }\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,2BAAa,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAGhC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,6LAAC,6KAAA,CAAA,OAAwB;QACvB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,4BAA4B;QACzC,GAAG,KAAK;;0BAET,6LAAC,6KAAA,CAAA,WAA4B;gBAAC,WAAU;0BACrC;;;;;;0BAEH,6LAAC;;;;;0BACD,6LAAC,6KAAA,CAAA,SAA0B;;;;;;;;;;;;AAG/B,WAAW,WAAW,GAAG,6KAAA,CAAA,OAAwB,CAAC,WAAW;AAE7D,MAAM,0BAAY,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,EAG/B,CAAC,EAAE,SAAS,EAAE,cAAc,UAAU,EAAE,GAAG,OAAO,EAAE,oBACpD,6LAAC,6KAAA,CAAA,sBAAuC;QACtC,KAAK;QACL,aAAa;QACb,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,iDACA,gBAAgB,cACd,sDACF,gBAAgB,gBACd,wDACF;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,6KAAA,CAAA,kBAAmC;YAAC,WAAU;;;;;;;;;;;MAjB7C;AAoBN,UAAU,WAAW,GAAG,6KAAA,CAAA,sBAAuC,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/separator.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Separator = React.forwardRef<\r\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\r\n>(\r\n  (\r\n    { className, orientation = \"horizontal\", decorative = true, ...props },\r\n    ref\r\n  ) => (\r\n    <SeparatorPrimitive.Root\r\n      ref={ref}\r\n      decorative={decorative}\r\n      orientation={orientation}\r\n      className={cn(\r\n        \"shrink-0 bg-border\",\r\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n)\r\nSeparator.displayName = SeparatorPrimitive.Root.displayName\r\n\r\nexport { Separator }\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,0BAAY,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAI/B,CACE,EAAE,SAAS,EAAE,cAAc,YAAY,EAAE,aAAa,IAAI,EAAE,GAAG,OAAO,EACtE,oBAEA,6LAAC,wKAAA,CAAA,OAAuB;QACtB,KAAK;QACL,YAAY;QACZ,aAAa;QACb,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,sBACA,gBAAgB,eAAe,mBAAmB,kBAClD;QAED,GAAG,KAAK;;;;;;;AAIf,UAAU,WAAW,GAAG,wKAAA,CAAA,OAAuB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/avatar.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Avatar = React.forwardRef<\r\n  React.ElementRef<typeof AvatarPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\r\n>(({ className, ...props }, ref) => (\r\n  <AvatarPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nAvatar.displayName = AvatarPrimitive.Root.displayName\r\n\r\nconst AvatarImage = React.forwardRef<\r\n  React.ElementRef<typeof AvatarPrimitive.Image>,\r\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\r\n>(({ className, ...props }, ref) => (\r\n  <AvatarPrimitive.Image\r\n    ref={ref}\r\n    className={cn(\"aspect-square h-full w-full\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\r\n\r\nconst AvatarFallback = React.forwardRef<\r\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\r\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\r\n>(({ className, ...props }, ref) => (\r\n  <AvatarPrimitive.Fallback\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\r\n\r\nexport { Avatar, AvatarImage, AvatarFallback }\r\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,uBAAS,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAG5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,qKAAA,CAAA,OAAoB;QACnB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,iEACA;QAED,GAAG,KAAK;;;;;;;AAGb,OAAO,WAAW,GAAG,qKAAA,CAAA,OAAoB,CAAC,WAAW;AAErD,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,qKAAA,CAAA,QAAqB;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,+BAA+B;QAC5C,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,qKAAA,CAAA,QAAqB,CAAC,WAAW;AAE3D,MAAM,+BAAiB,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGpC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,qKAAA,CAAA,WAAwB;QACvB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,wEACA;QAED,GAAG,KAAK;;;;;;;AAGb,eAAe,WAAW,GAAG,qKAAA,CAAA,WAAwB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/FollowingList.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { supabase } from '@/lib/supabaseClient'; // Assuming supabase client is exported from here\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"; // Using Shadcn Avatar\r\n\r\n// Define the type for a followed user profile (subset of Profiles table)\r\ntype FollowedProfile = {\r\n  id: string;\r\n  username: string | null;\r\n  profile_picture_url: string | null;\r\n};\r\n\r\nexport function FollowingList() {\r\n  const { user } = useAuth();\r\n  const [followingProfiles, setFollowingProfiles] = useState<FollowedProfile[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const fetchFollowing = async () => {\r\n      if (!user) {\r\n        setLoading(false);\r\n        setFollowingProfiles([]); // Clear profiles if user logs out\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      try {\r\n        // Fetch relationships where the current user is the follower\r\n        // Join with profiles table to get followed user details\r\n        const { data, error: fetchError } = await supabase\r\n          .from('relationships')\r\n          // Hint the join using the correct foreign key name\r\n          .select(`\r\n            followed_uid,\r\n            profiles:profiles!relationships_followed_uid_fkey (\r\n              id,\r\n              username,\r\n              profile_picture_url\r\n            )\r\n          `)\r\n          .eq('follower_uid', user.id);\r\n\r\n        if (fetchError) {\r\n          throw fetchError;\r\n        }\r\n\r\n        // Type assertion for the expected data structure after hinting\r\n        const typedData = data as {\r\n          followed_uid: string;\r\n          profiles: FollowedProfile | null; // profiles should now match FollowedProfile or be null\r\n        }[] | null;\r\n\r\n\r\n        // Extract profile data safely\r\n        const profiles: FollowedProfile[] = typedData\r\n          ? typedData\r\n              .map(rel => rel.profiles) // Extract the profiles object\r\n              .filter((profile): profile is FollowedProfile => // Filter out nulls and ensure type\r\n                profile !== null &&\r\n                typeof profile === 'object' &&\r\n                'id' in profile &&\r\n                'username' in profile && // Check for username existence\r\n                'profile_picture_url' in profile // Check for profile picture URL existence\r\n              )\r\n          : []; // Handle case where data is null\r\n\r\n        setFollowingProfiles(profiles);\r\n\r\n      } catch (err: unknown) {\r\n        const message = err instanceof Error ? err.message : String(err);\r\n        console.error(\"Error fetching following list:\", err);\r\n        setError(\"Failed to load following list.\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchFollowing();\r\n  }, [user]); // Re-run effect when user changes\r\n\r\n  if (!user) {\r\n    // Optionally show a login prompt or nothing\r\n    return null; // Don't show the section if not logged in\r\n  }\r\n\r\n  if (loading) {\r\n    return <div className=\"px-4 py-2 text-sm text-muted-foreground\">Loading following...</div>;\r\n  }\r\n\r\n  if (error) {\r\n    return <div className=\"px-4 py-2 text-sm text-destructive\">{error}</div>;\r\n  }\r\n\r\n  if (followingProfiles.length === 0) {\r\n    return <div className=\"px-4 py-2 text-sm text-muted-foreground\">Not following anyone yet.</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      {followingProfiles.map((profile) => (\r\n        <Link\r\n          key={profile.id}\r\n          href={`/profile/${profile.username || profile.id}`} // Link to username profile if available\r\n          className=\"flex items-center gap-3 px-4 py-2 rounded-md transition-colors w-full text-foreground/80 hover:text-foreground hover:bg-secondary/50\"\r\n        >\r\n          <Avatar className=\"h-8 w-8\">\r\n            <AvatarImage src={profile.profile_picture_url ?? undefined} alt={profile.username ?? 'User'} />\r\n            <AvatarFallback>{profile.username?.charAt(0).toUpperCase() ?? 'U'}</AvatarFallback>\r\n          </Avatar>\r\n          <span className=\"text-sm font-medium truncate\">{profile.username ?? 'Unnamed User'}</span>\r\n        </Link>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAEA;AACA,gOAAiD,iDAAiD;AAClG,yOAA8E,sBAAsB;;;AAPpG;;;;;;AAgBO,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,GAAG,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD;IACvB,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAqB,EAAE;IAChF,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB;IAElD,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;mCAAE;YACR,MAAM;0DAAiB;oBACrB,IAAI,CAAC,MAAM;wBACT,WAAW;wBACX,qBAAqB,EAAE,GAAG,kCAAkC;wBAC5D;oBACF;oBAEA,WAAW;oBACX,SAAS;oBAET,IAAI;wBACF,6DAA6D;wBAC7D,wDAAwD;wBACxD,MAAM,EAAE,IAAI,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,+HAAA,CAAA,WAAQ,CAC/C,IAAI,CAAC,gBACN,mDAAmD;yBAClD,MAAM,CAAC,CAAC;;;;;;;UAOT,CAAC,EACA,EAAE,CAAC,gBAAgB,KAAK,EAAE;wBAE7B,IAAI,YAAY;4BACd,MAAM;wBACR;wBAEA,+DAA+D;wBAC/D,MAAM,YAAY;wBAMlB,8BAA8B;wBAC9B,MAAM,WAA8B,YAChC,UACG,GAAG;sEAAC,CAAA,MAAO,IAAI,QAAQ;qEAAE,8BAA8B;yBACvD,MAAM;sEAAC,CAAC,UACP,YAAY,QACZ,OAAO,YAAY,YACnB,QAAQ,WACR,cAAc,WAAW,+BAA+B;gCACxD,yBAAyB,QAAQ,0CAA0C;uEAE/E,EAAE,EAAE,iCAAiC;wBAEzC,qBAAqB;oBAEvB,EAAE,OAAO,KAAc;wBACrB,MAAM,UAAU,eAAe,QAAQ,IAAI,OAAO,GAAG,OAAO;wBAC5D,QAAQ,KAAK,CAAC,kCAAkC;wBAChD,SAAS;oBACX,SAAU;wBACR,WAAW;oBACb;gBACF;;YAEA;QACF;kCAAG;QAAC;KAAK,GAAG,kCAAkC;IAE9C,IAAI,CAAC,MAAM;QACT,4CAA4C;QAC5C,OAAO,MAAM,0CAA0C;IACzD;IAEA,IAAI,SAAS;QACX,qBAAO,6LAAC;YAAI,WAAU;sBAA0C;;;;;;IAClE;IAEA,IAAI,OAAO;QACT,qBAAO,6LAAC;YAAI,WAAU;sBAAsC;;;;;;IAC9D;IAEA,IAAI,kBAAkB,MAAM,KAAK,GAAG;QAClC,qBAAO,6LAAC;YAAI,WAAU;sBAA0C;;;;;;IAClE;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACZ,kBAAkB,GAAG,CAAC,CAAC,wBACtB,6LAAC,+JAAA,CAAA,UAAI;gBAEH,MAAM,CAAC,SAAS,EAAE,QAAQ,QAAQ,IAAI,QAAQ,EAAE,EAAE;gBAClD,WAAU;;kCAEV,6LAAC,qIAAA,CAAA,SAAM;wBAAC,WAAU;;0CAChB,6LAAC,qIAAA,CAAA,cAAW;gCAAC,KAAK,QAAQ,mBAAmB,IAAI;gCAAW,KAAK,QAAQ,QAAQ,IAAI;;;;;;0CACrF,6LAAC,qIAAA,CAAA,iBAAc;0CAAE,QAAQ,QAAQ,EAAE,OAAO,GAAG,iBAAiB;;;;;;;;;;;;kCAEhE,6LAAC;wBAAK,WAAU;kCAAgC,QAAQ,QAAQ,IAAI;;;;;;;eAR/D,QAAQ,EAAE;;;;;;;;;;AAazB;GAzGgB;;QACG,iIAAA,CAAA,UAAO;;;KADV","debugId":null}},
    {"offset": {"line": 380, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/Sidebar.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport Image from \"next/image\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useAuth } from \"@/context/AuthContext\"; // Import useAuth\r\nimport { FollowingList } from \"./FollowingList\"; // Import the new component\r\n// Removed Input and other search-related imports\r\nimport { FaHome, FaCompass, FaUser, FaVideo, FaTv, FaEnvelope, FaSearch } from \"react-icons/fa\";\r\nimport { IoMdPeople } from \"react-icons/io\";\r\n\r\n// --- Sidebar Props ---\r\ninterface SidebarProps {\r\n  // Callback to toggle the search panel visibility\r\n  toggleSearchPanel: () => void;\r\n  // Callback to deactivate search mode when navigating\r\n  deactivateSearch: () => void;\r\n}\r\n\r\nexport function Sidebar({ toggleSearchPanel, deactivateSearch }: SidebarProps) {\r\n  const { user } = useAuth(); // Get logged-in user state\r\n\r\n  // Determine the correct profile link\r\n  // Link to /profile/[username] if available, otherwise link to the generic /profile page\r\n  const profileHref = (user && user.user_metadata?.username)\r\n    ? `/profile/${user.user_metadata.username}`\r\n    : '/profile'; // Default to /profile if not logged in or no username\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-screen w-[240px] border-r border-border pb-4\">\r\n      {/* Logo */}\r\n      <div className=\"p-4 flex-shrink-0\">\r\n        <Link href=\"/\" className=\"flex items-center\" onClick={deactivateSearch}> {/* Deactivate search on logo click */}\r\n\r\n          <span className=\"text-xl font-bold\">SubScroll</span>\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Removed Search Input Area */}\r\n\r\n      {/* Navigation Links Area */}\r\n      <ScrollArea className=\"flex-1 px-4\">\r\n        <div className=\"space-y-2 py-2\">\r\n          {/* Search Toggle Button */}\r\n          <button\r\n            onClick={toggleSearchPanel}\r\n            className={`flex items-center gap-3 px-4 py-4 rounded-md transition-colors w-full text-foreground/80 hover:text-foreground hover:bg-secondary/50`}\r\n          >\r\n            <FaSearch size={20} />\r\n            <span className=\"text-base\">Search</span>\r\n          </button>\r\n          {/* Standard Nav Items */}\r\n          <NavItem href=\"/\" icon={<FaHome size={20} />} label=\"For You\" onClick={deactivateSearch} />\r\n          <NavItem href=\"/explore\" icon={<FaCompass size={20} />} label=\"Explore\" onClick={deactivateSearch} />\r\n          <NavItem href=\"/following\" icon={<IoMdPeople size={20} />} label=\"Following\" onClick={deactivateSearch} />\r\n          <NavItem href=\"/messages\" icon={<FaEnvelope size={20} />} label=\"Messages\" onClick={deactivateSearch} /> {/* Also deactivate search */}\r\n          <NavItem href=\"/upload\" icon={<FaVideo size={20} />} label=\"Upload\" onClick={deactivateSearch} /> {/* Also deactivate search */}\r\n          {/* Use dynamic profileHref */}\r\n          <NavItem href={profileHref} icon={<FaUser size={20} />} label=\"Profile\" onClick={deactivateSearch} />\r\n        </div>\r\n\r\n        <Separator className=\"my-4\" />\r\n\r\n        {/* Following Users List */}\r\n        <NavGroup title=\"Following\">\r\n          <FollowingList />\r\n        </NavGroup>\r\n\r\n        {/* Removed login prompt and footer links */}\r\n      </ScrollArea>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface NavItemProps {\r\n  href: string;\r\n  icon: React.ReactNode;\r\n  label: string;\r\n  active?: boolean;\r\n  onClick?: () => void; // Added optional onClick prop\r\n}\r\n\r\nfunction NavItem({ href, icon, label, active, onClick }: NavItemProps) { // Added onClick to destructuring\r\n  // Make link full width, increase vertical padding, adjust horizontal padding\r\n  return (\r\n    <Link href={href} onClick={onClick} className={`flex items-center gap-3 px-4 py-4 rounded-md transition-colors w-full ${active ? 'font-semibold bg-secondary' : 'text-foreground/80 hover:text-foreground hover:bg-secondary/50'}`}>\r\n      {icon}\r\n      <span className=\"text-base\">{label}</span>\r\n    </Link>\r\n  );\r\n}\r\n\r\ninterface NavGroupProps {\r\n  title: string;\r\n  children: React.ReactNode;\r\n}\r\n\r\nfunction NavGroup({ title, children }: NavGroupProps) {\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <h4 className=\"text-xs uppercase tracking-wider text-muted-foreground\">{title}</h4>\r\n      <div className=\"space-y-1\">\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface NavLinkProps {\r\n  href: string;\r\n  children: React.ReactNode;\r\n}\r\n\r\nfunction NavLink({ href, children }: NavLinkProps) {\r\n  return (\r\n    <Link href={href} className=\"block text-xs text-muted-foreground hover:underline\">\r\n      {children}\r\n    </Link>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 689, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"bg-primary text-primary-foreground shadow hover:bg-primary/90\",\r\n        destructive:\r\n          \"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90\",\r\n        outline:\r\n          \"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground\",\r\n        secondary:\r\n          \"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80\",\r\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\r\n        link: \"text-primary underline-offset-4 hover:underline\",\r\n      },\r\n      size: {\r\n        default: \"h-9 px-4 py-2\",\r\n        sm: \"h-8 rounded-md px-3 text-xs\",\r\n        lg: \"h-10 rounded-md px-8\",\r\n        icon: \"h-9 w-9\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface ButtonProps\r\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n    VariantProps<typeof buttonVariants> {\r\n  asChild?: boolean\r\n}\r\n\r\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"button\"\r\n    return (\r\n      <Comp\r\n        className={cn(buttonVariants({ variant, size, className }))}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nButton.displayName = \"Button\"\r\n\r\nexport { Button, buttonVariants }\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,iBAAiB,CAAA,GAAA,mKAAA,CAAA,MAAG,AAAD,EACvB,ySACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,aACE;YACF,SACE;YACF,WACE;YACF,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAC5B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,mKAAA,CAAA,OAAI,GAAG;IAC9B,qBACE,6LAAC;QACC,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,OAAO,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 756, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/Header.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from 'next/link';\r\n// Removed Input import\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { FaEllipsisV, FaGoogle } from \"react-icons/fa\"; // Removed FaSearch\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useRouter } from 'next/navigation'; // Keep for potential future use? Or remove if unused.\r\nimport type React from 'react';\r\n\r\n// Removed HeaderProps interface\r\n\r\nexport function Header() { // Removed props\r\n  const { user, loading, signInWithGoogle, signOut } = useAuth();\r\n  const router = useRouter();\r\n\r\n  // Removed all search-related state and handlers\r\n\r\n  // Auth handlers remain the same\r\n  const handleSignIn = async () => {\r\n    await signInWithGoogle();\r\n  };\r\n\r\n  const handleSignOut = async () => {\r\n    await signOut();\r\n  };\r\n\r\n  return (\r\n    // Header is simpler now, just contains actions/auth\r\n    <header className=\"fixed top-0 right-0 left-[240px] h-16 flex items-center justify-end px-6 bg-background/95 backdrop-blur-sm z-10\"> {/* Changed justify-between to justify-end */}\r\n\r\n      {/* Removed Search Input Area */}\r\n\r\n      {/* Right side elements (Upload, Auth) */}\r\n      <div className=\"flex items-center gap-3\">\r\n        <Link href=\"/upload\">\r\n          <Button variant=\"outline\" className=\"border-primary text-primary hover:bg-primary/10 font-semibold\">\r\n            Upload\r\n          </Button>\r\n        </Link>\r\n\r\n        {loading ? (\r\n          <Button disabled>Loading...</Button>\r\n        ) : user ? (\r\n          <>\r\n             <Link href={`/profile/${user.user_metadata?.username || user.id}`} passHref>\r\n                <Avatar className=\"h-8 w-8 cursor-pointer\">\r\n                  <AvatarImage\r\n                    src={user.user_metadata?.avatar_url || undefined}\r\n                    alt={user.user_metadata?.full_name || user.email || 'User'}\r\n                  />\r\n                  <AvatarFallback>\r\n                    {user.user_metadata?.username?.charAt(0)?.toUpperCase() || user.email?.charAt(0)?.toUpperCase() || 'U'}\r\n                  </AvatarFallback>\r\n                </Avatar>\r\n             </Link>\r\n            <Button onClick={handleSignOut} variant=\"outline\">\r\n              Log out\r\n            </Button>\r\n          </>\r\n        ) : (\r\n          <Button onClick={handleSignIn} className=\"tiktok-button px-4 py-2 flex items-center gap-2\">\r\n            {/* Wrap content in a span to prevent potential nesting issues */}\r\n            <span><FaGoogle /> Log in</span>\r\n          </Button>\r\n        )}\r\n\r\n        <Button variant=\"ghost\" size=\"icon\">\r\n          <FaEllipsisV />\r\n        </Button>\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA,uBAAuB;AACvB;AACA,8PAAwD,mBAAmB;AAC3E;AACA;AACA,4OAA6C,sDAAsD;;;AARnG;;;;;;;AAaO,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,gBAAgB,EAAE,OAAO,EAAE,GAAG,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD;IAC3D,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IAEvB,gDAAgD;IAEhD,gCAAgC;IAChC,MAAM,eAAe;QACnB,MAAM;IACR;IAEA,MAAM,gBAAgB;QACpB,MAAM;IACR;IAEA,OACE,oDAAoD;kBACpD,6LAAC;QAAO,WAAU;;YAAkH;0BAKlI,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,+JAAA,CAAA,UAAI;wBAAC,MAAK;kCACT,cAAA,6LAAC,qIAAA,CAAA,SAAM;4BAAC,SAAQ;4BAAU,WAAU;sCAAgE;;;;;;;;;;;oBAKrG,wBACC,6LAAC,qIAAA,CAAA,SAAM;wBAAC,QAAQ;kCAAC;;;;;+BACf,qBACF;;0CACG,6LAAC,+JAAA,CAAA,UAAI;gCAAC,MAAM,CAAC,SAAS,EAAE,KAAK,aAAa,EAAE,YAAY,KAAK,EAAE,EAAE;gCAAE,QAAQ;0CACxE,cAAA,6LAAC,qIAAA,CAAA,SAAM;oCAAC,WAAU;;sDAChB,6LAAC,qIAAA,CAAA,cAAW;4CACV,KAAK,KAAK,aAAa,EAAE,cAAc;4CACvC,KAAK,KAAK,aAAa,EAAE,aAAa,KAAK,KAAK,IAAI;;;;;;sDAEtD,6LAAC,qIAAA,CAAA,iBAAc;sDACZ,KAAK,aAAa,EAAE,UAAU,OAAO,IAAI,iBAAiB,KAAK,KAAK,EAAE,OAAO,IAAI,iBAAiB;;;;;;;;;;;;;;;;;0CAI3G,6LAAC,qIAAA,CAAA,SAAM;gCAAC,SAAS;gCAAe,SAAQ;0CAAU;;;;;;;qDAKpD,6LAAC,qIAAA,CAAA,SAAM;wBAAC,SAAS;wBAAc,WAAU;kCAEvC,cAAA,6LAAC;;8CAAK,6LAAC,iJAAA,CAAA,WAAQ;;;;;gCAAG;;;;;;;;;;;;kCAItB,6LAAC,qIAAA,CAAA,SAAM;wBAAC,SAAQ;wBAAQ,MAAK;kCAC3B,cAAA,6LAAC,iJAAA,CAAA,cAAW;;;;;;;;;;;;;;;;;;;;;;AAKtB;GA7DgB;;QACuC,iIAAA,CAAA,UAAO;QAC7C,qIAAA,CAAA,YAAS;;;KAFV","debugId":null}},
    {"offset": {"line": 929, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\r\n  ({ className, type, ...props }, ref) => {\r\n    return (\r\n      <input\r\n        type={type}\r\n        className={cn(\r\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\r\n          className\r\n        )}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nInput.displayName = \"Input\"\r\n\r\nexport { Input }\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAC3B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,6LAAC;QACC,MAAM;QACN,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,2WACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,MAAM,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 965, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/SearchPanel.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useCallback, useRef } from \"react\";\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { FaSearch, FaTimes } from \"react-icons/fa\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport type { Tables } from '@/lib/database.types';\r\nimport { debounce } from 'lodash';\r\n\r\n// --- Suggestion Types ---\r\ntype ProfileSuggestion = Pick<Tables<'profiles'>, 'id' | 'username' | 'name' | 'profile_picture_url'>;\r\ntype TextSuggestion = string; // Could be recent searches, popular terms etc.\r\ntype Suggestion =\r\n | { type: 'profile'; data: ProfileSuggestion }\r\n | { type: 'text'; data: TextSuggestion };\r\n\r\n// --- Component Props ---\r\ninterface SearchPanelProps {\r\n  isVisible: boolean; // To control internal logic if needed, though parent controls rendering\r\n  setActiveSearchQuery: (query: string) => void; // Update parent's query for main content\r\n  setIsSearchActive: (isActive: boolean) => void; // Signal parent if search is active\r\n  closePanel: () => void; // Function to call when closing the panel\r\n}\r\n\r\nexport function SearchPanel({\r\n  isVisible, // isVisible might not be strictly needed if parent handles rendering\r\n  setActiveSearchQuery,\r\n  setIsSearchActive,\r\n  closePanel\r\n}: SearchPanelProps) {\r\n  const router = useRouter();\r\n  const [localQuery, setLocalQuery] = useState(''); // Internal state for the input\r\n  const [suggestions, setSuggestions] = useState<Suggestion[]>([]);\r\n  const [isSearchingSuggestions, setIsSearchingSuggestions] = useState(false);\r\n  const [showSuggestions, setShowSuggestions] = useState(true); // Keep suggestions visible while panel is open\r\n  const panelRef = useRef<HTMLDivElement>(null); // Ref for the panel itself\r\n\r\n  // --- Debounced Fetching for Suggestions ---\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  const debouncedFetchSuggestions = useCallback(\r\n    debounce(async (query: string) => {\r\n      if (query.trim().length < 1) {\r\n        // TODO: Fetch/show recent searches or default suggestions\r\n        setSuggestions([\r\n            { type: 'text', data: 'metal sonic edit' },\r\n            { type: 'text', data: 'meta quest 3' },\r\n        ]);\r\n        setIsSearchingSuggestions(false);\r\n        return;\r\n      }\r\n      setIsSearchingSuggestions(true);\r\n      let combinedSuggestions: Suggestion[] = [];\r\n\r\n      try {\r\n        // Fetch profiles\r\n        const { data: profiles, error: profileError } = await supabase\r\n          .from('profiles')\r\n          .select('id, username, name, profile_picture_url')\r\n          .or(`username.ilike.%${query}%,name.ilike.%${query}%`)\r\n          .limit(4);\r\n\r\n        if (profileError) console.error(\"Profile suggestion error:\", profileError);\r\n        else if (profiles) {\r\n          combinedSuggestions = combinedSuggestions.concat(\r\n            profiles.map(p => ({ type: 'profile' as const, data: p as ProfileSuggestion }))\r\n          );\r\n        }\r\n\r\n        // TODO: Fetch dynamic text suggestions\r\n        const staticTextSuggestions: TextSuggestion[] = [\r\n            \"metal sonic edit\", \"metal gear solid\", \"meta quest 3\", \"metallica\",\r\n        ].filter(s => s.toLowerCase().includes(query.toLowerCase())).slice(0, 6);\r\n\r\n        combinedSuggestions = combinedSuggestions.concat(\r\n            staticTextSuggestions.map(s => ({ type: 'text' as const, data: s }))\r\n        );\r\n\r\n        // Sort suggestions (e.g., text first, then profiles)\r\n        combinedSuggestions.sort((a, b) => {\r\n            if (a.type === 'text' && b.type === 'profile') return -1;\r\n            if (a.type === 'profile' && b.type === 'text') return 1;\r\n            return 0;\r\n        });\r\n\r\n        setSuggestions(combinedSuggestions);\r\n\r\n      } catch (err) {\r\n        console.error(\"Error fetching suggestions:\", err);\r\n        setSuggestions([]);\r\n      } finally {\r\n       setIsSearchingSuggestions(false);\r\n       }\r\n     }, 300),\r\n     [] // Debounce function is stable, empty dependency array is correct.\r\n   );\r\n\r\n  // --- Effects ---\r\n  // Fetch suggestions when query changes\r\n  useEffect(() => {\r\n     debouncedFetchSuggestions(localQuery);\r\n     // Cleanup debounce on unmount or query change\r\n     return () => debouncedFetchSuggestions.cancel();\r\n  }, [localQuery, debouncedFetchSuggestions]); // Keep debouncedFetchSuggestions here\r\n\r\n  // --- Handlers ---\r\n  const handleInputChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const query = event.target.value;\r\n    setLocalQuery(query);\r\n    setActiveSearchQuery(query); // Update parent state for main content results\r\n    setIsSearchActive(true); // Ensure main content shows results\r\n  };\r\n\r\n  // Handle submitting search (e.g., clicking \"View all results\")\r\n  const handleSearchSubmit = (query: string) => {\r\n    const trimmedQuery = query.trim();\r\n    if (trimmedQuery) {\r\n      setLocalQuery(trimmedQuery);\r\n      setActiveSearchQuery(trimmedQuery);\r\n      setIsSearchActive(true);\r\n      // Optionally close panel on submit? Or keep it open? Let's keep it open for now.\r\n      // closePanel();\r\n      // Navigation happens implicitly by MainLayout rendering SearchResultsDisplay\r\n    }\r\n  };\r\n\r\n   const handleSuggestionClick = (suggestion: string) => {\r\n     handleSearchSubmit(suggestion);\r\n  };\r\n\r\n  const handleProfileClick = () => {\r\n     closePanel(); // Close panel when navigating to profile\r\n  };\r\n\r\n  const handleClearInput = () => {\r\n     setLocalQuery('');\r\n     setActiveSearchQuery(''); // Clear parent query\r\n     setSuggestions([]); // Clear suggestions\r\n     debouncedFetchSuggestions.cancel();\r\n     // Optionally set search inactive?\r\n     // setIsSearchActive(false);\r\n  };\r\n\r\n  // --- Render ---\r\n  return (\r\n    // Panel styling - fixed position next to sidebar\r\n    <div\r\n      ref={panelRef}\r\n      className=\"fixed left-[240px] top-0 w-[350px] h-full bg-background border-r border-border z-20 flex flex-col shadow-lg\" // Example width, adjust as needed\r\n    >\r\n      {/* Panel Header */}\r\n      <div className=\"flex items-center justify-between p-4 border-b border-border flex-shrink-0\">\r\n        <h2 className=\"text-lg font-semibold text-foreground\">Search</h2>\r\n        <Button variant=\"ghost\" size=\"icon\" onClick={closePanel} aria-label=\"Close search\">\r\n          <FaTimes className=\"h-5 w-5 text-muted-foreground\" />\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Panel Search Input */}\r\n      <div className=\"p-4 flex-shrink-0\">\r\n        <div className=\"relative\">\r\n          <Input\r\n            type=\"text\"\r\n            placeholder=\"Search accounts and videos\"\r\n            value={localQuery}\r\n            onChange={handleInputChange}\r\n            onKeyDown={(e) => e.key === 'Enter' && handleSearchSubmit(localQuery)}\r\n            className=\"bg-secondary border-0 pl-10 pr-10 h-10 rounded-md text-sm focus-visible:ring-1 focus-visible:ring-primary\"\r\n            autoFocus\r\n          />\r\n          <div className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-muted-foreground pointer-events-none\">\r\n            <FaSearch size={16} />\r\n          </div>\r\n          {localQuery && (\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              className=\"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground hover:text-foreground h-10 w-10\"\r\n              onClick={handleClearInput}\r\n              aria-label=\"Clear search\"\r\n            >\r\n              <FaTimes className=\"h-4 w-4\" />\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Suggestions Area */}\r\n      <div className=\"flex-grow overflow-y-auto px-4 pb-4\">\r\n        {isSearchingSuggestions && suggestions.length === 0 && (\r\n          <p className=\"text-muted-foreground text-center p-4 text-sm\">Searching...</p>\r\n        )}\r\n        {!isSearchingSuggestions && suggestions.length === 0 && localQuery.trim().length > 0 && (\r\n           <p className=\"text-muted-foreground text-center p-4 text-sm\">No results found for \"{localQuery}\"</p>\r\n        )}\r\n        {/* TODO: Add Recent Searches section here */}\r\n        {suggestions.length > 0 && (\r\n          <ul className=\"space-y-1\">\r\n            {/* Text Suggestions */}\r\n            {suggestions.filter(s => s.type === 'text').map((s, i) => (\r\n               <li key={`text-${i}`}>\r\n                 <button onClick={() => handleSuggestionClick(s.data as string)} className=\"flex items-center gap-3 w-full text-left p-2 rounded hover:bg-secondary transition-colors\">\r\n                   <FaSearch className=\"w-4 h-4 text-muted-foreground flex-shrink-0\" />\r\n                   <span className=\"text-sm text-foreground truncate\">{s.data as string}</span>\r\n                 </button>\r\n               </li>\r\n            ))}\r\n            {/* Profile Suggestions */}\r\n            {suggestions.filter(s => s.type === 'profile').length > 0 && (\r\n               <li className=\"px-2 pt-3 pb-1 text-xs font-semibold text-muted-foreground uppercase\">Accounts</li>\r\n            )}\r\n            {suggestions.filter(s => s.type === 'profile').map((s) => {\r\n               const profile = s.data as ProfileSuggestion;\r\n               return (\r\n                 <li key={profile.id}>\r\n                   <Link href={`/profile/${profile.username}`} onClick={handleProfileClick} className=\"flex items-center gap-3 p-2 rounded hover:bg-secondary transition-colors\">\r\n                     <Avatar className=\"h-8 w-8\">\r\n                       <AvatarImage src={profile.profile_picture_url || undefined} alt={profile.username || 'User'} />\r\n                       <AvatarFallback className=\"text-xs\">{profile.username?.charAt(0)?.toUpperCase() || 'U'}</AvatarFallback>\r\n                     </Avatar>\r\n                     <div>\r\n                       <p className=\"font-medium text-sm text-foreground\">{profile.username}</p>\r\n                       <p className=\"text-xs text-muted-foreground\">{profile.name}</p>\r\n                     </div>\r\n                   </Link>\r\n                 </li>\r\n               );\r\n            })}\r\n          </ul>\r\n        )}\r\n        {/* \"View all results\" button */}\r\n        {localQuery.trim() && !isSearchingSuggestions && (\r\n           <div className=\"mt-4 pt-4 border-t border-border\">\r\n               <button\r\n                  onClick={() => handleSearchSubmit(localQuery)}\r\n                  className=\"flex items-center gap-3 w-full text-left p-2 rounded hover:bg-secondary transition-colors text-primary\"\r\n               >\r\n                  <FaSearch className=\"w-4 h-4\" />\r\n                  <span className=\"text-sm font-medium\">View all results for \"{localQuery}\"</span>\r\n               </button>\r\n           </div>\r\n        )}\r\n         {!localQuery.trim() && !isSearchingSuggestions && suggestions.length === 0 && (\r\n             <p className=\"text-muted-foreground text-center p-4 text-sm\">Search for accounts or videos.</p>\r\n         )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1428, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/PostInteractionButtons.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useCallback, useContext } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation'; // Keep useRouter import\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport { AuthContext } from '@/context/AuthContext';\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\n// Use Font Awesome icons for closer match to original screenshot\r\nimport { FaHeart, FaCommentDots, FaShare } from \"react-icons/fa\";\r\nimport { Lock, Unlock, ShoppingCart, Loader2 } from 'lucide-react'; // Keep Lock/Unlock for internal logic if needed elsewhere, but remove from UI stack\r\nimport { toast } from 'sonner';\r\nimport { Button } from '@/components/ui/button';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\n\r\n// Initialize Stripe outside the component\r\nconst stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!);\r\n\r\ninterface PostInteractionButtonsProps {\r\n  postId: string;\r\n  userId: string; // ID of the post owner\r\n  // onProfileClick prop removed\r\n  username: string;\r\n  profilePictureUrl?: string;\r\n  initialLikes: number;\r\n  initialIsLiked: boolean;\r\n  commentsCount: string;\r\n  sharesCount: string;\r\n  initialIsPrivate: boolean;\r\n  isOwner: boolean;\r\n  videoCaption?: string;\r\n  postType: 'video' | 'image';\r\n  is_for_sale: boolean;\r\n  price?: number | null;\r\n  currency?: string | null;\r\n  onLikeSuccess?: (newLikesCount: number) => void;\r\n  // onCommentSuccess prop removed as it wasn't used\r\n}\r\n\r\nexport function PostInteractionButtons({\r\n  postId,\r\n  userId,\r\n  username,\r\n  profilePictureUrl,\r\n  initialLikes,\r\n  initialIsLiked,\r\n  commentsCount,\r\n  sharesCount,\r\n  initialIsPrivate,\r\n  isOwner,\r\n  videoCaption,\r\n  postType,\r\n  is_for_sale,\r\n  price,\r\n  currency,\r\n  onLikeSuccess,\r\n  // onProfileClick removed from destructuring\r\n}: PostInteractionButtonsProps) {\r\n  const router = useRouter(); // Keep router instance\r\n  const { user: loggedInUser } = useContext(AuthContext);\r\n  const [isLiked, setIsLiked] = useState(initialIsLiked);\r\n  const [currentLikes, setCurrentLikes] = useState(initialLikes);\r\n  const [currentIsPrivate, setCurrentIsPrivate] = useState(initialIsPrivate);\r\n  const [isUpdatingPrivacy, setIsUpdatingPrivacy] = useState(false);\r\n  const [isCheckoutLoading, setIsCheckoutLoading] = useState(false);\r\n\r\n  // --- Like Handler ---\r\n  const handleLike = useCallback(async () => {\r\n    if (!loggedInUser) {\r\n      toast.info(\"Please log in to like posts.\");\r\n      return;\r\n    }\r\n    const originalLiked = isLiked;\r\n    const originalLikesCount = currentLikes;\r\n    const newLikedStatus = !isLiked;\r\n    const newLikesCount = newLikedStatus ? currentLikes + 1 : currentLikes - 1;\r\n\r\n    setIsLiked(newLikedStatus);\r\n    setCurrentLikes(newLikesCount);\r\n\r\n    try {\r\n      if (newLikedStatus) {\r\n        const { error } = await supabase.from('likes').insert({ user_id: loggedInUser.id, post_id: postId });\r\n        if (error) throw error;\r\n      } else {\r\n        const { error } = await supabase.from('likes').delete().match({ user_id: loggedInUser.id, post_id: postId });\r\n        if (error) throw error;\r\n      }\r\n      onLikeSuccess?.(newLikesCount);\r\n    } catch (error: unknown) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      setIsLiked(originalLiked);\r\n      setCurrentLikes(originalLikesCount);\r\n      toast.error(\"Failed to update like status.\");\r\n      console.error('[InteractionButtons] Error updating like status:', message); // Use the extracted message\r\n    }\r\n  }, [loggedInUser, postId, isLiked, currentLikes, onLikeSuccess]);\r\n\r\n  // --- Share Handler ---\r\n  const handleShare = useCallback(async () => {\r\n    const shareData = {\r\n      title: `Check out this post by @${username}!`,\r\n      text: videoCaption || `Check out this post by @${username}!`,\r\n      url: postType === 'video'\r\n         ? `${window.location.origin}/video/${postId}`\r\n         : `${window.location.origin}/image/${postId}`,\r\n    };\r\n    try {\r\n      if (navigator.share) {\r\n        await navigator.share(shareData);\r\n      } else {\r\n        await navigator.clipboard.writeText(shareData.url);\r\n        toast.success(\"Link copied to clipboard!\");\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sharing:', error);\r\n      if ((error as DOMException).name !== 'AbortError') {\r\n        toast.error(\"Could not share post.\");\r\n      }\r\n    }\r\n  }, [postId, username, videoCaption, postType]);\r\n\r\n  // --- Privacy Toggle Handler ---\r\n  const handleTogglePrivacy = useCallback(async () => {\r\n    if (!isOwner || isUpdatingPrivacy || !loggedInUser) {\r\n      if (!loggedInUser) toast.error(\"You must be logged in.\");\r\n      return;\r\n    }\r\n    setIsUpdatingPrivacy(true);\r\n    const originalIsPrivate = currentIsPrivate;\r\n    const newIsPrivate = !currentIsPrivate;\r\n    setCurrentIsPrivate(newIsPrivate); // Optimistic update\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('posts')\r\n        .update({ is_private: newIsPrivate })\r\n        .eq('id', postId)\r\n        .eq('user_id', loggedInUser.id);\r\n      if (error) throw error;\r\n      toast.success(`Post set to ${newIsPrivate ? 'Private' : 'Public'}`);\r\n    } catch (error: unknown) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      setCurrentIsPrivate(originalIsPrivate); // Revert on error\r\n      toast.error(\"Failed to update privacy status.\");\r\n      console.error('Error updating privacy status:', message);\r\n    } finally {\r\n      setIsUpdatingPrivacy(false);\r\n    }\r\n  }, [isOwner, isUpdatingPrivacy, loggedInUser, postId, currentIsPrivate]);\r\n\r\n  // --- Purchase Handler ---\r\n  const handlePurchase = useCallback(async () => {\r\n    if (!loggedInUser) {\r\n      toast.info(\"Please log in to purchase items.\");\r\n      return;\r\n    }\r\n    if (!postId || !is_for_sale || !price || price <= 0) {\r\n      toast.error(\"This item cannot be purchased currently.\");\r\n      return;\r\n    }\r\n    setIsCheckoutLoading(true);\r\n    try {\r\n      const response = await fetch('/api/stripe/create-item-checkout-session', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ postId }),\r\n      });\r\n      const sessionData = await response.json();\r\n      if (!response.ok) throw new Error(sessionData.error || 'Failed to create checkout session');\r\n      if (!sessionData.sessionId) throw new Error('Session ID not received from server');\r\n      const stripe = await stripePromise;\r\n      if (!stripe) throw new Error('Stripe.js failed to load.');\r\n      const { error: stripeError } = await stripe.redirectToCheckout({ sessionId: sessionData.sessionId });\r\n      if (stripeError) throw new Error(stripeError.message);\r\n    } catch (error) {\r\n      console.error('Purchase initiation error:', error);\r\n      toast.error(`Failed to initiate purchase: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    } finally {\r\n      setIsCheckoutLoading(false);\r\n    }\r\n   }, [loggedInUser, postId, is_for_sale, price]);\r\n\r\n   const PrivacyIcon = currentIsPrivate ? Lock : Unlock;\r\n\r\n   // Determine container classes based on is_for_sale\r\n  const containerClasses = is_for_sale\r\n    ? \"absolute top-4 right-4 z-20 pointer-events-auto\" // Top-right for sale items\r\n    : \"absolute bottom-12 right-3 z-20 flex flex-col items-end space-y-1 pointer-events-auto\"; // Position even lower, tighten spacing, adjust right offset\r\n\r\n  return (\r\n    <div className={containerClasses}>\r\n      {/* Profile Link (Always rendered, position handled by container) */}\r\n      <Link\r\n        href={`/profile/${username}`} // Link to the user's profile page\r\n        onClick={(e) => {\r\n          e.stopPropagation(); // Prevent parent Link navigation\r\n        }}\r\n        className={`profile-link-area text-white cursor-pointer ${!is_for_sale && postType === 'video' ? 'mt-4' : ''} ${!is_for_sale ? 'mb-1' : ''} ${is_for_sale ? '' : 'flex flex-col items-center'}`}\r\n        aria-label={`View profile for ${username}`}\r\n      >\r\n        <Avatar className=\"w-10 h-10 border-2 border-white\">\r\n          <AvatarImage src={profilePictureUrl ?? ''} alt={`${username}'s profile picture`} />\r\n          <AvatarFallback>{username?.charAt(0).toUpperCase() ?? 'U'}</AvatarFallback>\r\n        </Avatar>\r\n      </Link>\r\n\r\n      {/* Like Button (Only render if not for sale) */}\r\n      {/* Like Button (Using FaHeart) */}\r\n      {!is_for_sale && (\r\n        <button onClick={handleLike} className=\"flex flex-col items-center text-white group/like\">\r\n          <div className={`w-10 h-10 bg-black/40 rounded-full flex items-center justify-center mb-1 transition-colors ${isLiked ? 'bg-red-500/80' : 'group-hover/like:bg-white/20'}`}>\r\n            <FaHeart size={24} className={`${isLiked ? 'text-red-500' : 'text-white'} transition-transform group-hover/like:scale-110`} /> {/* Use FaHeart */}\r\n          </div>\r\n          <span className=\"text-xs font-semibold\">{currentLikes}</span>\r\n        </button>\r\n      )}\r\n\r\n      {/* Comment Button */}\r\n      {!is_for_sale && (\r\n        <Link\r\n          href={postType === 'video' ? `/video/${postId}#comments` : `/image/${postId}#comments`}\r\n          className=\"flex flex-col items-center text-white\"\r\n          aria-label=\"View comments\"\r\n          onClick={(e) => e.stopPropagation()} // Keep stopPropagation here too\r\n        >\r\n          <div className=\"w-10 h-10 bg-black/40 rounded-full flex items-center justify-center mb-1\">\r\n            <FaCommentDots size={24} /> {/* Use FaCommentDots */}\r\n          </div>\r\n          <span className=\"text-xs font-semibold\">{commentsCount}</span>\r\n        </Link>\r\n      )}\r\n\r\n      {/* Share Button */}\r\n      {/* Share Button (Using FaShare) */}\r\n      {!is_for_sale && (\r\n        <button onClick={handleShare} className=\"flex flex-col items-center text-white group/share\">\r\n          <div className=\"w-10 h-10 bg-black/40 rounded-full flex items-center justify-center mb-1 transition-colors group-hover/share:bg-white/20\">\r\n            <FaShare size={22} className=\"transition-transform group-hover/share:scale-110\" /> {/* Use FaShare, slightly smaller */}\r\n          </div>\r\n          <span className=\"text-xs font-semibold\">{sharesCount}</span>\r\n        </button>\r\n      )}\r\n\r\n      {/* Privacy Status Display/Button REMOVED from UI stack */}\r\n\r\n\r\n      {/* Buy Button (Conditional - Now removed entirely for sale items based on feedback) */}\r\n      {/* {is_for_sale && price && price > 0 && !isOwner && (\r\n        <button\r\n          onClick={handlePurchase}\r\n          disabled={isCheckoutLoading || !loggedInUser}\r\n          className=\"flex flex-col items-center text-white group/buy mt-2\"\r\n          aria-label={`Purchase for ${(price / 100).toFixed(2)} ${currency?.toUpperCase() ?? 'USD'}`}\r\n        >\r\n          <div className={`w-10 h-10 bg-green-600/80 hover:bg-green-500/90 rounded-full flex items-center justify-center mb-1 transition-colors`}>\r\n            {isCheckoutLoading ? <Loader2 className=\"h-5 w-5 animate-spin\" /> : <ShoppingCart size={24} />}\r\n          </div>\r\n          <span className=\"text-xs font-semibold\">Buy (${(price / 100).toFixed(2)})</span>\r\n        </button>\r\n      )} */}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1794, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\r\n        secondary:\r\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        destructive:\r\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\r\n        outline: \"text-foreground\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface BadgeProps\r\n  extends React.HTMLAttributes<HTMLDivElement>,\r\n    VariantProps<typeof badgeVariants> {}\r\n\r\nfunction Badge({ className, variant, ...props }: BadgeProps) {\r\n  return (\r\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\r\n  )\r\n}\r\n\r\nexport { Badge, badgeVariants }\r\n"],"names":[],"mappings":";;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,CAAA,GAAA,mKAAA,CAAA,MAAG,AAAD,EACtB,0KACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;QACX;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,6LAAC;QAAI,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE;KAJS","debugId":null}},
    {"offset": {"line": 1842, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/VerticalVideoPlayer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useRef, useEffect, useState, useCallback, useContext } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport { AuthContext } from '@/context/AuthContext';\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Play, Pause, Volume2, VolumeX, Lock, Loader2, ShoppingCart } from 'lucide-react';\r\nimport { PostInteractionButtons } from './PostInteractionButtons';\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { toast } from 'react-hot-toast';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\n\r\n// Initialize Stripe outside the component\r\nconst stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!);\r\n\r\n// Define the props based on the data available\r\ninterface VerticalVideoPlayerProps {\r\n  id: string;\r\n  username: string;\r\n  verified?: boolean;\r\n  profilePictureUrl?: string;\r\n  caption: string | null;\r\n  videoSrc: string;\r\n  posterSrc?: string;\r\n  likes: string;\r\n  comments: string;\r\n  shares: string;\r\n  initialIsLiked?: boolean;\r\n  isPrivate?: boolean | null;\r\n  isOwner?: boolean;\r\n  userId: string;\r\n  is_for_sale: boolean;\r\n  price?: number | null;\r\n  currency?: string | null;\r\n  stripe_price_id?: string | null;\r\n  isLocked?: boolean;\r\n  showControls?: boolean; // Add new prop\r\n  isForYouPage?: boolean; // Add prop to indicate if on For You page\r\n}\r\n\r\n// Helper function to format price\r\nconst formatPrice = (priceInCents: number, currency: string = 'usd') => {\r\n  return new Intl.NumberFormat('en-US', {\r\n    style: 'currency',\r\n    currency: currency.toUpperCase(),\r\n   }).format(priceInCents / 100);\r\n };\r\n\r\n// Helper function to format time (e.g., 0:05, 1:23)\r\nconst formatTime = (timeInSeconds: number): string => {\r\n  if (isNaN(timeInSeconds) || timeInSeconds < 0) {\r\n    return \"0:00\"; // Return default or error state\r\n  }\r\n  const minutes = Math.floor(timeInSeconds / 60);\r\n  const seconds = Math.floor(timeInSeconds % 60);\r\n  return `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n};\r\n\r\n export function VerticalVideoPlayer({\r\n   id,\r\n  username,\r\n  verified,\r\n  profilePictureUrl,\r\n  caption,\r\n  videoSrc,\r\n  posterSrc,\r\n  likes,\r\n  comments,\r\n  shares,\r\n  isPrivate: initialIsPrivate,\r\n  isOwner,\r\n  userId,\r\n  is_for_sale,\r\n  price,\r\n  currency,\r\n  isLocked: isSubLocked,\r\n  initialIsLiked = false,\r\n  showControls = true, // Destructure showControls, default to true\r\n  isForYouPage = false, // Destructure isForYouPage, default to false\r\n}: VerticalVideoPlayerProps) {\r\n  const { user: loggedInUser } = useContext(AuthContext);\r\n  const router = useRouter();\r\n\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const progressBarContainerRef = useRef<HTMLDivElement>(null);\r\n  const [objectUrl, setObjectUrl] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [errorState, setErrorState] = useState<string | null>(null);\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [isMuted, setIsMuted] = useState(true);\r\n  const [progress, setProgress] = useState(0);\r\n  const [duration, setDuration] = useState(0);\r\n  const [isBuying, setIsBuying] = useState(false);\r\n  const [accumulatedWatchTimeMs, setAccumulatedWatchTimeMs] = useState(0);\r\n  const [isVisible, setIsVisible] = useState(false);\r\n   const watchIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n   const reportedWatchTimeRef = useRef(false);\r\n   const [isHovering, setIsHovering] = useState(false); // State for hover\r\n   const [hoverTime, setHoverTime] = useState(0); // State for time preview on hover\r\n   const [isScrubbing, setIsScrubbing] = useState(false); // State for scrubbing\r\n   const [currentTimeFormatted, setCurrentTimeFormatted] = useState(\"0:00\"); // State for current time display\r\n   const [showOverlayOnEnd, setShowOverlayOnEnd] = useState(false); // State to show overlay on video end\r\n\r\n   // Determine lock status\r\n   const isContentLocked = (is_for_sale && !isOwner) || (isSubLocked && !isOwner);\r\n  const isLockedForPurchase = is_for_sale && !isOwner;\r\n\r\n  // Refs to hold latest state values for cleanup function\r\n  const durationRef = useRef(duration);\r\n  const accumulatedWatchTimeMsRef = useRef(accumulatedWatchTimeMs);\r\n  const isContentLockedRef = useRef(isContentLocked);\r\n\r\n  // Keep refs updated\r\n  useEffect(() => { durationRef.current = duration; }, [duration]);\r\n  useEffect(() => { accumulatedWatchTimeMsRef.current = accumulatedWatchTimeMs; }, [accumulatedWatchTimeMs]);\r\n  useEffect(() => { isContentLockedRef.current = isContentLocked; }, [isContentLocked]);\r\n\r\n\r\n  // Fetch video blob only if content is not locked\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    let currentObjectUrl: string | null = null;\r\n    const fetchVideoAsBlob = async () => {\r\n      if (isContentLockedRef.current || !videoSrc) { // Use ref\r\n        setIsLoading(false); return;\r\n      }\r\n      setIsLoading(true); setErrorState(null); setObjectUrl(null);\r\n      try {\r\n        const urlParts = videoSrc.split('/public/');\r\n        if (urlParts.length < 2) throw new Error(\"Invalid video URL format\");\r\n        const bucketAndPath = urlParts[1];\r\n        const firstSlashIndex = bucketAndPath.indexOf('/');\r\n        if (firstSlashIndex === -1) throw new Error(\"Invalid bucket/path format\");\r\n        const bucketName = bucketAndPath.substring(0, firstSlashIndex);\r\n        const filePath = bucketAndPath.substring(firstSlashIndex + 1);\r\n        const { data: blob, error: downloadError } = await supabase.storage.from(bucketName).download(filePath);\r\n        if (downloadError) throw downloadError;\r\n        if (!blob) throw new Error(\"Downloaded data is null\");\r\n        currentObjectUrl = URL.createObjectURL(blob);\r\n        if (isMounted) setObjectUrl(currentObjectUrl);\r\n      } catch (err: unknown) {\r\n        const message = err instanceof Error ? err.message : String(err);\r\n        if (isMounted) setErrorState(`Failed to load video: ${message}`);\r\n      } finally {\r\n        if (isMounted) setIsLoading(false);\r\n      }\r\n    };\r\n    fetchVideoAsBlob();\r\n    return () => { isMounted = false; if (currentObjectUrl) URL.revokeObjectURL(currentObjectUrl); };\r\n  }, [id, videoSrc]); // Removed isContentLocked dependency, rely on ref\r\n\r\n  // Control Handlers\r\n  const togglePlayPause = useCallback(() => {\r\n    if (isContentLockedRef.current) return; // Use ref\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n    if (video.paused || video.ended) video.play().catch(e => console.error(\"Play error:\", e));\r\n    else video.pause();\r\n  }, []); // No dependencies needed as it uses refs\r\n\r\n  const toggleMute = useCallback(() => {\r\n    if (isContentLockedRef.current) return; // Use ref\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n    video.muted = !video.muted;\r\n    setIsMuted(video.muted);\r\n  }, []); // No dependencies needed as it uses refs\r\n\r\n  const handleTimeUpdate = useCallback(() => {\r\n    // Don't update progress if scrubbing or locked\r\n    if (isScrubbing || isContentLockedRef.current) return;\r\n    const video = videoRef.current;\r\n    const progressBarContainer = progressBarContainerRef.current;\r\n    // Use durationRef here\r\n    if (!video || !durationRef.current || !progressBarContainer) return;\r\n    const currentTime = video.currentTime;\r\n    const currentProgress = (currentTime / durationRef.current) * 100;\r\n    setProgress(currentProgress);\r\n    setCurrentTimeFormatted(formatTime(currentTime)); // Update formatted time state\r\n    // Flash effect logic (optional, kept for consistency)\r\n    if (currentTime < 0.1 && durationRef.current > 0 && !video.seeking) {\r\n      if (progressBarContainer && !progressBarContainer.classList.contains('flash-effect')) { // Added null check\r\n        progressBarContainer.classList.add('flash-effect');\r\n        setTimeout(() => {\r\n          // Check again if the element exists before removing class\r\n          if (progressBarContainerRef.current) {\r\n             progressBarContainerRef.current.classList.remove('flash-effect');\r\n          }\r\n        }, 200);\r\n      }\r\n    }\r\n  }, [isScrubbing]); // Add isScrubbing dependency\r\n\r\n  const handleLoadedMetadata = useCallback(() => {\r\n    if (isContentLockedRef.current) return; // Use ref\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n     setDuration(video.duration); // Update state, which updates durationRef via its effect\r\n     setCurrentTimeFormatted(formatTime(0)); // Reset time display on new video load\r\n   }, []); // No dependencies needed as it uses refs\r\n\r\n  // Seek handler for progress bar click\r\n  const handleSeek = useCallback((event: React.MouseEvent<HTMLDivElement>) => {\r\n    if (isContentLockedRef.current) return;\r\n    const progressBarContainer = progressBarContainerRef.current;\r\n    const video = videoRef.current;\r\n    const currentDuration = durationRef.current; // Use ref\r\n\r\n    if (!progressBarContainer || !video || !currentDuration || currentDuration <= 0) return;\r\n\r\n    const rect = progressBarContainer.getBoundingClientRect();\r\n    const clickX = event.clientX - rect.left;\r\n    const barWidth = rect.width;\r\n    const seekPercentage = Math.max(0, Math.min(1, clickX / barWidth)); // Clamp between 0 and 1\r\n    const seekTime = seekPercentage * currentDuration;\r\n\r\n    video.currentTime = seekTime;\r\n    // Update progress state immediately for responsiveness\r\n     setProgress(seekPercentage * 100);\r\n     setCurrentTimeFormatted(formatTime(seekTime)); // Update time display on seek\r\n\r\n   }, []); // No dependencies needed as it uses refs\r\n\r\n  // Hover handlers for progress bar preview\r\n  const handleMouseMove = useCallback((event: React.MouseEvent<HTMLDivElement>) => {\r\n    if (isContentLockedRef.current) return;\r\n    const progressBarContainer = progressBarContainerRef.current;\r\n    const currentDuration = durationRef.current;\r\n\r\n    if (!progressBarContainer || !currentDuration || currentDuration <= 0) return;\r\n\r\n    const rect = progressBarContainer.getBoundingClientRect();\r\n    const hoverX = event.clientX - rect.left;\r\n    const barWidth = rect.width;\r\n    const hoverPercentage = Math.max(0, Math.min(1, hoverX / barWidth));\r\n    setHoverTime(hoverPercentage * currentDuration);\r\n\r\n  }, []); // Dependencies: none, uses refs\r\n\r\n  const handleMouseEnter = useCallback(() => {\r\n    if (isContentLockedRef.current) return;\r\n    setIsHovering(true);\r\n  }, []); // Dependencies: none, uses refs\r\n\r\n  const handleMouseLeave = useCallback(() => {\r\n    if (isContentLockedRef.current) return;\r\n     setIsHovering(false);\r\n   }, []); // Dependencies: none, uses refs\r\n\r\n  // Handle video end\r\n  const handleVideoEnd = useCallback(() => {\r\n    if (isForYouPage) {\r\n      setShowOverlayOnEnd(true);\r\n    }\r\n    setIsPlaying(false); // Update playing state\r\n  }, [isForYouPage]);\r\n\r\n  // Scrubbing handlers\r\n  // Removed useCallback to avoid potential closure issues with isScrubbing state inside listeners\r\n  const handleScrubMove = (event: MouseEvent) => {\r\n    // Check isScrubbing state directly\r\n    if (!isScrubbing || isContentLockedRef.current) return;\r\n\r\n    const progressBarContainer = progressBarContainerRef.current;\r\n    const video = videoRef.current;\r\n    const currentDuration = durationRef.current;\r\n\r\n    if (!progressBarContainer || !video || !currentDuration || currentDuration <= 0) return;\r\n\r\n    const rect = progressBarContainer.getBoundingClientRect();\r\n    // Calculate position relative to the progress bar\r\n    const clientX = event.clientX;\r\n    const scrubX = clientX - rect.left;\r\n    const barWidth = rect.width;\r\n\r\n    // Calculate percentage and clamp between 0 and 1\r\n    const scrubPercentage = Math.max(0, Math.min(1, scrubX / barWidth));\r\n    const seekTime = scrubPercentage * currentDuration;\r\n\r\n    // Update video time directly\r\n    video.currentTime = seekTime;\r\n\r\n    // Update progress state for visual feedback during scrub\r\n    setProgress(scrubPercentage * 100);\r\n    // Update hover time preview as well\r\n    setHoverTime(seekTime);\r\n    setCurrentTimeFormatted(formatTime(seekTime)); // Update time display during scrub\r\n\r\n  }; // Removed useCallback and dependency\r\n\r\n  // Removed useCallback\r\n  const handleScrubEnd = () => {\r\n    // Check isScrubbing state directly\r\n    if (!isScrubbing) return;\r\n    setIsScrubbing(false);\r\n    // Remove global listeners - ensure the function reference is correct\r\n    document.removeEventListener('mousemove', handleScrubMove);\r\n    document.removeEventListener('mouseup', handleScrubEnd);\r\n    // Optional: Resume playback if it was paused due to scrubbing (if needed)\r\n    // const video = videoRef.current;\r\n    // if (video && video.paused) {\r\n    //   video.play().catch(e => console.error(\"Error resuming play after scrub:\", e));\r\n    // }\r\n  }; // Removed useCallback and dependencies\r\n\r\n  const handleMouseDown = useCallback((event: React.MouseEvent<HTMLDivElement>) => {\r\n    if (isContentLockedRef.current) return;\r\n\r\n    setIsScrubbing(true);\r\n    setShowOverlayOnEnd(false); // Hide overlay when scrubbing starts\r\n    // Immediately seek to the clicked position using the existing handleSeek logic\r\n    handleSeek(event);\r\n    // Add global listeners for mouse move and up\r\n    // Add listeners - these will now reference the non-memoized functions\r\n    document.addEventListener('mousemove', handleScrubMove);\r\n    document.addEventListener('mouseup', handleScrubEnd);\r\n  // Update dependencies: handleSeek is memoized, others are not but stable references\r\n  }, [handleSeek]);\r\n\r\n  // Cleanup global listeners on component unmount\r\n  useEffect(() => {\r\n    // Define the cleanup function referencing the potentially non-memoized handlers\r\n    const cleanup = () => {\r\n      document.removeEventListener('mousemove', handleScrubMove);\r\n      document.removeEventListener('mouseup', handleScrubEnd);\r\n    };\r\n    return cleanup;\r\n  }, []); // Empty dependency array: cleanup runs once on unmount\r\n\r\n   // Intersection Observer and Watch Time Reporting Effect\r\n   useEffect(() => {\r\n    const videoElement = videoRef.current;\r\n    // Use ref for isContentLocked check\r\n    if (isContentLockedRef.current || !videoElement || !objectUrl) return;\r\n\r\n    // Define the reporting function *inside* the effect's cleanup\r\n    // This ensures it runs with the values captured at the time of cleanup\r\n    const reportWatchTimeOnCleanup = async () => {\r\n      // Access latest values via refs\r\n      const currentDuration = durationRef.current;\r\n      const currentAccumulatedTime = accumulatedWatchTimeMsRef.current;\r\n      const currentContentLocked = isContentLockedRef.current;\r\n\r\n      if (reportedWatchTimeRef.current || currentContentLocked || currentDuration <= 0 || currentAccumulatedTime <= 0) {\r\n        return;\r\n      }\r\n      reportedWatchTimeRef.current = true;\r\n      if (watchIntervalRef.current) {\r\n        clearInterval(watchIntervalRef.current);\r\n        watchIntervalRef.current = null;\r\n      }\r\n      const payload = {\r\n        post_id: id, // id is stable from props\r\n        watch_time_ms: Math.round(currentAccumulatedTime),\r\n        video_duration_ms: Math.round(currentDuration * 1000),\r\n      };\r\n      console.log(`Reporting watch time for post ${id} (Cleanup):`, payload);\r\n      try {\r\n        const functionUrl = `${process.env.NEXT_PUBLIC_SUPABASE_URL}/functions/v1/record-watch-time`;\r\n        const response = await fetch(functionUrl, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload),\r\n          keepalive: true,\r\n        });\r\n        if (!response.ok) {\r\n          const errorData = await response.json();\r\n          throw new Error(errorData.error || `HTTP error! status: ${response.status}`);\r\n        }\r\n        console.log(`Successfully reported watch time for post ${id} (Cleanup)`);\r\n      } catch (error) {\r\n        console.error(`Failed to report watch time for post ${id} (Cleanup):`, error);\r\n        reportedWatchTimeRef.current = false; // Allow retry if failed\r\n      }\r\n    };\r\n\r\n    const observer = new IntersectionObserver(\r\n      ([entry]) => {\r\n        const currentlyVisible = entry.isIntersecting;\r\n        setIsVisible(currentlyVisible); // Update state for the interval effect\r\n\r\n        if (currentlyVisible) {\r\n          reportedWatchTimeRef.current = false; // Reset flag when visible again\r\n          videoElement.play().then(() => setIsPlaying(true)).catch(() => setIsPlaying(false));\r\n        } else {\r\n          if (!videoElement.paused) {\r\n            videoElement.pause();\r\n            setIsPlaying(false);\r\n          }\r\n          // Report immediately when scrolling out\r\n          reportWatchTimeOnCleanup();\r\n        }\r\n      },\r\n      { threshold: 0.5 }\r\n    );\r\n\r\n    observer.observe(videoElement);\r\n\r\n    // Cleanup: disconnect observer and report final time\r\n    return () => {\r\n      observer.disconnect();\r\n      reportWatchTimeOnCleanup(); // Report any remaining time on unmount/cleanup\r\n    };\r\n  // Minimal dependencies: only need to re-run if the video source or lock status fundamentally changes\r\n  }, [objectUrl, id]); // Removed state dependencies, rely on refs\r\n\r\n  // Watch Time Accumulation Interval Effect (depends on state)\r\n  useEffect(() => {\r\n    // Use state for interval logic, but refs for reporting logic\r\n    if (isPlaying && isVisible && !isContentLockedRef.current) {\r\n      if (!watchIntervalRef.current) {\r\n        watchIntervalRef.current = setInterval(() => {\r\n          setAccumulatedWatchTimeMs(prev => prev + 100);\r\n        }, 100);\r\n      }\r\n    } else {\r\n      if (watchIntervalRef.current) {\r\n        clearInterval(watchIntervalRef.current);\r\n        watchIntervalRef.current = null;\r\n      }\r\n    }\r\n    return () => {\r\n      if (watchIntervalRef.current) {\r\n        clearInterval(watchIntervalRef.current);\r\n        watchIntervalRef.current = null;\r\n      }\r\n    };\r\n  }, [isPlaying, isVisible]); // Removed isContentLocked dependency, rely on ref\r\n\r\n  // Purchase Handler\r\n  const handlePurchase = useCallback(async () => {\r\n    if (!loggedInUser) { toast.error(\"Please log in to purchase.\"); return; }\r\n    if (!id || !is_for_sale || !price || price <= 0) { toast.error(\"Item not purchasable.\"); return; }\r\n    setIsBuying(true);\r\n    try {\r\n      const response = await fetch('/api/stripe/create-item-checkout-session', {\r\n        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ postId: id }),\r\n      });\r\n      const sessionData = await response.json();\r\n      if (!response.ok) throw new Error(sessionData.error || 'Failed to create session');\r\n      if (!sessionData.sessionId) throw new Error('Session ID missing');\r\n      const stripe = await stripePromise;\r\n      if (!stripe) throw new Error('Stripe.js failed');\r\n      const { error } = await stripe.redirectToCheckout({ sessionId: sessionData.sessionId });\r\n      if (error) throw new Error(error.message);\r\n    } catch (error) {\r\n      toast.error(`Purchase failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    } finally {\r\n      setIsBuying(false);\r\n    }\r\n  }, [loggedInUser, id, is_for_sale, price]);\r\n\r\n  // Profile Click Handler\r\n  const handleProfileClick = () => {\r\n    router.push('/profile');\r\n  };\r\n\r\n   return (\r\n     // Conditionally apply 'group' class based on isForYouPage\r\n     <div\r\n       ref={containerRef}\r\n       className={`relative w-full h-full bg-black overflow-hidden ${!isForYouPage ? 'group' : ''} ${showOverlayOnEnd ? 'show-end-overlay' : ''}`}\r\n     >\r\n      {isContentLocked ? (\r\n         <div className=\"w-full h-full bg-black flex flex-col items-center justify-center text-white relative p-4\">\r\n           <div className=\"flex flex-col items-center justify-center text-center z-10\">\r\n             <Lock size={48} className=\"mb-3 opacity-80\" />\r\n             <span className=\"text-lg font-semibold mb-1\">\r\n               {isLockedForPurchase ? 'Purchase to View' : 'Subscribe to View'}\r\n             </span>\r\n             {isLockedForPurchase && price && (\r\n               <Badge variant=\"secondary\" className=\"text-sm font-bold cursor-default mb-4\">\r\n                 {formatPrice(price, currency ?? undefined)}\r\n               </Badge>\r\n             )}\r\n           </div>\r\n           {isLockedForPurchase && (\r\n             <Button\r\n               variant=\"default\" size=\"sm\"\r\n               className=\"mt-4 h-9 px-5 text-sm bg-pink-600 hover:bg-pink-700 text-white rounded-full absolute bottom-16 left-1/2 transform -translate-x-1/2 z-20\"\r\n               onClick={handlePurchase} disabled={isBuying || !loggedInUser}\r\n               aria-label={`Buy for ${formatPrice(price ?? 0, currency ?? undefined)}`}\r\n             >\r\n               {isBuying ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> : <ShoppingCart className=\"mr-2 h-4 w-4\" />}\r\n               {isBuying ? 'Processing...' : 'Buy'}\r\n             </Button>\r\n           )}\r\n         </div>\r\n       ) : (\r\n         <>\r\n           {isLoading && <div className=\"text-white absolute z-10 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2\"><Loader2 className=\"h-8 w-8 animate-spin\" /></div>}\r\n           {errorState && <div className=\"text-red-500 absolute z-10 p-4 text-center\">{errorState}</div>}\r\n           <video\r\n             ref={videoRef} key={objectUrl} src={objectUrl ?? undefined} poster={posterSrc}\r\n             className={`w-full h-full object-contain ${!objectUrl || isLoading || errorState ? 'invisible' : ''} border-0`}\r\n             playsInline loop muted={isMuted} onClick={togglePlayPause}\r\n             onPlay={() => { setIsPlaying(true); setShowOverlayOnEnd(false); }} onPause={() => setIsPlaying(false)} // Reset overlay state on play\r\n             onEnded={handleVideoEnd} // Call handler on video end\r\n             onLoadedMetadata={handleLoadedMetadata} onTimeUpdate={handleTimeUpdate}\r\n             onError={(e) => console.error(`Video Error (ID: ${id}):`, (e.target as HTMLVideoElement).error)}\r\n           />\r\n           {/* Show progress bar and time display when loaded AND showControls is true */}\r\n           {showControls && objectUrl && !isLoading && !errorState && duration > 0 && (\r\n             <>\r\n               {/* Progress bar - Conditionally adjust bottom position */}\r\n               <div\r\n                ref={progressBarContainerRef}\r\n                // Conditionally adjust height and bottom position for For You page\r\n                className={`absolute ${isForYouPage ? 'bottom-16 h-1.5' : 'bottom-0 h-3'} left-0 w-full bg-gray-500/30 z-50 transition-all duration-100 cursor-pointer ${!isForYouPage ? 'group/progress' : ''}`} // Changed bottom-8 to bottom-16 for FYP\r\n                onClick={handleSeek}\r\n                onMouseDown={handleMouseDown}\r\n                onMouseMove={handleMouseMove}\r\n                onMouseEnter={handleMouseEnter}\r\n                onMouseLeave={handleMouseLeave}\r\n               >\r\n                 <div className=\"absolute top-0 left-0 h-full w-full bg-gray-500/30\" />\r\n                 <div\r\n                   className=\"absolute top-0 left-0 h-full bg-white/80 transition-colors duration-200 group-hover/progress:bg-white\"\r\n                   style={{ width: `${progress}%` }}\r\n                 />\r\n                 <div\r\n                   className={`absolute top-1/2 w-3 h-3 bg-white rounded-full transform -translate-y-1/2 -translate-x-1/2 pointer-events-none transition-opacity duration-200 ${isHovering || isScrubbing ? 'opacity-100' : 'opacity-0'}`}\r\n                   style={{ left: `${progress}%` }}\r\n                 />\r\n                 {(isHovering || isScrubbing) && (\r\n                   <div\r\n                     className=\"absolute bottom-full mb-2 left-0 transform -translate-x-1/2 px-2 py-1 bg-black/70 text-white text-xs rounded whitespace-nowrap z-50 pointer-events-none\"\r\n                     style={{ left: `${(hoverTime / duration) * 100}%` }}\r\n                   >\r\n                     {formatTime(hoverTime)}\r\n                   </div>\r\n                 )}\r\n               </div>\r\n               {/* Time Display - Conditionally adjust position for FYP */}\r\n               <div className={`absolute ${isForYouPage ? 'bottom-12 right-4' : 'bottom-5 right-16'} text-white text-xs font-mono z-50 pointer-events-none select-none drop-shadow-md`}>\r\n                 {currentTimeFormatted} / {formatTime(duration)}\r\n               </div>\r\n             </>\r\n           )}\r\n           {/* Show Play button only when NOT playing AND NOT scrubbing */}\r\n           {!isPlaying && !isScrubbing && objectUrl && !isLoading && !errorState && (\r\n             <div className=\"absolute inset-0 flex items-center justify-center pointer-events-auto z-10\">\r\n               <button onClick={togglePlayPause} className=\"p-4 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors\" aria-label=\"Play\">\r\n                 <Play size={60} fill=\"currentColor\" />\r\n               </button>\r\n             </div>\r\n           )}\r\n           {objectUrl && !isLoading && !errorState && (\r\n             <button onClick={toggleMute} className=\"absolute bottom-4 right-4 p-2 bg-black/40 rounded-full text-white z-20 pointer-events-auto\" aria-label={isMuted ? 'Unmute' : 'Mute'}>\r\n               {isMuted ? <VolumeX size={18} /> : <Volume2 size={18} />}\r\n             </button>\r\n           )}\r\n           {/* Gradient overlay - Conditionally adjust bottom position and opacity */}\r\n           <div className={`absolute inset-x-0 ${isForYouPage ? 'bottom-20 pb-8 opacity-100' : 'bottom-0 pb-16 opacity-0 group-hover:opacity-100 [.show-end-overlay_&]:opacity-100'} z-30 pointer-events-none bg-gradient-to-t from-black/60 via-black/30 to-transparent pt-12 transition-opacity duration-300`}> {/* Changed bottom-10 to bottom-20, pb-12 to pb-8 for FYP */}\r\n             {/* Inner content */}\r\n             <div className=\"\">\r\n               <div className={`text-white pointer-events-auto p-4 pt-0 ${isForYouPage ? 'pb-2' : ''}`}>\r\n                  <div className={`flex items-center gap-1.5 group cursor-pointer ${isForYouPage ? 'py-1 px-2' : ''}`} onClick={(e) => {\r\n                      e.preventDefault(); e.stopPropagation(); router.push('/profile');\r\n                    }}\r\n                    aria-label={`View profile of ${username}`} role=\"button\" tabIndex={0}\r\n                    onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); router.push('/profile'); } }}\r\n                  >\r\n                    <Avatar className=\"h-7 w-7 border border-gray-600 group-hover:scale-110 transition-transform\">\r\n                      <AvatarImage src={profilePictureUrl ?? undefined} alt={username ?? 'User profile'} />\r\n                      <AvatarFallback>{username?.charAt(0).toUpperCase() ?? 'U'}</AvatarFallback>\r\n                    </Avatar>\r\n                    <span className=\"font-bold text-sm hover:underline\">@{username}</span>\r\n                   </div>\r\n                   {caption && <p className=\"text-xs text-white mt-1 max-w-full break-words line-clamp-2\">{caption}</p>}\r\n                   {is_for_sale && !isContentLocked && price && (\r\n                     <Badge variant=\"secondary\" className=\"mt-1 text-xs font-semibold cursor-default bg-green-600 hover:bg-green-700 text-white\">\r\n                       For Sale: {formatPrice(price, currency ?? undefined)}\r\n                     </Badge>\r\n                 )}\r\n                </div>\r\n             </div>\r\n           </div>\r\n           {/* Interaction Buttons - Conditionally adjust top position and opacity */}\r\n           <div className={`absolute ${isForYouPage ? 'top-[45%]' : 'top-1/2'} right-4 transform -translate-y-1/2 z-50 pointer-events-auto ${isForYouPage ? 'opacity-100' : 'opacity-0 group-hover:opacity-100 [.show-end-overlay_&]:opacity-100'} transition-opacity duration-300`}>\r\n             <PostInteractionButtons\r\n               postId={id} userId={userId} username={username}\r\n               profilePictureUrl={profilePictureUrl ?? undefined}\r\n               initialLikes={parseInt(likes, 10) || 0} initialIsLiked={initialIsLiked}\r\n               commentsCount={comments} sharesCount={shares}\r\n               initialIsPrivate={initialIsPrivate ?? false} postType=\"video\"\r\n               isOwner={isOwner ?? false} videoCaption={caption ?? undefined}\r\n               is_for_sale={is_for_sale} price={price} currency={currency}\r\n             />\r\n           </div>\r\n         </>\r\n       )}\r\n     </div>\r\n   );\r\n }\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2740, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ClientVideoPlayerWrapper.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from 'react'; // Import React\r\nimport { VerticalVideoPlayer } from './VerticalVideoPlayer';\r\n\r\n// Define the props type - should match VerticalVideoPlayerProps\r\ninterface ClientVideoPlayerWrapperProps {\r\n  id: string;\r\n  username: string;\r\n  verified?: boolean;\r\n  profilePictureUrl?: string; // Add profile picture URL prop\r\n  caption: string;\r\n  videoSrc: string;\r\n  posterSrc?: string;\r\n  likes: string;\r\n  comments: string;\r\n  shares: string;\r\n  isPrivate?: boolean | null;\r\n  isOwner?: boolean;\r\n  userId: string; // Post owner's ID\r\n  // Add sale-related props passed from VideoGrid\r\n  is_for_sale: boolean;\r\n  price?: number | null;\r\n  currency?: string | null;\r\n  stripe_price_id?: string | null;\r\n  isLocked?: boolean; // Locked by subscription or sale\r\n  isPaidContent?: boolean | null | undefined; // Allow null as well\r\n}\r\n\r\n// Wrap the component with React.memo to prevent unnecessary re-renders\r\n// if the props haven't changed.\r\nexport const ClientVideoPlayerWrapper = React.memo(function ClientVideoPlayerWrapper(props: ClientVideoPlayerWrapperProps) {\r\n  // Log that the wrapper is rendering (can be removed after debugging)\r\n  // console.log(`Rendering ClientVideoPlayerWrapper for ID: ${props.id}`);\r\n  // Pass all props down to VerticalVideoPlayer\r\n  return <VerticalVideoPlayer {...props} />;\r\n});\r\n\r\n// Optional: Add a display name for better debugging in React DevTools\r\nClientVideoPlayerWrapper.displayName = 'ClientVideoPlayerWrapper';\r\n"],"names":[],"mappings":";;;;AAEA,mRAA2B,eAAe;AAC1C;AAHA;;;;AA+BO,MAAM,yCAA2B,6JAAA,CAAA,UAAK,CAAC,IAAI,MAAC,SAAS,yBAAyB,KAAoC;IACvH,qEAAqE;IACrE,yEAAyE;IACzE,6CAA6C;IAC7C,qBAAO,6LAAC,4IAAA,CAAA,sBAAmB;QAAE,GAAG,KAAK;;;;;;AACvC;;AAEA,sEAAsE;AACtE,yBAAyB,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 2777, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ImageCard.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation'; // Import useRouter\r\nimport { PostInteractionButtons } from './PostInteractionButtons';\r\nimport { Lock, ShoppingCart, Loader2 } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { toast } from 'react-hot-toast';\r\nimport Image from 'next/image'; // Keep standard Image import\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { FaImage, FaLock } from 'react-icons/fa';\r\n\r\n// Define props for ImageCard\r\ninterface ImageCardProps {\r\n  id: string;\r\n  userId: string;\r\n  username: string;\r\n  profilePictureUrl?: string;\r\n  caption: string | null;\r\n  imageUrl: string;\r\n  likes: number;\r\n  comments: string;\r\n  shares: string;\r\n  isPrivate: boolean;\r\n  isOwner: boolean;\r\n  initialIsLiked: boolean;\r\n  is_for_sale: boolean;\r\n  price?: number | null;\r\n  currency?: string | null;\r\n  stripe_price_id?: string | null;\r\n  isLocked?: boolean;\r\n  isPaidContent?: boolean;\r\n}\r\n\r\n// Initialize Stripe outside component\r\nconst stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!);\r\n\r\n// Helper function to format price\r\nconst formatPrice = (priceInCents: number, currency: string = 'usd') => {\r\n  return new Intl.NumberFormat('en-US', {\r\n    style: 'currency',\r\n    currency: currency.toUpperCase(),\r\n  }).format(priceInCents / 100);\r\n};\r\n\r\nexport function ImageCard({\r\n  id,\r\n  userId,\r\n  username,\r\n  profilePictureUrl,\r\n  caption,\r\n  imageUrl,\r\n  likes,\r\n  comments,\r\n  shares,\r\n  isPrivate,\r\n  isOwner,\r\n  initialIsLiked,\r\n  is_for_sale,\r\n  price,\r\n  currency,\r\n  stripe_price_id,\r\n  isLocked,\r\n}: ImageCardProps) {\r\n  const router = useRouter(); // Get router instance\r\n  const [isBuying, setIsBuying] = useState(false);\r\n  const userInitial = username.charAt(0).toUpperCase();\r\n\r\n  // Handler for profile click\r\n  const handleProfileClick = () => {\r\n    router.push('/profile'); // Navigate to the main profile page\r\n  };\r\n\r\n  // Determine lock status\r\n  const isContentLocked = is_for_sale || isLocked;\r\n\r\n  // Handle Buy Now click\r\n  const handleBuyClick = async (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!is_for_sale) return;\r\n\r\n    setIsBuying(true);\r\n    let sessionId = '';\r\n    try {\r\n      const response = await fetch('/api/stripe/create-item-checkout-session', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ postId: id }),\r\n      });\r\n      const sessionData = await response.json();\r\n      sessionId = sessionData.sessionId;\r\n      if (!response.ok || !sessionId) throw new Error(sessionData.error || 'Failed to create session.');\r\n      const stripe = await stripePromise;\r\n      if (!stripe) throw new Error('Stripe.js failed.');\r\n      const { error: stripeError } = await stripe.redirectToCheckout({ sessionId });\r\n      if (stripeError) throw new Error(stripeError.message || 'Redirect failed.');\r\n    } catch (err) {\r\n      const errorMsg = err instanceof Error ? err.message : 'Unknown error.';\r\n      toast.error(`Purchase failed: ${errorMsg}`);\r\n      if (sessionId) console.error(\"Session ID:\", sessionId);\r\n    } finally {\r\n      setIsBuying(false);\r\n    }\r\n  };\r\n\r\n  // Component for the main media area (image + overlays)\r\n  function MediaArea() {\r\n    return (\r\n      <div className=\"relative w-full h-full bg-black flex items-center justify-center overflow-hidden\">\r\n        {/* Image Display or Blackout */}\r\n        {isContentLocked ? (\r\n          <div className=\"w-full h-full bg-black\" />\r\n        ) : (\r\n          <img\r\n            src={imageUrl}\r\n            alt={caption || 'User uploaded image'}\r\n            className=\"w-full h-full object-contain\"\r\n            loading=\"lazy\"\r\n          />\r\n        )}\r\n\r\n        {/* Centered Overlay for Purchasable Content */}\r\n        {is_for_sale && (\r\n           <div className=\"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none\">\r\n             <FaLock className=\"text-4xl mb-2 text-white\" />\r\n             <span className=\"text-sm font-semibold text-white\">Purchase to View</span>\r\n             {price && currency && (\r\n               <Badge variant=\"secondary\" className=\"mt-1.5 text-sm font-bold\">\r\n                 {formatPrice(price, currency)}\r\n               </Badge>\r\n             )}\r\n             {isBuying && <Loader2 className=\"absolute top-4 right-4 h-5 w-5 animate-spin text-white\" />}\r\n           </div>\r\n        )}\r\n        {/* Centered Overlay for Subscription Locked Content */}\r\n        {isLocked && !is_for_sale && (\r\n           <div className=\"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none bg-black/60\">\r\n             <FaLock className=\"text-4xl mb-2 text-white\" />\r\n             <span className=\"text-xs font-semibold text-white\">Subscribe to View</span>\r\n           </div>\r\n        )}\r\n        {/* Bottom Info Overlay (Caption Only) - Show only if NOT locked */}\r\n        {!isContentLocked && caption && (\r\n           <div className=\"absolute inset-x-0 bottom-0 z-10 p-4 pointer-events-none bg-gradient-to-t from-black/60 via-black/30 to-transparent\">\r\n             <p className=\"text-white text-sm truncate\">{caption}</p>\r\n           </div>\r\n         )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"relative w-full h-full bg-black flex items-center justify-center overflow-hidden group\">\r\n\r\n      {/* Content Area (Link or Div) */}\r\n      {isContentLocked ? (\r\n        <div className=\"block w-full h-full cursor-default\">\r\n          <MediaArea />\r\n        </div>\r\n      ) : (\r\n        <Link href={`/image/${id}`} className=\"block w-full h-full\">\r\n          <MediaArea />\r\n        </Link>\r\n       )}\r\n\r\n      {/* Interaction Buttons - Rendered directly inside the relative root div */}\r\n      <PostInteractionButtons\r\n        postId={id}\r\n        userId={userId}\r\n           username={username}\r\n           profilePictureUrl={profilePictureUrl}\r\n           initialLikes={likes}\r\n           initialIsLiked={initialIsLiked}\r\n           commentsCount={comments}\r\n           sharesCount={shares}\r\n           initialIsPrivate={isPrivate ?? false}\r\n           isOwner={isOwner}\r\n           postType={'image'} // Pass 'image' directly\r\n           is_for_sale={is_for_sale}\r\n           price={price}\r\n           currency={currency}\r\n           // onProfileClick prop removed\r\n         />\r\n      {/* Removed the wrapper div */}\r\n\r\n      {/* Separate Buy Button (Only if for sale) */}\r\n      {is_for_sale && (\r\n         <Button\r\n           variant=\"default\"\r\n           size=\"sm\"\r\n           className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-30 h-8 px-4 text-sm bg-pink-600 hover:bg-pink-700 text-white rounded-full\"\r\n           onClick={handleBuyClick}\r\n           disabled={isBuying}\r\n           aria-label={`Buy ${caption || 'image'}`}\r\n         >\r\n           {isBuying ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> : <ShoppingCart className=\"mr-2 h-4 w-4\" />}\r\n           {isBuying ? 'Processing...' : 'Buy'}\r\n         </Button>\r\n       )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3067, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/dialog.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\r\nimport { X } from \"lucide-react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Dialog = DialogPrimitive.Root\r\n\r\nconst DialogTrigger = DialogPrimitive.Trigger\r\n\r\nconst DialogPortal = DialogPrimitive.Portal\r\n\r\nconst DialogClose = DialogPrimitive.Close\r\n\r\nconst DialogOverlay = React.forwardRef<\r\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\r\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\r\n>(({ className, ...props }, ref) => (\r\n  <DialogPrimitive.Overlay\r\n    ref={ref}\r\n    className={cn(\r\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\r\n\r\nconst DialogContent = React.forwardRef<\r\n  React.ElementRef<typeof DialogPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\r\n>(({ className, children, ...props }, ref) => (\r\n  <DialogPortal>\r\n    <DialogOverlay />\r\n    <DialogPrimitive.Content\r\n      ref={ref}\r\n      className={cn(\r\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\r\n        className\r\n      )}\r\n      {...props}\r\n    >\r\n      {children}\r\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\r\n        <X className=\"h-4 w-4\" />\r\n        <span className=\"sr-only\">Close</span>\r\n      </DialogPrimitive.Close>\r\n    </DialogPrimitive.Content>\r\n  </DialogPortal>\r\n))\r\nDialogContent.displayName = DialogPrimitive.Content.displayName\r\n\r\nconst DialogHeader = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nDialogHeader.displayName = \"DialogHeader\"\r\n\r\nconst DialogFooter = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nDialogFooter.displayName = \"DialogFooter\"\r\n\r\nconst DialogTitle = React.forwardRef<\r\n  React.ElementRef<typeof DialogPrimitive.Title>,\r\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\r\n>(({ className, ...props }, ref) => (\r\n  <DialogPrimitive.Title\r\n    ref={ref}\r\n    className={cn(\r\n      \"text-lg font-semibold leading-none tracking-tight\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nDialogTitle.displayName = DialogPrimitive.Title.displayName\r\n\r\nconst DialogDescription = React.forwardRef<\r\n  React.ElementRef<typeof DialogPrimitive.Description>,\r\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\r\n>(({ className, ...props }, ref) => (\r\n  <DialogPrimitive.Description\r\n    ref={ref}\r\n    className={cn(\"text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n))\r\nDialogDescription.displayName = DialogPrimitive.Description.displayName\r\n\r\nexport {\r\n  Dialog,\r\n  DialogPortal,\r\n  DialogOverlay,\r\n  DialogTrigger,\r\n  DialogClose,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogFooter,\r\n  DialogTitle,\r\n  DialogDescription,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,MAAM,SAAS,qKAAA,CAAA,OAAoB;AAEnC,MAAM,gBAAgB,qKAAA,CAAA,UAAuB;AAE7C,MAAM,eAAe,qKAAA,CAAA,SAAsB;AAE3C,MAAM,cAAc,qKAAA,CAAA,QAAqB;AAEzC,MAAM,8BAAgB,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,EAGnC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,qKAAA,CAAA,UAAuB;QACtB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,2JACA;QAED,GAAG,KAAK;;;;;;KAVP;AAaN,cAAc,WAAW,GAAG,qKAAA,CAAA,UAAuB,CAAC,WAAW;AAE/D,MAAM,8BAAgB,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGnC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,6LAAC;;0BACC,6LAAC;;;;;0BACD,6LAAC,qKAAA,CAAA,UAAuB;gBACtB,KAAK;gBACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,+fACA;gBAED,GAAG,KAAK;;oBAER;kCACD,6LAAC,qKAAA,CAAA,QAAqB;wBAAC,WAAU;;0CAC/B,6LAAC,+LAAA,CAAA,IAAC;gCAAC,WAAU;;;;;;0CACb,6LAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;;;;;;;;;;;;;;AAKlC,cAAc,WAAW,GAAG,qKAAA,CAAA,UAAuB,CAAC,WAAW;AAE/D,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,sDACA;QAED,GAAG,KAAK;;;;;;MATP;AAYN,aAAa,WAAW,GAAG;AAE3B,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,iEACA;QAED,GAAG,KAAK;;;;;;MATP;AAYN,aAAa,WAAW,GAAG;AAE3B,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,qKAAA,CAAA,QAAqB;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,qDACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,qKAAA,CAAA,QAAqB,CAAC,WAAW;AAE3D,MAAM,kCAAoB,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGvC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,qKAAA,CAAA,cAA2B;QAC1B,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,kBAAkB,WAAW,GAAG,qKAAA,CAAA,cAA2B,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 3218, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/label.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst labelVariants = cva(\r\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\r\n)\r\n\r\nconst Label = React.forwardRef<\r\n  React.ElementRef<typeof LabelPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\r\n    VariantProps<typeof labelVariants>\r\n>(({ className, ...props }, ref) => (\r\n  <LabelPrimitive.Root\r\n    ref={ref}\r\n    className={cn(labelVariants(), className)}\r\n    {...props}\r\n  />\r\n))\r\nLabel.displayName = LabelPrimitive.Root.displayName\r\n\r\nexport { Label }\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,MAAM,gBAAgB,CAAA,GAAA,mKAAA,CAAA,MAAG,AAAD,EACtB;AAGF,MAAM,sBAAQ,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAI3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oKAAA,CAAA,OAAmB;QAClB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,iBAAiB;QAC9B,GAAG,KAAK;;;;;;;AAGb,MAAM,WAAW,GAAG,oKAAA,CAAA,OAAmB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 3257, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/switch.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Switch = React.forwardRef<\r\n  React.ElementRef<typeof SwitchPrimitives.Root>,\r\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\r\n>(({ className, ...props }, ref) => (\r\n  <SwitchPrimitives.Root\r\n    className={cn(\r\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\r\n      className\r\n    )}\r\n    {...props}\r\n    ref={ref}\r\n  >\r\n    <SwitchPrimitives.Thumb\r\n      className={cn(\r\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\r\n      )}\r\n    />\r\n  </SwitchPrimitives.Root>\r\n))\r\nSwitch.displayName = SwitchPrimitives.Root.displayName\r\n\r\nexport { Switch }\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,uBAAS,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAG5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,qKAAA,CAAA,OAAqB;QACpB,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,+XACA;QAED,GAAG,KAAK;QACT,KAAK;kBAEL,cAAA,6LAAC,qKAAA,CAAA,QAAsB;YACrB,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV;;;;;;;;;;;;AAKR,OAAO,WAAW,GAAG,qKAAA,CAAA,OAAqB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 3300, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/EditPostSaleModal.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect, useContext } from 'react'; // Added useContext\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport { useAuth } from '@/context/AuthContext'; // Import useAuth\r\n// Remove MCP hook import - no longer creating Stripe objects here\r\n// import { useMcpTool } from '@/hooks/useMcpTool';\r\nimport { Tables, TablesUpdate } from '@/lib/database.types';\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Dialog, DialogContent, DialogHeader, DialogTitle,\r\n  DialogDescription, DialogFooter, DialogClose\r\n} from \"@/components/ui/dialog\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { DollarSign, Loader2 } from 'lucide-react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { AnimatePresence, motion } from 'framer-motion';\r\n\r\n// Define the type for the post data passed to the modal\r\ntype PostData = Pick<Tables<'posts'>, 'id' | 'user_id' | 'caption' | 'is_for_sale' | 'price' | 'currency' | 'stripe_product_id' | 'stripe_price_id'>; // Added user_id\r\n\r\n// Define a type for the mutation function arguments, including the temporary price field\r\ntype UpdatePostMutationArgs = {\r\n  is_for_sale: boolean;\r\n  newPriceInCents?: number | null; // Temporary field for price logic\r\n  // Include other fields from TablesUpdate<'posts'> if they were editable here\r\n};\r\n\r\n\r\ninterface EditPostSaleModalProps {\r\n  isOpen: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  postData: PostData | null;\r\n  onSaveSuccess?: () => void;\r\n}\r\n\r\nconst MIN_SALE_PRICE = 0.50; // Minimum price in USD\r\n\r\nexport function EditPostSaleModal({ isOpen, onOpenChange, postData, onSaveSuccess }: EditPostSaleModalProps) {\r\n  const queryClient = useQueryClient();\r\n  const { user } = useAuth(); // Get user from AuthContext\r\n  const [isForSale, setIsForSale] = useState(false);\r\n  const [salePrice, setSalePrice] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  // Remove MCP hook usage\r\n  // const { callTool: callStripeTool, isLoading: isStripeLoading } = useMcpTool('github.com/stripe/agent-toolkit');\r\n  const isStripeLoading = false; // Remove placeholder loading state\r\n\r\n  // Effect to initialize form state when postData changes\r\n  useEffect(() => {\r\n    if (postData) {\r\n      setIsForSale(postData.is_for_sale ?? false);\r\n      setSalePrice(postData.price ? (postData.price / 100).toFixed(2) : '');\r\n      setError(null); // Clear errors when modal opens with new data\r\n    }\r\n  }, [postData]);\r\n\r\n  // --- Mutation Logic ---\r\n  const updatePostMutation = useMutation({\r\n    // Use the specific argument type here\r\n    mutationFn: async (args: UpdatePostMutationArgs) => {\r\n      if (!postData) throw new Error(\"No post data available for update.\");\r\n      setError(null);\r\n\r\n      // Prepare update payload for Supabase\r\n      const finalUpdateData: TablesUpdate<'posts'> = {\r\n        is_for_sale: args.is_for_sale,\r\n        price: args.is_for_sale ? args.newPriceInCents : null,\r\n        currency: args.is_for_sale ? 'usd' : null,\r\n        // Clear Stripe IDs if toggling off sale, otherwise keep existing (or null)\r\n        // Stripe objects will be created/managed by the backend route on purchase attempt\r\n        stripe_product_id: args.is_for_sale ? postData.stripe_product_id : null,\r\n        stripe_price_id: args.is_for_sale ? postData.stripe_price_id : null,\r\n      };\r\n\r\n      // Update Supabase posts table\r\n      const { error: updateError } = await supabase\r\n        .from('posts')\r\n        .update(finalUpdateData) // Pass the cleaned payload\r\n        .eq('id', postData.id);\r\n\r\n      if (updateError) throw updateError;\r\n    },\r\n    onSuccess: () => {\r\n      toast.success(\"Post sale status updated!\");\r\n      // Invalidate relevant queries\r\n      queryClient.invalidateQueries({ queryKey: ['posts'] }); // General posts query (if used elsewhere)\r\n      queryClient.invalidateQueries({ queryKey: ['posts', postData?.user_id] }); // Posts by this specific user\r\n      queryClient.invalidateQueries({ queryKey: ['homeFeedPosts', user?.id] }); // <<< Invalidate the Profile Home Feed query\r\n      if (onSaveSuccess) onSaveSuccess();\r\n      onOpenChange(false);\r\n    },\r\n    onError: (err: unknown) => {\r\n      const message = err instanceof Error ? err.message : String(err);\r\n      console.error(\"Failed to update post sale status:\", err);\r\n      setError(message || \"Failed to update post.\");\r\n      toast.error(`Update failed: ${message}`);\r\n    }\r\n  });\r\n  // --- End Mutation Logic ---\r\n\r\n  const handleSubmit = (event: React.FormEvent) => {\r\n    event.preventDefault();\r\n    if (!postData) return;\r\n\r\n    let priceInCents: number | null = null;\r\n    if (isForSale) {\r\n      if (!salePrice || isNaN(parseFloat(salePrice))) {\r\n        setError(\"Please enter a valid price.\");\r\n        return;\r\n      }\r\n      priceInCents = Math.round(parseFloat(salePrice) * 100);\r\n      if (priceInCents < MIN_SALE_PRICE * 100) {\r\n        setError(`Price must be at least $${MIN_SALE_PRICE.toFixed(2)}.`);\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Use the specific argument type for the mutation\r\n    const mutationArgs: UpdatePostMutationArgs = {\r\n      is_for_sale: isForSale,\r\n      newPriceInCents: isForSale ? priceInCents : null,\r\n    };\r\n\r\n    updatePostMutation.mutate(mutationArgs);\r\n  };\r\n\r\n  if (!postData) return null;\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle>Edit Post Sale Status</DialogTitle>\r\n          <DialogDescription>\r\n            Update whether this post is for sale and set its price.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"grid gap-6 py-4\">\r\n            {/* Is For Sale Switch */}\r\n            <div className=\"flex items-center justify-between space-x-2\">\r\n              <Label htmlFor=\"sale-switch-edit\" className=\"flex flex-col space-y-1\">\r\n                <span>Mark as For Sale</span>\r\n                <span className=\"font-normal leading-snug text-muted-foreground\">\r\n                  Enable this to set a price for direct purchase.\r\n                </span>\r\n              </Label>\r\n              <Switch\r\n                id=\"sale-switch-edit\" // Ensure unique ID if multiple modals exist\r\n                checked={isForSale}\r\n                onCheckedChange={setIsForSale}\r\n                disabled={updatePostMutation.isPending} // Remove isStripeLoading\r\n              />\r\n            </div>\r\n\r\n            {/* Price Input (Conditional) */}\r\n            <AnimatePresence>\r\n              {isForSale && (\r\n                <motion.div\r\n                  key=\"price-input-edit\"\r\n                  initial={{ opacity: 0, height: 0 }}\r\n                  animate={{ opacity: 1, height: 'auto' }}\r\n                  exit={{ opacity: 0, height: 0 }}\r\n                  transition={{ duration: 0.2 }}\r\n                  className=\"overflow-hidden space-y-2\"\r\n                >\r\n                  <Label htmlFor=\"sale-price-edit\">Price (USD)</Label>\r\n                  <div className=\"relative\">\r\n                     <DollarSign className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\r\n                     <Input\r\n                       id=\"sale-price-edit\"\r\n                       type=\"number\"\r\n                       value={salePrice}\r\n                       onChange={(e) => setSalePrice(e.target.value)}\r\n                       placeholder=\"e.g., 5.00\"\r\n                       className=\"pl-8\"\r\n                       step=\"0.01\"\r\n                       min={MIN_SALE_PRICE.toFixed(2)}\r\n                       disabled={updatePostMutation.isPending} // Remove isStripeLoading\r\n                       required={isForSale}\r\n                     />\r\n                  </div>\r\n                  <p className=\"text-xs text-muted-foreground\">Minimum price is ${MIN_SALE_PRICE.toFixed(2)}.</p>\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n\r\n            {/* Error Message */}\r\n            {error && (\r\n              <p className=\"text-sm text-red-600 text-center\">{error}</p>\r\n            )}\r\n          </div>\r\n          <DialogFooter>\r\n            <DialogClose asChild>\r\n              <Button type=\"button\" variant=\"outline\" disabled={updatePostMutation.isPending}>Cancel</Button>\r\n            </DialogClose>\r\n            <Button type=\"submit\" disabled={updatePostMutation.isPending}>\r\n              {updatePostMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n              Save Changes\r\n            </Button>\r\n          </DialogFooter>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3693, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/VideoGrid.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { ClientVideoPlayerWrapper } from \"./ClientVideoPlayerWrapper\";\r\nimport { ImageCard } from './ImageCard';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Trash2, Lock, Pencil } from 'lucide-react';\r\nimport {\r\n  Dialog, DialogContent, DialogHeader, DialogTitle,\r\n  DialogDescription, DialogFooter, DialogTrigger, DialogClose\r\n} from \"@/components/ui/dialog\";\r\nimport { EditPostSaleModal } from './EditPostSaleModal';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport { toast } from 'react-hot-toast'; // Import toast\r\n\r\n// Define types\r\ntype PostWithProfile = {\r\n  id: string;\r\n  user_id: string;\r\n  caption: string | null;\r\n  type: string;\r\n  video_url: string | null;\r\n  image_url: string | null;\r\n  thumbnail_url: string | null;\r\n  likes_count: number | null;\r\n  comments_count: number | null;\r\n  is_private: boolean | null;\r\n  is_for_sale: boolean;\r\n  price: number | null;\r\n  currency: string | null;\r\n  stripe_price_id: string | null;\r\n  stripe_product_id: string | null;\r\n  profiles: {\r\n    username: string | null;\r\n    profile_picture_url: string | null;\r\n  } | null;\r\n};\r\n\r\ntype RawPostData = {\r\n  id: string;\r\n  user_id: string;\r\n  caption: string | null;\r\n  type: string;\r\n  video_url: string | null;\r\n  image_url: string | null;\r\n  thumbnail_url: string | null;\r\n  likes_count: number | null;\r\n  comments_count: number | null;\r\n  is_private: boolean | null;\r\n  is_for_sale: boolean;\r\n  price: number | null;\r\n  currency: string | null;\r\n  stripe_price_id: string | null;\r\n  stripe_product_id: string | null;\r\n  profiles: {\r\n    username: string | null;\r\n    profile_picture_url: string | null;\r\n  } | null;\r\n};\r\n\r\ninterface VideoGridProps {\r\n  userId?: string; // For profile page\r\n  searchQuery?: string; // For search results\r\n  followedUserIds?: string[]; // For following feed\r\n  allowDeletion?: boolean;\r\n}\r\n\r\nexport function VideoGrid({ userId, searchQuery, followedUserIds, allowDeletion = false }: VideoGridProps) {\r\n  const router = useRouter();\r\n  const { user: loggedInUser } = useAuth();\r\n  const queryClient = useQueryClient();\r\n  const [posts, setPosts] = useState<PostWithProfile[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [deletingId, setDeletingId] = useState<string | null>(null);\r\n  const [isConfirmDeleteDialogOpen, setIsConfirmDeleteDialogOpen] = useState(false);\r\n  const [postIdToDelete, setPostIdToDelete] = useState<string | null>(null);\r\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\r\n  const [editingPost, setEditingPost] = useState<PostWithProfile | null>(null);\r\n\r\n  // Delete handler\r\n  const handleDelete = useCallback(async (postIdToDelete: string) => {\r\n    if (deletingId) return;\r\n    setDeletingId(postIdToDelete);\r\n    setError(null);\r\n    try {\r\n      const postToDelete = posts.find(p => p.id === postIdToDelete);\r\n      if (!postToDelete) throw new Error(\"Post not found.\");\r\n      const { error: dbError } = await supabase.from('posts').delete().eq('id', postIdToDelete);\r\n      if (dbError) throw dbError;\r\n      // Storage deletion logic...\r\n      setPosts(currentPosts => currentPosts.filter(p => p.id !== postIdToDelete));\r\n      queryClient.invalidateQueries({ queryKey: ['posts', userId] });\r\n    } catch (err: unknown) {\r\n      const message = err instanceof Error ? err.message : String(err);\r\n      setError(`Failed to delete post: ${message}`);\r\n    } finally {\r\n      setDeletingId(null);\r\n      setPostIdToDelete(null);\r\n      setIsConfirmDeleteDialogOpen(false);\r\n    }\r\n  }, [posts, deletingId, queryClient, userId]);\r\n\r\n  // Fetch posts effect\r\n  useEffect(() => {\r\n    const fetchPosts = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n      try {\r\n        let query = supabase\r\n          .from('posts')\r\n          .select(`\r\n            id, user_id, caption, type, video_url, image_url, thumbnail_url,\r\n            likes_count, comments_count, is_private, is_for_sale, price,\r\n            currency, stripe_price_id, stripe_product_id,\r\n            profiles (username, profile_picture_url)\r\n          `)\r\n          .order('created_at', { ascending: false });\r\n\r\n        if (userId) {\r\n          // Profile page: Fetch posts for a specific user\r\n          query = query.eq('user_id', userId);\r\n          // Optionally decide if owner should see their private/sale posts here\r\n          // if (!allowDeletion) { // If not owner's view, hide private/sale\r\n          //   query = query.eq('is_private', false).eq('is_for_sale', false);\r\n          // }\r\n        } else if (searchQuery?.trim()) {\r\n          // Search page: Fetch public posts matching query\r\n          query = query.ilike('caption', `%${searchQuery}%`).eq('is_private', false);\r\n        } else if (followedUserIds && followedUserIds.length > 0) {\r\n          // Following page: Fetch posts from followed users (including private/sale)\r\n          query = query.in('user_id', followedUserIds);\r\n        } else {\r\n          // Explore page (default): Fetch public, non-sale posts\r\n          query = query.eq('is_private', false).eq('is_for_sale', false);\r\n        }\r\n\r\n        const { data, error: fetchError } = await query; // Removed type assertion\r\n        if (fetchError) throw fetchError;\r\n\r\n        if (data?.length) {\r\n          const formattedPosts = data.map((post: RawPostData) => ({\r\n            ...post,\r\n            profiles: post.profiles,\r\n            likes_count: post.likes_count ?? 0,\r\n            comments_count: post.comments_count ?? 0,\r\n            is_private: post.is_private, // Keep as boolean | null\r\n            is_for_sale: post.is_for_sale ?? false,\r\n            price: post.price,\r\n            currency: post.currency,\r\n            stripe_price_id: post.stripe_price_id,\r\n            stripe_product_id: post.stripe_product_id,\r\n          }));\r\n          setPosts(formattedPosts);\r\n        } else setPosts([]);\r\n      } catch (err: unknown) {\r\n        const message = err instanceof Error ? err.message : String(err);\r\n        setError(message || \"Error fetching posts.\");\r\n        setPosts([]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchPosts();\r\n  }, [userId, searchQuery, followedUserIds]); // Add followedUserIds dependency\r\n\r\n  // Loading/Error/Empty states\r\n  if (loading) return <div className=\"text-center p-4\">Loading posts...</div>;\r\n  if (error) return <div className=\"text-center text-red-500 p-4\">{error}</div>;\r\n  if (posts.length === 0) return <div className=\"text-center text-muted-foreground p-4\">No posts found.</div>;\r\n\r\n  const openDeleteConfirmDialog = (postId: string) => {\r\n    setPostIdToDelete(postId);\r\n    setIsConfirmDeleteDialogOpen(true);\r\n  };\r\n  const confirmDelete = () => {\r\n    if (postIdToDelete) handleDelete(postIdToDelete);\r\n  };\r\n\r\n  // Function to open edit modal\r\n  const openEditModal = (post: PostWithProfile) => {\r\n    setEditingPost(post);\r\n    setIsEditModalOpen(true);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-4\">\r\n        {posts.map((post) => {\r\n          const isOwner = loggedInUser?.id === post.user_id;\r\n          const isSubscriptionLocked = post.is_private && !isOwner;\r\n          const canNavigate = !isSubscriptionLocked;\r\n\r\n          let PostContent;\r\n          if (post.type === 'video' && post.video_url) {\r\n            PostContent = (\r\n              <ClientVideoPlayerWrapper\r\n                id={post.id}\r\n                userId={post.user_id}\r\n                username={post.profiles?.username || 'Unknown User'}\r\n                profilePictureUrl={post.profiles?.profile_picture_url || undefined}\r\n                caption={post.caption || ''}\r\n                videoSrc={post.video_url}\r\n                likes={(post.likes_count ?? 0).toString()}\r\n                comments={(post.comments_count ?? 0).toString()}\r\n                shares={'0'}\r\n                isPrivate={post.is_private}\r\n                isOwner={isOwner}\r\n                is_for_sale={post.is_for_sale}\r\n                price={post.price}\r\n                currency={post.currency}\r\n                stripe_price_id={post.stripe_price_id}\r\n                isLocked={isSubscriptionLocked === null ? undefined : isSubscriptionLocked}\r\n                isPaidContent={post.is_private === null ? undefined : post.is_private} // Convert null to undefined\r\n              />\r\n            );\r\n          } else if (post.type === 'image' && post.image_url) {\r\n            PostContent = (\r\n              <ImageCard\r\n                id={post.id}\r\n                userId={post.user_id}\r\n                username={post.profiles?.username || 'Unknown User'}\r\n                profilePictureUrl={post.profiles?.profile_picture_url || undefined}\r\n                caption={post.caption}\r\n                imageUrl={post.image_url}\r\n                likes={post.likes_count ?? 0}\r\n                comments={(post.comments_count ?? 0).toString()}\r\n                shares={'0'}\r\n                isPrivate={post.is_private ?? false} // Revert to ?? false for ImageCard\r\n                isOwner={isOwner}\r\n                initialIsLiked={false}\r\n                is_for_sale={post.is_for_sale}\r\n                price={post.price}\r\n                currency={post.currency}\r\n                stripe_price_id={post.stripe_price_id}\r\n                isLocked={isSubscriptionLocked === null ? undefined : isSubscriptionLocked} // Convert null to undefined\r\n                isPaidContent={post.is_private === null ? undefined : post.is_private} // Convert null to undefined\r\n              />\r\n            );\r\n          } else {\r\n            PostContent = <div className=\"w-full h-full flex items-center justify-center bg-gray-800 text-white text-xs p-2\">Invalid post data</div>;\r\n          }\r\n\r\n          const handleNavigate = () => {\r\n            if (canNavigate) {\r\n              const detailUrl = post.type === 'video' ? `/video/${post.id}` : `/image/${post.id}`;\r\n              router.push(detailUrl);\r\n            } else {\r\n              toast('Subscription required to view this content.'); // Use imported toast\r\n            }\r\n          };\r\n\r\n          return (\r\n            <div\r\n              key={post.id}\r\n              className=\"aspect-[9/16] overflow-hidden rounded-lg relative group bg-black cursor-pointer\"\r\n              onClick={handleNavigate}\r\n            >\r\n              <>\r\n                {PostContent}\r\n                {!canNavigate && (\r\n                  <div className=\"absolute inset-0 bg-black/60 flex items-center justify-center z-10 pointer-events-none\">\r\n                    <Lock className=\"h-10 w-10 text-white/80\" />\r\n                  </div>\r\n                )}\r\n              </>\r\n\r\n              {/* Edit/Delete Buttons for Owner (Top Left) */}\r\n              {allowDeletion && isOwner && (\r\n                <div className=\"absolute top-2 left-2 z-40 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                   <Button\r\n                     variant=\"outline\"\r\n                     size=\"icon\"\r\n                     className=\"h-7 w-7 bg-black/50 hover:bg-black/70 border-white/30 text-white\"\r\n                     onClick={(e) => {\r\n                       e.stopPropagation();\r\n                       e.preventDefault();\r\n                       openEditModal(post);\r\n                     }}\r\n                     aria-label=\"Edit post\"\r\n                   >\r\n                     <Pencil className=\"h-4 w-4\" />\r\n                   </Button>\r\n                   <Button\r\n                     variant=\"destructive\"\r\n                     size=\"icon\"\r\n                     className=\"h-7 w-7 bg-black/50 hover:bg-red-700\"\r\n                     onClick={(e) => {\r\n                       e.stopPropagation();\r\n                       e.preventDefault();\r\n                       openDeleteConfirmDialog(post.id);\r\n                     }}\r\n                     disabled={deletingId === post.id}\r\n                     aria-label=\"Delete post\"\r\n                   >\r\n                     {deletingId === post.id ? (\r\n                       <div className=\"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white\"></div>\r\n                     ) : (\r\n                       <Trash2 className=\"h-4 w-4\" />\r\n                     )}\r\n                   </Button>\r\n                 </div>\r\n              )}\r\n\r\n              {deletingId === post.id && (\r\n                <div className=\"absolute inset-0 bg-black/60 flex items-center justify-center text-white z-50\">Deleting...</div>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Confirmation Dialog */}\r\n      <Dialog open={isConfirmDeleteDialogOpen} onOpenChange={setIsConfirmDeleteDialogOpen}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Confirm Deletion</DialogTitle>\r\n            <DialogDescription>Are you sure you want to permanently delete this post? This action cannot be undone.</DialogDescription>\r\n          </DialogHeader>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsConfirmDeleteDialogOpen(false)} disabled={!!deletingId}>Cancel</Button>\r\n            <Button variant=\"destructive\" onClick={confirmDelete} disabled={!!deletingId}>\r\n              {deletingId ? 'Deleting...' : 'Delete Post'}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Edit Post Modal */}\r\n      {editingPost && (\r\n        <EditPostSaleModal\r\n          isOpen={isEditModalOpen}\r\n          onOpenChange={setIsEditModalOpen}\r\n          postData={{\r\n             id: editingPost.id,\r\n             user_id: editingPost.user_id,\r\n             caption: editingPost.caption,\r\n             is_for_sale: editingPost.is_for_sale,\r\n             price: editingPost.price,\r\n             currency: editingPost.currency,\r\n             stripe_product_id: editingPost.stripe_product_id,\r\n             stripe_price_id: editingPost.stripe_price_id,\r\n          }}\r\n          onSaveSuccess={() => {\r\n            queryClient.invalidateQueries({ queryKey: ['posts', userId] });\r\n            queryClient.invalidateQueries({ queryKey: ['posts'] });\r\n            setEditingPost(null);\r\n          }}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4183, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/MainLayout.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, type ReactNode } from \"react\";\r\nimport { Sidebar } from \"@/components/Sidebar\";\r\nimport { Header } from \"@/components/Header\";\r\nimport { SearchPanel } from \"./SearchPanel\";\r\n// import { SearchResultsDisplay } from \"./SearchResultsDisplay\"; // Remove this import\r\nimport { VideoGrid } from \"./VideoGrid\"; // Import VideoGrid\r\n\r\ninterface MainLayoutProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport function MainLayout({ children }: MainLayoutProps) {\r\n  const [activeSearchQuery, setActiveSearchQuery] = useState('');\r\n  const [isSearchActive, setIsSearchActive] = useState(false);\r\n  const [isSearchPanelVisible, setIsSearchPanelVisible] = useState(false); // State for the panel\r\n\r\n  // Toggle search panel visibility\r\n  const toggleSearchPanel = () => {\r\n    setIsSearchPanelVisible(prev => !prev);\r\n    // Optionally deactivate search results when closing panel\r\n    if (isSearchPanelVisible) {\r\n       // setIsSearchActive(false); // Decide if closing panel should clear results\r\n    }\r\n  };\r\n\r\n  // Deactivate search mode (e.g., when clicking nav links)\r\n  const deactivateSearch = () => {\r\n    setIsSearchActive(false);\r\n    setIsSearchPanelVisible(false); // Also close panel\r\n    setActiveSearchQuery(''); // Clear query\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen bg-background\">\r\n      {/* Fixed sidebar - Pass correct handlers */}\r\n      <div className=\"fixed left-0 top-0 w-[240px] h-full z-30\">\r\n        <Sidebar\r\n          toggleSearchPanel={toggleSearchPanel}\r\n          deactivateSearch={deactivateSearch}\r\n        />\r\n      </div>\r\n\r\n      {/* Search Panel (conditionally rendered) */}\r\n      {isSearchPanelVisible && (\r\n         <SearchPanel\r\n            isVisible={isSearchPanelVisible} // Pass visibility state\r\n            setActiveSearchQuery={setActiveSearchQuery} // Pass setter for main content query\r\n            setIsSearchActive={setIsSearchActive} // Pass setter for search mode\r\n            closePanel={() => setIsSearchPanelVisible(false)} // Pass close handler\r\n         />\r\n      )}\r\n\r\n      {/* Main content area - Adjust margin based on search panel visibility */}\r\n      <div className={`w-full transition-all duration-200 ease-in-out ${isSearchPanelVisible ? 'ml-[540px]' : 'ml-[240px]'}`}> {/* Adjust margin: 240 + 300 = 540 */}\r\n        {/* Fixed header */}\r\n        <div className={`fixed top-0 right-0 transition-all duration-200 ease-in-out z-10 ${isSearchPanelVisible ? 'left-[540px]' : 'left-[240px]'}`}>\r\n          <Header />\r\n        </div>\r\n\r\n        {/* Conditional Content: Render Search Results or Page Content */}\r\n        <div className=\"w-full pt-14 h-[calc(100vh-theme(space.14))] overflow-y-auto\">\r\n          {isSearchActive && activeSearchQuery.trim() ? (\r\n            // Render VideoGrid with the search query when search is active\r\n            <VideoGrid searchQuery={activeSearchQuery} />\r\n          ) : (\r\n            // Render the normal page content (children)\r\n            children\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA,uFAAuF;AACvF,sOAAyC,mBAAmB;;;AAP5D;;;;;;AAaO,SAAS,WAAW,EAAE,QAAQ,EAAmB;;IACtD,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC3D,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACrD,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE,QAAQ,sBAAsB;IAE/F,iCAAiC;IACjC,MAAM,oBAAoB;QACxB,wBAAwB,CAAA,OAAQ,CAAC;QACjC,0DAA0D;QAC1D,IAAI,sBAAsB;QACvB,4EAA4E;QAC/E;IACF;IAEA,yDAAyD;IACzD,MAAM,mBAAmB;QACvB,kBAAkB;QAClB,wBAAwB,QAAQ,mBAAmB;QACnD,qBAAqB,KAAK,cAAc;IAC1C;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC,gIAAA,CAAA,UAAO;oBACN,mBAAmB;oBACnB,kBAAkB;;;;;;;;;;;YAKrB,sCACE,6LAAC,oIAAA,CAAA,cAAW;gBACT,WAAW;gBACX,sBAAsB;gBACtB,mBAAmB;gBACnB,YAAY,IAAM,wBAAwB;;;;;;0BAKhD,6LAAC;gBAAI,WAAW,CAAC,+CAA+C,EAAE,uBAAuB,eAAe,cAAc;;oBAAE;kCAEtH,6LAAC;wBAAI,WAAW,CAAC,iEAAiE,EAAE,uBAAuB,iBAAiB,gBAAgB;kCAC1I,cAAA,6LAAC,+HAAA,CAAA,SAAM;;;;;;;;;;kCAIT,6LAAC;wBAAI,WAAU;kCACZ,kBAAkB,kBAAkB,IAAI,KACvC,+DAA+D;sCAC/D,6LAAC,kIAAA,CAAA,YAAS;4BAAC,aAAa;;;;;mCAExB,4CAA4C;wBAC5C;;;;;;;;;;;;;;;;;;AAMZ;GA7DgB;KAAA","debugId":null}},
    {"offset": {"line": 4306, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/tabs.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Tabs = TabsPrimitive.Root\r\n\r\nconst TabsList = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.List\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsList.displayName = TabsPrimitive.List.displayName\r\n\r\nconst TabsTrigger = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\r\n\r\nconst TabsContent = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsContent.displayName = TabsPrimitive.Content.displayName\r\n\r\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,OAAO,mKAAA,CAAA,OAAkB;AAE/B,MAAM,yBAAW,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAG9B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,mKAAA,CAAA,OAAkB;QACjB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,6FACA;QAED,GAAG,KAAK;;;;;;;AAGb,SAAS,WAAW,GAAG,mKAAA,CAAA,OAAkB,CAAC,WAAW;AAErD,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,mKAAA,CAAA,UAAqB;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,kYACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,mKAAA,CAAA,UAAqB,CAAC,WAAW;AAE3D,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,mKAAA,CAAA,UAAqB;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,mIACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,mKAAA,CAAA,UAAqB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 4372, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/alert.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst alertVariants = cva(\r\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-background text-foreground\",\r\n        destructive:\r\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nconst Alert = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\r\n>(({ className, variant, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    role=\"alert\"\r\n    className={cn(alertVariants({ variant }), className)}\r\n    {...props}\r\n  />\r\n))\r\nAlert.displayName = \"Alert\"\r\n\r\nconst AlertTitle = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLHeadingElement>\r\n>(({ className, ...props }, ref) => (\r\n  <h5\r\n    ref={ref}\r\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertTitle.displayName = \"AlertTitle\"\r\n\r\nconst AlertDescription = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDescription.displayName = \"AlertDescription\"\r\n\r\nexport { Alert, AlertTitle, AlertDescription }\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,CAAA,GAAA,mKAAA,CAAA,MAAG,AAAD,EACtB,2KACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,MAAM,sBAAQ,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAG3B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAO,EAAE,oBACnC,6LAAC;QACC,KAAK;QACL,MAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;;AAGb,MAAM,WAAW,GAAG;AAEpB,MAAM,2BAAa,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,gDAAgD;QAC7D,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,iCAAmB,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,iBAAiB,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 4449, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/textarea.tsx"],"sourcesContent":["import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Textarea = React.forwardRef<\r\n  HTMLTextAreaElement,\r\n  React.ComponentProps<\"textarea\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <textarea\r\n      className={cn(\r\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\r\n        className\r\n      )}\r\n      ref={ref}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nTextarea.displayName = \"Textarea\"\r\n\r\nexport { Textarea }\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;;AAEA,MAAM,yBAAW,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAG9B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IAC1B,qBACE,6LAAC;QACC,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,6QACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AACA,SAAS,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 4484, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/slider.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Slider = React.forwardRef<\r\n  React.ElementRef<typeof SliderPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\r\n>(({ className, ...props }, ref) => (\r\n  <SliderPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex w-full touch-none select-none items-center\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\r\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\r\n    </SliderPrimitive.Track>\r\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\r\n  </SliderPrimitive.Root>\r\n))\r\nSlider.displayName = SliderPrimitive.Root.displayName\r\n\r\nexport { Slider }\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,uBAAS,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAG5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,qKAAA,CAAA,OAAoB;QACnB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,4DACA;QAED,GAAG,KAAK;;0BAET,6LAAC,qKAAA,CAAA,QAAqB;gBAAC,WAAU;0BAC/B,cAAA,6LAAC,qKAAA,CAAA,QAAqB;oBAAC,WAAU;;;;;;;;;;;0BAEnC,6LAAC,qKAAA,CAAA,QAAqB;gBAAC,WAAU;;;;;;;;;;;;;AAGrC,OAAO,WAAW,GAAG,qKAAA,CAAA,OAAoB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 4543, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Card = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\r\n      \"rounded-xl border bg-card text-card-foreground shadow\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nCard.displayName = \"Card\"\r\n\r\nconst CardHeader = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\r\n    {...props}\r\n  />\r\n))\r\nCardHeader.displayName = \"CardHeader\"\r\n\r\nconst CardTitle = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\r\n    {...props}\r\n  />\r\n))\r\nCardTitle.displayName = \"CardTitle\"\r\n\r\nconst CardDescription = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n))\r\nCardDescription.displayName = \"CardDescription\"\r\n\r\nconst CardContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\r\n))\r\nCardContent.displayName = \"CardContent\"\r\n\r\nconst CardFooter = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"flex items-center p-6 pt-0\", className)}\r\n    {...props}\r\n  />\r\n))\r\nCardFooter.displayName = \"CardFooter\"\r\n\r\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\r\n"],"names":[],"mappings":";;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,qBAAO,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAG1B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,yDACA;QAED,GAAG,KAAK;;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,6CAA6C;QAC1D,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGrC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAI,KAAK;QAAK,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,YAAY;QAAa,GAAG,KAAK;;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,SAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 4646, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/components/ProfileHomeFeed.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useRef } from 'react';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader } from '@/components/ui/card';\r\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\r\nimport { formatDistanceToNow, format } from 'date-fns';\r\nimport { ImageIcon, Send, Loader2, MoreHorizontal, AlignLeft, Type, Edit, CheckCircle, Smile, X } from 'lucide-react'; // Added Smile, X icons\r\nimport { Tables } from '@/lib/database.types';\r\nimport Image from 'next/image';\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { ClientVideoPlayerWrapper } from './ClientVideoPlayerWrapper';\r\nimport EmojiPicker, { EmojiClickData } from 'emoji-picker-react';\r\n\r\n// Define the structure of a post, including profile info\r\ntype PostWithProfile = Tables<'posts'> & {\r\n  profiles: Pick<Tables<'profiles'>, 'username' | 'name' | 'profile_picture_url'> | null;\r\n};\r\n\r\n// Define type for the profile data needed in this component\r\ntype UserProfileData = Pick<Tables<'profiles'>, 'id' | 'username' | 'name' | 'profile_picture_url'> | null;\r\n\r\n\r\nexport default function ProfileHomeFeed() {\r\n  const { user } = useAuth();\r\n  const queryClient = useQueryClient();\r\n  const [newPostContent, setNewPostContent] = useState('');\r\n  const [selectedImageFile, setSelectedImageFile] = useState<File | null>(null);\r\n  const [imagePreviewUrl, setImagePreviewUrl] = useState<string | null>(null);\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n\r\n  // Fetch the current user's profile data\r\n  const { data: userProfileData, isLoading: isLoadingProfile } = useQuery<UserProfileData>({\r\n    queryKey: ['userProfile', user?.id],\r\n    queryFn: async () => {\r\n      if (!user?.id) return null;\r\n      const { data, error } = await supabase\r\n        .from('profiles')\r\n        .select('id, username, name, profile_picture_url')\r\n        .eq('id', user.id)\r\n        .single();\r\n      if (error && error.code !== 'PGRST116') {\r\n        console.error(\"Error fetching user profile:\", error);\r\n        throw error;\r\n      }\r\n      return data;\r\n    },\r\n    enabled: !!user?.id,\r\n  });\r\n\r\n  // Fetch posts for the home feed\r\n  const { data: posts, isLoading: isLoadingPosts, error: postsError } = useQuery<PostWithProfile[]>({\r\n    queryKey: ['homeFeedPosts', user?.id],\r\n    queryFn: async () => {\r\n      if (!user?.id) return [];\r\n      const { data: followingData, error: followingError } = await supabase\r\n        .from('relationships')\r\n        .select('followed_uid')\r\n        .eq('follower_uid', user.id);\r\n      if (followingError) throw new Error(followingError.message);\r\n      const followedIds = followingData?.map(f => f.followed_uid) || [];\r\n      const userIdsToFetch = [user.id, ...followedIds];\r\n      const { data, error } = await supabase\r\n        .from('posts')\r\n        .select(`*, profiles ( username, name, profile_picture_url )`)\r\n        .in('user_id', userIdsToFetch)\r\n        .order('created_at', { ascending: false });\r\n      if (error) throw new Error(error.message);\r\n      return data as PostWithProfile[];\r\n    },\r\n    enabled: !!user?.id,\r\n  });\r\n\r\n  // Mutation for creating a new post (text or image)\r\n  const createPostMutation = useMutation({\r\n    mutationFn: async ({ content, imageFile }: { content: string; imageFile: File | null }) => {\r\n      if (!user?.id) throw new Error(\"User not authenticated\");\r\n      if (!content.trim() && !imageFile) throw new Error(\"Post content or image cannot be empty\");\r\n\r\n      let imageUrl: string | null = null;\r\n      let postType: 'text' | 'image' = 'text';\r\n      let filePath: string | null = null; // Declare filePath outside the if block\r\n\r\n      // --- Image Upload Logic ---\r\n      if (imageFile) {\r\n        postType = 'image';\r\n        const fileExt = imageFile.name.split('.').pop();\r\n        const fileName = `${user.id}/${Date.now()}.${fileExt}`;\r\n        filePath = `${fileName}`; // Assign value here\r\n\r\n        console.log(`Uploading image to bucket 'posts' at path: ${filePath}`);\r\n\r\n        const { error: uploadError } = await supabase.storage\r\n          .from('posts')\r\n          .upload(filePath, imageFile, {\r\n             cacheControl: '3600',\r\n             upsert: false,\r\n          });\r\n\r\n        if (uploadError) {\r\n          console.error(\"Supabase storage upload error:\", uploadError);\r\n          if (uploadError.message.includes('Bucket not found')) {\r\n             throw new Error(\"Storage bucket 'posts' not found. Please create it in Supabase.\");\r\n          } else if (uploadError.message.includes('policy')) {\r\n             throw new Error(\"Storage policy violation. Check bucket permissions.\");\r\n          }\r\n          throw new Error(`Storage upload failed: ${uploadError.message}`);\r\n        }\r\n\r\n        const { data: urlData } = supabase.storage.from('posts').getPublicUrl(filePath);\r\n        imageUrl = urlData?.publicUrl;\r\n\r\n        if (!imageUrl) {\r\n           console.error(\"Failed to get public URL for uploaded image.\");\r\n           throw new Error(\"Failed to get public URL for image\");\r\n        }\r\n        console.log(\"Image uploaded successfully. Public URL:\", imageUrl);\r\n      }\r\n      // --- End Image Upload Logic ---\r\n\r\n      // Insert post record into the database\r\n      try {\r\n        const { data, error: insertError } = await supabase\r\n          .from('posts')\r\n          .insert({\r\n            user_id: user.id,\r\n            caption: content.trim() || null,\r\n            type: postType,\r\n            image_url: imageUrl,\r\n            updated_at: new Date().toISOString(),\r\n          })\r\n          .select()\r\n          .single();\r\n\r\n        if (insertError) {\r\n          throw insertError; // Throw error to be caught below\r\n        }\r\n        console.log(\"Post record created successfully:\", data);\r\n        return data;\r\n      } catch (insertError: unknown) { // Catch the error here\r\n        const message = insertError instanceof Error ? insertError.message : String(insertError);\r\n        console.error(\"Error inserting post record:\", insertError);\r\n        // If insert fails after upload, attempt to delete the uploaded storage object\r\n        if (imageUrl && filePath) { // Check if filePath is not null\r\n           console.warn(\"Post insert failed after image upload. Attempting to delete uploaded image:\", filePath);\r\n           // Use await here for cleanup\r\n           await supabase.storage.from('posts').remove([filePath]);\r\n        }\r\n        // Re-throw the error after cleanup attempt\r\n        throw insertError;\r\n      }\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['homeFeedPosts', user?.id] });\r\n      setNewPostContent('');\r\n      setSelectedImageFile(null);\r\n      setImagePreviewUrl(null);\r\n      setShowEmojiPicker(false);\r\n      if (imageInputRef.current) {\r\n        imageInputRef.current.value = '';\r\n      }\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Failed to create post (Mutation onError):\", error);\r\n      // Display user-friendly error message here (e.g., using a toast library)\r\n      alert(`Failed to create post: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  });\r\n\r\n  const handleCreatePost = () => {\r\n    createPostMutation.mutate({ content: newPostContent, imageFile: selectedImageFile });\r\n  };\r\n\r\n  const handleImageClick = () => {\r\n    imageInputRef.current?.click();\r\n  };\r\n\r\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (file) {\r\n      setSelectedImageFile(file);\r\n      const previewUrl = URL.createObjectURL(file);\r\n      setImagePreviewUrl(previewUrl);\r\n    } else {\r\n      setSelectedImageFile(null);\r\n      setImagePreviewUrl(null);\r\n    }\r\n  };\r\n\r\n  const clearSelectedImage = () => {\r\n     setSelectedImageFile(null);\r\n     setImagePreviewUrl(null);\r\n     if (imageInputRef.current) {\r\n       imageInputRef.current.value = '';\r\n     }\r\n  };\r\n\r\n  const onEmojiClick = (emojiData: EmojiClickData) => {\r\n    setNewPostContent(prevInput => prevInput + emojiData.emoji);\r\n  };\r\n\r\n  const getDisplayTime = (dateString: string): string => {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const yesterday = new Date(now);\r\n    yesterday.setDate(now.getDate() - 1);\r\n\r\n    if (format(date, 'yyyy-MM-dd') === format(now, 'yyyy-MM-dd')) {\r\n      return formatDistanceToNow(date, { addSuffix: true });\r\n    } else if (format(date, 'yyyy-MM-dd') === format(yesterday, 'yyyy-MM-dd')) {\r\n      return 'Yesterday';\r\n    } else {\r\n      return format(date, 'MMM d');\r\n    }\r\n  };\r\n\r\n\r\n  return (\r\n    <div className=\"space-y-4 max-w-xl mx-auto\"> {/* Reduced max-width further and centering */}\r\n      {/* Compose Post Section */}\r\n      <Card className=\"mb-4 relative\">\r\n        <CardHeader className=\"border-b p-4\">\r\n          <div className=\"text-muted-foreground text-sm mb-3\">Compose new post...</div>\r\n          <div className=\"flex space-x-4\">\r\n             <input\r\n               type=\"file\"\r\n               ref={imageInputRef}\r\n               onChange={handleFileChange}\r\n               accept=\"image/png, image/jpeg, image/webp\"\r\n               className=\"hidden\"\r\n               aria-label=\"Upload image\"\r\n             />\r\n             <ImageIcon\r\n               size={20}\r\n               className=\"text-muted-foreground cursor-pointer hover:text-foreground\"\r\n               onClick={handleImageClick}\r\n               aria-label=\"Add image\"\r\n             />\r\n            <AlignLeft size={20} className=\"text-muted-foreground cursor-pointer hover:text-foreground\" aria-label=\"Format text\" />\r\n            <Type size={20} className=\"text-muted-foreground cursor-pointer hover:text-foreground\" aria-label=\"Text options\" />\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent className=\"p-4 pt-4\">\r\n           <div className=\"flex items-start space-x-3 mb-2\">\r\n             {isLoadingProfile ? (\r\n               <Avatar className=\"w-10 h-10 flex-shrink-0 bg-muted rounded-full\" />\r\n             ) : (\r\n               <Avatar className=\"w-10 h-10 flex-shrink-0\">\r\n                 <AvatarImage src={userProfileData?.profile_picture_url ?? undefined} alt={userProfileData?.username ?? 'User'} />\r\n                 <AvatarFallback>{userProfileData?.name?.charAt(0)?.toUpperCase() ?? userProfileData?.username?.charAt(0)?.toUpperCase() ?? 'U'}</AvatarFallback>\r\n               </Avatar>\r\n             )}\r\n             <Textarea\r\n               placeholder=\"Compose new post...\"\r\n               value={newPostContent}\r\n               onChange={(e) => setNewPostContent(e.target.value)}\r\n               className=\"flex-grow resize-none border rounded-md p-2 min-h-[60px]\"\r\n               rows={2}\r\n             />\r\n           </div>\r\n           {imagePreviewUrl && (\r\n             <div className=\"ml-13 mb-3 relative w-32 h-32\">\r\n               <Image\r\n                 src={imagePreviewUrl}\r\n                 alt=\"Selected image preview\"\r\n                 layout=\"fill\"\r\n                 objectFit=\"cover\"\r\n                 className=\"rounded-md border\"\r\n                 // Clean up object URL on unmount or when preview changes\r\n                 onLoad={() => { if (imagePreviewUrl?.startsWith('blob:')) URL.revokeObjectURL(imagePreviewUrl) }}\r\n               />\r\n               <Button\r\n                 variant=\"destructive\"\r\n                 size=\"icon\"\r\n                 className=\"absolute top-1 right-1 h-6 w-6 rounded-full\"\r\n                 onClick={clearSelectedImage}\r\n                 aria-label=\"Remove selected image\"\r\n               >\r\n                 <X size={14} />\r\n               </Button>\r\n             </div>\r\n           )}\r\n           <div className=\"flex justify-between items-center\">\r\n              <Button\r\n                 variant=\"ghost\"\r\n                 size=\"icon\"\r\n                 className=\"text-muted-foreground hover:text-foreground\"\r\n                 onClick={() => setShowEmojiPicker(!showEmojiPicker)}\r\n                 aria-label=\"Add emoji\"\r\n               >\r\n                 <Smile size={20} />\r\n              </Button>\r\n              <Button\r\n                onClick={handleCreatePost}\r\n                disabled={(!newPostContent.trim() && !selectedImageFile) || createPostMutation.isPending || isLoadingProfile}\r\n                size=\"sm\"\r\n              >\r\n                {createPostMutation.isPending ? (\r\n                  <>\r\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> Posting...\r\n                  </>\r\n                ) : (\r\n                  'Post'\r\n                )}\r\n              </Button>\r\n           </div>\r\n           {showEmojiPicker && (\r\n             <div className=\"absolute z-10 mt-2 right-0 sm:right-auto sm:left-12\">\r\n               <EmojiPicker\r\n                 onEmojiClick={onEmojiClick}\r\n                 autoFocusSearch={false}\r\n                 lazyLoadEmojis={true}\r\n                 height={350}\r\n               />\r\n             </div>\r\n           )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Filter tabs */}\r\n      <div className=\"flex p-3 space-x-2 border-b border-border bg-card rounded-t-lg\">\r\n        <Badge variant=\"default\" className=\"cursor-pointer\">All</Badge>\r\n        <Badge variant=\"secondary\" className=\"cursor-pointer flex items-center\">\r\n          <Edit size={14} className=\"mr-1\" />\r\n        </Badge>\r\n      </div>\r\n\r\n\r\n      {/* Posts Feed */}\r\n      {isLoadingPosts && (\r\n         <div className=\"flex justify-center items-center py-10\">\r\n           <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n           <span className=\"ml-2 text-muted-foreground\">Loading posts...</span>\r\n         </div>\r\n      )}\r\n      {postsError && (\r\n        <Card className=\"border-destructive bg-destructive/10\">\r\n          <CardContent className=\"p-4 text-destructive-foreground\">\r\n            Error loading posts: {(postsError as Error).message}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n      {!isLoadingPosts && !postsError && posts?.length === 0 && (\r\n        <Card>\r\n          <CardContent className=\"p-6 text-center text-muted-foreground\">\r\n            Your feed is empty. Follow some users or create a post!\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n      {posts?.map((post) => (\r\n        <Card key={post.id} className=\"rounded-none first:rounded-t-lg last:rounded-b-lg border-t-0 first:border-t\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex justify-between items-start mb-3\">\r\n              <div className=\"flex items-center\">\r\n                <Avatar className=\"w-12 h-12\">\r\n                  <AvatarImage src={post.profiles?.profile_picture_url ?? undefined} alt={post.profiles?.username ?? 'User'} />\r\n                  <AvatarFallback>{post.profiles?.name?.charAt(0)?.toUpperCase() ?? post.profiles?.username?.charAt(0)?.toUpperCase() ?? 'U'}</AvatarFallback>\r\n                </Avatar>\r\n                <div className=\"ml-3\">\r\n                  <div className=\"font-semibold flex items-center text-foreground\">\r\n                    {post.profiles?.name ?? post.profiles?.username ?? 'Unknown User'}\r\n                  </div>\r\n                  <div className=\"text-muted-foreground text-sm\">@{post.profiles?.username ?? 'username'}</div>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex items-center\">\r\n                <div className=\"text-muted-foreground text-sm mr-2\">{getDisplayTime(post.created_at)}</div>\r\n                <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground h-6 w-6\">\r\n                  <MoreHorizontal size={16} />\r\n                </Button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Post Content */}\r\n            {post.caption && (\r\n              <p className=\"text-foreground text-sm mb-2 whitespace-pre-wrap\">\r\n                {post.caption.split(/(\\s)/).map((word, index) =>\r\n                  word.startsWith('@') ? (\r\n                    <span key={index} className=\"text-primary cursor-pointer hover:underline\">{word}</span>\r\n                  ) : word.match(/^(https?:\\/\\/[^\\s]+)/) ? (\r\n                    <a key={index} href={word} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary cursor-pointer hover:underline\">{word}</a>\r\n                  ) : (\r\n                    word\r\n                  )\r\n                )}\r\n              </p>\r\n            )}\r\n\r\n            {/* Media */}\r\n            {post.type === 'image' && post.image_url && (\r\n              <div className=\"mt-3 relative rounded-lg overflow-hidden border max-w-full\">\r\n                {post.image_url !== '/api/placeholder/400/300' ? (\r\n                   <Image src={post.image_url} alt=\"Post image\" width={600} height={600} className=\"object-contain w-full h-auto\" />\r\n                ) : (\r\n                   <div className=\"w-full h-64 bg-muted flex items-center justify-center text-muted-foreground\">Image Loading...</div>\r\n                )}\r\n              </div>\r\n             )}\r\n             {post.type === 'video' && post.video_url && (\r\n                <div className=\"mt-3 rounded-lg overflow-hidden border aspect-video bg-black\">\r\n                  <ClientVideoPlayerWrapper\r\n                    id={post.id}\r\n                    username={post.profiles?.username ?? 'user'}\r\n                    profilePictureUrl={post.profiles?.profile_picture_url ?? undefined}\r\n                    caption={post.caption ?? ''}\r\n                    videoSrc={post.video_url}\r\n                    posterSrc={post.thumbnail_url ?? undefined}\r\n                    likes={(post.likes_count ?? 0).toString()}\r\n                    comments={(post.comments_count ?? 0).toString()}\r\n                    shares={\"0\"}\r\n                    isPrivate={post.is_private}\r\n                    isOwner={post.user_id === user?.id}\r\n                    userId={post.user_id}\r\n                    is_for_sale={post.is_for_sale}\r\n                    price={post.price}\r\n                    currency={post.currency}\r\n                    stripe_price_id={post.stripe_price_id}\r\n                    isLocked={false}\r\n                    isPaidContent={post.is_for_sale || post.is_private}\r\n                  />\r\n                </div>\r\n             )}\r\n           </CardContent>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA,kWAAuH,uBAAuB;AAA9I;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;;;AAhBA;;;;;;;;;;;;;;;AA2Be,SAAS;;IACtB,MAAM,EAAE,IAAI,EAAE,GAAG,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD;IACvB,MAAM,cAAc,CAAA,GAAA,yLAAA,CAAA,iBAAc,AAAD;IACjC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACrD,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAe;IACxE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB;IACtE,MAAM,gBAAgB,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAoB;IAC/C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAEvD,wCAAwC;IACxC,MAAM,EAAE,MAAM,eAAe,EAAE,WAAW,gBAAgB,EAAE,GAAG,CAAA,GAAA,8KAAA,CAAA,WAAQ,AAAD,EAAmB;QACvF,UAAU;YAAC;YAAe,MAAM;SAAG;QACnC,OAAO;wCAAE;gBACP,IAAI,CAAC,MAAM,IAAI,OAAO;gBACtB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,+HAAA,CAAA,WAAQ,CACnC,IAAI,CAAC,YACL,MAAM,CAAC,2CACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;gBACT,IAAI,SAAS,MAAM,IAAI,KAAK,YAAY;oBACtC,QAAQ,KAAK,CAAC,gCAAgC;oBAC9C,MAAM;gBACR;gBACA,OAAO;YACT;;QACA,SAAS,CAAC,CAAC,MAAM;IACnB;IAEA,gCAAgC;IAChC,MAAM,EAAE,MAAM,KAAK,EAAE,WAAW,cAAc,EAAE,OAAO,UAAU,EAAE,GAAG,CAAA,GAAA,8KAAA,CAAA,WAAQ,AAAD,EAAqB;QAChG,UAAU;YAAC;YAAiB,MAAM;SAAG;QACrC,OAAO;wCAAE;gBACP,IAAI,CAAC,MAAM,IAAI,OAAO,EAAE;gBACxB,MAAM,EAAE,MAAM,aAAa,EAAE,OAAO,cAAc,EAAE,GAAG,MAAM,+HAAA,CAAA,WAAQ,CAClE,IAAI,CAAC,iBACL,MAAM,CAAC,gBACP,EAAE,CAAC,gBAAgB,KAAK,EAAE;gBAC7B,IAAI,gBAAgB,MAAM,IAAI,MAAM,eAAe,OAAO;gBAC1D,MAAM,cAAc,eAAe;gDAAI,CAAA,IAAK,EAAE,YAAY;kDAAK,EAAE;gBACjE,MAAM,iBAAiB;oBAAC,KAAK,EAAE;uBAAK;iBAAY;gBAChD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,+HAAA,CAAA,WAAQ,CACnC,IAAI,CAAC,SACL,MAAM,CAAC,CAAC,mDAAmD,CAAC,EAC5D,EAAE,CAAC,WAAW,gBACd,KAAK,CAAC,cAAc;oBAAE,WAAW;gBAAM;gBAC1C,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;gBACxC,OAAO;YACT;;QACA,SAAS,CAAC,CAAC,MAAM;IACnB;IAEA,mDAAmD;IACnD,MAAM,qBAAqB,CAAA,GAAA,iLAAA,CAAA,cAAW,AAAD,EAAE;QACrC,UAAU;+DAAE,OAAO,EAAE,OAAO,EAAE,SAAS,EAA+C;gBACpF,IAAI,CAAC,MAAM,IAAI,MAAM,IAAI,MAAM;gBAC/B,IAAI,CAAC,QAAQ,IAAI,MAAM,CAAC,WAAW,MAAM,IAAI,MAAM;gBAEnD,IAAI,WAA0B;gBAC9B,IAAI,WAA6B;gBACjC,IAAI,WAA0B,MAAM,wCAAwC;gBAE5E,6BAA6B;gBAC7B,IAAI,WAAW;oBACb,WAAW;oBACX,MAAM,UAAU,UAAU,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;oBAC7C,MAAM,WAAW,GAAG,KAAK,EAAE,CAAC,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,SAAS;oBACtD,WAAW,GAAG,UAAU,EAAE,oBAAoB;oBAE9C,QAAQ,GAAG,CAAC,CAAC,2CAA2C,EAAE,UAAU;oBAEpE,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,+HAAA,CAAA,WAAQ,CAAC,OAAO,CAClD,IAAI,CAAC,SACL,MAAM,CAAC,UAAU,WAAW;wBAC1B,cAAc;wBACd,QAAQ;oBACX;oBAEF,IAAI,aAAa;wBACf,QAAQ,KAAK,CAAC,kCAAkC;wBAChD,IAAI,YAAY,OAAO,CAAC,QAAQ,CAAC,qBAAqB;4BACnD,MAAM,IAAI,MAAM;wBACnB,OAAO,IAAI,YAAY,OAAO,CAAC,QAAQ,CAAC,WAAW;4BAChD,MAAM,IAAI,MAAM;wBACnB;wBACA,MAAM,IAAI,MAAM,CAAC,uBAAuB,EAAE,YAAY,OAAO,EAAE;oBACjE;oBAEA,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,+HAAA,CAAA,WAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,YAAY,CAAC;oBACtE,WAAW,SAAS;oBAEpB,IAAI,CAAC,UAAU;wBACZ,QAAQ,KAAK,CAAC;wBACd,MAAM,IAAI,MAAM;oBACnB;oBACA,QAAQ,GAAG,CAAC,4CAA4C;gBAC1D;gBACA,iCAAiC;gBAEjC,uCAAuC;gBACvC,IAAI;oBACF,MAAM,EAAE,IAAI,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,+HAAA,CAAA,WAAQ,CAChD,IAAI,CAAC,SACL,MAAM,CAAC;wBACN,SAAS,KAAK,EAAE;wBAChB,SAAS,QAAQ,IAAI,MAAM;wBAC3B,MAAM;wBACN,WAAW;wBACX,YAAY,IAAI,OAAO,WAAW;oBACpC,GACC,MAAM,GACN,MAAM;oBAET,IAAI,aAAa;wBACf,MAAM,aAAa,iCAAiC;oBACtD;oBACA,QAAQ,GAAG,CAAC,qCAAqC;oBACjD,OAAO;gBACT,EAAE,OAAO,aAAsB;oBAC7B,MAAM,UAAU,uBAAuB,QAAQ,YAAY,OAAO,GAAG,OAAO;oBAC5E,QAAQ,KAAK,CAAC,gCAAgC;oBAC9C,8EAA8E;oBAC9E,IAAI,YAAY,UAAU;wBACvB,QAAQ,IAAI,CAAC,+EAA+E;wBAC5F,6BAA6B;wBAC7B,MAAM,+HAAA,CAAA,WAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,MAAM,CAAC;4BAAC;yBAAS;oBACzD;oBACA,2CAA2C;oBAC3C,MAAM;gBACR;YACF;;QACA,SAAS;+DAAE;gBACT,YAAY,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;wBAAiB,MAAM;qBAAG;gBAAC;gBACtE,kBAAkB;gBAClB,qBAAqB;gBACrB,mBAAmB;gBACnB,mBAAmB;gBACnB,IAAI,cAAc,OAAO,EAAE;oBACzB,cAAc,OAAO,CAAC,KAAK,GAAG;gBAChC;YACF;;QACA,OAAO;+DAAE,CAAC;gBACR,QAAQ,KAAK,CAAC,6CAA6C;gBAC3D,yEAAyE;gBACzE,MAAM,CAAC,uBAAuB,EAAE,iBAAiB,QAAQ,MAAM,OAAO,GAAG,iBAAiB;YAC5F;;IACF;IAEA,MAAM,mBAAmB;QACvB,mBAAmB,MAAM,CAAC;YAAE,SAAS;YAAgB,WAAW;QAAkB;IACpF;IAEA,MAAM,mBAAmB;QACvB,cAAc,OAAO,EAAE;IACzB;IAEA,MAAM,mBAAmB,CAAC;QACxB,MAAM,OAAO,MAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;QACpC,IAAI,MAAM;YACR,qBAAqB;YACrB,MAAM,aAAa,IAAI,eAAe,CAAC;YACvC,mBAAmB;QACrB,OAAO;YACL,qBAAqB;YACrB,mBAAmB;QACrB;IACF;IAEA,MAAM,qBAAqB;QACxB,qBAAqB;QACrB,mBAAmB;QACnB,IAAI,cAAc,OAAO,EAAE;YACzB,cAAc,OAAO,CAAC,KAAK,GAAG;QAChC;IACH;IAEA,MAAM,eAAe,CAAC;QACpB,kBAAkB,CAAA,YAAa,YAAY,UAAU,KAAK;IAC5D;IAEA,MAAM,iBAAiB,CAAC;QACtB,MAAM,OAAO,IAAI,KAAK;QACtB,MAAM,MAAM,IAAI;QAChB,MAAM,YAAY,IAAI,KAAK;QAC3B,UAAU,OAAO,CAAC,IAAI,OAAO,KAAK;QAElC,IAAI,CAAA,GAAA,wJAAA,CAAA,SAAM,AAAD,EAAE,MAAM,kBAAkB,CAAA,GAAA,wJAAA,CAAA,SAAM,AAAD,EAAE,KAAK,eAAe;YAC5D,OAAO,CAAA,GAAA,qJAAA,CAAA,sBAAmB,AAAD,EAAE,MAAM;gBAAE,WAAW;YAAK;QACrD,OAAO,IAAI,CAAA,GAAA,wJAAA,CAAA,SAAM,AAAD,EAAE,MAAM,kBAAkB,CAAA,GAAA,wJAAA,CAAA,SAAM,AAAD,EAAE,WAAW,eAAe;YACzE,OAAO;QACT,OAAO;YACL,OAAO,CAAA,GAAA,wJAAA,CAAA,SAAM,AAAD,EAAE,MAAM;QACtB;IACF;IAGA,qBACE,6LAAC;QAAI,WAAU;;YAA6B;0BAE1C,6LAAC,mIAAA,CAAA,OAAI;gBAAC,WAAU;;kCACd,6LAAC,mIAAA,CAAA,aAAU;wBAAC,WAAU;;0CACpB,6LAAC;gCAAI,WAAU;0CAAqC;;;;;;0CACpD,6LAAC;gCAAI,WAAU;;kDACZ,6LAAC;wCACC,MAAK;wCACL,KAAK;wCACL,UAAU;wCACV,QAAO;wCACP,WAAU;wCACV,cAAW;;;;;;kDAEb,6LAAC,2MAAA,CAAA,YAAS;wCACR,MAAM;wCACN,WAAU;wCACV,SAAS;wCACT,cAAW;;;;;;kDAEd,6LAAC,mNAAA,CAAA,YAAS;wCAAC,MAAM;wCAAI,WAAU;wCAA6D,cAAW;;;;;;kDACvG,6LAAC,qMAAA,CAAA,OAAI;wCAAC,MAAM;wCAAI,WAAU;wCAA6D,cAAW;;;;;;;;;;;;;;;;;;kCAGtG,6LAAC,mIAAA,CAAA,cAAW;wBAAC,WAAU;;0CACpB,6LAAC;gCAAI,WAAU;;oCACZ,iCACC,6LAAC,qIAAA,CAAA,SAAM;wCAAC,WAAU;;;;;6DAElB,6LAAC,qIAAA,CAAA,SAAM;wCAAC,WAAU;;0DAChB,6LAAC,qIAAA,CAAA,cAAW;gDAAC,KAAK,iBAAiB,uBAAuB;gDAAW,KAAK,iBAAiB,YAAY;;;;;;0DACvG,6LAAC,qIAAA,CAAA,iBAAc;0DAAE,iBAAiB,MAAM,OAAO,IAAI,iBAAiB,iBAAiB,UAAU,OAAO,IAAI,iBAAiB;;;;;;;;;;;;kDAG/H,6LAAC,uIAAA,CAAA,WAAQ;wCACP,aAAY;wCACZ,OAAO;wCACP,UAAU,CAAC,IAAM,kBAAkB,EAAE,MAAM,CAAC,KAAK;wCACjD,WAAU;wCACV,MAAM;;;;;;;;;;;;4BAGT,iCACC,6LAAC;gCAAI,WAAU;;kDACb,6LAAC,gIAAA,CAAA,UAAK;wCACJ,KAAK;wCACL,KAAI;wCACJ,QAAO;wCACP,WAAU;wCACV,WAAU;wCACV,yDAAyD;wCACzD,QAAQ;4CAAQ,IAAI,iBAAiB,WAAW,UAAU,IAAI,eAAe,CAAC;wCAAiB;;;;;;kDAEjG,6LAAC,qIAAA,CAAA,SAAM;wCACL,SAAQ;wCACR,MAAK;wCACL,WAAU;wCACV,SAAS;wCACT,cAAW;kDAEX,cAAA,6LAAC,+LAAA,CAAA,IAAC;4CAAC,MAAM;;;;;;;;;;;;;;;;;0CAIf,6LAAC;gCAAI,WAAU;;kDACZ,6LAAC,qIAAA,CAAA,SAAM;wCACJ,SAAQ;wCACR,MAAK;wCACL,WAAU;wCACV,SAAS,IAAM,mBAAmB,CAAC;wCACnC,cAAW;kDAEX,cAAA,6LAAC,uMAAA,CAAA,QAAK;4CAAC,MAAM;;;;;;;;;;;kDAEhB,6LAAC,qIAAA,CAAA,SAAM;wCACL,SAAS;wCACT,UAAU,AAAC,CAAC,eAAe,IAAI,MAAM,CAAC,qBAAsB,mBAAmB,SAAS,IAAI;wCAC5F,MAAK;kDAEJ,mBAAmB,SAAS,iBAC3B;;8DACE,6LAAC,oNAAA,CAAA,UAAO;oDAAC,WAAU;;;;;;gDAA8B;;2DAGnD;;;;;;;;;;;;4BAIN,iCACC,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC,sLAAA,CAAA,UAAW;oCACV,cAAc;oCACd,iBAAiB;oCACjB,gBAAgB;oCAChB,QAAQ;;;;;;;;;;;;;;;;;;;;;;;0BAQnB,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,oIAAA,CAAA,QAAK;wBAAC,SAAQ;wBAAU,WAAU;kCAAiB;;;;;;kCACpD,6LAAC,oIAAA,CAAA,QAAK;wBAAC,SAAQ;wBAAY,WAAU;kCACnC,cAAA,6LAAC,8MAAA,CAAA,OAAI;4BAAC,MAAM;4BAAI,WAAU;;;;;;;;;;;;;;;;;YAM7B,gCACE,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,oNAAA,CAAA,UAAO;wBAAC,WAAU;;;;;;kCACnB,6LAAC;wBAAK,WAAU;kCAA6B;;;;;;;;;;;;YAGjD,4BACC,6LAAC,mIAAA,CAAA,OAAI;gBAAC,WAAU;0BACd,cAAA,6LAAC,mIAAA,CAAA,cAAW;oBAAC,WAAU;;wBAAkC;wBAChC,WAAqB,OAAO;;;;;;;;;;;;YAIxD,CAAC,kBAAkB,CAAC,cAAc,OAAO,WAAW,mBACnD,6LAAC,mIAAA,CAAA,OAAI;0BACH,cAAA,6LAAC,mIAAA,CAAA,cAAW;oBAAC,WAAU;8BAAwC;;;;;;;;;;;YAKlE,OAAO,IAAI,CAAC,qBACX,6LAAC,mIAAA,CAAA,OAAI;oBAAe,WAAU;8BAC5B,cAAA,6LAAC,mIAAA,CAAA,cAAW;wBAAC,WAAU;;0CACrB,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAI,WAAU;;0DACb,6LAAC,qIAAA,CAAA,SAAM;gDAAC,WAAU;;kEAChB,6LAAC,qIAAA,CAAA,cAAW;wDAAC,KAAK,KAAK,QAAQ,EAAE,uBAAuB;wDAAW,KAAK,KAAK,QAAQ,EAAE,YAAY;;;;;;kEACnG,6LAAC,qIAAA,CAAA,iBAAc;kEAAE,KAAK,QAAQ,EAAE,MAAM,OAAO,IAAI,iBAAiB,KAAK,QAAQ,EAAE,UAAU,OAAO,IAAI,iBAAiB;;;;;;;;;;;;0DAEzH,6LAAC;gDAAI,WAAU;;kEACb,6LAAC;wDAAI,WAAU;kEACZ,KAAK,QAAQ,EAAE,QAAQ,KAAK,QAAQ,EAAE,YAAY;;;;;;kEAErD,6LAAC;wDAAI,WAAU;;4DAAgC;4DAAE,KAAK,QAAQ,EAAE,YAAY;;;;;;;;;;;;;;;;;;;kDAGhF,6LAAC;wCAAI,WAAU;;0DACb,6LAAC;gDAAI,WAAU;0DAAsC,eAAe,KAAK,UAAU;;;;;;0DACnF,6LAAC,qIAAA,CAAA,SAAM;gDAAC,SAAQ;gDAAQ,MAAK;gDAAO,WAAU;0DAC5C,cAAA,6LAAC,mNAAA,CAAA,iBAAc;oDAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;4BAM3B,KAAK,OAAO,kBACX,6LAAC;gCAAE,WAAU;0CACV,KAAK,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,CAAC,CAAC,MAAM,QACrC,KAAK,UAAU,CAAC,qBACd,6LAAC;wCAAiB,WAAU;kDAA+C;uCAAhE;;;;+CACT,KAAK,KAAK,CAAC,wCACb,6LAAC;wCAAc,MAAM;wCAAM,QAAO;wCAAS,KAAI;wCAAsB,WAAU;kDAA+C;uCAAtH;;;;+CAER;;;;;;4BAOP,KAAK,IAAI,KAAK,WAAW,KAAK,SAAS,kBACtC,6LAAC;gCAAI,WAAU;0CACZ,KAAK,SAAS,KAAK,2CACjB,6LAAC,gIAAA,CAAA,UAAK;oCAAC,KAAK,KAAK,SAAS;oCAAE,KAAI;oCAAa,OAAO;oCAAK,QAAQ;oCAAK,WAAU;;;;;yDAEhF,6LAAC;oCAAI,WAAU;8CAA8E;;;;;;;;;;;4BAIlG,KAAK,IAAI,KAAK,WAAW,KAAK,SAAS,kBACrC,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC,iJAAA,CAAA,2BAAwB;oCACvB,IAAI,KAAK,EAAE;oCACX,UAAU,KAAK,QAAQ,EAAE,YAAY;oCACrC,mBAAmB,KAAK,QAAQ,EAAE,uBAAuB;oCACzD,SAAS,KAAK,OAAO,IAAI;oCACzB,UAAU,KAAK,SAAS;oCACxB,WAAW,KAAK,aAAa,IAAI;oCACjC,OAAO,CAAC,KAAK,WAAW,IAAI,CAAC,EAAE,QAAQ;oCACvC,UAAU,CAAC,KAAK,cAAc,IAAI,CAAC,EAAE,QAAQ;oCAC7C,QAAQ;oCACR,WAAW,KAAK,UAAU;oCAC1B,SAAS,KAAK,OAAO,KAAK,MAAM;oCAChC,QAAQ,KAAK,OAAO;oCACpB,aAAa,KAAK,WAAW;oCAC7B,OAAO,KAAK,KAAK;oCACjB,UAAU,KAAK,QAAQ;oCACvB,iBAAiB,KAAK,eAAe;oCACrC,UAAU;oCACV,eAAe,KAAK,WAAW,IAAI,KAAK,UAAU;;;;;;;;;;;;;;;;;mBApEnD,KAAK,EAAE;;;;;;;;;;;AA6E1B;GArZwB;;QACL,iIAAA,CAAA,UAAO;QACJ,yLAAA,CAAA,iBAAc;QAQ6B,8KAAA,CAAA,WAAQ;QAmBD,8KAAA,CAAA,WAAQ;QAuBnD,iLAAA,CAAA,cAAW;;;KApDhB","debugId":null}},
    {"offset": {"line": 5447, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/kevin/Desktop/tiktok-clone/src/app/profile/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect, useRef, ChangeEvent } from 'react'; // Added ChangeEvent\r\nimport { MainLayout } from \"@/components/MainLayout\";\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport { motion } from 'framer-motion';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { format } from 'date-fns';\r\nimport Image from 'next/image'; // Keep Image for profile pic and potentially initial banner\r\nimport Link from 'next/link'; // Keep Link for other potential uses\r\nimport { useRouter } from 'next/navigation'; // Import useRouter\r\nimport ReactCrop, { type Crop, PixelCrop, centerCrop, makeAspectCrop } from 'react-image-crop'; // Crop imports\r\nimport 'react-image-crop/dist/ReactCrop.css'; // Crop CSS\r\n\r\n// shadcn/ui components & Lucide icons\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\r\nimport {\r\n  Dialog, DialogContent, DialogHeader, DialogTitle,\r\n  DialogDescription, DialogFooter, DialogTrigger, DialogClose\r\n} from \"@/components/ui/dialog\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Slider } from '@/components/ui/slider'; // Import Slider for zoom\r\nimport {\r\n  MapPin, Globe, Calendar, Settings, Share2, Bookmark,\r\n  MoreHorizontal, Mail, UserPlus, Camera, FileText, PlusCircle, Pencil, // Keep Camera\r\n  ShoppingBag\r\n} from \"lucide-react\";\r\nimport { VideoGrid } from '@/components/VideoGrid';\r\n// Import the new component for the Home tab feed\r\nimport ProfileHomeFeed from '@/components/ProfileHomeFeed'; // Import the new feed component\r\n\r\n// Type definition based on actual schema\r\ninterface ProfileData {\r\n  id: string;\r\n  username: string | null;\r\n  name: string | null;\r\n  profile_picture_url: string | null;\r\n  bio: string | null;\r\n  banner_image_url: string | null;\r\n  created_at: string | null;\r\n  following_count: number;\r\n  followers_count: number;\r\n}\r\n\r\n\r\n// --- Cropping Helper Functions ---\r\n// Helper function to generate cropped image blob\r\nfunction getCroppedImg(\r\n  image: HTMLImageElement,\r\n  crop: PixelCrop,\r\n  scale = 1,\r\n): Promise<Blob | null> {\r\n  const canvas = document.createElement('canvas');\r\n  const ctx = canvas.getContext('2d');\r\n\r\n  if (!ctx) {\r\n    throw new Error('No 2d context');\r\n  }\r\n\r\n  const scaleX = image.naturalWidth / image.width;\r\n  const scaleY = image.naturalHeight / image.height;\r\n  const pixelRatio = 1; // window.devicePixelRatio;\r\n\r\n  canvas.width = Math.floor(crop.width * scaleX * pixelRatio);\r\n  canvas.height = Math.floor(crop.height * scaleY * pixelRatio);\r\n\r\n  ctx.scale(pixelRatio, pixelRatio);\r\n  ctx.imageSmoothingQuality = 'high';\r\n\r\n  const cropX = crop.x * scaleX;\r\n  const cropY = crop.y * scaleY;\r\n\r\n  const centerX = image.naturalWidth / 2;\r\n  const centerY = image.naturalHeight / 2;\r\n\r\n  ctx.save();\r\n  ctx.translate(-cropX, -cropY);\r\n  ctx.translate(centerX, centerY);\r\n  ctx.scale(scale, scale);\r\n  ctx.translate(-centerX, -centerY);\r\n  ctx.drawImage(\r\n    image,\r\n    0,\r\n    0,\r\n    image.naturalWidth,\r\n    image.naturalHeight,\r\n    0,\r\n    0,\r\n    image.naturalWidth,\r\n    image.naturalHeight,\r\n  );\r\n  ctx.restore();\r\n\r\n  return new Promise((resolve, reject) => {\r\n    canvas.toBlob((blob) => {\r\n      if (!blob) {\r\n        console.error('Canvas is empty');\r\n        reject(new Error('Canvas is empty'));\r\n        return;\r\n      }\r\n      resolve(blob);\r\n    }, 'image/png'); // Or 'image/jpeg'\r\n  });\r\n}\r\n\r\n// Helper function to center the crop\r\nfunction centerAspectCrop(\r\n  mediaWidth: number,\r\n  mediaHeight: number,\r\n  aspect: number,\r\n) {\r\n  return centerCrop(\r\n    makeAspectCrop(\r\n      {\r\n        unit: '%',\r\n        width: 90, // Initial crop size (percentage)\r\n      },\r\n      aspect,\r\n      mediaWidth,\r\n      mediaHeight,\r\n    ),\r\n    mediaWidth,\r\n    mediaHeight,\r\n  );\r\n}\r\n// --- End Cropping Helper Functions ---\r\n\r\n\r\nexport default function ProfilePage() {\r\n  const { user, loading: authLoading } = useAuth();\r\n  const router = useRouter(); // Get router instance\r\n  const queryClient = useQueryClient();\r\n  const [editedBio, setEditedBio] = useState('');\r\n  const [isBioModalOpen, setIsBioModalOpen] = useState(false);\r\n\r\n  // --- Banner State ---\r\n  const [isBannerModalOpen, setIsBannerModalOpen] = useState(false);\r\n  const [selectedBannerFile, setSelectedBannerFile] = useState<File | null>(null); // Holds the final file (cropped image or video)\r\n  const [bannerPreviewUrl, setBannerPreviewUrl] = useState<string | null>(null); // For the preview in the modal\r\n  const [bannerMediaType, setBannerMediaType] = useState<'image' | 'video' | null>(null); // Track type\r\n  const [bannerImageSrcForCrop, setBannerImageSrcForCrop] = useState<string | null>(null); // Source for react-image-crop (only used if image)\r\n  const [bannerCrop, setBannerCrop] = useState<Crop>();\r\n  const [completedBannerCrop, setCompletedBannerCrop] = useState<PixelCrop>();\r\n  const [bannerScale, setBannerScale] = useState(1);\r\n  const bannerAspect = 16 / 9; // Banner aspect ratio\r\n  const bannerImgRef = useRef<HTMLImageElement>(null); // Ref for the image element in the cropper\r\n  const bannerFileInputRef = useRef<HTMLInputElement>(null); // Ref for the hidden file input\r\n  const [bannerError, setBannerError] = useState<string | null>(null); // Error state for banner modal\r\n  const [bannerOriginalWidth, setBannerOriginalWidth] = useState<number | null>(null); // State for original width\r\n  const [bannerOriginalHeight, setBannerOriginalHeight] = useState<number | null>(null); // State for original height\r\n\r\n  // --- Avatar State ---\r\n  const [isAvatarModalOpen, setIsAvatarModalOpen] = useState(false);\r\n  const [selectedAvatarFile, setSelectedAvatarFile] = useState<File | null>(null);\r\n  const [avatarPreviewUrl, setAvatarPreviewUrl] = useState<string | null>(null);\r\n  const avatarFileInputRef = useRef<HTMLInputElement>(null);\r\n  const [activeTab, setActiveTab] = useState('content'); // Default to content tab\r\n\r\n  // --- React Query ---\r\n  const { data: profile, isLoading, error } = useQuery({\r\n    queryKey: ['profile', user?.id],\r\n    queryFn: async () => {\r\n      if (!user?.id) throw new Error(\"User not authenticated\");\r\n      const { data, error } = await supabase\r\n        .from('profiles')\r\n        .select(`\r\n          id, username, name, profile_picture_url, bio,\r\n          banner_image_url, created_at, following_count,\r\n          followers_count\r\n        `)\r\n        .eq('id', user.id)\r\n        .single();\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n      return data ? data as ProfileData : null;\r\n    },\r\n    enabled: !!user?.id && !authLoading,\r\n  });\r\n\r\n  // --- Effects ---\r\n  useEffect(() => {\r\n    if (profile) {\r\n      setEditedBio(profile.bio || '');\r\n      // Set initial banner state based on fetched profile data\r\n      setBannerPreviewUrl(profile.banner_image_url);\r\n      if (profile.banner_image_url) {\r\n        const extension = profile.banner_image_url.split('.').pop()?.split('?')[0]?.toLowerCase();\r\n        setBannerMediaType(extension && ['mp4', 'webm', 'mov', 'ogg', 'mkv', 'avi'].includes(extension) ? 'video' : 'image');\r\n      } else {\r\n        setBannerMediaType(null);\r\n      }\r\n    }\r\n  }, [profile]);\r\n\r\n  // --- Mutations ---\r\n  const updateBioMutation = useMutation({\r\n    mutationFn: async (newBio: string) => {\r\n      if (!user?.id) throw new Error(\"User not authenticated\");\r\n      const { error } = await supabase\r\n        .from('profiles')\r\n        .update({ bio: newBio, updated_at: new Date().toISOString() })\r\n        .eq('id', user.id);\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['profile', user?.id] });\r\n      setIsBioModalOpen(false);\r\n    },\r\n    onError: (error) => console.error(\"Failed to update bio:\", error),\r\n  });\r\n\r\n  const updateBannerMutation = useMutation({\r\n    mutationFn: async (file: File) => {\r\n      if (!user?.id) throw new Error(\"User not authenticated\");\r\n      if (!file) throw new Error(\"No file selected\");\r\n\r\n      const fileExt = file.name.split('.').pop();\r\n      const fileName = `banner.${fileExt}`;\r\n      const filePath = `${user.id}/${fileName}`;\r\n      const contentType = file.type;\r\n\r\n      console.log(`Uploading banner ${contentType} to: banners/${filePath}`);\r\n\r\n      // --- Deletion of Old Banner ---\r\n      const { data: currentProfileData, error: fetchError } = await supabase\r\n        .from('profiles')\r\n        .select('banner_image_url')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n      if (fetchError && fetchError.code !== 'PGRST116') {\r\n        console.error(\"Error fetching current banner URL for deletion:\", fetchError);\r\n      }\r\n\r\n      const currentDbFilePath = currentProfileData?.banner_image_url;\r\n      const storagePathRegex = /\\/banners\\/(.+?)(\\?|$)/;\r\n      const match = currentDbFilePath?.match(storagePathRegex);\r\n      const currentStoragePath = match ? match[1] : null;\r\n\r\n      if (currentStoragePath && currentStoragePath !== filePath) {\r\n        try {\r\n          console.log(`Attempting to remove old banner file from storage: ${currentStoragePath}`);\r\n          const { error: removeError } = await supabase.storage.from('banners').remove([currentStoragePath]);\r\n          if (removeError && removeError.message !== 'The resource was not found') {\r\n            console.warn(`Failed to remove old banner file at ${currentStoragePath}:`, removeError.message);\r\n          } else if (!removeError) {\r\n            console.log(`Successfully removed old banner file: ${currentStoragePath}`);\r\n          }\r\n        } catch (err: unknown) {\r\n          const message = err instanceof Error ? err.message : String(err);\r\n          console.warn(`Error during removal of old banner file:`, message);\r\n        }\r\n      }\r\n      // --- End Deletion Logic ---\r\n\r\n      // 1. Upload new banner\r\n      const { error: uploadError } = await supabase.storage\r\n        .from('banners')\r\n        .upload(filePath, file, { cacheControl: '3600', upsert: true, contentType: contentType });\r\n      if (uploadError) throw new Error(`Storage upload failed: ${uploadError.message}`);\r\n\r\n      // 2. Get public URL with cache buster\r\n      const timestamp = `t=${new Date().getTime()}`;\r\n      const { data: urlData } = supabase.storage.from('banners').getPublicUrl(filePath);\r\n      let publicUrl = urlData?.publicUrl;\r\n      if (!publicUrl) throw new Error(\"Failed to get public URL for banner. Check bucket RLS.\");\r\n      publicUrl = publicUrl.includes('?') ? `${publicUrl}&${timestamp}` : `${publicUrl}?${timestamp}`;\r\n\r\n      // 3. Update profile table\r\n      const { error: updateError } = await supabase\r\n        .from('profiles')\r\n        .update({ banner_image_url: publicUrl, updated_at: new Date().toISOString() })\r\n        .eq('id', user.id);\r\n      if (updateError) throw new Error(`Profile update failed: ${updateError.message}`);\r\n\r\n      return publicUrl;\r\n    },\r\n    onSuccess: (newUrl) => {\r\n      queryClient.invalidateQueries({ queryKey: ['profile', user?.id] });\r\n      // Reset banner modal state *after* successful upload\r\n      setIsBannerModalOpen(false);\r\n      setSelectedBannerFile(null);\r\n      setBannerImageSrcForCrop(null);\r\n      setBannerCrop(undefined);\r\n      setCompletedBannerCrop(undefined);\r\n      setBannerError(null);\r\n      // Reset dimensions state after successful upload\r\n      setBannerOriginalWidth(null);\r\n      setBannerOriginalHeight(null);\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Failed to update banner:\", error);\r\n      setBannerError(`Failed to update banner: ${error.message}`);\r\n    }\r\n  });\r\n\r\n  const updateAvatarMutation = useMutation({\r\n    mutationFn: async (file: File) => {\r\n      if (!user?.id) throw new Error(\"User not authenticated\");\r\n      if (!file) throw new Error(\"No file selected\");\r\n\r\n      const fileExt = file.name.split('.').pop();\r\n      const filePath = `${user.id}/avatar.${fileExt}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from('profiles') // Assuming avatar bucket is named 'profiles'\r\n        .upload(filePath, file, { cacheControl: '3600', upsert: true });\r\n      if (uploadError) throw new Error(`Storage upload failed: ${uploadError.message}`);\r\n\r\n      const { data: urlData } = supabase.storage.from('profiles').getPublicUrl(filePath);\r\n      const publicUrl = urlData?.publicUrl;\r\n      if (!publicUrl) throw new Error(\"Failed to get public URL for avatar\");\r\n\r\n      const { error: updateError } = await supabase\r\n        .from('profiles')\r\n        .update({ profile_picture_url: publicUrl, updated_at: new Date().toISOString() })\r\n        .eq('id', user.id);\r\n      if (updateError) throw new Error(`Profile update failed: ${updateError.message}`);\r\n\r\n      return publicUrl;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['profile', user?.id] });\r\n      setIsAvatarModalOpen(false);\r\n      setSelectedAvatarFile(null);\r\n      setAvatarPreviewUrl(null);\r\n    },\r\n    onError: (error) => console.error(\"Failed to update avatar:\", error),\r\n  });\r\n\r\n  // --- Handlers ---\r\n  const handleSaveBio = () => {\r\n    updateBioMutation.mutate(editedBio);\r\n  };\r\n\r\n  // Called when the BANNER image loads in the cropper\r\n  function onBannerImageLoad(e: React.SyntheticEvent<HTMLImageElement>) {\r\n    const { width, height } = e.currentTarget;\r\n    setBannerCrop(centerAspectCrop(width, height, bannerAspect));\r\n  }\r\n\r\n  // Updated Banner File Change Handler (triggers cropper for images)\r\n  const handleBannerFileChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    setBannerError(null); // Clear previous errors\r\n    if (file) {\r\n      // Reset relevant states before processing new file\r\n      setSelectedBannerFile(null);\r\n      setBannerImageSrcForCrop(null);\r\n      setBannerCrop(undefined);\r\n      setCompletedBannerCrop(undefined);\r\n      setBannerOriginalWidth(null); // Reset dimensions\r\n      setBannerOriginalHeight(null); // Reset dimensions\r\n\r\n      if (file.type.startsWith('video/')) {\r\n        setBannerMediaType('video');\r\n        setSelectedBannerFile(file); // Set the final file state immediately\r\n        setBannerPreviewUrl(URL.createObjectURL(file)); // Update preview for modal\r\n      } else if (file.type.startsWith('image/')) {\r\n        setBannerMediaType('image');\r\n        setBannerScale(1); // Reset zoom\r\n        const reader = new FileReader();\r\n        reader.onloadend = () => {\r\n          const img = document.createElement('img');\r\n          img.onload = () => {\r\n            setBannerOriginalWidth(img.naturalWidth); // Set original width\r\n            setBannerOriginalHeight(img.naturalHeight); // Set original height\r\n            setBannerImageSrcForCrop(reader.result as string); // Set source for cropper\r\n            setBannerPreviewUrl(reader.result as string); // Also set preview for initial display in cropper\r\n          };\r\n          img.onerror = () => {\r\n             console.error(\"Failed to load image for dimension reading.\");\r\n             setBannerError(\"Failed to read image dimensions.\");\r\n             setBannerImageSrcForCrop(null);\r\n             setBannerOriginalWidth(null);\r\n             setBannerOriginalHeight(null);\r\n          };\r\n          img.src = reader.result as string; // Set src for the temporary image element\r\n        };\r\n        reader.onerror = () => {\r\n          console.error(\"Failed to read the selected banner image file.\");\r\n          setBannerImageSrcForCrop(null);\r\n          setBannerError(\"Failed to read the selected image file.\");\r\n        }\r\n        reader.readAsDataURL(file);\r\n      } else {\r\n        setBannerError(\"Unsupported file type. Please select an image or video.\");\r\n        setBannerMediaType(null);\r\n        setSelectedBannerFile(null);\r\n        setBannerPreviewUrl(profile?.banner_image_url ?? null); // Revert preview\r\n      }\r\n    } else {\r\n      // No file selected, reset to initial state\r\n      setSelectedBannerFile(null);\r\n      setBannerImageSrcForCrop(null);\r\n      setBannerPreviewUrl(profile?.banner_image_url ?? null);\r\n      setBannerMediaType(profile?.banner_image_url ? (profile.banner_image_url.match(/\\.(mp4|webm|mov|ogg)$/i) ? 'video' : 'image') : null);\r\n      setBannerOriginalWidth(null); // Reset dimensions\r\n      setBannerOriginalHeight(null); // Reset dimensions\r\n    }\r\n  };\r\n\r\n  // Handle applying the BANNER crop from the modal\r\n  const handleApplyBannerCrop = async () => {\r\n    if (!completedBannerCrop || !bannerImgRef.current || !bannerImageSrcForCrop) {\r\n      console.error(\"Banner Crop details, image ref, or image source not available\");\r\n      setBannerError(\"Could not apply crop. Please try again.\");\r\n      return;\r\n    }\r\n    try {\r\n      setBannerError(null);\r\n      const croppedBlob = await getCroppedImg(\r\n        bannerImgRef.current,\r\n        completedBannerCrop,\r\n        bannerScale\r\n      );\r\n\r\n      if (croppedBlob) {\r\n        const fileExtMatch = bannerImageSrcForCrop.match(/data:image\\/(.+);/);\r\n        const fileExt = fileExtMatch ? fileExtMatch[1] : 'png';\r\n        const fileName = `banner_cropped_${Date.now()}.${fileExt}`;\r\n        const croppedFile = new File([croppedBlob], fileName, { type: `image/${fileExt}` });\r\n\r\n        setSelectedBannerFile(croppedFile); // Set the final cropped file\r\n        setBannerPreviewUrl(URL.createObjectURL(croppedBlob)); // Update preview shown in modal\r\n        setBannerMediaType('image'); // Ensure type is image\r\n        setBannerImageSrcForCrop(null); // Clear cropper source after applying\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Error cropping banner image:\", e);\r\n      setBannerError(\"Could not crop the image. Please try again.\");\r\n    } finally {\r\n      // Clear the file input value *after* processing\r\n      if (bannerFileInputRef.current) {\r\n        bannerFileInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  // Handle cancelling the BANNER crop/upload modal (called by Dialog onOpenChange or Cancel button)\r\n  const handleCancelBannerChange = () => {\r\n    setIsBannerModalOpen(false); // Close the main modal\r\n    // Reset all banner-related temporary states\r\n    setSelectedBannerFile(null);\r\n    setBannerImageSrcForCrop(null);\r\n    setBannerCrop(undefined);\r\n    setCompletedBannerCrop(undefined);\r\n    setBannerError(null);\r\n    setBannerOriginalWidth(null); // Reset dimensions on cancel\r\n    setBannerOriginalHeight(null); // Reset dimensions on cancel\r\n    // Revert preview URL and type shown outside the modal to the initial profile state\r\n    setBannerPreviewUrl(profile?.banner_image_url ?? null);\r\n    if (profile?.banner_image_url) {\r\n       const extension = profile.banner_image_url.split('.').pop()?.split('?')[0]?.toLowerCase();\r\n       setBannerMediaType(extension && ['mp4', 'webm', 'mov', 'ogg', 'mkv', 'avi'].includes(extension) ? 'video' : 'image');\r\n    } else {\r\n       setBannerMediaType(null);\r\n    }\r\n    if (bannerFileInputRef.current) {\r\n      bannerFileInputRef.current.value = \"\"; // Clear file input\r\n    }\r\n  };\r\n\r\n  // Handle Save Banner (triggers mutation with the selected file - either original video or cropped image)\r\n  const handleSaveBanner = () => {\r\n    if (selectedBannerFile) {\r\n      setBannerError(null); // Clear previous errors before saving\r\n      updateBannerMutation.mutate(selectedBannerFile);\r\n      // onSuccess in the mutation handles closing the modal and resetting state\r\n    } else {\r\n      setBannerError(\"Please select a file first.\");\r\n    }\r\n  };\r\n\r\n  const handleAvatarFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (file) {\r\n      setSelectedAvatarFile(file);\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setAvatarPreviewUrl(reader.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    } else {\r\n      setSelectedAvatarFile(null);\r\n      setAvatarPreviewUrl(null);\r\n    }\r\n  };\r\n\r\n  const handleSaveAvatar = () => {\r\n    if (selectedAvatarFile) {\r\n      updateAvatarMutation.mutate(selectedAvatarFile);\r\n    }\r\n  };\r\n\r\n  // --- Animation Variants ---\r\n  const bannerVariants = {\r\n    hidden: { opacity: 0 },\r\n    visible: { opacity: 1, transition: { duration: 0.6 } }\r\n  };\r\n\r\n  const profileVariants = {\r\n    hidden: { opacity: 0, y: 20 },\r\n    visible: { opacity: 1, y: 0, transition: { duration: 0.5, delay: 0.2 } }\r\n  };\r\n\r\n  // --- Render Logic ---\r\n  if (authLoading) {\r\n    return (\r\n      <MainLayout>\r\n        <div className=\"flex justify-center items-center min-h-[70vh]\">\r\n          <div className=\"flex flex-col items-center\">\r\n            <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary\"></div>\r\n            <p className=\"mt-4 text-muted-foreground\">Loading authentication...</p>\r\n          </div>\r\n        </div>\r\n      </MainLayout>\r\n    );\r\n  }\r\n\r\n  if (!user) {\r\n    return (\r\n      <MainLayout>\r\n        <div className=\"container max-w-6xl mx-auto px-4 py-12\">\r\n          <Alert>\r\n            <AlertTitle>Authentication Required</AlertTitle>\r\n            <AlertDescription> Please log in to view this profile. </AlertDescription>\r\n          </Alert>\r\n        </div>\r\n      </MainLayout>\r\n    );\r\n  }\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <MainLayout>\r\n        <div className=\"container max-w-6xl mx-auto px-4 py-12 text-center\">\r\n           <p>Loading profile...</p>\r\n        </div>\r\n      </MainLayout>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <MainLayout>\r\n        <div className=\"container max-w-6xl mx-auto px-4 py-12\">\r\n          <Alert variant=\"destructive\">\r\n            <AlertTitle>Error Loading Profile</AlertTitle>\r\n            <AlertDescription> {(error as Error).message || \"Failed to load profile data.\"} </AlertDescription>\r\n          </Alert>\r\n        </div>\r\n      </MainLayout>\r\n    );\r\n  }\r\n\r\n  if (!profile) {\r\n     return (\r\n       <MainLayout>\r\n         <div className=\"container max-w-6xl mx-auto px-4 py-12\">\r\n           <Alert>\r\n             <AlertTitle>Profile Not Found</AlertTitle>\r\n             <AlertDescription> This profile could not be found. </AlertDescription>\r\n           </Alert>\r\n         </div>\r\n       </MainLayout>\r\n      );\r\n   }\r\n\r\n   return (\r\n     <MainLayout>\r\n       {/* Hero banner - Removed motion.div for debugging asChild error */}\r\n       <div\r\n         className=\"relative w-full h-72 md:h-96 overflow-hidden bg-gradient-to-r from-slate-300 to-slate-400 dark:from-slate-700 dark:to-slate-800\" // Increased height\r\n         // variants={bannerVariants} // Removed animation props\r\n         // initial=\"hidden\"\r\n        // animate=\"visible\"\r\n      >\r\n        {/* Display Current Banner (Image or Video) */}\r\n        {profile.banner_image_url ? (\r\n          (profile.banner_image_url.match(/\\.(mp4|webm|mov|ogg)$/i)) ? (\r\n            <video\r\n              src={profile.banner_image_url}\r\n              className=\"w-full h-full object-cover\"\r\n              autoPlay loop muted playsInline key={profile.banner_image_url} // Key forces reload if URL changes\r\n            />\r\n          ) : (\r\n            <Image\r\n              src={profile.banner_image_url}\r\n              alt=\"Profile banner\"\r\n              className=\"object-cover object-center\"\r\n              fill // Use fill layout\r\n              priority\r\n              quality={90}\r\n              key={profile.banner_image_url} // Key forces reload if URL changes\r\n            />\r\n          )\r\n        ) : (\r\n          <div className=\"absolute inset-0 bg-muted\"></div> // Placeholder if no banner\r\n        )}\r\n\r\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent\"></div>\r\n\r\n        {/* Edit Banner Button & Modal */}\r\n        {/* Use handleCancelBannerChange for onOpenChange when closing */}\r\n        <Dialog\r\n          open={isBannerModalOpen}\r\n          onOpenChange={(isOpen) => {\r\n            // Update the controlled state based on the event\r\n            setIsBannerModalOpen(isOpen);\r\n\r\n            if (!isOpen) {\r\n              // Reset state fully on close using the existing handler\r\n              handleCancelBannerChange();\r\n            } else {\r\n              // If opening, reset temporary states needed for the modal\r\n              setSelectedBannerFile(null);\r\n              setBannerImageSrcForCrop(null);\r\n              setBannerCrop(undefined);\r\n              setCompletedBannerCrop(undefined);\r\n              setBannerError(null);\r\n              // Set preview to current profile banner when opening\r\n              setBannerPreviewUrl(profile?.banner_image_url ?? null);\r\n              setBannerMediaType(profile?.banner_image_url ? (profile.banner_image_url.match(/\\.(mp4|webm|mov|ogg)$/i) ? 'video' : 'image') : null);\r\n              if (bannerFileInputRef.current) {\r\n                bannerFileInputRef.current.value = \"\"; // Clear file input on open\r\n              }\r\n            }\r\n          }}\r\n        >\r\n          {/* Removed asChild from DialogTrigger, trigger manually */}\r\n          <DialogTrigger asChild={false}> \r\n            {/* Button now triggers manually */}\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              className=\"absolute top-4 right-4 bg-black/40 hover:bg-black/60 text-white border-white/20 backdrop-blur-sm\"\r\n              onClick={() => {\r\n                // Manually trigger opening and reset state\r\n                setSelectedBannerFile(null);\r\n                setBannerImageSrcForCrop(null);\r\n                setBannerCrop(undefined);\r\n                setCompletedBannerCrop(undefined);\r\n                setBannerError(null);\r\n                setBannerPreviewUrl(profile?.banner_image_url ?? null);\r\n                setBannerMediaType(profile?.banner_image_url ? (profile.banner_image_url.match(/\\.(mp4|webm|mov|ogg)$/i) ? 'video' : 'image') : null);\r\n                if (bannerFileInputRef.current) {\r\n                  bannerFileInputRef.current.value = \"\"; // Clear file input\r\n                }\r\n                setIsBannerModalOpen(true); // Open the dialog\r\n              }}\r\n            >\r\n              <Camera className=\"h-4 w-4 mr-2\" />\r\n              Change Banner\r\n            </Button>\r\n          </DialogTrigger> \r\n          {/* Increase max width for cropper */}\r\n          <DialogContent className=\"sm:max-w-lg bg-card\">\r\n            <DialogHeader>\r\n              <DialogTitle>Change Banner</DialogTitle>\r\n              <DialogDescription>\r\n                Select a new image or video. Images can be cropped.\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n\r\n            {/* Conditionally render Cropper or Preview/Input */}\r\n            {bannerImageSrcForCrop ? (\r\n              // --- Cropper View ---\r\n              <div className=\"space-y-4 py-4\">\r\n                <div className=\"relative flex justify-center items-center overflow-hidden p-4 border rounded-md\" style={{ maxHeight: '60vh' }}>\r\n                  <ReactCrop\r\n                    crop={bannerCrop}\r\n                    onChange={(_, percentCrop) => setBannerCrop(percentCrop)}\r\n                    onComplete={(c) => setCompletedBannerCrop(c)}\r\n                    aspect={bannerAspect}\r\n                    keepSelection\r\n                  >\r\n                    <img\r\n                      ref={bannerImgRef}\r\n                      alt=\"Crop banner\"\r\n                      src={bannerImageSrcForCrop}\r\n                      style={{ transform: `scale(${bannerScale})`, objectFit: 'contain', width: '100%', height: 'auto' }}\r\n                      onLoad={onBannerImageLoad}\r\n                    />\r\n                  </ReactCrop>\r\n                </div>\r\n                <div className=\"w-full max-w-xs mx-auto flex items-center space-x-2 px-4\">\r\n                  <Label htmlFor=\"bannerZoom\" className=\"w-12 text-sm text-muted-foreground\">Zoom</Label>\r\n                  <Slider\r\n                    id=\"bannerZoom\"\r\n                    min={1} max={3} step={0.01} value={[bannerScale]}\r\n                    onValueChange={(value) => setBannerScale(value[0])}\r\n                    className=\"flex-1\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex justify-end space-x-2 pt-2\">\r\n                   {/* Back button clears the cropper source, returning to upload view */}\r\n                   <Button variant=\"outline\" onClick={() => {\r\n                       setBannerImageSrcForCrop(null);\r\n                       // Revert preview based on original profile data\r\n                       setBannerPreviewUrl(profile?.banner_image_url ?? null);\r\n                       setBannerMediaType(profile?.banner_image_url ? (profile.banner_image_url.match(/\\.(mp4|webm|mov|ogg)$/i) ? 'video' : 'image') : null);\r\n                       setSelectedBannerFile(null); // Clear selection\r\n                       if (bannerFileInputRef.current) bannerFileInputRef.current.value = \"\"; // Clear file input\r\n                   }}>Back</Button>\r\n                    <Button onClick={handleApplyBannerCrop} disabled={!completedBannerCrop}>Apply Crop</Button>\r\n                 </div>\r\n                 {/* Display original dimensions in cropper view */}\r\n                 {bannerOriginalWidth && bannerOriginalHeight && (\r\n                   <p className=\"text-xs text-muted-foreground text-center pt-1\">\r\n                     Original: {bannerOriginalWidth} x {bannerOriginalHeight} px\r\n                   </p>\r\n                 )}\r\n               </div>\r\n             ) : (\r\n               // --- Initial Upload/Preview View ---\r\n              <div className=\"space-y-4 py-4\">\r\n                {/* Preview Area */}\r\n                <div className=\"w-full aspect-[16/5] bg-muted rounded border border-dashed flex items-center justify-center overflow-hidden relative\">\r\n                  {bannerPreviewUrl ? (\r\n                    bannerMediaType === 'video' ? (\r\n                      <video\r\n                        src={bannerPreviewUrl}\r\n                        className=\"w-full h-full object-cover\"\r\n                        autoPlay loop muted playsInline key={bannerPreviewUrl}\r\n                      />\r\n                    ) : ( // Assumes image if not video\r\n                      <Image src={bannerPreviewUrl} alt=\"Banner preview\" layout=\"fill\" className=\"object-cover\" quality={90} key={bannerPreviewUrl} />\r\n                    )\r\n                  ) : (\r\n                    <span className=\"text-sm text-muted-foreground\">Select file below</span>\r\n                  )}\r\n                </div>\r\n                {/* File Input */}\r\n                <div className=\"grid w-full max-w-sm items-center gap-1.5\">\r\n                  <Label htmlFor=\"banner-upload\">Select Image or Video</Label>\r\n                  <Input\r\n                    id=\"banner-upload\"\r\n                    type=\"file\"\r\n                    // Accept common image and video types\r\n                    accept=\"image/png, image/jpeg, image/webp, video/mp4, video/webm, video/quicktime, video/ogg\"\r\n                    ref={bannerFileInputRef}\r\n                    onChange={handleBannerFileChange}\r\n                    className=\"cursor-pointer\"\r\n                   />\r\n                   <p className=\"text-xs text-muted-foreground\">PNG, JPG, WEBP, MP4, WEBM, MOV, OGG. Max 10MB.</p>\r\n                   {/* Display original dimensions in initial view */}\r\n                   {bannerMediaType === 'image' && bannerOriginalWidth && bannerOriginalHeight && (\r\n                     <p className=\"text-xs text-muted-foreground text-center\">\r\n                       Original: {bannerOriginalWidth} x {bannerOriginalHeight} px\r\n                     </p>\r\n                   )}\r\n                 </div>\r\n                 {bannerError && <p className=\"text-sm text-red-600\">{bannerError}</p>}\r\n               </div>\r\n            )}\r\n\r\n            <DialogFooter>\r\n              {/* Use the specific cancel handler */}\r\n              <Button type=\"button\" variant=\"outline\" onClick={handleCancelBannerChange}>Cancel</Button>\r\n              <Button\r\n                type=\"button\"\r\n                onClick={handleSaveBanner}\r\n                // Disable Save if: no file selected OR mutation is pending OR user is currently in cropping view\r\n                disabled={!selectedBannerFile || updateBannerMutation.isPending || !!bannerImageSrcForCrop}\r\n              >\r\n                {updateBannerMutation.isPending ? 'Saving...' : 'Save Banner'}\r\n              </Button>\r\n            </DialogFooter>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div> {/* End of banner div */}\r\n\r\n      <div className=\"container max-w-6xl mx-auto px-4\">\r\n        {/* Profile header section - Removed motion.div */}\r\n        <div\r\n          className=\"relative -mt-16 md:-mt-20 flex flex-col md:flex-row gap-6 md:gap-8 mb-8\"\r\n          // variants={profileVariants} // Removed animation props\r\n          // initial=\"hidden\"\r\n          // animate=\"visible\"\r\n        >\r\n          {/* Profile avatar */}\r\n          <div className=\"relative flex-shrink-0\">\r\n             <Avatar className=\"h-32 w-32 md:h-36 md:w-36 border-4 border-background shadow-lg\">\r\n               <AvatarImage src={profile?.profile_picture_url ?? undefined} alt={profile?.username ?? 'User'} />\r\n               <AvatarFallback className=\"text-3xl\">\r\n                {profile?.name?.charAt(0)?.toUpperCase() ?? profile?.username?.charAt(0)?.toUpperCase() ?? 'U'}\r\n               </AvatarFallback>\r\n            </Avatar>\r\n            {/* Edit Avatar Button with Modal */}\r\n            {/* Remove DialogTrigger and trigger manually */}\r\n            <Dialog open={isAvatarModalOpen} onOpenChange={setIsAvatarModalOpen}>\r\n              {/* No DialogTrigger here */}\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"icon\"\r\n                className=\"absolute bottom-1 right-1 bg-background rounded-full h-8 w-8 shadow-md\" // Removed absolute positioning\r\n                aria-label=\"Change profile picture\"\r\n                onClick={() => setIsAvatarModalOpen(true)} // Open modal directly\r\n              >\r\n                <Camera className=\"h-4 w-4\" />\r\n              </Button>\r\n              <DialogContent className=\"sm:max-w-md\">\r\n                <DialogHeader>\r\n                  <DialogTitle>Change Profile Picture</DialogTitle>\r\n                  <DialogDescription> Select a new image for your avatar. </DialogDescription>\r\n                </DialogHeader>\r\n                <div className=\"space-y-4 py-4\">\r\n                   <div className=\"flex justify-center\">\r\n                     <Avatar className=\"h-32 w-32 border-2 border-primary\">\r\n                       <AvatarImage src={avatarPreviewUrl ?? profile?.profile_picture_url ?? undefined} alt=\"Avatar preview\" />\r\n                       <AvatarFallback className=\"text-3xl\">\r\n                         {profile?.name?.charAt(0)?.toUpperCase() ?? profile?.username?.charAt(0)?.toUpperCase() ?? 'U'}\r\n                       </AvatarFallback>\r\n                    </Avatar>\r\n                  </div>\r\n                  <div className=\"grid w-full max-w-sm items-center gap-1.5 mx-auto\">\r\n                    <Label htmlFor=\"avatar-picture\">Select Image</Label>\r\n                    <Input id=\"avatar-picture\" type=\"file\" accept=\"image/png, image/jpeg, image/webp\" ref={avatarFileInputRef} onChange={handleAvatarFileChange} className=\"cursor-pointer\" />\r\n                    <p className=\"text-xs text-muted-foreground\">PNG, JPG, WEBP up to 2MB.</p>\r\n                  </div>\r\n                 </div>\r\n                 <DialogFooter>\r\n                   {/* Removed asChild from DialogClose */}\r\n                   <DialogClose> <Button type=\"button\" variant=\"outline\">Cancel</Button> </DialogClose>\r\n                   <Button type=\"button\" onClick={handleSaveAvatar} disabled={!selectedAvatarFile || updateAvatarMutation.isPending}>\r\n                     {updateAvatarMutation.isPending ? 'Uploading...' : 'Save Avatar'}\r\n                   </Button>\r\n                </DialogFooter>\r\n              </DialogContent>\r\n            </Dialog>\r\n          </div>\r\n\r\n          {/* Profile info */}\r\n          <div className=\"flex-1 space-y-3 pt-4 md:pt-6\">\r\n            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\r\n              <div>\r\n                <h1 className=\"text-2xl font-bold\">{profile?.name ?? 'User Name'}</h1>\r\n                <h2 className=\"text-lg text-muted-foreground\">@{profile?.username ?? 'username'}</h2>\r\n              </div>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                 {/* Changed Button to navigate programmatically */}\r\n                 <Button variant=\"outline\" onClick={() => router.push('/profile/edit')}>\r\n                   <Pencil className=\"h-4 w-4 mr-2\" /> Edit Profile\r\n                 </Button>\r\n                 <Button variant=\"ghost\" size=\"icon\"> <MoreHorizontal className=\"h-5 w-5\" /> </Button>\r\n               </div>\r\n             </div>\r\n\r\n             {/* Bio with Edit Modal */}\r\n             {profile && (\r\n               <div className=\"flex items-center\">\r\n                 <p className=\"max-w-3xl text-sm md:text-base mr-2\"> {profile.bio ?? 'No bio available.'} </p>\r\n                 <Dialog open={isBioModalOpen} onOpenChange={setIsBioModalOpen}>\r\n                   {/* Removed asChild, trigger manually */}\r\n                   <DialogTrigger asChild={false}>\r\n                     <Button\r\n                       variant=\"ghost\"\r\n                       size=\"icon\"\r\n                       className=\"h-6 w-6 text-primary flex-shrink-0\"\r\n                       onClick={() => setIsBioModalOpen(true)} // Open manually\r\n                     >\r\n                       <Pencil className=\"h-3 w-3\" />\r\n                     </Button>\r\n                   </DialogTrigger>\r\n                   <DialogContent className=\"sm:max-w-[425px]\">\r\n                     <DialogHeader>\r\n                       <DialogTitle>Edit Bio</DialogTitle>\r\n                       <DialogDescription> Make changes to your bio here. Click save when you're done. </DialogDescription>\r\n                     </DialogHeader>\r\n                     <div className=\"grid gap-4 py-4\">\r\n                       <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                         <Label htmlFor=\"bio\" className=\"text-right sr-only\"> Bio </Label>\r\n                         <Textarea id=\"bio\" value={editedBio} onChange={(e) => setEditedBio(e.target.value)} className=\"col-span-4 h-24\" maxLength={150} />\r\n                       </div>\r\n                      <p className=\"text-xs text-muted-foreground text-right col-span-4\"> {editedBio.length} / 150 </p>\r\n                     </div>\r\n                     <DialogFooter>\r\n                       {/* Removed asChild from DialogClose */}\r\n                       <DialogClose> <Button type=\"button\" variant=\"outline\">Cancel</Button> </DialogClose>\r\n                       <Button type=\"button\" onClick={handleSaveBio} disabled={updateBioMutation.isPending}>\r\n                         {updateBioMutation.isPending ? 'Saving...' : 'Save changes'}\r\n                       </Button>\r\n                     </DialogFooter>\r\n                   </DialogContent>\r\n                 </Dialog>\r\n               </div>\r\n             )}\r\n\r\n            {/* Profile metadata */}\r\n            <div className=\"flex flex-wrap gap-x-4 gap-y-1 text-sm text-muted-foreground\">\r\n              {profile?.created_at && (\r\n                <div className=\"flex items-center\">\r\n                  <Calendar className=\"h-4 w-4 mr-1\" />\r\n                  Joined {format(new Date(profile.created_at), 'MMMM yyyy')}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Stats */}\r\n            <div className=\"flex gap-6 pt-2\">\r\n              <div className=\"flex flex-col\">\r\n                <span className=\"font-bold\">{profile?.following_count?.toLocaleString() ?? 0}</span>\r\n                <span className=\"text-sm text-muted-foreground\">Following</span>\r\n              </div>\r\n              <div className=\"flex flex-col\">\r\n                <span className=\"font-bold\">{profile?.followers_count?.toLocaleString() ?? 0}</span>\r\n                <span className=\"text-sm text-muted-foreground\">Followers</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div> {/* End of profile header div */}\r\n\r\n        {/* Main content area - Simplified */}\r\n        <div className=\"mb-16\">\r\n           <Tabs defaultValue=\"content\" className=\"w-full\">\r\n             <div className=\"border-b\">\r\n               <TabsList className=\"justify-start h-12\">\r\n                 {/* Wrap TabsTrigger content in spans */}\r\n                 <TabsTrigger value=\"content\" className=\"flex items-center\">\r\n                   <span><FileText className=\"h-4 w-4 mr-2 inline-block\" /> Content</span>\r\n                 </TabsTrigger>\r\n                 <TabsTrigger value=\"home\" className=\"flex items-center\">\r\n                   <span><FileText className=\"h-4 w-4 mr-2 inline-block\" /> Home</span>\r\n                 </TabsTrigger>\r\n               </TabsList>\r\n             </div>\r\n              <TabsContent value=\"content\" className=\"py-6\">\r\n               <div className=\"mb-6 flex items-center justify-between\">\r\n                 <h2 className=\"text-xl font-semibold\">My Content</h2>\r\n                  {/* Changed Button to navigate programmatically */}\r\n                  <Button onClick={() => router.push('/upload')}>\r\n                    <PlusCircle className=\"h-4 w-4 mr-2\" /> Create New\r\n                  </Button>\r\n               </div>\r\n               <VideoGrid userId={user.id} allowDeletion={true} />\r\n             </TabsContent>\r\n            <TabsContent value=\"home\" className=\"py-6\">\r\n              <ProfileHomeFeed />\r\n            </TabsContent>\r\n          </Tabs>\r\n        </div>\r\n      </div>\r\n    </MainLayout>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}