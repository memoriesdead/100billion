(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{3792:(e,i,r)=>{"use strict";r.r(i),r.d(i,{default:()=>d});var s=r(5155),t=r(2115),l=r(4304),n=r(3762),o=r(8489),c=r(6927),a=r(9576),u=r(285);function d(){let{user:e}=(0,t.useContext)(a.cy),[i,r]=(0,t.useState)([]),[d,p]=(0,t.useState)([]),[_,f]=(0,t.useState)(!0),[v,m]=(0,t.useState)(null),[h,x]=(0,t.useState)("videos");if((0,t.useEffect)(()=>{!async function(){f(!0),m(null);try{console.log("Starting to fetch posts for For You page...");let{data:e,error:i}=await c.N.from("posts").select("*, profiles!inner(*)").is("is_private",!1).eq("is_for_sale",!1).order("created_at",{ascending:!1});if(i)throw i;if(e&&e.length>0){let i=e.map(e=>{var i,r,s;return{...e,profiles:e.profiles&&"object"==typeof e.profiles&&!Array.isArray(e.profiles)?e.profiles:null,likes_count:null!=(i=e.likes_count)?i:0,comments_count:null!=(r=e.comments_count)?r:0,is_private:e.is_private,is_for_sale:null!=(s=e.is_for_sale)&&s,price:e.price,currency:e.currency,stripe_price_id:e.stripe_price_id,stripe_product_id:e.stripe_product_id}}),s=i.filter(e=>"video"===e.type&&e.video_url),t=i.filter(e=>"image"===e.type&&e.image_url);r(s),p(t)}else r([]),p([])}catch(i){let e=i instanceof Error?i.message:String(i);console.error("Error fetching posts:",i),m(e||"Failed to fetch posts")}finally{f(!1)}}()},[]),_)return(0,s.jsx)(l.MainLayout,{children:(0,s.jsx)("div",{className:"flex h-full justify-center items-center text-white",children:"Loading posts..."})});if(v)return(0,s.jsx)(l.MainLayout,{children:(0,s.jsxs)("div",{className:"flex h-full justify-center items-center text-white",children:["Error: ",v]})});let y="videos"===h?i:d;return(0,s.jsxs)(l.MainLayout,{children:[(0,s.jsxs)("div",{className:"flex justify-center p-2 space-x-2 bg-background border-b border-border sticky top-0 z-10",children:[(0,s.jsx)(u.$,{variant:"videos"===h?"secondary":"ghost",onClick:()=>x("videos"),children:"Videos"}),(0,s.jsx)(u.$,{variant:"images"===h?"secondary":"ghost",onClick:()=>x("images"),children:"Images"})]}),(0,s.jsxs)("div",{className:"h-[calc(100vh-theme(space.14)-52px)] overflow-y-auto",children:[" ",0===y.length?(0,s.jsxs)("div",{className:"flex h-full flex-col justify-center items-center text-white",children:[(0,s.jsx)("p",{className:"text-xl mb-4",children:"videos"===h?"No videos found":"No images found"}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"Upload content to see it here"})]}):y.map(i=>{var r,t,l,c,a,u,d,p,_,f,v,m,h,x,y,g,j,k,b;return(0,s.jsx)("div",{className:"w-full h-full snap-start flex-shrink-0 flex items-center justify-center bg-black",children:"video"===i.type?(0,s.jsx)(n.Z,{id:i.id,userId:i.user_id,username:null!=(a=null==(r=i.profiles)?void 0:r.username)?a:"Unknown User",profilePictureUrl:null!=(u=null==(t=i.profiles)?void 0:t.profile_picture_url)?u:void 0,caption:null!=(d=i.caption)?d:"",videoSrc:null!=(p=i.video_url)?p:"",posterSrc:null!=(_=i.thumbnail_url)?_:void 0,likes:(null!=(f=i.likes_count)?f:0).toString(),comments:(null!=(v=i.comments_count)?v:0).toString(),shares:"0",isPrivate:null!=(m=i.is_private)?m:void 0,isOwner:(null==e?void 0:e.id)===i.user_id,is_for_sale:i.is_for_sale,price:i.price,currency:i.currency,stripe_price_id:i.stripe_price_id,isLocked:null!=(h=i.is_private)&&h&&(null==e?void 0:e.id)!==i.user_id,isPaidContent:null!=(x=i.is_private)?x:void 0}):(0,s.jsx)(o.S,{id:i.id,userId:i.user_id,username:(null==(l=i.profiles)?void 0:l.username)||"Unknown User",profilePictureUrl:(null==(c=i.profiles)?void 0:c.profile_picture_url)||void 0,caption:i.caption,imageUrl:i.image_url,likes:null!=(y=i.likes_count)?y:0,comments:(null!=(g=i.comments_count)?g:0).toString(),shares:"0",isPrivate:null!=(j=i.is_private)&&j,isOwner:(null==e?void 0:e.id)===i.user_id,initialIsLiked:!1,is_for_sale:i.is_for_sale,price:i.price,currency:i.currency,stripe_price_id:i.stripe_price_id,isLocked:null!=(k=i.is_private)&&k&&(null==e?void 0:e.id)!==i.user_id,isPaidContent:null!=(b=i.is_private)?b:void 0})},"post-".concat(i.id))})]})]})}},8035:(e,i,r)=>{Promise.resolve().then(r.bind(r,3792))}},e=>{var i=i=>e(e.s=i);e.O(0,[6711,4206,851,3953,6671,1733,3568,8312,1144,4550,7431,3762,4304,8441,1684,7358],()=>i(8035)),_N_E=e.O()}]);