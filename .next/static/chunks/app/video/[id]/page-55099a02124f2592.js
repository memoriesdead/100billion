(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1016],{172:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},620:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(157).A)("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]])},2781:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var s=r(5155),l=r(2115),a=r(5695),i=r(6874),o=r.n(i),n=r(3762),c=r(6927),d=r(9576),u=r(1394),m=r(285),h=r(2523),x=r(5318);let f=(0,r(157).A)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);var p=r(8224),g=r(9774),v=r(3672);function j(){var e;let t=(0,a.useParams)(),r=(0,a.useRouter)(),{user:i}=(0,d.As)(),j=t.id,[b,y]=(0,l.useState)(null),[N,k]=(0,l.useState)([]),[w,_]=(0,l.useState)(!0),[A,S]=(0,l.useState)(null),[C,z]=(0,l.useState)(!1),[E,L]=(0,l.useState)(null),[M,P]=(0,l.useState)(""),[U,q]=(0,l.useState)(!1),[F,D]=(0,l.useState)(!1),[R,$]=(0,l.useState)(!1),[V,B]=(0,l.useState)(!1);(0,l.useCallback)(async()=>{if(b&&i&&b.user_id===i.id&&!V&&window.confirm("Are you sure you want to delete this video?")){B(!0),S(null);try{let{error:e}=await c.N.from("posts").delete().eq("id",b.id);if(e)throw e;let t=[];if(b.video_url)try{let e=b.video_url.split("/public/");if(e.length>=2){let r=e[1],s=r.indexOf("/");-1!==s&&t.push(r.substring(s+1))}}catch(e){console.error("Could not parse video URL for deletion:",b.video_url,e)}if(b.thumbnail_url)try{let e=b.thumbnail_url.split("/public/");if(e.length>=2){let r=e[1],s=r.indexOf("/");-1!==s&&t.push(r.substring(s+1))}}catch(e){console.error("Could not parse thumbnail URL for deletion:",b.thumbnail_url,e)}if(t.length>0){let{error:e}=await c.N.storage.from("posts").remove(t);e&&console.error("Error deleting from storage:",e)}r.back()}catch(t){let e=t instanceof Error?t.message:String(t);console.error("Error deleting post:",t),S("Failed to delete post: ".concat(e)),B(!1)}}},[b,i,V,r]),(0,l.useEffect)(()=>{let e=async()=>{if(j){z(!0),L(null);try{let{data:e,error:t}=await c.N.from("comments").select("*").eq("post_id",j).order("created_at",{ascending:!0});if(t)throw t;if(!e)return void k([]);let r=[...new Set(e.map(e=>e.user_id).filter(e=>e))],s=new Map;if(r.length>0){let{data:e,error:t}=await c.N.from("profiles").select("id, username, profile_picture_url").in("id",r);t?console.error("Error fetching comment author profiles:",t):e&&e.forEach(e=>s.set(e.id,e))}let l=e.map(e=>({...e,profiles:s.get(e.user_id)||null}));k(l)}catch(e){console.error("Error fetching comments:",e),L("Failed to load comments: ".concat(e.message)),k([])}finally{z(!1)}}};(async()=>{if(j){_(!0),S(null);try{let{data:e,error:t}=await c.N.from("posts").select("*").eq("id",j).single();if(t){if("PGRST116"===t.code)throw Error("Video not found.");throw t}if(e){let{data:t,error:r}=await c.N.from("profiles").select("id, username, name, profile_picture_url").eq("id",e.user_id).single();r&&"PGRST116"!==r.code&&console.error("Error fetching post author profile:",r),console.log("Fetched Post Data:",e),console.log("Fetched Profile Data:",t),y({...e,profiles:t||null})}else S("Video not found.")}catch(e){console.error("Error fetching video data:",e),S("Failed to load video: ".concat(e.message))}finally{_(!1)}}})(),e()},[j]);let O=(0,l.useCallback)(async()=>{var e,t;if(!M.trim()||!i||!j)return;let r={post_id:j,user_id:i.id,text:M.trim()},s={...r,id:"temp-".concat(Date.now()),created_at:new Date().toISOString(),profiles:{id:i.id,username:(null==(e=i.user_metadata)?void 0:e.user_name)||"You",profile_picture_url:(null==(t=i.user_metadata)?void 0:t.avatar_url)||null}};k(e=>[...e,s]),P("");try{let{data:e,error:t}=await c.N.from("comments").insert(r).select().single();if(t)throw t;if(!e)throw Error("Failed to retrieve inserted comment.");let l={...e,profiles:s.profiles};k(e=>e.map(e=>e.id===s.id?l:e))}catch(e){console.error("Error posting comment:",e),L("Failed to post comment: ".concat(e.message)),k(e=>e.filter(e=>e.id!==s.id)),P(r.text)}},[M,i,j]);if(w)return(0,s.jsx)("div",{className:"flex justify-center items-center w-screen h-screen bg-black text-white",children:(0,s.jsx)("p",{children:"Loading video..."})});if(A)return(0,s.jsxs)("div",{className:"flex flex-col justify-center items-center w-screen h-screen bg-black text-white",children:[(0,s.jsx)("p",{className:"text-red-500 mb-4",children:A}),(0,s.jsx)(m.$,{variant:"secondary",onClick:()=>r.back(),children:"Go Back"})]});if(!b||!b.video_url)return(0,s.jsxs)("div",{className:"flex flex-col justify-center items-center w-screen h-screen bg-black text-white",children:[(0,s.jsx)("p",{className:"mb-4",children:"Video not found or source is unavailable."}),(0,s.jsx)(m.$,{variant:"secondary",onClick:()=>r.back(),children:"Go Back"})]});let{id:G,caption:H,video_url:T,thumbnail_url:K,likes_count:Z,comments_count:I,views_count:X,profiles:Y}=b,J=(null==Y?void 0:Y.username)||"Unknown",Q=(null==Y?void 0:Y.name)||J,W=null==Y?void 0:Y.profile_picture_url;return(0,s.jsxs)("div",{className:"fixed inset-0 flex bg-background text-foreground z-50",children:[" ",(0,s.jsx)(m.$,{variant:"ghost",size:"icon",className:"absolute top-4 left-4 text-white bg-black/50 hover:bg-black/70 rounded-full z-50",onClick:()=>r.back(),"aria-label":"Close video",children:(0,s.jsx)(x.A,{size:24})}),(0,s.jsx)("div",{className:"flex-1 bg-black flex items-center justify-center overflow-hidden relative",children:(0,s.jsx)(n.Z,{id:G,username:J,profilePictureUrl:null!=W?W:void 0,caption:null!=H?H:"",videoSrc:T,posterSrc:null!=K?K:void 0,likes:(null!=Z?Z:0).toString(),comments:(null!=I?I:0).toString(),shares:(null!=X?X:0).toString(),userId:b.user_id,is_for_sale:null!=(e=b.is_for_sale)&&e})}),(0,s.jsxs)("div",{className:"w-[400px] lg:w-[500px] border-l border-border bg-background flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-border",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)(o(),{href:"/profile/".concat(J),className:"flex items-center gap-2 group",children:[(0,s.jsxs)(u.eu,{className:"w-10 h-10",children:[(0,s.jsx)(u.BK,{src:null!=W?W:void 0,alt:J}),(0,s.jsx)(u.q5,{children:J.charAt(0).toUpperCase()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold group-hover:underline",children:J}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[Q," \xb7 ",(0,s.jsx)("span",{className:"text-xs",children:"5d ago"})]})," "]})]}),(0,s.jsx)(m.$,{variant:"outline",size:"sm",children:"Follow"})," "]}),(0,s.jsx)("p",{className:"text-sm mb-2",children:null!=H?H:"No caption"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"â™« original sound - placeholder"}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("button",{onClick:()=>q(!U),className:"flex items-center gap-1.5 text-sm hover:text-primary",children:[(0,s.jsx)(f,{size:20,fill:U?"currentColor":"none",className:U?"text-red-500":""}),null!=Z?Z:0]}),(0,s.jsxs)("button",{className:"flex items-center gap-1.5 text-sm hover:text-primary",children:[(0,s.jsx)(p.A,{size:20}),null!=I?I:0]}),(0,s.jsxs)("button",{onClick:()=>D(!F),className:"flex items-center gap-1.5 text-sm hover:text-primary",children:[(0,s.jsx)(g.A,{size:20,fill:F?"currentColor":"none"})," 0"]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(m.$,{variant:"ghost",size:"icon",className:"hover:bg-muted","aria-label":"Share options",children:(0,s.jsx)(v.A,{size:20})})})]}),(0,s.jsxs)("div",{className:"flex items-center border border-input rounded-md bg-muted",children:[(0,s.jsxs)("p",{className:"flex-1 px-3 py-1.5 text-sm text-muted-foreground truncate",children:[window.location.href," "]}),(0,s.jsx)(m.$,{variant:"ghost",size:"sm",className:"rounded-l-none",onClick:()=>{let e=window.location.href;navigator.clipboard.writeText(e).then(()=>{$(!0),setTimeout(()=>$(!1),2e3)}).catch(e=>console.error("Failed to copy URL: ",e))},children:R?"Copied":"Copy link"})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[C&&(0,s.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading comments..."}),E&&(0,s.jsx)("p",{className:"text-red-500 text-center",children:E}),!C&&0===N.length&&(0,s.jsx)("p",{className:"text-muted-foreground text-center",children:"No comments yet."}),N.map(e=>{var t,r,l,a,i,o,n,c,d;return(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsxs)(u.eu,{className:"w-8 h-8",children:[(0,s.jsx)(u.BK,{src:null!=(o=null==(t=e.profiles)?void 0:t.profile_picture_url)?o:void 0,alt:null!=(n=null==(r=e.profiles)?void 0:r.username)?n:"User"}),(0,s.jsx)(u.q5,{children:null!=(c=null==(a=e.profiles)||null==(l=a.username)?void 0:l.charAt(0).toUpperCase())?c:"U"})]}),(0,s.jsxs)("div",{className:"text-sm flex-1",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-semibold mr-1",children:null!=(d=null==(i=e.profiles)?void 0:i.username)?d:"User"}),e.text]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-1",children:[(0,s.jsx)("span",{children:new Date(e.created_at).toLocaleDateString()}),(0,s.jsx)("button",{className:"hover:underline",children:"Reply"}),(0,s.jsxs)("button",{className:"flex items-center gap-0.5 hover:text-red-500",children:[(0,s.jsx)(f,{size:12})," 0 "]})]})]})]},e.id)})]}),(0,s.jsx)("div",{className:"p-4 border-t border-border bg-background",children:i?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(h.p,{placeholder:"Add comment...",className:"flex-1",value:M,onChange:e=>P(e.target.value),onKeyPress:e=>"Enter"===e.key&&O()}),(0,s.jsx)(m.$,{onClick:O,disabled:!M.trim(),children:"Post"})]}):(0,s.jsxs)("p",{className:"text-sm text-muted-foreground text-center",children:[(0,s.jsx)(o(),{href:"#",className:"text-primary hover:underline",onClick:e=>{e.preventDefault()},children:"Log in"})," to add a comment."]})})]})]})}},3300:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(157).A)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},3672:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(157).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},3689:(e,t,r)=>{Promise.resolve().then(r.bind(r,2781))},4815:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(157).A)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},7789:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(157).A)("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]])},8224:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(157).A)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},9774:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(157).A)("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[6711,851,3953,6671,1733,3568,7431,3762,8441,1684,7358],()=>t(3689)),_N_E=e.O()}]);