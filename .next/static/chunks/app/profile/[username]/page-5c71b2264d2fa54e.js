(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6381],{5601:(e,l,s)=>{Promise.resolve().then(s.bind(s,7050))},7050:(e,l,s)=>{"use strict";s.r(l),s.d(l,{default:()=>S});var a=s(5155),r=s(2115),t=s(5695),n=s(6766),i=s(4266),o=s(9576),c=s(6927),d=s(4304),u=s(1394),m=s(285),x=s(7313),f=s(5365),h=s(4352),j=s(6970),w=s(6824),y=s(172),v=s(157);let p=(0,v.A)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),N=(0,v.A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),g=(0,v.A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);var b=s(3561),k=s(1920),_=s(5300),C=s(3568);function S(){var e,l,s,v,S,E,M,A,F,P,L,U,R,q;let T=(0,t.useRouter)(),{username:X}=(0,t.useParams)(),[H,I]=(0,r.useState)(null),{user:$}=(0,r.useContext)(o.cy),[D,G]=(0,r.useState)(!0),[O,z]=(0,r.useState)(null),[B,J]=(0,r.useState)("content"),[K,V]=(0,r.useState)(!1),[Y,Q]=(0,r.useState)(!1),[W,Z]=(0,r.useState)(!0),ee=(0,r.useCallback)(async()=>{if(!$||!H||$.id===H.id)return V(!1),Z(!1),!1;Z(!0);try{let{error:e,count:l}=await c.N.from("relationships").select("*",{count:"exact",head:!0}).eq("follower_uid",$.id).eq("followed_uid",H.id);if(e)throw e;let s=(null!=l?l:0)>0;return V(s),s}catch(e){return e instanceof Error?e.message:String(e),console.error("Error checking follow status:",e),C.oR.error("Could not verify follow status."),V(!1),!1}finally{Z(!1)}},[$,H]);(0,r.useEffect)(()=>{if(!X||"string"!=typeof X){z("Invalid username."),G(!1);return}(async()=>{G(!0),z(null),I(null);try{let{data:e,error:l}=await c.N.from("profiles").select("*").ilike("username",X).single();if(l)throw l;I(e)}catch(s){let e=s instanceof Error?s.message:String(s),l="object"==typeof s&&null!==s&&"code"in s?String(s.code):void 0;console.error("Error loading profile:",s),"PGRST116"===l?z("Profile not found for @".concat(X)):z(e||"Failed to load profile.")}finally{G(!1)}})()},[X]),(0,r.useEffect)(()=>{H&&$?ee():(Z(!1),V(!1))},[$,H,ee]);let el=async()=>{if(!$||!H||$.id===H.id)return void C.oR.error("Cannot follow/unfollow.");Q(!0);try{if(K){let{error:e}=await c.N.from("relationships").delete().match({follower_uid:$.id,followed_uid:H.id});if(e)throw e;C.oR.success("Unfollowed @".concat(H.username)),V(!1),I(e=>{var l;return e?{...e,followers_count:Math.max(0,(null!=(l=e.followers_count)?l:0)-1)}:null})}else{let{error:e}=await c.N.from("relationships").insert({follower_uid:$.id,followed_uid:H.id});if(e)throw e;C.oR.success("Followed @".concat(H.username)),V(!0),I(e=>{var l;return e?{...e,followers_count:(null!=(l=e.followers_count)?l:0)+1}:null})}}catch(l){let e=l instanceof Error?l.message:String(l);console.error("Error toggling follow (Full Error):",l),C.oR.error("Failed to ".concat(K?"unfollow":"follow",": ").concat(e)),V(K)}finally{Q(!1)}};return D?(0,a.jsx)(d.MainLayout,{children:(0,a.jsx)("div",{className:"flex justify-center items-center min-h-[70vh]",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)(y.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,a.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Loading profile..."})]})})}):O?(0,a.jsx)(d.MainLayout,{children:(0,a.jsx)("div",{className:"container max-w-3xl mx-auto px-4 py-12",children:(0,a.jsxs)(f.Fc,{variant:"destructive",children:[(0,a.jsx)(f.XL,{children:"Error"}),(0,a.jsx)(f.TN,{children:O})]})})}):H?(0,a.jsxs)(d.MainLayout,{children:[(0,a.jsxs)(i.P.div,{className:"relative w-full h-48 md:h-64 overflow-hidden bg-gradient-to-r from-slate-300 to-slate-400 dark:from-slate-700 dark:to-slate-800",initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},children:[H.banner_image_url&&(0,a.jsx)(n.default,{src:H.banner_image_url,alt:"Profile banner",className:"object-cover object-center",fill:!0,priority:!0,quality:90}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"})]}),(0,a.jsxs)("div",{className:"container max-w-3xl mx-auto px-4",children:[(0,a.jsxs)(i.P.div,{className:"relative -mt-16 md:-mt-20 flex flex-col md:flex-row gap-6 md:gap-8 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[(0,a.jsx)("div",{className:"relative flex-shrink-0",children:(0,a.jsxs)(u.eu,{className:"h-32 w-32 md:h-36 md:w-36 border-4 border-background shadow-lg",children:[(0,a.jsx)(u.BK,{src:null!=(M=H.profile_picture_url)?M:void 0,alt:null!=(A=H.username)?A:"User"}),(0,a.jsx)(u.q5,{className:"text-3xl",children:null!=(P=null!=(F=null==(l=H.name)||null==(e=l.charAt(0))?void 0:e.toUpperCase())?F:null==(v=H.username)||null==(s=v.charAt(0))?void 0:s.toUpperCase())?P:"U"})]})}),(0,a.jsxs)("div",{className:"flex-1 space-y-3 pt-4 md:pt-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:null!=(L=H.name)?L:"User Name"}),(0,a.jsxs)("h2",{className:"text-lg text-muted-foreground",children:["@",null!=(U=H.username)?U:"username"]})]}),$&&H&&$.id!==H.id&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsxs)(m.$,{variant:K?"secondary":"default",onClick:el,disabled:Y||W,children:[Y?(0,a.jsx)(y.A,{className:"h-4 w-4 mr-2 animate-spin"}):K?(0,a.jsx)(p,{className:"h-4 w-4 mr-2"}):(0,a.jsx)(N,{className:"h-4 w-4 mr-2"}),Y?"Processing...":K?"Followed":"Follow"]}),(0,a.jsxs)(m.$,{variant:"outline",onClick:()=>{if(!$||!H||$.id===H.id)return void C.oR.error("Cannot message this user.");T.push("/messages?userId=".concat(H.id))},children:[(0,a.jsx)(g,{className:"h-4 w-4 mr-2"})," Message"]}),(0,a.jsx)(m.$,{variant:"ghost",size:"icon",children:(0,a.jsx)(b.A,{className:"h-5 w-5"})})]})]}),H.bio&&(0,a.jsx)("p",{className:"max-w-3xl text-sm md:text-base mr-2",children:H.bio}),(0,a.jsx)("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-muted-foreground",children:H.created_at&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-1"})," Joined ",(0,w.GP)(new Date(H.created_at),"MMMM yyyy")]})}),(0,a.jsxs)("div",{className:"flex gap-6 pt-2",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-bold",children:null!=(R=null==(S=H.following_count)?void 0:S.toLocaleString())?R:"0"}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Following"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-bold",children:null!=(q=null==(E=H.followers_count)?void 0:E.toLocaleString())?q:"0"}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Followers"})]})]})]})]}),(0,a.jsx)("div",{className:"mb-16",children:(0,a.jsxs)(x.tU,{value:B,onValueChange:e=>{J(e)},className:"w-full",children:[(0,a.jsx)("div",{className:"border-b",children:(0,a.jsxs)(x.j7,{className:"justify-start h-12",children:[(0,a.jsxs)(x.Xi,{value:"content",className:"flex items-center",children:[(0,a.jsx)(_.A,{className:"h-4 w-4 mr-2"})," Content"]}),(0,a.jsxs)(x.Xi,{value:"home",className:"flex items-center",children:[(0,a.jsx)(_.A,{className:"h-4 w-4 mr-2"})," Home"]})]})}),(0,a.jsx)(x.av,{value:"content",children:(0,a.jsx)(h.Y,{userId:H.id,allowDeletion:!1})}),(0,a.jsx)(x.av,{value:"home",children:(0,a.jsx)(j.A,{})})]})})]})]}):(0,a.jsx)(d.MainLayout,{children:(0,a.jsx)("div",{className:"container max-w-3xl mx-auto px-4 py-12",children:(0,a.jsxs)(f.Fc,{children:[(0,a.jsx)(f.XL,{children:"Profile Not Found"}),(0,a.jsxs)(f.TN,{children:["The profile for @",X," could not be loaded."]})]})})})}}},e=>{var l=l=>e(e.s=l);e.O(0,[6711,4206,2666,851,3953,6671,1733,3568,8312,1144,4550,7328,9373,7436,7431,3762,4304,8104,8441,1684,7358],()=>l(5601)),_N_E=e.O()}]);