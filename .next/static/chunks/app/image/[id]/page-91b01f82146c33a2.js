(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1202],{3672:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(157).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},5365:(e,s,t)=>{"use strict";t.d(s,{Fc:()=>o,TN:()=>d,XL:()=>c});var r=t(5155),l=t(2115),i=t(2085),a=t(9434);let n=(0,i.F)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=l.forwardRef((e,s)=>{let{className:t,variant:l,...i}=e;return(0,r.jsx)("div",{ref:s,role:"alert",className:(0,a.cn)(n({variant:l}),t),...i})});o.displayName="Alert";let c=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,r.jsx)("h5",{ref:s,className:(0,a.cn)("mb-1 font-medium leading-none tracking-tight",t),...l})});c.displayName="AlertTitle";let d=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,r.jsx)("div",{ref:s,className:(0,a.cn)("text-sm [&_p]:leading-relaxed",t),...l})});d.displayName="AlertDescription"},6244:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>j});var r=t(5155),l=t(2115),i=t(5695),a=t(6927),n=t(9576),o=t(833),c=t(1394),d=t(6874),m=t.n(d),u=t(5365),f=t(285),x=t(2523),p=t(5318),h=t(8224),g=t(9774),v=t(3672);function j(){var e,s,t,d,j,b,N,k,y,_,w,C,S;let E=(0,i.useParams)(),A=(0,i.useRouter)(),{user:z}=(0,l.useContext)(n.cy),U=E.id,[L,F]=(0,l.useState)(null),[I,q]=(0,l.useState)(!0),[P,B]=(0,l.useState)(null),[T,$]=(0,l.useState)(!1),[D,M]=(0,l.useState)(!1),[R,K]=(0,l.useState)([]),[O,V]=(0,l.useState)(!1),[X,G]=(0,l.useState)(null),[Z,H]=(0,l.useState)(""),J=(0,l.useCallback)(async()=>{if(U){V(!0),G(null);try{let{data:e,error:s}=await a.N.from("comments").select("*").eq("post_id",U).order("created_at",{ascending:!0});if(s)throw s;if(!e)return void K([]);let t=[...new Set(e.map(e=>e.user_id).filter(e=>e))],r=new Map;if(t.length>0){let{data:e,error:s}=await a.N.from("profiles").select("id, username, profile_picture_url").in("id",t);s?console.error("Error fetching comment author profiles:",s):e&&e.forEach(e=>r.set(e.id,e))}let l=e.map(e=>({...e,profiles:r.get(e.user_id)||null}));K(l)}catch(s){let e=s instanceof Error?s.message:String(s);console.error("Error fetching comments for image:",s),G("Failed to load comments: ".concat(e)),K([])}finally{V(!1)}}},[U]);(0,l.useEffect)(()=>{let e=async()=>{if(z&&U)try{let{data:e,error:s}=await a.N.from("likes").select("id").eq("user_id",z.id).eq("post_id",U).maybeSingle();if(s)throw s;$(!!e)}catch(e){console.error("Error fetching like status for image:",e instanceof Error?e.message:String(e))}};(async()=>{if(!U){B("Post ID is missing."),q(!1);return}q(!0),B(null);try{let{data:e,error:s}=await a.N.from("posts").select("*, is_for_sale, profiles (username, profile_picture_url)").eq("id",U).eq("type","image").single();if(s)throw s;if(!e)throw Error("Image post not found.");if("image"!==e.type||!e.image_url)throw Error("Fetched post is not a valid image post.");F(e)}catch(s){let e=s instanceof Error?s.message:String(s);console.error("Error fetching image post:",s),B(e||"Failed to load image post."),F(null)}finally{q(!1)}})(),e(),J()},[U,z,J]);let Q=(0,l.useCallback)(e=>{F(s=>s?{...s,likes_count:e}:null)},[]),W=(0,l.useCallback)(()=>{F(e=>{var s;return e?{...e,comments_count:(null!=(s=e.comments_count)?s:0)+1}:null}),J()},[J]),Y=(0,l.useCallback)(async()=>{if(!Z.trim()||!z||!U)return;H("");let e={post_id:U,user_id:z.id,text:Z.trim()};try{let{error:s}=await a.N.from("comments").insert(e);if(s)throw s;W()}catch(s){let e=s instanceof Error?s.message:String(s);console.error("Error posting comment:",s),G("Failed to post comment: ".concat(e)),H(Z)}},[Z,z,U,W]);if(I)return(0,r.jsx)("div",{className:"fixed inset-0 flex justify-center items-center bg-black text-white z-50",children:"Loading..."});if(P)return(0,r.jsxs)("div",{className:"fixed inset-0 flex flex-col justify-center items-center bg-black text-white z-50 p-4",children:[(0,r.jsxs)(u.Fc,{variant:"destructive",className:"max-w-md",children:[(0,r.jsx)(u.XL,{children:"Error"}),(0,r.jsx)(u.TN,{children:P})]}),(0,r.jsx)(f.$,{variant:"secondary",onClick:()=>A.back(),className:"mt-4",children:"Go Back"})]});if(!L)return(0,r.jsxs)("div",{className:"fixed inset-0 flex flex-col justify-center items-center bg-black text-white z-50 p-4",children:[(0,r.jsxs)(u.Fc,{className:"max-w-md",children:[(0,r.jsx)(u.XL,{children:"Not Found"}),(0,r.jsx)(u.TN,{children:"This image post could not be found."})]}),(0,r.jsx)(f.$,{variant:"secondary",onClick:()=>A.back(),className:"mt-4",children:"Go Back"})]});let ee=(null==z?void 0:z.id)===L.user_id;return(0,r.jsxs)("div",{className:"fixed inset-0 flex bg-background text-foreground z-50",children:[(0,r.jsx)(f.$,{variant:"ghost",size:"icon",className:"absolute top-4 left-4 text-white bg-black/50 hover:bg-black/70 rounded-full z-50",onClick:()=>A.back(),"aria-label":"Close image",children:(0,r.jsx)(p.A,{size:24})}),(0,r.jsxs)("div",{className:"flex-1 bg-black flex items-center justify-center overflow-hidden relative",children:[(0,r.jsx)("img",{src:L.image_url,alt:L.caption||"Image post",className:"block max-w-full max-h-full object-contain"}),(0,r.jsx)(o.M,{postId:L.id,userId:L.user_id,username:(null==(e=L.profiles)?void 0:e.username)||"Unknown User",profilePictureUrl:(null==(s=L.profiles)?void 0:s.profile_picture_url)||void 0,initialLikes:null!=(y=L.likes_count)?y:0,initialIsLiked:T,commentsCount:(null!=(_=L.comments_count)?_:0).toString(),sharesCount:"0",initialIsPrivate:null!=(w=L.is_private)&&w,isOwner:ee,postType:"image",is_for_sale:null!=(C=L.is_for_sale)&&C,onLikeSuccess:Q})]}),(0,r.jsxs)("div",{className:"w-[400px] lg:w-[500px] border-l border-border bg-background flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-border",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)(m(),{href:"/profile/".concat((null==(t=L.profiles)?void 0:t.username)||""),className:"flex items-center gap-2 group",children:[(0,r.jsxs)(c.eu,{className:"w-10 h-10",children:[(0,r.jsx)(c.BK,{src:(null==(d=L.profiles)?void 0:d.profile_picture_url)||void 0,alt:(null==(j=L.profiles)?void 0:j.username)||"User"}),(0,r.jsx)(c.q5,{children:(null==(N=L.profiles)||null==(b=N.username)?void 0:b.charAt(0).toUpperCase())||"U"})]}),(0,r.jsx)("div",{children:(0,r.jsx)("p",{className:"font-semibold group-hover:underline",children:(null==(k=L.profiles)?void 0:k.username)||"Unknown User"})})]}),!ee&&(0,r.jsx)(f.$,{variant:"outline",size:"sm",children:"Follow"})]}),L.caption&&(0,r.jsx)("p",{className:"text-sm mb-3",children:L.caption}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("button",{className:"flex items-center gap-1.5 text-sm hover:text-primary",onClick:()=>{var e;return null==(e=document.getElementById("comments"))?void 0:e.scrollIntoView({behavior:"smooth"})},children:[(0,r.jsx)(h.A,{size:20}),null!=(S=L.comments_count)?S:0]}),(0,r.jsxs)("button",{onClick:()=>M(!D),className:"flex items-center gap-1.5 text-sm hover:text-primary",children:[(0,r.jsx)(g.A,{size:20,fill:D?"currentColor":"none"})," 0"]})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(f.$,{variant:"ghost",size:"icon",className:"hover:bg-muted","aria-label":"Share options",onClick:()=>{},children:(0,r.jsx)(v.A,{size:20})})})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",id:"comments",children:[O&&(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading comments..."}),X&&(0,r.jsx)("p",{className:"text-red-500 text-center",children:X}),!O&&0===R.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"No comments yet."}),R.map(e=>{var s,t,l,i,a,n,o,d,m;return(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsxs)(c.eu,{className:"w-8 h-8",children:[(0,r.jsx)(c.BK,{src:null!=(n=null==(s=e.profiles)?void 0:s.profile_picture_url)?n:void 0,alt:null!=(o=null==(t=e.profiles)?void 0:t.username)?o:"User"}),(0,r.jsx)(c.q5,{children:null!=(d=null==(i=e.profiles)||null==(l=i.username)?void 0:l.charAt(0).toUpperCase())?d:"U"})]}),(0,r.jsxs)("div",{className:"text-sm flex-1",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-semibold mr-1",children:null!=(m=null==(a=e.profiles)?void 0:a.username)?m:"User"}),e.text]}),(0,r.jsx)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-1",children:(0,r.jsx)("span",{children:new Date(e.created_at).toLocaleDateString()})})]})]},e.id)})]}),(0,r.jsx)("div",{className:"p-4 border-t border-border bg-background",children:z?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.p,{placeholder:"Add comment...",className:"flex-1",value:Z,onChange:e=>H(e.target.value),onKeyPress:e=>"Enter"===e.key&&Y()}),(0,r.jsx)(f.$,{onClick:Y,disabled:!Z.trim(),children:"Post"})]}):(0,r.jsxs)("p",{className:"text-sm text-muted-foreground text-center",children:[(0,r.jsx)(m(),{href:"#",className:"text-primary hover:underline",onClick:e=>{e.preventDefault()},children:"Log in"})," to add a comment."]})})]})]})}},6823:(e,s,t)=>{Promise.resolve().then(t.bind(t,6244))},8224:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(157).A)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},9774:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(157).A)("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[6711,851,3953,6671,1733,7431,8441,1684,7358],()=>s(6823)),_N_E=e.O()}]);