"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3762],{3762:(e,t,r)=>{r.d(t,{Z:()=>N});var s=r(5155),n=r(2115),a=r(5695),l=r(6927),o=r(9576),i=r(1394),c=r(1573),u=r(172),d=r(4815),f=r(3300),m=r(7789),p=r(620),b=r(833),h=r(6126),x=r(285),v=r(3568),g=r(7368),y=r(9509);let j=(0,g.c)(y.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY),w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"usd";return new Intl.NumberFormat("en-US",{style:"currency",currency:t.toUpperCase()}).format(e/100)};function k(e){var t;let{id:r,username:g,verified:y,profilePictureUrl:k,caption:N,videoSrc:C,posterSrc:E,likes:I,comments:S,shares:P,isPrivate:U,isOwner:L,userId:z,is_for_sale:R,price:_,currency:A,isLocked:O}=e,{user:T}=(0,n.useContext)(o.cy),B=(0,a.useRouter)(),V=(0,n.useRef)(null),D=(0,n.useRef)(null),[F,K]=(0,n.useState)(null),[M,W]=(0,n.useState)(!1),[q,H]=(0,n.useState)(null),[J,X]=(0,n.useState)(!1),[Y,Z]=(0,n.useState)(!0),[$,G]=(0,n.useState)(0),[Q,ee]=(0,n.useState)(0),[et,er]=(0,n.useState)(!1),es=R&&!L||O&&!L,en=R&&!L;(0,n.useEffect)(()=>{let e=!0,t=null;return(async()=>{if(es||!C)return W(!1);W(!0),H(null),K(null);try{let r=C.split("/public/");if(r.length<2)throw Error("Invalid video URL format");let s=r[1],n=s.indexOf("/");if(-1===n)throw Error("Invalid bucket/path format");let a=s.substring(0,n),o=s.substring(n+1),{data:i,error:c}=await l.N.storage.from(a).download(o);if(c)throw c;if(!i)throw Error("Downloaded data is null");t=URL.createObjectURL(i),e&&K(t)}catch(r){let t=r instanceof Error?r.message:String(r);e&&H("Failed to load video: ".concat(t))}finally{e&&W(!1)}})(),()=>{e=!1,t&&URL.revokeObjectURL(t)}},[r,C,es]),(0,n.useEffect)(()=>{let e=V.current;if(es||!e||!F)return;let t=new IntersectionObserver(t=>{let[r]=t;r.isIntersecting?e.play().then(()=>X(!0)).catch(()=>X(!1)):e.paused||(e.pause(),X(!1))},{threshold:.5});return t.observe(e),()=>t.disconnect()},[F,r,es]);let ea=(0,n.useCallback)(()=>{if(console.log("Video area clicked"),es)return;let e=V.current;e&&(e.paused||e.ended?e.play().catch(e=>console.error("Play error:",e)):e.pause())},[es]),el=(0,n.useCallback)(()=>{if(es)return;let e=V.current;e&&(e.muted=!e.muted,Z(e.muted))},[es]),eo=(0,n.useCallback)(()=>{if(es)return;let e=V.current;e&&Q&&G(e.currentTime/Q*100)},[Q,es]),ei=(0,n.useCallback)(()=>{if(es)return;let e=V.current;e&&ee(e.duration)},[es]),ec=(0,n.useCallback)(async()=>{if(!T)return void v.oR.error("Please log in to purchase.");if(!r||!R||!_||_<=0)return void v.oR.error("Item not purchasable.");er(!0);try{let e=await fetch("/api/stripe/create-item-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:r})}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to create session");if(!t.sessionId)throw Error("Session ID missing");let s=await j;if(!s)throw Error("Stripe.js failed");let{error:n}=await s.redirectToCheckout({sessionId:t.sessionId});if(n)throw Error(n.message)}catch(e){v.oR.error("Purchase failed: ".concat(e instanceof Error?e.message:"Unknown error")),er(!1)}},[T,r,R,_]);return(0,s.jsx)("div",{ref:D,className:"relative w-full h-full bg-black flex items-center justify-center overflow-hidden group",children:es?(0,s.jsxs)("div",{className:"w-full h-full bg-black flex flex-col items-center justify-center text-white relative p-4",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center z-10",children:[(0,s.jsx)(c.A,{size:48,className:"mb-3 opacity-80"}),(0,s.jsx)("span",{className:"text-lg font-semibold mb-1",children:en?"Purchase to View":"Subscribe to View"}),en&&_&&(0,s.jsxs)(h.E,{variant:"secondary",className:"text-sm font-bold cursor-default mb-4",children:[w(_,null!=A?A:void 0)," "]})]}),en&&(0,s.jsxs)(x.$,{variant:"default",size:"sm",className:"mt-4 h-9 px-5 text-sm bg-pink-600 hover:bg-pink-700 text-white rounded-full absolute bottom-16 left-1/2 transform -translate-x-1/2 z-20",onClick:ec,disabled:et||!T,"aria-label":"Buy for ".concat(w(null!=_?_:0,null!=A?A:void 0)),children:[et?(0,s.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(d.A,{className:"mr-2 h-4 w-4"}),et?"Processing...":"Buy"]})]}):(0,s.jsxs)(s.Fragment,{children:[M&&(0,s.jsx)("div",{className:"text-white absolute z-10",children:"Loading..."}),q&&(0,s.jsx)("div",{className:"text-red-500 absolute z-10 p-4 text-center",children:q}),(0,s.jsx)("video",{ref:V,src:null!=F?F:void 0,poster:E,className:"w-full h-full object-contain ".concat(!F||M||q?"invisible":""),playsInline:!0,loop:!0,muted:Y,onClick:ea,onPlay:()=>X(!0),onPause:()=>X(!1),onLoadedMetadata:ei,onTimeUpdate:eo,onError:e=>console.error("Video Error (ID: ".concat(r,"):"),e.target.error)},F),!J&&F&&!M&&!q&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-auto z-10",children:(0,s.jsx)("button",{onClick:ea,className:"p-4 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors","aria-label":"Play",children:(0,s.jsx)(f.A,{size:60,fill:"currentColor"})})}),F&&!M&&!q&&(0,s.jsx)("button",{onClick:el,className:"absolute bottom-4 right-4 p-2 bg-black/40 rounded-full text-white z-20 pointer-events-auto","aria-label":Y?"Unmute":"Mute",children:Y?(0,s.jsx)(m.A,{size:18}):(0,s.jsx)(p.A,{size:18})}),(0,s.jsxs)("div",{className:"absolute inset-x-0 bottom-0 z-10 pointer-events-none bg-gradient-to-t from-black/60 via-black/30 to-transparent",children:[(0,s.jsxs)("div",{className:"p-4 flex justify-between items-end pointer-events-auto",children:[" ",(0,s.jsxs)("div",{className:"text-white max-w-[calc(100%-80px)]",children:[" ",(0,s.jsxs)("div",{className:"flex items-center gap-1.5 group cursor-pointer",onClick:e=>{console.log("Bottom-left profile clicked, navigating to OWN profile"),e.preventDefault(),e.stopPropagation(),B.push("/profile")},"aria-label":"View profile of ".concat(g),role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),B.push("/profile"))},children:[(0,s.jsxs)(i.eu,{className:"h-7 w-7 border border-gray-600 group-hover:scale-110 transition-transform",children:[(0,s.jsx)(i.BK,{src:null!=k?k:void 0,alt:null!=g?g:"User profile"}),(0,s.jsx)(i.q5,{children:null!=(t=null==g?void 0:g.charAt(0).toUpperCase())?t:"U"})]}),(0,s.jsxs)("span",{className:"font-bold text-sm hover:underline",children:["@",g]})]}),R&&!es&&_&&(0,s.jsxs)(h.E,{variant:"secondary",className:"mt-1 text-xs font-semibold cursor-default bg-green-600 hover:bg-green-700 text-white",children:["For Sale: ",w(_,null!=A?A:void 0)," "]})]}),(0,s.jsx)(b.M,{postId:r,userId:z,username:g,profilePictureUrl:null!=k?k:void 0,initialLikes:parseInt(I,10)||0,initialIsLiked:!1,commentsCount:S,sharesCount:P,initialIsPrivate:null!=U&&U,postType:"video",isOwner:null!=L&&L,videoCaption:null!=N?N:void 0,is_for_sale:R,price:_,currency:A})]})," "]})," "]})})}let N=n.memo(function(e){return(0,s.jsx)(k,{...e})});N.displayName="ClientVideoPlayerWrapper"},6126:(e,t,r)=>{r.d(t,{E:()=>o});var s=r(5155);r(2115);var n=r(2085),a=r(9434);let l=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:r,...n}=e;return(0,s.jsx)("div",{className:(0,a.cn)(l({variant:r}),t),...n})}}}]);