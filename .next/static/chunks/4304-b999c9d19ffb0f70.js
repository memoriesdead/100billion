"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4304],{333:(e,t,s)=>{s.d(t,{d:()=>n});var r=s(5155),i=s(2115),l=s(4884),a=s(9434);let n=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)(l.bL,{className:(0,a.cn)("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...i,ref:t,children:(0,r.jsx)(l.zi,{className:(0,a.cn)("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})});n.displayName=l.bL.displayName},2346:(e,t,s)=>{s.d(t,{w:()=>n});var r=s(5155),i=s(2115),l=s(7489),a=s(9434);let n=i.forwardRef((e,t)=>{let{className:s,orientation:i="horizontal",decorative:n=!0,...o}=e;return(0,r.jsx)(l.b,{ref:t,decorative:n,orientation:i,className:(0,a.cn)("shrink-0 bg-border","horizontal"===i?"h-[1px] w-full":"h-full w-[1px]",s),...o})});n.displayName=l.b.displayName},4165:(e,t,s)=>{s.d(t,{Cf:()=>m,Es:()=>x,HM:()=>u,L3:()=>h,c7:()=>f,lG:()=>o,rr:()=>g,zM:()=>c});var r=s(5155),i=s(2115),l=s(4645),a=s(5318),n=s(9434);let o=l.bL,c=l.l9,d=l.ZL,u=l.bm,p=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)(l.hJ,{ref:t,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...i})});p.displayName=l.hJ.displayName;let m=i.forwardRef((e,t)=>{let{className:s,children:i,...o}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(p,{}),(0,r.jsxs)(l.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...o,children:[i,(0,r.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(a.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=l.UC.displayName;let f=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};f.displayName="DialogHeader";let x=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};x.displayName="DialogFooter";let h=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)(l.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",s),...i})});h.displayName=l.hE.displayName;let g=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)(l.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...i})});g.displayName=l.VY.displayName},4304:(e,t,s)=>{s.d(t,{MainLayout:()=>S});var r=s(5155),i=s(2115),l=s(6874),a=s.n(l),n=s(6424),o=s(2346),c=s(9576),d=s(6927),u=s(1394);function p(){let{user:e}=(0,c.As)(),[t,s]=(0,i.useState)([]),[l,n]=(0,i.useState)(!0),[o,p]=(0,i.useState)(null);return((0,i.useEffect)(()=>{(async()=>{if(!e){n(!1),s([]);return}n(!0),p(null);try{let{data:t,error:r}=await d.N.from("relationships").select("\n            followed_uid,\n            profiles:profiles!relationships_followed_uid_fkey (\n              id,\n              username,\n              profile_picture_url\n            )\n          ").eq("follower_uid",e.id);if(r)throw r;let i=t?t.map(e=>e.profiles).filter(e=>null!==e&&"object"==typeof e&&"id"in e&&"username"in e&&"profile_picture_url"in e):[];s(i)}catch(e){e instanceof Error?e.message:String(e),console.error("Error fetching following list:",e),p("Failed to load following list.")}finally{n(!1)}})()},[e]),e)?l?(0,r.jsx)("div",{className:"px-4 py-2 text-sm text-muted-foreground",children:"Loading following..."}):o?(0,r.jsx)("div",{className:"px-4 py-2 text-sm text-destructive",children:o}):0===t.length?(0,r.jsx)("div",{className:"px-4 py-2 text-sm text-muted-foreground",children:"Not following anyone yet."}):(0,r.jsx)("div",{className:"space-y-2",children:t.map(e=>{var t,s,i,l,n;return(0,r.jsxs)(a(),{href:"/profile/".concat(e.username||e.id),className:"flex items-center gap-3 px-4 py-2 rounded-md transition-colors w-full text-foreground/80 hover:text-foreground hover:bg-secondary/50",children:[(0,r.jsxs)(u.eu,{className:"h-8 w-8",children:[(0,r.jsx)(u.BK,{src:null!=(s=e.profile_picture_url)?s:void 0,alt:null!=(i=e.username)?i:"User"}),(0,r.jsx)(u.q5,{children:null!=(l=null==(t=e.username)?void 0:t.charAt(0).toUpperCase())?l:"U"})]}),(0,r.jsx)("span",{className:"text-sm font-medium truncate",children:null!=(n=e.username)?n:"Unnamed User"})]},e.id)})}):null}var m=s(9911),f=s(748);function x(e){var t;let{toggleSearchPanel:s,deactivateSearch:i}=e,{user:l}=(0,c.As)(),d=l&&(null==(t=l.user_metadata)?void 0:t.username)?"/profile/".concat(l.user_metadata.username):"/profile";return(0,r.jsxs)("div",{className:"flex flex-col h-screen w-[240px] border-r border-border pb-4",children:[(0,r.jsx)("div",{className:"p-4 flex-shrink-0",children:(0,r.jsxs)(a(),{href:"/",className:"flex items-center",onClick:i,children:[" ",(0,r.jsx)("span",{className:"text-xl font-bold",children:"SubScroll"})]})}),(0,r.jsxs)(n.F,{className:"flex-1 px-4",children:[(0,r.jsxs)("div",{className:"space-y-2 py-2",children:[(0,r.jsxs)("button",{onClick:s,className:"flex items-center gap-3 px-4 py-4 rounded-md transition-colors w-full text-foreground/80 hover:text-foreground hover:bg-secondary/50",children:[(0,r.jsx)(m.KSO,{size:20}),(0,r.jsx)("span",{className:"text-base",children:"Search"})]}),(0,r.jsx)(h,{href:"/",icon:(0,r.jsx)(m.rQ8,{size:20}),label:"For You",onClick:i}),(0,r.jsx)(h,{href:"/explore",icon:(0,r.jsx)(m.iq2,{size:20}),label:"Explore",onClick:i}),(0,r.jsx)(h,{href:"/following",icon:(0,r.jsx)(f.h7B,{size:20}),label:"Following",onClick:i}),(0,r.jsx)(h,{href:"/messages",icon:(0,r.jsx)(m.maD,{size:20}),label:"Messages",onClick:i})," ",(0,r.jsx)(h,{href:"/upload",icon:(0,r.jsx)(m.HiP,{size:20}),label:"Upload",onClick:i})," ",(0,r.jsx)(h,{href:d,icon:(0,r.jsx)(m.x$1,{size:20}),label:"Profile",onClick:i})]}),(0,r.jsx)(o.w,{className:"my-4"}),(0,r.jsx)(g,{title:"Following",children:(0,r.jsx)(p,{})})]})]})}function h(e){let{href:t,icon:s,label:i,active:l,onClick:n}=e;return(0,r.jsxs)(a(),{href:t,onClick:n,className:"flex items-center gap-3 px-4 py-4 rounded-md transition-colors w-full ".concat(l?"font-semibold bg-secondary":"text-foreground/80 hover:text-foreground hover:bg-secondary/50"),children:[s,(0,r.jsx)("span",{className:"text-base",children:i})]})}function g(e){let{title:t,children:s}=e;return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"text-xs uppercase tracking-wider text-muted-foreground",children:t}),(0,r.jsx)("div",{className:"space-y-1",children:s})]})}var j=s(285),v=s(5695);function b(){var e,t,s,i,l,n,o,d;let{user:p,loading:f,signInWithGoogle:x,signOut:h}=(0,c.As)();(0,v.useRouter)();let g=async()=>{await x()},b=async()=>{await h()};return(0,r.jsxs)("header",{className:"fixed top-0 right-0 left-[240px] h-16 flex items-center justify-end px-6 bg-background/95 backdrop-blur-sm z-10",children:[" ",(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(a(),{href:"/upload",children:(0,r.jsx)(j.$,{variant:"outline",className:"border-primary text-primary hover:bg-primary/10 font-semibold",children:"Upload"})}),f?(0,r.jsx)(j.$,{disabled:!0,children:"Loading..."}):p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a(),{href:"/profile/".concat((null==(e=p.user_metadata)?void 0:e.username)||p.id),passHref:!0,children:(0,r.jsxs)(u.eu,{className:"h-8 w-8 cursor-pointer",children:[(0,r.jsx)(u.BK,{src:(null==(t=p.user_metadata)?void 0:t.avatar_url)||void 0,alt:(null==(s=p.user_metadata)?void 0:s.full_name)||p.email||"User"}),(0,r.jsx)(u.q5,{children:(null==(n=p.user_metadata)||null==(l=n.username)||null==(i=l.charAt(0))?void 0:i.toUpperCase())||(null==(d=p.email)||null==(o=d.charAt(0))?void 0:o.toUpperCase())||"U"})]})}),(0,r.jsx)(j.$,{onClick:b,variant:"outline",children:"Log out"})]}):(0,r.jsx)(j.$,{onClick:g,className:"tiktok-button px-4 py-2 flex items-center gap-2",children:(0,r.jsxs)("span",{children:[(0,r.jsx)(m.DSS,{})," Log in"]})}),(0,r.jsx)(j.$,{variant:"ghost",size:"icon",children:(0,r.jsx)(m.H_v,{})})]})]})}var y=s(2523),N=s(5964),_=s.n(N);function w(e){let{isVisible:t,setActiveSearchQuery:s,setIsSearchActive:l,closePanel:n}=e;(0,v.useRouter)();let[o,c]=(0,i.useState)(""),[p,f]=(0,i.useState)([]),[x,h]=(0,i.useState)(!1),[g,b]=(0,i.useState)(!0),N=(0,i.useRef)(null),w=(0,i.useCallback)(_()(async e=>{if(e.trim().length<1){f([{type:"text",data:"metal sonic edit"},{type:"text",data:"meta quest 3"}]),h(!1);return}h(!0);let t=[];try{let{data:s,error:r}=await d.N.from("profiles").select("id, username, name, profile_picture_url").or("username.ilike.%".concat(e,"%,name.ilike.%").concat(e,"%")).limit(4);r?console.error("Profile suggestion error:",r):s&&(t=t.concat(s.map(e=>({type:"profile",data:e}))));let i=["metal sonic edit","metal gear solid","meta quest 3","metallica"].filter(t=>t.toLowerCase().includes(e.toLowerCase())).slice(0,6);(t=t.concat(i.map(e=>({type:"text",data:e})))).sort((e,t)=>"text"===e.type&&"profile"===t.type?-1:+("profile"===e.type&&"text"===t.type)),f(t)}catch(e){console.error("Error fetching suggestions:",e),f([])}finally{h(!1)}},300),[]);(0,i.useEffect)(()=>(w(o),()=>w.cancel()),[o,w]);let k=e=>{let t=e.trim();t&&(c(t),s(t),l(!0))},S=e=>{k(e)},C=()=>{n()};return(0,r.jsxs)("div",{ref:N,className:"fixed left-[240px] top-0 w-[350px] h-full bg-background border-r border-border z-20 flex flex-col shadow-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-border flex-shrink-0",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Search"}),(0,r.jsx)(j.$,{variant:"ghost",size:"icon",onClick:n,"aria-label":"Close search",children:(0,r.jsx)(m.QCr,{className:"h-5 w-5 text-muted-foreground"})})]}),(0,r.jsx)("div",{className:"p-4 flex-shrink-0",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(y.p,{type:"text",placeholder:"Search accounts and videos",value:o,onChange:e=>{let t=e.target.value;c(t),s(t),l(!0)},onKeyDown:e=>"Enter"===e.key&&k(o),className:"bg-secondary border-0 pl-10 pr-10 h-10 rounded-md text-sm focus-visible:ring-1 focus-visible:ring-primary",autoFocus:!0}),(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-muted-foreground pointer-events-none",children:(0,r.jsx)(m.KSO,{size:16})}),o&&(0,r.jsx)(j.$,{type:"button",variant:"ghost",size:"icon",className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground hover:text-foreground h-10 w-10",onClick:()=>{c(""),s(""),f([]),w.cancel()},"aria-label":"Clear search",children:(0,r.jsx)(m.QCr,{className:"h-4 w-4"})})]})}),(0,r.jsxs)("div",{className:"flex-grow overflow-y-auto px-4 pb-4",children:[x&&0===p.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center p-4 text-sm",children:"Searching..."}),!x&&0===p.length&&o.trim().length>0&&(0,r.jsxs)("p",{className:"text-muted-foreground text-center p-4 text-sm",children:['No results found for "',o,'"']}),p.length>0&&(0,r.jsxs)("ul",{className:"space-y-1",children:[p.filter(e=>"text"===e.type).map((e,t)=>(0,r.jsx)("li",{children:(0,r.jsxs)("button",{onClick:()=>S(e.data),className:"flex items-center gap-3 w-full text-left p-2 rounded hover:bg-secondary transition-colors",children:[(0,r.jsx)(m.KSO,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),(0,r.jsx)("span",{className:"text-sm text-foreground truncate",children:e.data})]})},"text-".concat(t))),p.filter(e=>"profile"===e.type).length>0&&(0,r.jsx)("li",{className:"px-2 pt-3 pb-1 text-xs font-semibold text-muted-foreground uppercase",children:"Accounts"}),p.filter(e=>"profile"===e.type).map(e=>{var t,s;let i=e.data;return(0,r.jsx)("li",{children:(0,r.jsxs)(a(),{href:"/profile/".concat(i.username),onClick:C,className:"flex items-center gap-3 p-2 rounded hover:bg-secondary transition-colors",children:[(0,r.jsxs)(u.eu,{className:"h-8 w-8",children:[(0,r.jsx)(u.BK,{src:i.profile_picture_url||void 0,alt:i.username||"User"}),(0,r.jsx)(u.q5,{className:"text-xs",children:(null==(s=i.username)||null==(t=s.charAt(0))?void 0:t.toUpperCase())||"U"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-sm text-foreground",children:i.username}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:i.name})]})]})},i.id)})]}),o.trim()&&!x&&(0,r.jsx)("div",{className:"mt-4 pt-4 border-t border-border",children:(0,r.jsxs)("button",{onClick:()=>k(o),className:"flex items-center gap-3 w-full text-left p-2 rounded hover:bg-secondary transition-colors text-primary",children:[(0,r.jsx)(m.KSO,{className:"w-4 h-4"}),(0,r.jsxs)("span",{className:"text-sm font-medium",children:['View all results for "',o,'"']})]})}),!o.trim()&&!x&&0===p.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center p-4 text-sm",children:"Search for accounts or videos."})]})]})}var k=s(4352);function S(e){let{children:t}=e,[s,l]=(0,i.useState)(""),[a,n]=(0,i.useState)(!1),[o,c]=(0,i.useState)(!1);return(0,r.jsxs)("div",{className:"flex min-h-screen bg-background",children:[(0,r.jsx)("div",{className:"fixed left-0 top-0 w-[240px] h-full z-30",children:(0,r.jsx)(x,{toggleSearchPanel:()=>{c(e=>!e)},deactivateSearch:()=>{n(!1),c(!1),l("")}})}),o&&(0,r.jsx)(w,{isVisible:o,setActiveSearchQuery:l,setIsSearchActive:n,closePanel:()=>c(!1)}),(0,r.jsxs)("div",{className:"w-full transition-all duration-200 ease-in-out ".concat(o?"ml-[540px]":"ml-[240px]"),children:[" ",(0,r.jsx)("div",{className:"fixed top-0 right-0 transition-all duration-200 ease-in-out z-10 ".concat(o?"left-[540px]":"left-[240px]"),children:(0,r.jsx)(b,{})}),(0,r.jsx)("div",{className:"w-full pt-14 h-[calc(100vh-theme(space.14))] overflow-y-auto",children:a&&s.trim()?(0,r.jsx)(k.Y,{searchQuery:s}):t})]})]})}},4352:(e,t,s)=>{s.d(t,{Y:()=>S});var r=s(5155),i=s(2115),l=s(5695),a=s(6927),n=s(9576),o=s(3762),c=s(8489),d=s(285),u=s(1573),p=s(5943),m=s(7223),f=s(4165),x=s(6715),h=s(5041),g=s(5057),j=s(2523),v=s(333),b=s(8390),y=s(172),N=s(3568),_=s(760),w=s(4266);function k(e){let{isOpen:t,onOpenChange:s,postData:l,onSaveSuccess:o}=e,c=(0,x.jE)(),{user:u}=(0,n.As)(),[p,m]=(0,i.useState)(!1),[k,S]=(0,i.useState)(""),[C,P]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(l){var e;m(null!=(e=l.is_for_sale)&&e),S(l.price?(l.price/100).toFixed(2):""),P(null)}},[l]);let E=(0,h.n)({mutationFn:async e=>{if(!l)throw Error("No post data available for update.");P(null);let t={is_for_sale:e.is_for_sale,price:e.is_for_sale?e.newPriceInCents:null,currency:e.is_for_sale?"usd":null,stripe_product_id:e.is_for_sale?l.stripe_product_id:null,stripe_price_id:e.is_for_sale?l.stripe_price_id:null},{error:s}=await a.N.from("posts").update(t).eq("id",l.id);if(s)throw s},onSuccess:()=>{N.oR.success("Post sale status updated!"),c.invalidateQueries({queryKey:["posts"]}),c.invalidateQueries({queryKey:["posts",null==l?void 0:l.user_id]}),c.invalidateQueries({queryKey:["homeFeedPosts",null==u?void 0:u.id]}),o&&o(),s(!1)},onError:e=>{let t=e instanceof Error?e.message:String(e);console.error("Failed to update post sale status:",e),P(t||"Failed to update post."),N.oR.error("Update failed: ".concat(t))}});return l?(0,r.jsx)(f.lG,{open:t,onOpenChange:s,children:(0,r.jsxs)(f.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(f.c7,{children:[(0,r.jsx)(f.L3,{children:"Edit Post Sale Status"}),(0,r.jsx)(f.rr,{children:"Update whether this post is for sale and set its price."})]}),(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!l)return;let t=null;if(p){if(!k||isNaN(parseFloat(k)))return void P("Please enter a valid price.");if((t=Math.round(100*parseFloat(k)))<50)return void P("Price must be at least $".concat("0.50","."))}let s={is_for_sale:p,newPriceInCents:p?t:null};E.mutate(s)},children:[(0,r.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between space-x-2",children:[(0,r.jsxs)(g.J,{htmlFor:"sale-switch-edit",className:"flex flex-col space-y-1",children:[(0,r.jsx)("span",{children:"Mark as For Sale"}),(0,r.jsx)("span",{className:"font-normal leading-snug text-muted-foreground",children:"Enable this to set a price for direct purchase."})]}),(0,r.jsx)(v.d,{id:"sale-switch-edit",checked:p,onCheckedChange:m,disabled:E.isPending})]}),(0,r.jsx)(_.N,{children:p&&(0,r.jsxs)(w.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden space-y-2",children:[(0,r.jsx)(g.J,{htmlFor:"sale-price-edit",children:"Price (USD)"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(b.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,r.jsx)(j.p,{id:"sale-price-edit",type:"number",value:k,onChange:e=>S(e.target.value),placeholder:"e.g., 5.00",className:"pl-8",step:"0.01",min:"0.50",disabled:E.isPending,required:p})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Minimum price is $","0.50","."]})]},"price-input-edit")}),C&&(0,r.jsx)("p",{className:"text-sm text-red-600 text-center",children:C})]}),(0,r.jsxs)(f.Es,{children:[(0,r.jsx)(f.HM,{asChild:!0,children:(0,r.jsx)(d.$,{type:"button",variant:"outline",disabled:E.isPending,children:"Cancel"})}),(0,r.jsxs)(d.$,{type:"submit",disabled:E.isPending,children:[E.isPending&&(0,r.jsx)(y.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})]})}):null}function S(e){let{userId:t,searchQuery:s,followedUserIds:h,allowDeletion:g=!1}=e,j=(0,l.useRouter)(),{user:v}=(0,n.As)(),b=(0,x.jE)(),[y,_]=(0,i.useState)([]),[w,S]=(0,i.useState)(!0),[C,P]=(0,i.useState)(null),[E,U]=(0,i.useState)(null),[z,L]=(0,i.useState)(!1),[F,A]=(0,i.useState)(null),[q,R]=(0,i.useState)(!1),[I,D]=(0,i.useState)(null),$=(0,i.useCallback)(async e=>{if(!E){U(e),P(null);try{if(!y.find(t=>t.id===e))throw Error("Post not found.");let{error:s}=await a.N.from("posts").delete().eq("id",e);if(s)throw s;_(t=>t.filter(t=>t.id!==e)),b.invalidateQueries({queryKey:["posts",t]})}catch(t){let e=t instanceof Error?t.message:String(t);P("Failed to delete post: ".concat(e))}finally{U(null),A(null),L(!1)}}},[y,E,b,t]);if((0,i.useEffect)(()=>{(async()=>{S(!0),P(null);try{let e=a.N.from("posts").select("\n            id, user_id, caption, type, video_url, image_url, thumbnail_url,\n            likes_count, comments_count, is_private, is_for_sale, price,\n            currency, stripe_price_id, stripe_product_id,\n            profiles (username, profile_picture_url)\n          ").order("created_at",{ascending:!1});e=t?e.eq("user_id",t):(null==s?void 0:s.trim())?e.ilike("caption","%".concat(s,"%")).eq("is_private",!1):h&&h.length>0?e.in("user_id",h):e.eq("is_private",!1).eq("is_for_sale",!1);let{data:r,error:i}=await e;if(i)throw i;if(null==r?void 0:r.length){let e=r.map(e=>{var t,s,r;return{...e,profiles:e.profiles,likes_count:null!=(t=e.likes_count)?t:0,comments_count:null!=(s=e.comments_count)?s:0,is_private:e.is_private,is_for_sale:null!=(r=e.is_for_sale)&&r,price:e.price,currency:e.currency,stripe_price_id:e.stripe_price_id,stripe_product_id:e.stripe_product_id}});_(e)}else _([])}catch(e){P((e instanceof Error?e.message:String(e))||"Error fetching posts."),_([])}finally{S(!1)}})()},[t,s,h]),w)return(0,r.jsx)("div",{className:"text-center p-4",children:"Loading posts..."});if(C)return(0,r.jsx)("div",{className:"text-center text-red-500 p-4",children:C});if(0===y.length)return(0,r.jsx)("div",{className:"text-center text-muted-foreground p-4",children:"No posts found."});let K=e=>{A(e),L(!0)},O=e=>{D(e),R(!0)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-4",children:y.map(e=>{var t,s,i,l,a,n,f,x,h;let b,y=(null==v?void 0:v.id)===e.user_id,_=e.is_private&&!y,w=!_;return b="video"===e.type&&e.video_url?(0,r.jsx)(o.Z,{id:e.id,userId:e.user_id,username:(null==(t=e.profiles)?void 0:t.username)||"Unknown User",profilePictureUrl:(null==(s=e.profiles)?void 0:s.profile_picture_url)||void 0,caption:e.caption||"",videoSrc:e.video_url,likes:(null!=(i=e.likes_count)?i:0).toString(),comments:(null!=(l=e.comments_count)?l:0).toString(),shares:"0",isPrivate:e.is_private,isOwner:y,is_for_sale:e.is_for_sale,price:e.price,currency:e.currency,stripe_price_id:e.stripe_price_id,isLocked:null===_?void 0:_,isPaidContent:null===e.is_private?void 0:e.is_private}):"image"===e.type&&e.image_url?(0,r.jsx)(c.S,{id:e.id,userId:e.user_id,username:(null==(a=e.profiles)?void 0:a.username)||"Unknown User",profilePictureUrl:(null==(n=e.profiles)?void 0:n.profile_picture_url)||void 0,caption:e.caption,imageUrl:e.image_url,likes:null!=(f=e.likes_count)?f:0,comments:(null!=(x=e.comments_count)?x:0).toString(),shares:"0",isPrivate:null!=(h=e.is_private)&&h,isOwner:y,initialIsLiked:!1,is_for_sale:e.is_for_sale,price:e.price,currency:e.currency,stripe_price_id:e.stripe_price_id,isLocked:null===_?void 0:_,isPaidContent:null===e.is_private?void 0:e.is_private}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-800 text-white text-xs p-2",children:"Invalid post data"}),(0,r.jsxs)("div",{className:"aspect-[9/16] overflow-hidden rounded-lg relative group bg-black cursor-pointer",onClick:()=>{if(w){let t="video"===e.type?"/video/".concat(e.id):"/image/".concat(e.id);j.push(t)}else(0,N.oR)("Subscription required to view this content.")},children:[(0,r.jsxs)(r.Fragment,{children:[b,!w&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10 pointer-events-none",children:(0,r.jsx)(u.A,{className:"h-10 w-10 text-white/80"})})]}),g&&y&&(0,r.jsxs)("div",{className:"absolute top-2 left-2 z-40 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,r.jsx)(d.$,{variant:"outline",size:"icon",className:"h-7 w-7 bg-black/50 hover:bg-black/70 border-white/30 text-white",onClick:t=>{t.stopPropagation(),t.preventDefault(),O(e)},"aria-label":"Edit post",children:(0,r.jsx)(p.A,{className:"h-4 w-4"})}),(0,r.jsx)(d.$,{variant:"destructive",size:"icon",className:"h-7 w-7 bg-black/50 hover:bg-red-700",onClick:t=>{t.stopPropagation(),t.preventDefault(),K(e.id)},disabled:E===e.id,"aria-label":"Delete post",children:E===e.id?(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"}):(0,r.jsx)(m.A,{className:"h-4 w-4"})})]}),E===e.id&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white z-50",children:"Deleting..."})]},e.id)})}),(0,r.jsx)(f.lG,{open:z,onOpenChange:L,children:(0,r.jsxs)(f.Cf,{children:[(0,r.jsxs)(f.c7,{children:[(0,r.jsx)(f.L3,{children:"Confirm Deletion"}),(0,r.jsx)(f.rr,{children:"Are you sure you want to permanently delete this post? This action cannot be undone."})]}),(0,r.jsxs)(f.Es,{children:[(0,r.jsx)(d.$,{variant:"outline",onClick:()=>L(!1),disabled:!!E,children:"Cancel"}),(0,r.jsx)(d.$,{variant:"destructive",onClick:()=>{F&&$(F)},disabled:!!E,children:E?"Deleting...":"Delete Post"})]})]})}),I&&(0,r.jsx)(k,{isOpen:q,onOpenChange:R,postData:{id:I.id,user_id:I.user_id,caption:I.caption,is_for_sale:I.is_for_sale,price:I.price,currency:I.currency,stripe_product_id:I.stripe_product_id,stripe_price_id:I.stripe_price_id},onSaveSuccess:()=>{b.invalidateQueries({queryKey:["posts",t]}),b.invalidateQueries({queryKey:["posts"]}),D(null)}})]})}},5057:(e,t,s)=>{s.d(t,{J:()=>c});var r=s(5155),i=s(2115),l=s(968),a=s(2085),n=s(9434);let o=(0,a.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)(l.b,{ref:t,className:(0,n.cn)(o(),s),...i})});c.displayName=l.b.displayName},6424:(e,t,s)=>{s.d(t,{F:()=>n});var r=s(5155),i=s(2115),l=s(7655),a=s(9434);let n=i.forwardRef((e,t)=>{let{className:s,children:i,...n}=e;return(0,r.jsxs)(l.bL,{ref:t,className:(0,a.cn)("relative overflow-hidden",s),...n,children:[(0,r.jsx)(l.LM,{className:"h-full w-full rounded-[inherit]",children:i}),(0,r.jsx)(o,{}),(0,r.jsx)(l.OK,{})]})});n.displayName=l.bL.displayName;let o=i.forwardRef((e,t)=>{let{className:s,orientation:i="vertical",...n}=e;return(0,r.jsx)(l.VM,{ref:t,orientation:i,className:(0,a.cn)("flex touch-none select-none transition-colors","vertical"===i&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===i&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...n,children:(0,r.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});o.displayName=l.VM.displayName},8489:(e,t,s)=>{s.d(t,{S:()=>v});var r=s(5155),i=s(2115),l=s(6874),a=s.n(l),n=s(5695),o=s(833),c=s(172),d=s(4815),u=s(285),p=s(6126),m=s(7368),f=s(3568),x=s(9911),h=s(9509);let g=(0,m.c)(h.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY),j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"usd";return new Intl.NumberFormat("en-US",{style:"currency",currency:t.toUpperCase()}).format(e/100)};function v(e){let{id:t,userId:s,username:l,profilePictureUrl:m,caption:h,imageUrl:v,likes:b,comments:y,shares:N,isPrivate:_,isOwner:w,initialIsLiked:k,is_for_sale:S,price:C,currency:P,stripe_price_id:E,isLocked:U}=e;(0,n.useRouter)();let[z,L]=(0,i.useState)(!1);l.charAt(0).toUpperCase();let F=S||U,A=async e=>{if(e.preventDefault(),e.stopPropagation(),!S)return;L(!0);let s="";try{let e=await fetch("/api/stripe/create-item-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:t})}),r=await e.json();if(s=r.sessionId,!e.ok||!s)throw Error(r.error||"Failed to create session.");let i=await g;if(!i)throw Error("Stripe.js failed.");let{error:l}=await i.redirectToCheckout({sessionId:s});if(l)throw Error(l.message||"Redirect failed.")}catch(t){let e=t instanceof Error?t.message:"Unknown error.";f.oR.error("Purchase failed: ".concat(e)),s&&console.error("Session ID:",s)}finally{L(!1)}};function q(){return(0,r.jsxs)("div",{className:"relative w-full h-full bg-black flex items-center justify-center overflow-hidden",children:[F?(0,r.jsx)("div",{className:"w-full h-full bg-black"}):(0,r.jsx)("img",{src:v,alt:h||"User uploaded image",className:"w-full h-full object-contain",loading:"lazy"}),S&&(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none",children:[(0,r.jsx)(x.JhU,{className:"text-4xl mb-2 text-white"}),(0,r.jsx)("span",{className:"text-sm font-semibold text-white",children:"Purchase to View"}),C&&P&&(0,r.jsx)(p.E,{variant:"secondary",className:"mt-1.5 text-sm font-bold",children:j(C,P)}),z&&(0,r.jsx)(c.A,{className:"absolute top-4 right-4 h-5 w-5 animate-spin text-white"})]}),U&&!S&&(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none bg-black/60",children:[(0,r.jsx)(x.JhU,{className:"text-4xl mb-2 text-white"}),(0,r.jsx)("span",{className:"text-xs font-semibold text-white",children:"Subscribe to View"})]}),!F&&h&&(0,r.jsx)("div",{className:"absolute inset-x-0 bottom-0 z-10 p-4 pointer-events-none bg-gradient-to-t from-black/60 via-black/30 to-transparent",children:(0,r.jsx)("p",{className:"text-white text-sm truncate",children:h})})]})}return(0,r.jsxs)("div",{className:"relative w-full h-full bg-black flex items-center justify-center overflow-hidden group",children:[F?(0,r.jsx)("div",{className:"block w-full h-full cursor-default",children:(0,r.jsx)(q,{})}):(0,r.jsx)(a(),{href:"/image/".concat(t),className:"block w-full h-full",children:(0,r.jsx)(q,{})}),(0,r.jsx)(o.M,{postId:t,userId:s,username:l,profilePictureUrl:m,initialLikes:b,initialIsLiked:k,commentsCount:y,sharesCount:N,initialIsPrivate:null!=_&&_,isOwner:w,postType:"image",is_for_sale:S,price:C,currency:P}),S&&(0,r.jsxs)(u.$,{variant:"default",size:"sm",className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-30 h-8 px-4 text-sm bg-pink-600 hover:bg-pink-700 text-white rounded-full",onClick:A,disabled:z,"aria-label":"Buy ".concat(h||"image"),children:[z?(0,r.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(d.A,{className:"mr-2 h-4 w-4"}),z?"Processing...":"Buy"]})]})}}}]);